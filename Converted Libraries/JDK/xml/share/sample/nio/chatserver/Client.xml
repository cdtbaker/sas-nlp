<?xml version="1.0" encoding="UTF-8"?>
    <source package="">
        <import package="java.io.IOException"/>
        <import package="java.nio.ByteBuffer"/>
        <import package="java.nio.channels.AsynchronousSocketChannel"/>
        <import package="java.nio.channels.CompletionHandler"/>
        <import package="java.util.LinkedList"/>
        <import package="java.util.Queue"/>
        <import package="java.util.concurrent.atomic.AtomicReference"/>
        <class name="Client" line="40">
            <javadoc line="40">
                Client represents a remote connection to the chat server.
                  It contains methods for reading and writing messages from the
                  channel.
                  Messages are considered to be separated by newline, so incomplete
                  messages are buffered in the {@code Client}.
                  All reads and writes are asynchronous and uses the nio2 asynchronous
                  elements.                
            </javadoc>
            <declaration name="channel" type="AsynchronousSocketChannel" line="51"/>
            <declaration name="reader" type="AtomicReference&amp;lt;ClientReader&amp;gt;" line="52"/>
            <declaration name="userName" type="String" line="53"/>
            <declaration name="messageBuffer" type="StringBuilder" line="54"/>
            <declaration name="queue" type="Queue&amp;lt;ByteBuffer&amp;gt;" line="56"/>
            <declaration name="writing" type="boolean" line="57"/>
            <method name="Client" type="constructor" line="59">
                <params>
                    <param name="channel" type="AsynchronousSocketChannel"/>
                    <param name="reader" type="ClientReader"/>
                </params>
            </method>
            <javadoc line="64">
                Enqueues a write of the buffer to the channel.
                  The call is asynchronous so the buffer is not safe to modify after
                  passing the buffer here.                
                <param>
                    buffer the buffer to send to the channel                    
                </param>
            </javadoc>
            <method name="writeMessage" type="void" line="71">
                <params>
                    <param name="buffer" type="ByteBuffer"/>
                </params>
                <comment line="77">
                    Currently no thread writing, make this thread dispatch a write                    
                </comment>
                <declaration name="threadShouldWrite" type="boolean" line="72"/>
                <scope line="74">
                    <scope line="77"/>
                </scope>
                <scope line="83"/>
            </method>
            <method name="writeFromQueue" type="void" line="88">
                <comment line="99">
                    No new data in buffer to write                    
                </comment>
                <declaration name="buffer" type="ByteBuffer" line="89"/>
                <scope line="91">
                    <scope line="93"/>
                </scope>
                <scope line="99"/>
            </method>
            <method name="writeBuffer" type="void" line="104">
                <params>
                    <param name="buffer" type="ByteBuffer"/>
                </params>
                <comment line="112">
                    Go back and check if there is new data to write                    
                </comment>
                <anonymous_class line="105">
                    <method name="completed" type="void" line="107">
                        <params>
                            <param name="result" type="Integer"/>
                            <param name="buffer" type="ByteBuffer"/>
                        </params>
                        <comment line="112">
                            Go back and check if there is new data to write                            
                        </comment>
                        <scope line="108"/>
                        <scope line="110"/>
                    </method>
                    <method name="failed" type="void" line="117">
                        <params>
                            <param name="exc" type="Throwable"/>
                            <param name="attachment" type="ByteBuffer"/>
                        </params>
                    </method>
                </anonymous_class>
            </method>
            <javadoc line="122">
                Sends a message                
                <param>
                    string the message                    
                </param>
            </javadoc>
            <method name="writeStringMessage" type="void" line="126">
                <params>
                    <param name="string" type="String"/>
                </params>
            </method>
            <javadoc line="130">
                Send a message from a specific client                
                <param>
                    client the message is sent from                    
                </param>
                <param>
                    message to send                    
                </param>
            </javadoc>
            <method name="writeMessageFrom" type="void" line="135">
                <params>
                    <param name="client" type="Client"/>
                    <param name="message" type="String"/>
                </params>
                <scope line="136"/>
            </method>
            <javadoc line="141">
                Enqueue a read                
                <param>
                    completionHandler callback on completed read                    
                </param>
            </javadoc>
            <method name="read" type="void" line="145">
                <params>
                    <param name="completionHandler" type="CompletionHandler&lt;Integer,? super ByteBuffer&gt;"/>
                </params>
                <declaration name="input" type="ByteBuffer" line="146"/>
                <scope line="147"/>
            </method>
            <javadoc line="153">
                Closes the channel                
            </javadoc>
            <method name="close" type="void" line="156">
                <scope line="157"/>
                <scope line="159"/>
            </method>
            <javadoc line="164">
                Run the current states actions.                
            </javadoc>
            <method name="run" type="void" line="167"/>
            <method name="setUserName" type="void" line="171">
                <params>
                    <param name="userName" type="String"/>
                </params>
            </method>
            <method name="setReader" type="void" line="175">
                <params>
                    <param name="reader" type="ClientReader"/>
                </params>
            </method>
            <method name="getUserName" type="String" line="179"/>
            <method name="appendMessage" type="void" line="183">
                <params>
                    <param name="message" type="String"/>
                </params>
                <scope line="184"/>
            </method>
            <javadoc line="189">
                @return the next newline separated message in the buffer. null is returned if the buffer
                  doesn&apos;t contain any newline.                
            </javadoc>
            <method name="nextMessage" type="String" line="193">
                <scope line="194">
                    <declaration name="nextNewline" type="int" line="195"/>
                    <scope line="196"/>
                    <declaration name="message" type="String" line="199"/>
                </scope>
            </method>
        </class>
    </source>