<?xml version="1.0" encoding="UTF-8"?>
    <source package="com.sun.servicetag">
        <import package="java.io"/>
        <import package="java.util.ArrayList"/>
        <import package="java.util.Date"/>
        <import package="java.util.HashSet"/>
        <import package="java.util.List"/>
        <import package="java.util.Properties"/>
        <import package="java.util.Set"/>
        <import package="com.sun.servicetag.Util"/>
        <import package="com.sun.servicetag.RegistrationDocument"/>
        <class name="Registry" line="39">
            <comment line="64">
                stclient exit value (see sthelper.h)                
            </comment>
            <comment line="68">
                The stclient output has to be an exported interface                
            </comment>
            <comment line="75">
                System properties for testing                
            </comment>
            <comment line="214">
                Returns null if the service tag record not found;
                 or throw UnauthorizedAccessException or IOException
                 based on the exitValue.                
            </comment>
            <javadoc line="39">
                A service tag registry is a XML-based registry containing
                  the list of {@link ServiceTag service tags} installed in the system.
                  The {@code Registry} class provides interfaces
                  to add, remove, update, and get a service tag from a service tag
                  registry.
                  This {@code Registry} class may not be supported
                  on all systems. The {@link #isSupported} method
                  can be called to determine if it is supported.
                  &lt;p&gt;
                  A registry may implement restrictions to only allow certain users
                  to {@link #updateServiceTag update} and
                  to {@link #removeServiceTag remove} a service tag record. Typically,
                  only the owner of the service tag, the owner of the registry
                  and superuser are authorized to update or remove a service tag in
                  the registry.                
                <see>
                    <a href="https://sn-tools.central.sun.com/twiki/bin/view/ServiceTags/ServiceTagDevGuideHelper">
                      Service Tag User Guide</a>                    
                </see>
            </javadoc>
            <declaration name="STCLIENT_SOLARIS" type="String" line="61"/>
            <declaration name="STCLIENT_LINUX" type="String" line="62"/>
            <declaration name="ST_ERR_NOT_AUTH" type="int" line="64"/>
            <declaration name="ST_ERR_REC_NOT_FOUND" type="int" line="65"/>
            <declaration name="INSTANCE_URN_DESC" type="String" line="68"/>
            <declaration name="initialized" type="boolean" line="69"/>
            <declaration name="stclient" type="File" line="70"/>
            <declaration name="stclientPath" type="String" line="71"/>
            <declaration name="registry" type="Registry" line="72"/>
            <declaration name="SVCTAG_STCLIENT_CMD" type="String" line="75"/>
            <declaration name="SVCTAG_STHELPER_SUPPORTED" type="String" line="76"/>
            <method name="Registry" type="constructor" line="78"/>
            <method name="getSTclient" type="String" line="81">
                <comment line="84">
                    Initialization to determine the platform&apos;s stclient pathname                    
                </comment>
                <comment line="100">
                    default                    
                </comment>
                <comment line="102">
                    the system property always overrides the default setting                    
                </comment>
                <comment line="107">
                    disable system registry                    
                </comment>
                <comment line="111">
                    This is only used for testing                    
                </comment>
                <comment line="117">
                    com.sun.servicetag package has to be compiled with JDK 5 as well
                     JDK 5 doesn&apos;t support the File.canExecute() method.
                     Risk not checking isExecute() for the stclient command is very low.                    
                </comment>
                <scope line="82">
                    <declaration name="os" type="String" line="84"/>
                    <scope line="85"/>
                    <scope line="87"/>
                    <scope line="89"/>
                    <scope line="91">
                        <scope line="92"/>
                    </scope>
                </scope>
                <declaration name="supportsHelperClass" type="boolean" line="99"/>
                <scope line="100"/>
                <scope line="105"/>
                <declaration name="path" type="String" line="111"/>
                <scope line="112"/>
                <scope line="119"/>
            </method>
            <javadoc line="125">
                Returns the system service tag registry. The {@code Registry} class
                  may not be supported on some platforms; use the {@link #isSupported}method to determine if it is supported.                
                <return>
                    the {@code Registry} object for the system service tag registry.                    
                </return>
                <throws>
                    UnsupportedOperationException if the {@code Registry} class is
                      not supported.                    
                </throws>
            </javadoc>
            <method name="getSystemRegistry" type="Registry" line="135">
                <scope line="136"/>
                <scope line="138"/>
            </method>
            <javadoc line="143">
                Returns {@code true} if the {@code Registry} class is supported on this system.                
                <return>
                    {@code true} if the {@code Registry} class is supported;
                      otherwise, return {@code false}.                    
                </return>
            </javadoc>
            <method name="isSupported" type="boolean" line="149"/>
            <method name="getCommandList" type="List<String>" line="153">
                <comment line="155">
                    Set up the arguments to call stclient                    
                </comment>
                <comment line="158">
                    This is for jtreg testing use. This will be set to something
                     like:
                     $JAVA_HOME/bin/java -cp $TEST_DIR \
                        -Dstclient.registry.path=$TEST_DIR/registry.xml \
                        SvcTagClient
                    
                     On Windows, the JAVA_HOME and TEST_DIR path could contain
                     space e.g. c:\Program Files\Java\jdk1.6.0_05\bin\java.
                     The SVCTAG_STCLIENT_CMD must be set with a list of
                     space-separated parameters.  If a parameter contains spaces,
                     it must be quoted with &apos;&quot;&apos;.                    
                </comment>
                <comment line="179">
                    look for the separator or matched the closing &apos;&quot;&apos;                    
                </comment>
                <comment line="188">
                    add an empty parameter                    
                </comment>
                <comment line="191">
                    double quotes and space are not included                    
                </comment>
                <comment line="195">
                    skip spaces                    
                </comment>
                <declaration name="command" type="List&lt;String&gt;" line="155"/>
                <scope line="156">
                    <declaration name="cmd" type="String" line="169"/>
                    <declaration name="len" type="int" line="170"/>
                    <declaration name="i" type="int" line="171"/>
                    <scope line="172">
                        <declaration name="separator" type="char" line="173"/>
                        <scope line="174"/>
                        <declaration name="j" type="int" line="179"/>
                        <scope line="180">
                            <scope line="181"/>
                        </scope>
                        <scope line="186"/>
                        <scope line="189"/>
                        <scope line="195">
                            <scope line="196"/>
                        </scope>
                    </scope>
                    <scope line="201">
                        <scope line="203"/>
                    </scope>
                </scope>
                <scope line="207"/>
            </method>
            <method name="checkReturnError" type="ServiceTag" line="218">
                <params>
                    <param name="exitValue" type="int"/>
                    <param name="output" type="String"/>
                    <param name="st" type="ServiceTag"/>
                </params>
                <scope line="223"/>
                <scope line="227"/>
            </method>
            <javadoc line="237">
                Adds a service tag to this registry.
                  If the given service tag has an empty &lt;tt&gt;instance_urn&lt;/tt&gt;,
                  this helper class will generate a URN and place it in the
                  copy of the service tag in this registry.
                  This method will return the {@code ServiceTag} representing
                  the service tag entry to this registry.                
                <param>
                    st {@code ServiceTag} object                    
                </param>
                <return>
                    a {@code ServiceTag} object representing the service tag
                      entry to this registry.                    
                </return>
                <throws>
                    IllegalArgumentException if a service tag of the same
                      <tt>instance_urn</tt> already exists in this registry.                    
                </throws>
                <throws>
                    java.io.IOException if an I/O error occurs in this operation.                    
                </throws>
            </javadoc>
            <method name="addServiceTag" type="ServiceTag" line="254">
                <params>
                    <param name="st" type="ServiceTag"/>
                </params>
                <comment line="303">
                    Obtain the instance urn from the stclient output                    
                </comment>
                <declaration name="command" type="List&lt;String&gt;" line="255"/>
                <scope line="257">
                    <declaration name="sysSvcTag" type="ServiceTag" line="258"/>
                    <scope line="259"/>
                </scope>
                <scope line="272"/>
                <scope line="278"/>
                <declaration name="in" type="BufferedReader" line="291"/>
                <scope line="292">
                    <declaration name="pb" type="ProcessBuilder" line="293"/>
                    <declaration name="p" type="Process" line="294"/>
                    <declaration name="output" type="String" line="295"/>
                    <scope line="296"/>
                    <declaration name="urn" type="String" line="300"/>
                    <scope line="301">
                        <declaration name="line" type="String" line="304"/>
                        <scope line="305">
                            <scope line="307"/>
                        </scope>
                        <scope line="312"/>
                    </scope>
                    <scope line="317"/>
                </scope>
                <scope line="320">
                    <scope line="321"/>
                </scope>
            </method>
            <javadoc line="327">
                Removes a service tag of the given &lt;tt&gt;instance_urn&lt;/tt&gt; from this
                  registry.                
                <param>
                    instanceURN the <tt>instance_urn</tt> of the service tag
                      to be removed.                    
                </param>
                <return>
                    the {@code ServiceTag} object removed from this registry;
                      or {@code null} if the service tag does not exist in this registry.                    
                </return>
                <throws>
                    UnauthorizedAccessException if the user is not authorized to
                      remove the service tag of the given <tt>instance_urn</tt>
                      from this registry.                    
                </throws>
                <throws>
                    java.io.IOException if an I/O error occurs in this operation.                    
                </throws>
            </javadoc>
            <method name="removeServiceTag" type="ServiceTag" line="343">
                <params>
                    <param name="instanceURN" type="String"/>
                </params>
                <declaration name="st" type="ServiceTag" line="344"/>
                <scope line="345"/>
                <declaration name="command" type="List&lt;String&gt;" line="349"/>
                <declaration name="pb" type="ProcessBuilder" line="354"/>
                <declaration name="p" type="Process" line="355"/>
                <declaration name="output" type="String" line="356"/>
                <scope line="357"/>
                <scope line="361"/>
                <scope line="363"/>
            </method>
            <javadoc line="368">
                Updates the &lt;tt&gt;product_defined_instance_id&lt;/tt&gt; in the service tag
                  of the specified &lt;tt&gt;instance_urn&lt;/tt&gt; in this registry.                
                <param>
                    instanceURN the <tt>instance_urn</tt> of the service tag to be updated.                    
                </param>
                <param>
                    productDefinedInstanceID the value of the
                      <tt>product_defined_instance_id</tt> to be set.                    
                </param>
                <return>
                    the updated {@code ServiceTag} object;
                      or {@code null} if the service tag does not exist in this
                      registry.                    
                </return>
                <throws>
                    UnauthorizedAccessException if the user is not authorized to
                      update the service tag from this registry.                    
                </throws>
                <throws>
                    IOException if an I/O error occurs in this operation.                    
                </throws>
            </javadoc>
            <method name="updateServiceTag" type="ServiceTag" line="387">
                <params>
                    <param name="instanceURN" type="String"/>
                    <param name="productDefinedInstanceID" type="String"/>
                </params>
                <declaration name="svcTag" type="ServiceTag" line="388"/>
                <scope line="389"/>
                <declaration name="command" type="List&lt;String&gt;" line="393"/>
                <scope line="398"/>
                <scope line="400"/>
                <declaration name="pb" type="ProcessBuilder" line="404"/>
                <declaration name="p" type="Process" line="405"/>
                <declaration name="output" type="String" line="406"/>
                <scope line="407"/>
                <scope line="412"/>
                <scope line="414"/>
            </method>
            <javadoc line="419">
                Returns a {@code ServiceTag} object of the given  &lt;tt&gt;instance_urn&lt;/tt&gt;
                  in this registry.                
                <param>
                    instanceURN the  <tt>instance_urn</tt> of the service tag                    
                </param>
                <return>
                    a {@code ServiceTag} object of the given <tt>instance_urn</tt>
                      in this registry; or {@code null} if not found.                    
                </return>
                <throws>
                    java.io.IOException if an I/O error occurs in this operation.                    
                </throws>
            </javadoc>
            <method name="getServiceTag" type="ServiceTag" line="429">
                <params>
                    <param name="instanceURN" type="String"/>
                </params>
                <scope line="430"/>
                <declaration name="command" type="List&lt;String&gt;" line="434"/>
                <declaration name="pb" type="ProcessBuilder" line="439"/>
                <declaration name="p" type="Process" line="440"/>
                <declaration name="output" type="String" line="441"/>
                <scope line="442"/>
                <scope line="446"/>
                <scope line="448"/>
            </method>
            <method name="parseServiceTag" type="ServiceTag" line="453">
                <params>
                    <param name="output" type="String"/>
                </params>
                <comment line="458">
                    parse the service tag output from stclient                    
                </comment>
                <declaration name="in" type="BufferedReader" line="454"/>
                <scope line="455">
                    <declaration name="props" type="Properties" line="456"/>
                    <declaration name="line" type="String" line="459"/>
                    <scope line="460">
                        <scope line="461">
                            <declaration name="ss" type="String[]" line="462"/>
                            <scope line="463"/>
                            <scope line="465"/>
                        </scope>
                    </scope>
                    <declaration name="urn" type="String" line="471"/>
                    <declaration name="productName" type="String" line="472"/>
                    <declaration name="productVersion" type="String" line="473"/>
                    <declaration name="productURN" type="String" line="474"/>
                    <declaration name="productParent" type="String" line="475"/>
                    <declaration name="productParentURN" type="String" line="476"/>
                    <declaration name="productDefinedInstanceID" type="String" line="477"/>
                    <declaration name="productVendor" type="String" line="479"/>
                    <declaration name="platformArch" type="String" line="480"/>
                    <declaration name="container" type="String" line="481"/>
                    <declaration name="source" type="String" line="482"/>
                    <declaration name="installerUID" type="int" line="483"/>
                    <declaration name="timestamp" type="Date" line="485"/>
                </scope>
                <scope line="501">
                    <scope line="502"/>
                </scope>
            </method>
            <javadoc line="509">
                Returns the service tags of the specified
                  &lt;tt&gt;product_urn&lt;/tt&gt; in this registry.                
                <param>
                    productURN the  <tt>product_urn</tt> to look up                    
                </param>
                <return>
                    a {@code Set} of {@code ServiceTag} objects
                      of the specified <tt>product_urn</tt> in this registry.                    
                </return>
                <throws>
                    java.io.IOException if an I/O error occurs in this operation.                    
                </throws>
            </javadoc>
            <method name="findServiceTags" type="Set<ServiceTag>" line="519">
                <params>
                    <param name="productURN" type="String"/>
                </params>
                <comment line="538">
                    parse the service tag output from stclient                    
                </comment>
                <scope line="520"/>
                <declaration name="command" type="List&lt;String&gt;" line="524"/>
                <declaration name="in" type="BufferedReader" line="529"/>
                <scope line="530">
                    <declaration name="pb" type="ProcessBuilder" line="531"/>
                    <declaration name="p" type="Process" line="532"/>
                    <declaration name="output" type="String" line="533"/>
                    <declaration name="instances" type="Set&lt;ServiceTag&gt;" line="535"/>
                    <scope line="536">
                        <declaration name="line" type="String" line="539"/>
                        <scope line="540">
                            <declaration name="s" type="String" line="541"/>
                            <scope line="542"/>
                        </scope>
                    </scope>
                    <scope line="546"/>
                </scope>
                <scope line="550">
                    <scope line="551"/>
                </scope>
            </method>
        </class>
    </source>