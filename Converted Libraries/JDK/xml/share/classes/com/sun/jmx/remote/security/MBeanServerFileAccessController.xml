<?xml version="1.0" encoding="UTF-8"?>
    <source package="com.sun.jmx.remote.security">
        <import package="java.io.FileInputStream"/>
        <import package="java.io.IOException"/>
        <import package="java.security.AccessControlContext"/>
        <import package="java.security.AccessController"/>
        <import package="java.security.Principal"/>
        <import package="java.security.PrivilegedAction"/>
        <import package="java.util.ArrayList"/>
        <import package="java.util.HashMap"/>
        <import package="java.util.Iterator"/>
        <import package="java.util.List"/>
        <import package="java.util.Map"/>
        <import package="java.util.Properties"/>
        <import package="java.util.Set"/>
        <import package="java.util.StringTokenizer"/>
        <import package="java.util.regex.Pattern"/>
        <import package="javax.management.MBeanServer"/>
        <import package="javax.management.ObjectName"/>
        <import package="javax.security.auth.Subject"/>
        <class name="MBeanServerFileAccessController" line="20">
            <extends class="MBeanServerAccessController"/>
            <javadoc line="20">
                &lt;p&gt;An object of this class implements the MBeanServerAccessController
                  interface and, for each of its methods, calls an appropriate checking
                  method and then forwards the request to a wrapped MBeanServer object.
                  The checking method may throw a SecurityException if the operation is
                  not allowed; in this case the request is not forwarded to the
                  wrapped object.&lt;/p&gt;
                  &lt;p&gt;This class implements the {@link #checkRead()}, {@link #checkWrite()},{@link #checkCreate(String)}, and {@link #checkUnregister(ObjectName)}methods based on an access level properties file containing username/access
                  level pairs. The set of username/access level pairs is passed either as a
                  filename which denotes a properties file on disk, or directly as an instance
                  of the {@link Properties} class.  In both cases, the name of each property
                  represents a username, and the value of the property is the associated access
                  level.  Thus, any given username either does not exist in the properties or
                  has exactly one access level. The same access level can be shared by several
                  usernames.&lt;/p&gt;
                  &lt;p&gt;The supported access level values are {@code readonly} and{@code readwrite}.  The {@code readwrite} access level can be
                  qualified by one or more &lt;i&gt;clauses&lt;/i&gt;, where each clause looks
                  like &lt;code&gt;create &lt;i&gt;classNamePattern&lt;/i&gt;&lt;/code&gt; or {@codeunregister}.  For example:&lt;/p&gt;
                  &lt;pre&gt;
                  monitorRole  readonly
                  controlRole  readwrite \
                  create javax.management.timer.,javax.management.monitor. \
                  unregister
                  &lt;/pre&gt;
                  &lt;p&gt;(The continuation lines with {@code \} come from the parser for
                  Properties files.)&lt;/p&gt;                
            </javadoc>
            <declaration name="READONLY" type="String" line="48"/>
            <declaration name="READWRITE" type="String" line="49"/>
            <declaration name="CREATE" type="String" line="50"/>
            <declaration name="UNREGISTER" type="String" line="51"/>
            <declaration name="AccessType" type="enum" line="52"/>
            <scope line="52"/>
            <class name="Access" line="53">
                <declaration name="write" type="boolean" line="54"/>
                <declaration name="createPatterns" type="String[]" line="55"/>
                <declaration name="unregister" type="boolean" line="56"/>
                <method name="Access" type="constructor" line="57">
                    <params>
                        <param name="write" type="boolean"/>
                        <param name="unregister" type="boolean"/>
                        <param name="createPatternList" type="List&lt;String&gt;"/>
                    </params>
                    <declaration name="npats" type="int" line="59"/>
                </method>
                <declaration name="NO_STRINGS" type="String[]" line="64"/>
            </class>
            <javadoc line="66">
                &lt;p&gt;Create a new MBeanServerAccessController that forwards all the
                  MBeanServer requests to the MBeanServer set by invoking the {@link #setMBeanServer} method after doing access checks based on read and
                  write permissions.&lt;/p&gt;
                  &lt;p&gt;This instance is initialized from the specified properties file.&lt;/p&gt;                
                <param>
                    accessFileName name of the file which denotes a properties
                      file on disk containing the username/access level entries.                    
                </param>
                <exception>
                    IOException if the file does not exist, is a
                      directory rather than a regular file, or for some other
                      reason cannot be opened for reading.                    
                </exception>
                <exception>
                    IllegalArgumentException if any of the supplied access
                      level values differs from &quot;readonly&quot; or &quot;readwrite&quot;.                    
                </exception>
            </javadoc>
            <method name="MBeanServerFileAccessController" type="constructor" line="79">
                <params>
                    <param name="accessFileName" type="String"/>
                </params>
                <declaration name="props" type="Properties" line="82"/>
            </method>
            <javadoc line="85">
                &lt;p&gt;Create a new MBeanServerAccessController that forwards all the
                  MBeanServer requests to &lt;code&gt;mbs&lt;/code&gt; after doing access checks
                  based on read and write permissions.&lt;/p&gt;
                  &lt;p&gt;This instance is initialized from the specified properties file.&lt;/p&gt;                
                <param>
                    accessFileName name of the file which denotes a properties
                      file on disk containing the username/access level entries.                    
                </param>
                <param>
                    mbs the MBeanServer object to which requests will be forwarded.                    
                </param>
                <exception>
                    IOException if the file does not exist, is a
                      directory rather than a regular file, or for some other
                      reason cannot be opened for reading.                    
                </exception>
                <exception>
                    IllegalArgumentException if any of the supplied access
                      level values differs from &quot;readonly&quot; or &quot;readwrite&quot;.                    
                </exception>
            </javadoc>
            <method name="MBeanServerFileAccessController" type="constructor" line="99">
                <params>
                    <param name="accessFileName" type="String"/>
                    <param name="mbs" type="MBeanServer"/>
                </params>
            </method>
            <javadoc line="103">
                &lt;p&gt;Create a new MBeanServerAccessController that forwards all the
                  MBeanServer requests to the MBeanServer set by invoking the {@link #setMBeanServer} method after doing access checks based on read and
                  write permissions.&lt;/p&gt;
                  &lt;p&gt;This instance is initialized from the specified properties
                  instance.  This constructor makes a copy of the properties
                  instance and it is the copy that is consulted to check the
                  username and access level of an incoming connection. The
                  original properties object can be modified without affecting
                  the copy. If the {@link #refresh} method is then called, the
                  &lt;code&gt;MBeanServerFileAccessController&lt;/code&gt; will make a new
                  copy of the properties object at that time.&lt;/p&gt;                
                <param>
                    accessFileProps properties list containing the username/access
                      level entries.                    
                </param>
                <exception>
                    IllegalArgumentException if &lt;code&gt;accessFileProps&lt;/code&gt; is
                      &lt;code&gt;null&lt;/code&gt; or if any of the supplied access level values differs
                      from &quot;readonly&quot; or &quot;readwrite&quot;.                    
                </exception>
            </javadoc>
            <method name="MBeanServerFileAccessController" type="constructor" line="121">
                <params>
                    <param name="accessFileProps" type="Properties"/>
                </params>
            </method>
            <javadoc line="127">
                &lt;p&gt;Create a new MBeanServerAccessController that forwards all the
                  MBeanServer requests to the MBeanServer set by invoking the {@link #setMBeanServer} method after doing access checks based on read and
                  write permissions.&lt;/p&gt;
                  &lt;p&gt;This instance is initialized from the specified properties
                  instance.  This constructor makes a copy of the properties
                  instance and it is the copy that is consulted to check the
                  username and access level of an incoming connection. The
                  original properties object can be modified without affecting
                  the copy. If the {@link #refresh} method is then called, the
                  &lt;code&gt;MBeanServerFileAccessController&lt;/code&gt; will make a new
                  copy of the properties object at that time.&lt;/p&gt;                
                <param>
                    accessFileProps properties list containing the username/access
                      level entries.                    
                </param>
                <param>
                    mbs the MBeanServer object to which requests will be forwarded.                    
                </param>
                <exception>
                    IllegalArgumentException if &lt;code&gt;accessFileProps&lt;/code&gt; is
                      &lt;code&gt;null&lt;/code&gt; or if any of the supplied access level values differs
                      from &quot;readonly&quot; or &quot;readwrite&quot;.                    
                </exception>
            </javadoc>
            <method name="MBeanServerFileAccessController" type="constructor" line="146">
                <params>
                    <param name="accessFileProps" type="Properties"/>
                    <param name="mbs" type="MBeanServer"/>
                </params>
            </method>
            <javadoc line="150">
                Check if the caller can do read operations. This method does
                  nothing if so, otherwise throws SecurityException.                
            </javadoc>
            <method name="checkRead" type="void" line="154"/>
            <javadoc line="157">
                Check if the caller can do write operations.  This method does
                  nothing if so, otherwise throws SecurityException.                
            </javadoc>
            <method name="checkWrite" type="void" line="161"/>
            <javadoc line="164">
                Check if the caller can create MBeans or instances of the given class.
                  This method does nothing if so, otherwise throws SecurityException.                
            </javadoc>
            <method name="checkCreate" type="void" line="168">
                <params>
                    <param name="className" type="String"/>
                </params>
            </method>
            <javadoc line="171">
                Check if the caller can do unregister operations.  This method does
                  nothing if so, otherwise throws SecurityException.                
            </javadoc>
            <method name="checkUnregister" type="void" line="175">
                <params>
                    <param name="name" type="ObjectName"/>
                </params>
            </method>
            <javadoc line="178">
                &lt;p&gt;Refresh the set of username/access level entries.&lt;/p&gt;
                  &lt;p&gt;If this instance was created using the{@link #MBeanServerFileAccessController(String)} or{@link #MBeanServerFileAccessController(String,MBeanServer)}constructors to specify a file from which the entries are read,
                  the file is re-read.&lt;/p&gt;
                  &lt;p&gt;If this instance was created using the{@link #MBeanServerFileAccessController(Properties)} or{@link #MBeanServerFileAccessController(Properties,MBeanServer)}constructors then a new copy of the &lt;code&gt;Properties&lt;/code&gt; object
                  is made.&lt;/p&gt;                
                <exception>
                    IOException if the file does not exist, is a
                      directory rather than a regular file, or for some other
                      reason cannot be opened for reading.                    
                </exception>
                <exception>
                    IllegalArgumentException if any of the supplied access
                      level values differs from &quot;readonly&quot; or &quot;readwrite&quot;.                    
                </exception>
            </javadoc>
            <method name="refresh" type="void" line="190">
                <declaration name="props" type="Properties" line="191"/>
            </method>
            <method name="propertiesFromFile" type="Properties" line="196">
                <params>
                    <param name="fname" type="String"/>
                </params>
                <declaration name="fin" type="FileInputStream" line="197"/>
                <scope line="198">
                    <declaration name="p" type="Properties" line="199"/>
                </scope>
                <scope line="203"/>
            </method>
            <method name="checkAccess" type="void" line="207">
                <params>
                    <param name="requiredAccess" type="AccessType"/>
                    <param name="arg" type="String"/>
                </params>
                <declaration name="acc" type="AccessControlContext" line="208"/>
                <anonymous_class line="209">
                    <method name="run" type="Subject" line="210"/>
                </anonymous_class>
                <declaration name="s" type="Subject" line="209"/>
                <declaration name="principals" type="Set" line="216"/>
                <declaration name="newPropertyValue" type="String" line="217"/>
                <scope line="218">
                    <declaration name="p" type="Principal" line="219"/>
                    <declaration name="access" type="Access" line="220"/>
                    <scope line="221">
                        <declaration name="ok" type="boolean" line="222"/>
                    </scope>
                </scope>
                <declaration name="se" type="SecurityException" line="244"/>
                <scope line="245">
                    <declaration name="se2" type="SecurityException" line="246"/>
                </scope>
            </method>
            <method name="checkCreateAccess" type="boolean" line="251">
                <params>
                    <param name="access" type="Access"/>
                    <param name="className" type="String"/>
                </params>
                <scope line="252"/>
            </method>
            <method name="classNameMatch" type="boolean" line="257">
                <params>
                    <param name="pattern" type="String"/>
                    <param name="className" type="String"/>
                </params>
                <declaration name="sb" type="StringBuilder" line="258"/>
                <declaration name="stok" type="StringTokenizer" line="259"/>
                <scope line="260">
                    <declaration name="tok" type="String" line="261"/>
                </scope>
            </method>
            <method name="parseProperties" type="void" line="267">
                <params>
                    <param name="props" type="Properties"/>
                </params>
                <scope line="269">
                    <declaration name="identity" type="String" line="270"/>
                    <declaration name="accessString" type="String" line="271"/>
                    <declaration name="access" type="Access" line="272"/>
                </scope>
            </method>
            <class name="Parser" line="276">
                <declaration name="EOS" type="int" line="277"/>
                <scope line="278"/>
                <declaration name="identity" type="String" line="281"/>
                <declaration name="s" type="String" line="282"/>
                <declaration name="len" type="int" line="283"/>
                <declaration name="i" type="int" line="284"/>
                <declaration name="c" type="int" line="285"/>
                <method name="Parser" type="constructor" line="286">
                    <params>
                        <param name="identity" type="String"/>
                        <param name="s" type="String"/>
                    </params>
                </method>
                <method name="parseAccess" type="Access" line="294">
                    <params>
                        <param name="identity" type="String"/>
                        <param name="s" type="String"/>
                    </params>
                </method>
                <method name="parseAccess" type="Access" line="297">
                    <declaration name="type" type="String" line="299"/>
                    <declaration name="access" type="Access" line="300"/>
                    <scope line="303"/>
                </method>
                <method name="parseReadWrite" type="Access" line="309">
                    <declaration name="createClasses" type="List&amp;lt;String&amp;gt;" line="310"/>
                    <declaration name="unregister" type="boolean" line="311"/>
                    <scope line="312">
                        <declaration name="type" type="String" line="315"/>
                    </scope>
                </method>
                <method name="parseCreate" type="void" line="322">
                    <params>
                        <param name="createClasses" type="List&lt;String&gt;"/>
                    </params>
                    <scope line="323"/>
                </method>
                <method name="parseClassName" type="String" line="331">
                    <declaration name="start" type="int" line="332"/>
                    <declaration name="dotOK" type="boolean" line="333"/>
                    <scope line="334">
                        <scope line="335"/>
                    </scope>
                    <declaration name="className" type="String" line="343"/>
                </method>
                <method name="next" type="void" line="347">
                    <scope line="348"/>
                </method>
                <method name="skipSpace" type="void" line="354"/>
                <method name="parseWord" type="String" line="357">
                    <declaration name="start" type="int" line="360"/>
                    <declaration name="word" type="String" line="362"/>
                </method>
                <method name="syntax" type="IllegalArgumentException" line="366">
                    <params>
                        <param name="msg" type="String"/>
                    </params>
                </method>
            </class>
            <declaration name="accessMap" type="Map&amp;lt;String,Access&amp;gt;" line="370"/>
            <declaration name="originalProps" type="Properties" line="371"/>
            <declaration name="accessFileName" type="String" line="372"/>
        </class>
    </source>