<?xml version="1.0" encoding="UTF-8"?>
    <source package="com.sun.security.auth.module">
        <import package="javax.security.auth"/>
        <import package="javax.security.auth.callback"/>
        <import package="javax.security.auth.login"/>
        <import package="javax.security.auth.spi"/>
        <import package="javax.naming"/>
        <import package="javax.naming.directory"/>
        <import package="java.io.IOException"/>
        <import package="java.util.Map"/>
        <import package="java.util.LinkedList"/>
        <import package="java.util.ResourceBundle"/>
        <import package="com.sun.security.auth.UnixPrincipal"/>
        <import package="com.sun.security.auth.UnixNumericUserPrincipal"/>
        <import package="com.sun.security.auth.UnixNumericGroupPrincipal"/>
        <import package="sun.security.util.AuthResources"/>
        <class name="JndiLoginModule" line="46">
            <comment line="164">
                configurable options                
            </comment>
            <comment line="174">
                the authentication status                
            </comment>
            <comment line="178">
                username, password, and JNDI context                
            </comment>
            <comment line="183">
                the user (assume it is a UnixPrincipal)                
            </comment>
            <comment line="190">
                initial state                
            </comment>
            <implements interface="LoginModule"/>
            <javadoc line="46">
                &lt;p&gt; The module prompts for a username and password
                  and then verifies the password against the password stored in
                  a directory service configured under JNDI.
                  &lt;p&gt; This &lt;code&gt;LoginModule&lt;/code&gt; interoperates with
                  any conformant JNDI service provider.  To direct this
                  &lt;code&gt;LoginModule&lt;/code&gt; to use a specific JNDI service provider,
                  two options must be specified in the login &lt;code&gt;Configuration&lt;/code&gt;
                  for this &lt;code&gt;LoginModule&lt;/code&gt;.
                  &lt;pre&gt;
                  user.provider.url=&lt;b&gt;name_service_url&lt;/b&gt;
                  group.provider.url=&lt;b&gt;name_service_url&lt;/b&gt;
                  &lt;/pre&gt;
                  &lt;b&gt;name_service_url&lt;/b&gt; specifies
                  the directory service and path where this &lt;code&gt;LoginModule&lt;/code&gt;
                  can access the relevant user and group information.  Because this
                  &lt;code&gt;LoginModule&lt;/code&gt; only performs one-level searches to
                  find the relevant user information, the &lt;code&gt;URL&lt;/code&gt;
                  must point to a directory one level above where the user and group
                  information is stored in the directory service.
                  For example, to instruct this &lt;code&gt;LoginModule&lt;/code&gt;
                  to contact a NIS server, the following URLs must be specified:
                  &lt;pre&gt;
                  user.provider.url=&quot;nis://&lt;b&gt;NISServerHostName&lt;/b&gt;/&lt;b&gt;NISDomain&lt;/b&gt;/user&quot;
                  group.provider.url=&quot;nis://&lt;b&gt;NISServerHostName&lt;/b&gt;/&lt;b&gt;NISDomain&lt;/b&gt;/system/group&quot;
                  &lt;/pre&gt;
                  &lt;b&gt;NISServerHostName&lt;/b&gt; specifies the server host name of the
                  NIS server (for example, &lt;i&gt;nis.sun.com&lt;/i&gt;, and &lt;b&gt;NISDomain&lt;/b&gt;
                  specifies the domain for that NIS server (for example, &lt;i&gt;jaas.sun.com&lt;/i&gt;.
                  To contact an LDAP server, the following URLs must be specified:
                  &lt;pre&gt;
                  user.provider.url=&quot;ldap://&lt;b&gt;LDAPServerHostName&lt;/b&gt;/&lt;b&gt;LDAPName&lt;/b&gt;&quot;
                  group.provider.url=&quot;ldap://&lt;b&gt;LDAPServerHostName&lt;/b&gt;/&lt;b&gt;LDAPName&lt;/b&gt;&quot;
                  &lt;/pre&gt;
                  &lt;b&gt;LDAPServerHostName&lt;/b&gt; specifies the server host name of the
                  LDAP server, which may include a port number
                  (for example, &lt;i&gt;ldap.sun.com:389&lt;/i&gt;),
                  and &lt;b&gt;LDAPName&lt;/b&gt; specifies the entry name in the LDAP directory
                  (for example, &lt;i&gt;ou=People,o=Sun,c=US&lt;/i&gt; and &lt;i&gt;ou=Groups,o=Sun,c=US&lt;/i&gt;
                  for user and group information, respectively).
                  &lt;p&gt; The format in which the user&apos;s information must be stored in
                  the directory service is specified in RFC 2307.  Specifically,
                  this &lt;code&gt;LoginModule&lt;/code&gt; will search for the user&apos;s entry in the
                  directory service using the user&apos;s &lt;i&gt;uid&lt;/i&gt; attribute,
                  where &lt;i&gt;uid=&lt;b&gt;username&lt;/b&gt;&lt;/i&gt;.  If the search succeeds,
                  this &lt;code&gt;LoginModule&lt;/code&gt; will then
                  obtain the user&apos;s encrypted password from the retrieved entry
                  using the &lt;i&gt;userPassword&lt;/i&gt; attribute.
                  This &lt;code&gt;LoginModule&lt;/code&gt; assumes that the password is stored
                  as a byte array, which when converted to a &lt;code&gt;String&lt;/code&gt;,
                  has the following format:
                  &lt;pre&gt;
                  &quot;{crypt}&lt;b&gt;encrypted_password&lt;/b&gt;&quot;
                  &lt;/pre&gt;
                  The LDAP directory server must be configured
                  to permit read access to the userPassword attribute.
                  If the user entered a valid username and password,
                  this &lt;code&gt;LoginModule&lt;/code&gt; associates a
                  &lt;code&gt;UnixPrincipal&lt;/code&gt;, &lt;code&gt;UnixNumericUserPrincipal&lt;/code&gt;,
                  and the relevant UnixNumericGroupPrincipals with the
                  &lt;code&gt;Subject&lt;/code&gt;.
                  &lt;p&gt; This LoginModule also recognizes the following &lt;code&gt;Configuration&lt;/code&gt;
                  options:
                  &lt;pre&gt;
                  debug          if, true, debug messages are output to System.out.
                  useFirstPass   if, true, this LoginModule retrieves the
                  username and password from the module&apos;s shared state,
                  using &quot;javax.security.auth.login.name&quot; and
                  &quot;javax.security.auth.login.password&quot; as the respective
                  keys.  The retrieved values are used for authentication.
                  If authentication fails, no attempt for a retry is made,
                  and the failure is reported back to the calling
                  application.
                  tryFirstPass   if, true, this LoginModule retrieves the
                  the username and password from the module&apos;s shared state,
                  using &quot;javax.security.auth.login.name&quot; and
                  &quot;javax.security.auth.login.password&quot; as the respective
                  keys.  The retrieved values are used for authentication.
                  If authentication fails, the module uses the
                  CallbackHandler to retrieve a new username and password,
                  and another attempt to authenticate is made.
                  If the authentication fails, the failure is reported
                  back to the calling application.
                  storePass      if, true, this LoginModule stores the username and password
                  obtained from the CallbackHandler in the module&apos;s
                  shared state, using &quot;javax.security.auth.login.name&quot; and
                  &quot;javax.security.auth.login.password&quot; as the respective
                  keys.  This is not performed if existing values already
                  exist for the username and password in the shared state,
                  or if authentication fails.
                  clearPass     if, true, this &lt;code&gt;LoginModule&lt;/code&gt; clears the
                  username and password stored in the module&apos;s shared state
                  after both phases of authentication (login and commit)
                  have completed.
                  &lt;/pre&gt;                
            </javadoc>
            <declaration name="rb" type="java.util.ResourceBundle" line="156"/>
            <declaration name="USER_PROVIDER" type="String" line="159"/>
            <javadoc line="159">
                JNDI Provider                
            </javadoc>
            <declaration name="GROUP_PROVIDER" type="String" line="161"/>
            <declaration name="debug" type="boolean" line="164"/>
            <declaration name="strongDebug" type="boolean" line="165"/>
            <declaration name="userProvider" type="String" line="166"/>
            <declaration name="groupProvider" type="String" line="167"/>
            <declaration name="useFirstPass" type="boolean" line="168"/>
            <declaration name="tryFirstPass" type="boolean" line="169"/>
            <declaration name="storePass" type="boolean" line="170"/>
            <declaration name="clearPass" type="boolean" line="171"/>
            <declaration name="succeeded" type="boolean" line="174"/>
            <declaration name="commitSucceeded" type="boolean" line="175"/>
            <declaration name="username" type="String" line="178"/>
            <declaration name="password" type="char[]" line="179"/>
            <declaration name="ctx" type="DirContext" line="180"/>
            <declaration name="userPrincipal" type="UnixPrincipal" line="183"/>
            <declaration name="UIDPrincipal" type="UnixNumericUserPrincipal" line="184"/>
            <declaration name="GIDPrincipal" type="UnixNumericGroupPrincipal" line="185"/>
            <declaration name="supplementaryGroups" type="LinkedList&lt;UnixNumericGroupPrincipal&gt;" line="186"/>
            <declaration name="subject" type="Subject" line="190"/>
            <declaration name="callbackHandler" type="CallbackHandler" line="191"/>
            <declaration name="sharedState" type="Map" line="192"/>
            <declaration name="options" type="Map&lt;String,?&gt;" line="193"/>
            <declaration name="CRYPT" type="String" line="195"/>
            <declaration name="USER_PWD" type="String" line="196"/>
            <declaration name="USER_UID" type="String" line="197"/>
            <declaration name="USER_GID" type="String" line="198"/>
            <declaration name="GROUP_ID" type="String" line="199"/>
            <declaration name="NAME" type="String" line="200"/>
            <declaration name="PWD" type="String" line="201"/>
            <javadoc line="203">
                Initialize this &lt;code&gt;LoginModule&lt;/code&gt;.
                  &lt;p&gt;                
                <param>
                    subject the <code>Subject</code> to be authenticated. <p>                    
                </param>
                <param>
                    callbackHandler a <code>CallbackHandler</code> for communicating
                      with the end user (prompting for usernames and
                      passwords, for example). <p>                    
                </param>
                <param>
                    sharedState shared <code>LoginModule</code> state. <p>                    
                </param>
                <param>
                    options options specified in the login
                      <code>Configuration</code> for this particular
                      <code>LoginModule</code>.                    
                </param>
            </javadoc>
            <method name="initialize" type="void" line="222">
                <params>
                    <param name="subject" type="Subject"/>
                    <param name="callbackHandler" type="CallbackHandler"/>
                    <param name="sharedState" type="Map<String,?>"/>
                    <param name="options" type="Map<String,?>"/>
                </params>
                <comment line="230">
                    initialize any configured options                    
                </comment>
            </method>
            <javadoc line="245">
                &lt;p&gt; Prompt for username and password.
                  Verify the password against the relevant name service.
                  &lt;p&gt;                
                <return>
                    true always, since this <code>LoginModule</code>
                      should not be ignored.                    
                </return>
                <exception>
                    FailedLoginException if the authentication fails. <p>                    
                </exception>
                <exception>
                    LoginException if this <code>LoginModule</code>
                      is unable to perform the authentication.                    
                </exception>
            </javadoc>
            <method name="login" type="boolean" line="259">
                <comment line="278">
                    attempt the authentication                    
                </comment>
                <comment line="282">
                    attempt the authentication by getting the
                     username and password from shared state                    
                </comment>
                <comment line="286">
                    authentication succeeded                    
                </comment>
                <comment line="294">
                    authentication failed -- try again below by prompting                    
                </comment>
                <comment line="306">
                    attempt the authentication by getting the
                     username and password from shared state                    
                </comment>
                <comment line="310">
                    authentication succeeded                    
                </comment>
                <comment line="318">
                    authentication failed                    
                </comment>
                <comment line="328">
                    attempt the authentication by prompting for the username and pwd                    
                </comment>
                <comment line="332">
                    authentication succeeded                    
                </comment>
                <scope line="261"/>
                <scope line="265"/>
                <scope line="270"/>
                <scope line="278">
                    <scope line="280">
                        <scope line="287"/>
                    </scope>
                    <scope line="292">
                        <scope line="295"/>
                    </scope>
                </scope>
                <scope line="302">
                    <scope line="304">
                        <scope line="311"/>
                    </scope>
                    <scope line="316">
                        <scope line="319"/>
                    </scope>
                </scope>
                <scope line="328">
                    <scope line="333"/>
                </scope>
                <scope line="338">
                    <scope line="340"/>
                </scope>
            </method>
            <javadoc line="348">
                Abstract method to commit the authentication process (phase 2).
                  &lt;p&gt; This method is called if the LoginContext&apos;s
                  overall authentication succeeded
                  (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL LoginModules
                  succeeded).
                  &lt;p&gt; If this LoginModule&apos;s own authentication attempt
                  succeeded (checked by retrieving the private state saved by the
                  &lt;code&gt;login&lt;/code&gt; method), then this method associates a
                  &lt;code&gt;UnixPrincipal&lt;/code&gt;
                  with the &lt;code&gt;Subject&lt;/code&gt; located in the
                  &lt;code&gt;LoginModule&lt;/code&gt;.  If this LoginModule&apos;s own
                  authentication attempted failed, then this method removes
                  any state that was originally saved.
                  &lt;p&gt;                
                <exception>
                    LoginException if the commit fails                    
                </exception>
                <return>
                    true if this LoginModule's own login and commit
                      attempts succeeded, or false otherwise.                    
                </return>
            </javadoc>
            <method name="commit" type="boolean" line="372">
                <comment line="382">
                    add Principals to the Subject                    
                </comment>
                <comment line="403">
                    in any case, clean out state                    
                </comment>
                <scope line="374"/>
                <scope line="376">
                    <scope line="377"/>
                    <scope line="388"/>
                    <scope line="394"/>
                </scope>
            </method>
            <javadoc line="408">
                &lt;p&gt; This method is called if the LoginContext&apos;s
                  overall authentication failed.
                  (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL LoginModules
                  did not succeed).
                  &lt;p&gt; If this LoginModule&apos;s own authentication attempt
                  succeeded (checked by retrieving the private state saved by the
                  &lt;code&gt;login&lt;/code&gt; and &lt;code&gt;commit&lt;/code&gt; methods),
                  then this method cleans up any state that was originally saved.
                  &lt;p&gt;                
                <exception>
                    LoginException if the abort fails.                    
                </exception>
                <return>
                    false if this LoginModule's own login and/or commit attempts
                      failed, and true otherwise.                    
                </return>
            </javadoc>
            <method name="abort" type="boolean" line="426">
                <comment line="436">
                    Clean out state                    
                </comment>
                <comment line="445">
                    overall authentication succeeded and commit succeeded,
                     but someone else&apos;s commit failed                    
                </comment>
                <scope line="431"/>
                <scope line="433"/>
                <scope line="443"/>
            </method>
            <javadoc line="451">
                Logout a user.
                  &lt;p&gt; This method removes the Principals
                  that were added by the &lt;code&gt;commit&lt;/code&gt; method.
                  &lt;p&gt;                
                <exception>
                    LoginException if the logout fails.                    
                </exception>
                <return>
                    true in all cases since this <code>LoginModule</code>
                      should not be ignored.                    
                </return>
            </javadoc>
            <method name="logout" type="boolean" line="464">
                <comment line="478">
                    clean out state                    
                </comment>
                <scope line="465"/>
                <scope line="472"/>
                <scope line="487"/>
            </method>
            <javadoc line="494">
                Attempt authentication
                  &lt;p&gt;                
                <param>
                    getPasswdFromSharedState boolean that tells this method whether
                      to retrieve the password from the sharedState.                    
                </param>
            </javadoc>
            <method name="attemptAuthentication" type="void" line="503">
                <params>
                    <param name="getPasswdFromSharedState" type="boolean"/>
                </params>
                <comment line="508">
                    first get the username and password                    
                </comment>
                <comment line="513">
                    get the user&apos;s passwd entry from the user provider URL                    
                </comment>
                <comment line="517">
                    SearchControls controls = new SearchControls
                    (SearchControls.ONELEVEL_SCOPE,
                    0,
                    5000,
                    new String[] { USER_PWD },
                    false,
                    false);                    
                </comment>
                <comment line="535">
                    get the password                    
                </comment>
                <comment line="537">
                    this module works only if the LDAP directory server
                     is configured to permit read access to the userPassword
                     attribute. The directory administrator need to grant
                     this access.
                    
                     A workaround would be to make the server do authentication
                     by setting the Context.SECURITY_PRINCIPAL
                     and Context.SECURITY_CREDENTIALS property.
                     However, this would make it not work with systems that
                     don&apos;t do authentication at the server (like NIS).
                    
                     Setting the SECURITY_* properties and using &quot;simple&quot;
                     authentication for LDAP is recommended only for secure
                     channels. For nonsecure channels, SSL is recommended.                    
                </comment>
                <comment line="556">
                    check the password                    
                </comment>
                <comment line="560">
                    authentication succeeded                    
                </comment>
                <comment line="566">
                    authentication failed                    
                </comment>
                <comment line="573">
                    save input as shared state only if
                     authentication succeeded                    
                </comment>
                <comment line="582">
                    create the user principal                    
                </comment>
                <comment line="585">
                    get the UID                    
                </comment>
                <comment line="595">
                    get the GID                    
                </comment>
                <comment line="606">
                    get the supplementary groups from the group provider URL                    
                </comment>
                <comment line="630">
                    bad username                    
                </comment>
                <comment line="637">
                    bad username                    
                </comment>
                <comment line="644">
                    password stored in incorrect format                    
                </comment>
                <comment line="654">
                    authentication succeeded                    
                </comment>
                <declaration name="encryptedPassword" type="String" line="505"/>
                <scope line="510">
                    <declaration name="iCtx" type="InitialContext" line="513"/>
                    <declaration name="controls" type="SearchControls" line="526"/>
                    <declaration name="ne" type="NamingEnumeration&lt;SearchResult&gt;" line="527"/>
                    <scope line="530">
                        <declaration name="result" type="SearchResult" line="531"/>
                        <declaration name="attributes" type="Attributes" line="532"/>
                        <declaration name="pwd" type="Attribute" line="551"/>
                        <declaration name="encryptedPwd" type="String" line="552"/>
                        <scope line="557"/>
                        <scope line="564"/>
                        <scope line="576"/>
                        <declaration name="uid" type="Attribute" line="585"/>
                        <declaration name="uidNumber" type="String" line="586"/>
                        <scope line="588"/>
                        <declaration name="gid" type="Attribute" line="595"/>
                        <declaration name="gidNumber" type="String" line="596"/>
                        <scope line="599"/>
                        <scope line="609">
                            <declaration name="suppGid" type="String" line="614"/>
                            <scope line="615">
                                <declaration name="suppPrincipal" type="UnixNumericGroupPrincipal" line="616"/>
                                <scope line="619"/>
                            </scope>
                        </scope>
                    </scope>
                    <scope line="628">
                        <scope line="630"/>
                    </scope>
                </scope>
                <scope line="635">
                    <scope line="637"/>
                </scope>
                <scope line="642">
                    <scope line="644"/>
                </scope>
            </method>
            <javadoc line="656">
                Get the username and password.
                  This method does not return any value.
                  Instead, it sets global name and password variables.
                  &lt;p&gt; Also note that this method will set the username and password
                  values in the shared state in case subsequent LoginModules
                  want to use them via use/tryFirstPass.
                  &lt;p&gt;                
                <param>
                    getPasswdFromSharedState boolean that tells this method whether
                      to retrieve the password from the sharedState.                    
                </param>
            </javadoc>
            <method name="getUsernamePassword" type="void" line="671">
                <params>
                    <param name="getPasswdFromSharedState" type="boolean"/>
                </params>
                <comment line="675">
                    use the password saved by the first module in the stack                    
                </comment>
                <comment line="681">
                    prompt for a username and password                    
                </comment>
                <comment line="712">
                    print debugging information                    
                </comment>
                <scope line="673"/>
                <declaration name="protocol" type="String" line="685"/>
                <declaration name="callbacks" type="Callback[]" line="687"/>
                <scope line="694">
                    <declaration name="tmpPassword" type="char[]" line="697"/>
                </scope>
                <scope line="703"/>
                <scope line="705"/>
                <scope line="712"/>
            </method>
            <javadoc line="724">
                Verify a password against the encrypted passwd from /etc/shadow                
            </javadoc>
            <method name="verifyPassword" type="boolean" line="727">
                <params>
                    <param name="encryptedPassword" type="String"/>
                    <param name="password" type="String"/>
                </params>
                <comment line="745">
                    cannot happen, but return false just to be safe                    
                </comment>
                <declaration name="c" type="Crypt" line="732"/>
                <scope line="733">
                    <declaration name="oldCrypt" type="byte" line="734"/>
                    <declaration name="newCrypt" type="byte" line="735"/>
                    <scope line="739"/>
                </scope>
                <scope line="743"/>
            </method>
            <javadoc line="750">
                Clean out state because of a failed authentication attempt                
            </javadoc>
            <method name="cleanState" type="void" line="753">
                <scope line="755"/>
                <scope line="762"/>
            </method>
        </class>
    </source>