<?xml version="1.0" encoding="UTF-8"?>
    <source package="com.sun.jndi.ldap.pool">
        <import package="java.util.ArrayList"/>
        <import package="java.util.List"/>
        <import package="java.util.Iterator"/>
        <import package="java.lang.ref.Reference"/>
        <import package="java.lang.ref.SoftReference"/>
        <import package="javax.naming.NamingException"/>
        <import package="javax.naming.InterruptedNamingException"/>
        <import package="javax.naming.CommunicationException"/>
        <class name="Connections" line="39">
            <comment line="66">
                Package private: accessed only by Pool                
            </comment>
            <comment line="77">
                Closed for business                
            </comment>
            <comment line="78">
                maintains reference to id to prevent premature GC                
            </comment>
            <implements interface="PoolCallback"/>
            <javadoc line="39">
                Represents a list of PooledConnections (actually, ConnectionDescs) with the
                  same pool id.
                  The list starts out with an initial number of connections.
                  Additional PooledConnections are created lazily upon demand.
                  The list has a maximum size. When the number of connections
                  reaches the maximum size, a request for a PooledConnection blocks until
                  a connection is returned to the list. A maximum size of zero means that
                  there is no maximum: connection creation will be attempted when
                  no idle connection is available.
                  The list may also have a preferred size. If the current list size
                  is less than the preferred size, a request for a connection will result in
                  a PooledConnection being created (even if an idle connection is available).
                  If the current list size is greater than the preferred size,
                  a connection being returned to the list will be closed and removed from
                  the list. A preferred size of zero means that there is no preferred size:
                  connections are created only when no idle connection is available and
                  a connection being returned to the list is not closed. Regardless of the
                  preferred size, connection creation always observes the maximum size:
                  a connection won&apos;t be created if the list size is at or exceeds the
                  maximum size.                
                <author>
                    Rosanna Lee                    
                </author>
            </javadoc>
            <declaration name="debug" type="boolean" line="67"/>
            <declaration name="trace" type="boolean" line="68"/>
            <declaration name="DEFAULT_SIZE" type="int" line="70"/>
            <declaration name="maxSize" type="int" line="72"/>
            <declaration name="prefSize" type="int" line="73"/>
            <declaration name="conns" type="List" line="74"/>
            <declaration name="closed" type="boolean" line="76"/>
            <declaration name="ref" type="Reference" line="77"/>
            <javadoc line="79">
                @param id the identity (connection request) of the connections in the list                
                <param>
                    initSize the number of connections to create initially                    
                </param>
                <param>
                    prefSize the preferred size of the pool. The pool will try
                      to maintain a pool of this size by creating and closing connections
                      as needed.                    
                </param>
                <param>
                    maxSize the maximum size of the pool. The pool will not exceed
                      this size. If the pool is at this size, a request for a connection
                      will block until an idle connection is released to the pool or
                      when one is removed.                    
                </param>
                <param>
                    factory The factory responsible for creating a connection                    
                </param>
            </javadoc>
            <method name="Connections" type="constructor" line="92">
                <params>
                    <param name="id" type="Object"/>
                    <param name="initSize" type="int"/>
                    <param name="prefSize" type="int"/>
                    <param name="maxSize" type="int"/>
                    <param name="factory" type="PooledConnectionFactory"/>
                </params>
                <comment line="96">
                    prefSize and initSize cannot exceed specified maxSize                    
                </comment>
                <comment line="104">
                    Maintain soft ref to id so that this Connections&apos; entry in                    
                </comment>
                <comment line="105">
                    Pool doesn&apos;t get GC&apos;ed prematurely                    
                </comment>
                <comment line="112">
                    Create initial connections                    
                </comment>
                <comment line="117">
                    Add new idle conn to pool                    
                </comment>
                <scope line="95"/>
                <scope line="99"/>
                <declaration name="conn" type="PooledConnection" line="113"/>
                <scope line="114"/>
            </method>
            <javadoc line="121">
                Retrieves a PooledConnection from this list of connections.
                  Use an existing one if one is idle, or create one if the list&apos;s
                  max size hasn&apos;t been reached. If max size has been reached, wait
                  for a PooledConnection to be returned, or one to be removed (thus
                  not reaching the max size any longer).                
                <param>
                    timeout if > 0, msec to wait until connection is available                    
                </param>
                <param>
                    factory creates the PooledConnection if one needs to be created                    
                </param>
                <return>
                    A non-null PooledConnection                    
                </return>
                <throws>
                    NamingException PooledConnection cannot be created, because this
                      thread was interrupted while it waited for an available connection,
                      or if it timed out while waiting, or the creation of a connection
                      resulted in an error.                    
                </throws>
            </javadoc>
            <method name="get" type="PooledConnection" line="138">
                <params>
                    <param name="timeout" type="long"/>
                    <param name="factory" type="PooledConnectionFactory"/>
                </params>
                <comment line="153">
                    Wait until one is released or removed                    
                </comment>
                <comment line="161">
                    Check whether we timed out                    
                </comment>
                <declaration name="conn" type="PooledConnection" line="139"/>
                <declaration name="start" type="long" line="140"/>
                <declaration name="waittime" type="long" line="141"/>
                <scope line="144">
                    <scope line="145"/>
                    <scope line="150">
                        <scope line="152"/>
                        <scope line="154"/>
                    </scope>
                    <scope line="157"/>
                    <scope line="162">
                        <declaration name="now" type="long" line="163"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="172">
                Retrieves an idle connection from this list if one is available.
                  If none is available, create a new one if maxSize hasn&apos;t been reached.
                  If maxSize has been reached, return null.
                  Always called from a synchronized method.                
            </javadoc>
            <method name="getOrCreateConnection" type="PooledConnection" line="179">
                <params>
                    <param name="factory" type="PooledConnectionFactory"/>
                </params>
                <comment line="181">
                    Current number of idle/nonidle conns                    
                </comment>
                <comment line="185">
                    If no prefSize specified, or list size already meets or                    
                </comment>
                <comment line="186">
                    exceeds prefSize, then first look for an idle connection                    
                </comment>
                <comment line="198">
                    Check if list size already at maxSize specified                    
                </comment>
                <comment line="200">
                    List size is at limit; cannot create any more                    
                </comment>
                <comment line="205">
                    Add new conn to pool                    
                </comment>
                <declaration name="size" type="int" line="181"/>
                <declaration name="conn" type="PooledConnection" line="182"/>
                <scope line="184">
                    <declaration name="entry" type="ConnectionDesc" line="187"/>
                    <scope line="188">
                        <scope line="190"/>
                    </scope>
                </scope>
                <scope line="199"/>
            </method>
            <javadoc line="210">
                Releases connection back into list.
                  If the list size is below prefSize, the connection may be reused.
                  If the list size exceeds prefSize, then the connection is closed
                  and removed from the list.
                  public because implemented as part of PoolCallback.                
            </javadoc>
            <method name="releasePooledConnection" type="boolean" line="218">
                <params>
                    <param name="conn" type="PooledConnection"/>
                </params>
                <comment line="225">
                    Found entry                    
                </comment>
                <comment line="228">
                    If list size exceeds prefSize, close connection                    
                </comment>
                <comment line="233">
                    size must be &gt;= 2 so don&apos;t worry about empty list                    
                </comment>
                <comment line="241">
                    Get ConnectionDesc from list to get correct state info                    
                </comment>
                <comment line="243">
                    Return connection to list, ready for reuse                    
                </comment>
                <declaration name="entry" type="ConnectionDesc" line="219"/>
                <declaration name="loc" type="int" line="220"/>
                <scope line="224">
                    <scope line="227"/>
                    <scope line="237"/>
                </scope>
                <scope line="249"/>
            </method>
            <javadoc line="254">
                Removes PooledConnection from list of connections.
                  The closing of the connection is separate from this method.
                  This method is called usually when the caller encouters an error
                  when using the connection and wants it removed from the pool.                
                <return>
                    true if conn removed; false if it was not in pool
                      public because implemented as part of PoolCallback.                    
                </return>
            </javadoc>
            <method name="removePooledConnection" type="boolean" line="264">
                <params>
                    <param name="conn" type="PooledConnection"/>
                </params>
                <comment line="274">
                    Remove softref to make pool entry eligible for GC.                    
                </comment>
                <comment line="275">
                    Once ref has been removed, it cannot be reinstated.                    
                </comment>
                <scope line="265">
                    <scope line="273"/>
                </scope>
                <scope line="280"/>
            </method>
            <javadoc line="286">
                Goes through all entries in list, removes and closes ones that have been
                  idle before threshold.                
                <param>
                    threshold an entry idle since this time has expired.                    
                </param>
                <return>
                    true if no more connections in list                    
                </return>
            </javadoc>
            <method name="expire" type="boolean" line="293">
                <params>
                    <param name="threshold" type="long"/>
                </params>
                <comment line="302">
                    remove from pool                    
                </comment>
                <comment line="304">
                    Don&apos;t need to call notify() because we&apos;re                    
                </comment>
                <comment line="305">
                    removing only idle connections. If there were                    
                </comment>
                <comment line="306">
                    idle connections, then there should be no waiters.                    
                </comment>
                <comment line="309">
                    whether whole list has &apos;expired&apos;                    
                </comment>
                <declaration name="iter" type="Iterator" line="294"/>
                <declaration name="entry" type="ConnectionDesc" line="295"/>
                <scope line="296">
                    <scope line="298"/>
                </scope>
            </method>
            <javadoc line="312">
                Called when this instance of Connections has been removed from Pool.
                  This means that no one can get any pooled connections from this
                  Connections any longer. Expire all idle connections as of &apos;now&apos;
                  and leave indicator so that any in-use connections will be closed upon
                  their return.                
            </javadoc>
            <method name="close" type="void" line="319">
                <comment line="320">
                    Expire idle connections                    
                </comment>
                <comment line="321">
                    Close in-use connections when they are returned                    
                </comment>
            </method>
            <method name="getStats" type="String" line="324">
                <declaration name="idle" type="int" line="325"/>
                <declaration name="busy" type="int" line="326"/>
                <declaration name="expired" type="int" line="327"/>
                <declaration name="use" type="long" line="328"/>
                <declaration name="len" type="int" line="329"/>
                <scope line="331">
                    <declaration name="entry" type="ConnectionDesc" line="334"/>
                    <scope line="335"/>
                </scope>
            </method>
            <method name="d" type="void" line="354">
                <params>
                    <param name="msg" type="String"/>
                    <param name="o1" type="Object"/>
                </params>
                <scope line="355"/>
            </method>
            <method name="d" type="void" line="360">
                <params>
                    <param name="msg" type="String"/>
                    <param name="i" type="int"/>
                </params>
                <scope line="361"/>
            </method>
            <method name="d" type="void" line="366">
                <params>
                    <param name="msg" type="String"/>
                </params>
                <scope line="367"/>
            </method>
            <method name="td" type="void" line="372">
                <params>
                    <param name="msg" type="String"/>
                    <param name="o1" type="Object"/>
                    <param name="o2" type="Object"/>
                </params>
                <comment line="373">
                    redo test to avoid object creation                    
                </comment>
                <scope line="373"/>
            </method>
            <method name="td" type="void" line="377">
                <params>
                    <param name="msg" type="String"/>
                    <param name="o1" type="Object"/>
                </params>
                <comment line="378">
                    redo test to avoid object creation                    
                </comment>
                <scope line="378"/>
            </method>
            <method name="td" type="void" line="382">
                <params>
                    <param name="msg" type="String"/>
                </params>
                <scope line="383"/>
            </method>
        </class>
    </source>