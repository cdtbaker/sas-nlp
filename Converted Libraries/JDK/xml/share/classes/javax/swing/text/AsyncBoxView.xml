<?xml version="1.0" encoding="UTF-8"?>
    <source package="javax.swing.text">
        <import package="java.util"/>
        <import package="java.util.List"/>
        <import package="java.awt"/>
        <import package="javax.swing.SwingUtilities"/>
        <import package="javax.swing.event.DocumentEvent"/>
        <class name="AsyncBoxView" line="33">
            <extends class="View"/>
            <comment line="459">
                --- View methods ------------------------------------                
            </comment>
            <comment line="857">
                --- variables -----------------------------------------                
            </comment>
            <javadoc line="33">
                A box that does layout asynchronously.  This
                  is useful to keep the GUI event thread moving by
                  not doing any layout on it.  The layout is done
                  on a granularity of operations on the child views.
                  After each child view is accessed for some part
                  of layout (a potentially time consuming operation)
                  the remaining tasks can be abandoned or a new higher
                  priority task (i.e. to service a synchronous request
                  or a visible area) can be taken on.
                  &lt;p&gt;
                  While the child view is being accessed
                  a read lock is aquired on the associated document
                  so that the model is stable while being accessed.                
                <author>
                    Timothy Prinzing                    
                </author>
                <since>
                    1.3                    
                </since>
            </javadoc>
            <javadoc line="53">
                Construct a box view that does asynchronous layout.                
                <param>
                    elem the element of the model to represent                    
                </param>
                <param>
                    axis the axis to tile along.  This can be
                      either X_AXIS or Y_AXIS.                    
                </param>
            </javadoc>
            <method name="AsyncBoxView" type="constructor" line="60">
                <params>
                    <param name="elem" type="Element"/>
                    <param name="axis" type="int"/>
                </params>
            </method>
            <javadoc line="70">
                Fetch the major axis (the axis the children
                  are tiled along).  This will have a value of
                  either X_AXIS or Y_AXIS.                
            </javadoc>
            <method name="getMajorAxis" type="int" line="75"/>
            <javadoc line="79">
                Fetch the minor axis (the axis orthoginal
                  to the tiled axis).  This will have a value of
                  either X_AXIS or Y_AXIS.                
            </javadoc>
            <method name="getMinorAxis" type="int" line="84"/>
            <javadoc line="88">
                Get the top part of the margin around the view.                
            </javadoc>
            <method name="getTopInset" type="float" line="91"/>
            <javadoc line="95">
                Set the top part of the margin around the view.                
                <param>
                    i the value of the inset                    
                </param>
            </javadoc>
            <method name="setTopInset" type="void" line="100">
                <params>
                    <param name="i" type="float"/>
                </params>
            </method>
            <javadoc line="104">
                Get the bottom part of the margin around the view.                
            </javadoc>
            <method name="getBottomInset" type="float" line="107"/>
            <javadoc line="111">
                Set the bottom part of the margin around the view.                
                <param>
                    i the value of the inset                    
                </param>
            </javadoc>
            <method name="setBottomInset" type="void" line="116">
                <params>
                    <param name="i" type="float"/>
                </params>
            </method>
            <javadoc line="120">
                Get the left part of the margin around the view.                
            </javadoc>
            <method name="getLeftInset" type="float" line="123"/>
            <javadoc line="127">
                Set the left part of the margin around the view.                
                <param>
                    i the value of the inset                    
                </param>
            </javadoc>
            <method name="setLeftInset" type="void" line="132">
                <params>
                    <param name="i" type="float"/>
                </params>
            </method>
            <javadoc line="136">
                Get the right part of the margin around the view.                
            </javadoc>
            <method name="getRightInset" type="float" line="139"/>
            <javadoc line="143">
                Set the right part of the margin around the view.                
                <param>
                    i the value of the inset                    
                </param>
            </javadoc>
            <method name="setRightInset" type="void" line="148">
                <params>
                    <param name="i" type="float"/>
                </params>
            </method>
            <javadoc line="152">
                Fetch the span along an axis that is taken up by the insets.                
                <param>
                    axis the axis to determine the total insets along,
                      either X_AXIS or Y_AXIS.                    
                </param>
                <since>
                    1.4                    
                </since>
            </javadoc>
            <method name="getInsetSpan" type="float" line="159">
                <params>
                    <param name="axis" type="int"/>
                </params>
                <declaration name="margin" type="float" line="160"/>
            </method>
            <javadoc line="165">
                Set the estimatedMajorSpan property that determines if the
                  major span should be treated as being estimated.  If this
                  property is true, the value of setSize along the major axis
                  will change the requirements along the major axis and incremental
                  changes will be ignored until all of the children have been updated
                  (which will cause the property to automatically be set to false).
                  If the property is false the value of the majorSpan will be
                  considered to be accurate and incremental changes will be
                  added into the total as they are calculated.                
                <since>
                    1.4                    
                </since>
            </javadoc>
            <method name="setEstimatedMajorSpan" type="void" line="178">
                <params>
                    <param name="isEstimated" type="boolean"/>
                </params>
            </method>
            <javadoc line="182">
                Is the major span currently estimated?                
                <since>
                    1.4                    
                </since>
            </javadoc>
            <method name="getEstimatedMajorSpan" type="boolean" line="187"/>
            <javadoc line="191">
                Fetch the object representing the layout state of
                  of the child at the given index.                
                <param>
                    index the child index.  This should be a
                      value >= 0 and < getViewCount().                    
                </param>
            </javadoc>
            <method name="getChildState" type="ChildState" line="198">
                <params>
                    <param name="index" type="int"/>
                </params>
                <scope line="199">
                    <scope line="200"/>
                </scope>
            </method>
            <javadoc line="207">
                Fetch the queue to use for layout.                
            </javadoc>
            <method name="getLayoutQueue" type="LayoutQueue" line="210"/>
            <javadoc line="214">
                New ChildState records are created through
                  this method to allow subclasses the extend
                  the ChildState records to do/hold more                
            </javadoc>
            <method name="createChildState" type="ChildState" line="219">
                <params>
                    <param name="v" type="View"/>
                </params>
            </method>
            <javadoc line="223">
                Requirements changed along the major axis.
                  This is called by the thread doing layout for
                  the given ChildState object when it has completed
                  fetching the child views new preferences.
                  Typically this would be the layout thread, but
                  might be the event thread if it is trying to update
                  something immediately (such as to perform a
                  model/view translation).
                  &lt;p&gt;
                  This is implemented to mark the major axis as having
                  changed so that a future check to see if the requirements
                  need to be published to the parent view will consider
                  the major axis.  If the span along the major axis is
                  not estimated, it is updated by the given delta to reflect
                  the incremental change.  The delta is ignored if the
                  major span is estimated.                
            </javadoc>
            <method name="majorRequirementChange" type="void" line="241">
                <params>
                    <param name="cs" type="ChildState"/>
                    <param name="delta" type="float"/>
                </params>
                <scope line="242"/>
            </method>
            <javadoc line="248">
                Requirements changed along the minor axis.
                  This is called by the thread doing layout for
                  the given ChildState object when it has completed
                  fetching the child views new preferences.
                  Typically this would be the layout thread, but
                  might be the GUI thread if it is trying to update
                  something immediately (such as to perform a
                  model/view translation).                
            </javadoc>
            <method name="minorRequirementChange" type="void" line="258">
                <params>
                    <param name="cs" type="ChildState"/>
                </params>
            </method>
            <javadoc line="262">
                Publish the changes in preferences upward to the parent
                  view.  This is normally called by the layout thread.                
            </javadoc>
            <method name="flushRequirementChanges" type="void" line="266">
                <comment line="276">
                    perform tasks that iterate over the children while                    
                </comment>
                <comment line="277">
                    preventing the collection from changing.                    
                </comment>
                <comment line="312">
                    message preferenceChanged                    
                </comment>
                <comment line="329">
                    propagate a preferenceChanged, using the                    
                </comment>
                <comment line="330">
                    layout thread.                    
                </comment>
                <comment line="334">
                    probably want to change this to be more exact.                    
                </comment>
                <declaration name="doc" type="AbstractDocument" line="267"/>
                <scope line="268">
                    <declaration name="parent" type="View" line="271"/>
                    <declaration name="horizontal" type="boolean" line="272"/>
                    <declaration name="vertical" type="boolean" line="273"/>
                    <scope line="275">
                        <scope line="278">
                            <declaration name="n" type="int" line="279"/>
                            <scope line="280">
                                <declaration name="q" type="LayoutQueue" line="281"/>
                                <declaration name="min" type="ChildState" line="282"/>
                                <declaration name="pref" type="ChildState" line="283"/>
                                <declaration name="span" type="float" line="284"/>
                                <scope line="285">
                                    <declaration name="cs" type="ChildState" line="286"/>
                                    <scope line="287">
                                        <scope line="288"/>
                                        <scope line="291"/>
                                    </scope>
                                    <scope line="295"/>
                                </scope>
                                <scope line="300"/>
                                <scope line="304"/>
                            </scope>
                        </scope>
                        <scope line="313">
                            <scope line="315">
                                <scope line="316"/>
                                <scope line="319"/>
                            </scope>
                        </scope>
                    </scope>
                    <scope line="331">
                        <declaration name="c" type="Component" line="335"/>
                        <scope line="336"/>
                    </scope>
                </scope>
                <scope line="340"/>
            </method>
            <javadoc line="345">
                Calls the superclass to update the child views, and
                  updates the status records for the children.  This
                  is expected to be called while a write lock is held
                  on the model so that interaction with the layout
                  thread will not happen (i.e. the layout thread
                  acquires a read lock before doing anything).                
                <param>
                    offset the starting offset into the child views >= 0                    
                </param>
                <param>
                    length the number of existing views to replace >= 0                    
                </param>
                <param>
                    views the child views to insert                    
                </param>
            </javadoc>
            <method name="replace" type="void" line="357">
                <params>
                    <param name="offset" type="int"/>
                    <param name="length" type="int"/>
                    <param name="views" type="View[]"/>
                </params>
                <comment line="359">
                    remove the replaced state records                    
                </comment>
                <comment line="370">
                    insert the state records for the new children                    
                </comment>
                <comment line="380">
                    notify that the size changed                    
                </comment>
                <scope line="358">
                    <scope line="360">
                        <declaration name="cs" type="ChildState" line="361"/>
                        <declaration name="csSpan" type="float" line="362"/>
                        <scope line="365"/>
                    </scope>
                    <declaration name="q" type="LayoutQueue" line="371"/>
                    <scope line="372">
                        <scope line="373">
                            <declaration name="s" type="ChildState" line="374"/>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="385">
                Loads all of the children to initialize the view.
                  This is called by the {@link #setParent setParent}method.  Subclasses can reimplement this to initialize
                  their child views in a different manner.  The default
                  implementation creates a child view for each
                  child element.
                  &lt;p&gt;
                  Normally a write-lock is held on the Document while
                  the children are being changed, which keeps the rendering
                  and layout threads safe.  The exception to this is when
                  the view is initialized to represent an existing element
                  (via this method), so it is synchronized to exclude
                  preferenceChanged while we are initializing.                
                <param>
                    f the view factory                    
                </param>
                <see>
                    #setParent                    
                </see>
            </javadoc>
            <method name="loadChildren" type="void" line="403">
                <params>
                    <param name="f" type="ViewFactory"/>
                </params>
                <declaration name="e" type="Element" line="404"/>
                <declaration name="n" type="int" line="405"/>
                <scope line="406">
                    <declaration name="added" type="View[]" line="407"/>
                    <scope line="408"/>
                </scope>
            </method>
            <javadoc line="415">
                Fetches the child view index representing the given position in
                  the model.  This is implemented to fetch the view in the case
                  where there is a child view for each child element.                
                <param>
                    pos the position >= 0                    
                </param>
                <return>
                    index of the view representing the given position, or
                      -1 if no view represents that position                    
                </return>
            </javadoc>
            <method name="getViewIndexAtPosition" type="int" line="424">
                <params>
                    <param name="pos" type="int"/>
                    <param name="b" type="Position.Bias"/>
                </params>
                <declaration name="isBackward" type="boolean" line="425"/>
                <declaration name="elem" type="Element" line="427"/>
            </method>
            <javadoc line="431">
                Update the layout in response to receiving notification of
                  change from the model.  This is implemented to note the
                  change on the ChildLocator so that offsets of the children
                  will be correctly computed.                
                <param>
                    ec changes to the element this view is responsible
                      for (may be null if there were no changes).                    
                </param>
                <param>
                    e the change information from the associated document                    
                </param>
                <param>
                    a the current allocation of the view                    
                </param>
                <see>
                    #insertUpdate                    
                </see>
                <see>
                    #removeUpdate                    
                </see>
                <see>
                    #changedUpdate                    
                </see>
            </javadoc>
            <method name="updateLayout" type="void" line="446">
                <params>
                    <param name="ec" type="DocumentEvent.ElementChange"/>
                    <param name="e" type="DocumentEvent"/>
                    <param name="a" type="Shape"/>
                </params>
                <comment line="448">
                    the newly inserted children don&apos;t have a valid                    
                </comment>
                <comment line="449">
                    offset so the child locator needs to be messaged                    
                </comment>
                <comment line="450">
                    that the child prior to the new children has                    
                </comment>
                <comment line="451">
                    changed size.                    
                </comment>
                <scope line="447">
                    <declaration name="index" type="int" line="452"/>
                    <declaration name="cs" type="ChildState" line="453"/>
                </scope>
            </method>
            <javadoc line="460">
                Sets the parent of the view.
                  This is reimplemented to provide the superclass
                  behavior as well as calling the &lt;code&gt;loadChildren&lt;/code&gt;
                  method if this view does not already have children.
                  The children should not be loaded in the
                  constructor because the act of setting the parent
                  may cause them to try to search up the hierarchy
                  (to get the hosting Container for example).
                  If this view has children (the view is being moved
                  from one place in the view hierarchy to another),
                  the &lt;code&gt;loadChildren&lt;/code&gt; method will not be called.                
                <param>
                    parent the parent of the view, null if none                    
                </param>
            </javadoc>
            <method name="setParent" type="void" line="475">
                <params>
                    <param name="parent" type="View"/>
                </params>
                <scope line="477">
                    <declaration name="f" type="ViewFactory" line="478"/>
                </scope>
            </method>
            <javadoc line="483">
                Child views can call this on the parent to indicate that
                  the preference has changed and should be reconsidered
                  for layout.  This is reimplemented to queue new work
                  on the layout thread.  This method gets messaged from
                  multiple threads via the children.                
                <param>
                    child the child view                    
                </param>
                <param>
                    width true if the width preference has changed                    
                </param>
                <param>
                    height true if the height preference has changed                    
                </param>
                <see>
                    javax.swing.JComponent#revalidate                    
                </see>
            </javadoc>
            <method name="preferenceChanged" type="void" line="495">
                <params>
                    <param name="child" type="View"/>
                    <param name="width" type="boolean"/>
                    <param name="height" type="boolean"/>
                </params>
                <comment line="502">
                    size was being changed on the child, no need to                    
                </comment>
                <comment line="503">
                    queue work for it.                    
                </comment>
                <scope line="496"/>
                <scope line="498">
                    <scope line="499">
                        <declaration name="cv" type="View" line="500"/>
                        <scope line="501"/>
                    </scope>
                    <declaration name="index" type="int" line="508"/>
                    <declaration name="cs" type="ChildState" line="510"/>
                    <declaration name="q" type="LayoutQueue" line="512"/>
                </scope>
            </method>
            <javadoc line="518">
                Sets the size of the view.  This should cause
                  layout of the view if the view caches any layout
                  information.
                  &lt;p&gt;
                  Since the major axis is updated asynchronously and should be
                  the sum of the tiled children the call is ignored for the major
                  axis.  Since the minor axis is flexible, work is queued to resize
                  the children if the minor span changes.                
                <param>
                    width the width >= 0                    
                </param>
                <param>
                    height the height >= 0                    
                </param>
            </javadoc>
            <method name="setSize" type="void" line="531">
                <params>
                    <param name="width" type="float"/>
                    <param name="height" type="float"/>
                </params>
            </method>
            <javadoc line="536">
                Retrieves the size of the view along an axis.                
                <param>
                    axis may be either <code>View.X_AXIS</code> or
                      <code>View.Y_AXIS</code>                    
                </param>
                <return>
                    the current span of the view along the given axis, >= 0                    
                </return>
            </javadoc>
            <method name="getSpanOnAxis" type="float" line="543">
                <params>
                    <param name="axis" type="int"/>
                </params>
                <scope line="544"/>
            </method>
            <javadoc line="550">
                Sets the size of the view along an axis.  Since the major
                  axis is updated asynchronously and should be the sum of the
                  tiled children the call is ignored for the major axis.  Since
                  the minor axis is flexible, work is queued to resize the
                  children if the minor span changes.                
                <param>
                    axis may be either <code>View.X_AXIS</code> or
                      <code>View.Y_AXIS</code>                    
                </param>
                <param>
                    span the span to layout to >= 0                    
                </param>
            </javadoc>
            <method name="setSpanOnAxis" type="void" line="561">
                <params>
                    <param name="axis" type="int"/>
                    <param name="span" type="float"/>
                </params>
                <comment line="568">
                    mark all of the ChildState instances as needing to                    
                </comment>
                <comment line="569">
                    resize the child, and queue up work to fix them.                    
                </comment>
                <comment line="582">
                    along the major axis the value is ignored                    
                </comment>
                <comment line="583">
                    unless the estimatedMajorSpan property is                    
                </comment>
                <comment line="584">
                    true.                    
                </comment>
                <declaration name="margin" type="float" line="562"/>
                <scope line="563">
                    <declaration name="targetSpan" type="float" line="564"/>
                    <scope line="565">
                        <declaration name="n" type="int" line="570"/>
                        <scope line="571">
                            <declaration name="q" type="LayoutQueue" line="572"/>
                            <scope line="573">
                                <declaration name="cs" type="ChildState" line="574"/>
                            </scope>
                        </scope>
                    </scope>
                </scope>
                <scope line="581">
                    <scope line="585"/>
                </scope>
            </method>
            <javadoc line="591">
                Render the view using the given allocation and
                  rendering surface.
                  &lt;p&gt;
                  This is implemented to determine whether or not the
                  desired region to be rendered (i.e. the unclipped
                  area) is up to date or not.  If up-to-date the children
                  are rendered.  If not up-to-date, a task to build
                  the desired area is placed on the layout queue as
                  a high priority task.  This keeps by event thread
                  moving by rendering if ready, and postponing until
                  a later time if not ready (since paint requests
                  can be rescheduled).                
                <param>
                    g the rendering surface to use                    
                </param>
                <param>
                    alloc the allocated region to render into                    
                </param>
                <see>
                    View#paint                    
                </see>
            </javadoc>
            <method name="paint" type="void" line="609">
                <params>
                    <param name="g" type="Graphics"/>
                    <param name="alloc" type="Shape"/>
                </params>
                <scope line="610"/>
            </method>
            <javadoc line="616">
                Determines the preferred span for this view along an
                  axis.                
                <param>
                    axis may be either View.X_AXIS or View.Y_AXIS                    
                </param>
                <return>
                    the span the view would like to be rendered into >= 0.
                      Typically the view is told to render into the span
                      that is returned, although there is no guarantee.
                      The parent may choose to resize or break the view.                    
                </return>
                <exception>
                    IllegalArgumentException for an invalid axis type                    
                </exception>
            </javadoc>
            <method name="getPreferredSpan" type="float" line="627">
                <params>
                    <param name="axis" type="int"/>
                </params>
                <comment line="637">
                    nothing is known about the children yet                    
                </comment>
                <declaration name="margin" type="float" line="628"/>
                <scope line="629"/>
                <scope line="632">
                    <declaration name="child" type="View" line="633"/>
                </scope>
            </method>
            <javadoc line="641">
                Determines the minimum span for this view along an
                  axis.                
                <param>
                    axis may be either View.X_AXIS or View.Y_AXIS                    
                </param>
                <return>
                    the span the view would like to be rendered into >= 0.
                      Typically the view is told to render into the span
                      that is returned, although there is no guarantee.
                      The parent may choose to resize or break the view.                    
                </return>
                <exception>
                    IllegalArgumentException for an invalid axis type                    
                </exception>
            </javadoc>
            <method name="getMinimumSpan" type="float" line="652">
                <params>
                    <param name="axis" type="int"/>
                </params>
                <comment line="661">
                    nothing is known about the children yet                    
                </comment>
                <scope line="653"/>
                <scope line="656">
                    <declaration name="child" type="View" line="657"/>
                </scope>
                <scope line="662"/>
                <scope line="664"/>
            </method>
            <javadoc line="669">
                Determines the maximum span for this view along an
                  axis.                
                <param>
                    axis may be either View.X_AXIS or View.Y_AXIS                    
                </param>
                <return>
                    the span the view would like to be rendered into >= 0.
                      Typically the view is told to render into the span
                      that is returned, although there is no guarantee.
                      The parent may choose to resize or break the view.                    
                </return>
                <exception>
                    IllegalArgumentException for an invalid axis type                    
                </exception>
            </javadoc>
            <method name="getMaximumSpan" type="float" line="680">
                <params>
                    <param name="axis" type="int"/>
                </params>
                <scope line="681"/>
            </method>
            <javadoc line="688">
                Returns the number of views in this view.  Since
                  the default is to not be a composite view this
                  returns 0.                
                <return>
                    the number of views >= 0                    
                </return>
                <see>
                    View#getViewCount                    
                </see>
            </javadoc>
            <method name="getViewCount" type="int" line="696">
                <scope line="697"/>
            </method>
            <javadoc line="702">
                Gets the nth child view.  Since there are no
                  children by default, this returns null.                
                <param>
                    n the number of the view to get, >= 0 && < getViewCount()                    
                </param>
                <return>
                    the view                    
                </return>
            </javadoc>
            <method name="getView" type="View" line="709">
                <params>
                    <param name="n" type="int"/>
                </params>
                <declaration name="cs" type="ChildState" line="710"/>
                <scope line="711"/>
            </method>
            <javadoc line="717">
                Fetches the allocation for the given child view.
                  This enables finding out where various views
                  are located, without assuming the views store
                  their location.  This returns null since the
                  default is to not have any child views.                
                <param>
                    index the index of the child, >= 0 && < getViewCount()                    
                </param>
                <param>
                    a  the allocation to this view.                    
                </param>
                <return>
                    the allocation to the child                    
                </return>
            </javadoc>
            <method name="getChildAllocation" type="Shape" line="728">
                <params>
                    <param name="index" type="int"/>
                    <param name="a" type="Shape"/>
                </params>
                <declaration name="ca" type="Shape" line="729"/>
            </method>
            <javadoc line="733">
                Returns the child view index representing the given position in
                  the model.  By default a view has no children so this is implemented
                  to return -1 to indicate there is no valid child index for any
                  position.                
                <param>
                    pos the position >= 0                    
                </param>
                <return>
                    index of the view representing the given position, or
                      -1 if no view represents that position                    
                </return>
                <since>
                    1.3                    
                </since>
            </javadoc>
            <method name="getViewIndex" type="int" line="744">
                <params>
                    <param name="pos" type="int"/>
                    <param name="b" type="Position.Bias"/>
                </params>
            </method>
            <javadoc line="748">
                Provides a mapping from the document model coordinate space
                  to the coordinate space of the view mapped to it.                
                <param>
                    pos the position to convert >= 0                    
                </param>
                <param>
                    a the allocated region to render into                    
                </param>
                <param>
                    b the bias toward the previous character or the
                      next character represented by the offset, in case the
                      position is a boundary of two views.                    
                </param>
                <return>
                    the bounding box of the given position is returned                    
                </return>
                <exception>
                    BadLocationException  if the given position does
                      not represent a valid location in the associated document                    
                </exception>
                <exception>
                    IllegalArgumentException for an invalid bias argument                    
                </exception>
                <see>
                    View#viewToModel                    
                </see>
            </javadoc>
            <method name="modelToView" type="Shape" line="763">
                <params>
                    <param name="pos" type="int"/>
                    <param name="a" type="Shape"/>
                    <param name="b" type="Position.Bias"/>
                </params>
                <comment line="767">
                    forward to the child view, and make sure we don&apos;t                    
                </comment>
                <comment line="768">
                    interact with the layout thread by synchronizing                    
                </comment>
                <comment line="769">
                    on the child state.                    
                </comment>
                <declaration name="index" type="int" line="764"/>
                <declaration name="ca" type="Shape" line="765"/>
                <declaration name="cs" type="ChildState" line="770"/>
                <scope line="771">
                    <declaration name="cv" type="View" line="772"/>
                    <declaration name="v" type="Shape" line="773"/>
                </scope>
            </method>
            <javadoc line="778">
                Provides a mapping from the view coordinate space to the logical
                  coordinate space of the model.  The biasReturn argument will be
                  filled in to indicate that the point given is closer to the next
                  character in the model or the previous character in the model.
                  &lt;p&gt;
                  This is expected to be called by the GUI thread, holding a
                  read-lock on the associated model.  It is implemented to
                  locate the child view and determine it&apos;s allocation with a
                  lock on the ChildLocator object, and to call viewToModel
                  on the child view with a lock on the ChildState object
                  to avoid interaction with the layout thread.                
                <param>
                    x the X coordinate >= 0                    
                </param>
                <param>
                    y the Y coordinate >= 0                    
                </param>
                <param>
                    a the allocated region to render into                    
                </param>
                <return>
                    the location within the model that best represents the
                      given point in the view >= 0.  The biasReturn argument will be
                      filled in to indicate that the point given is closer to the next
                      character in the model or the previous character in the model.                    
                </return>
            </javadoc>
            <method name="viewToModel" type="int" line="799">
                <params>
                    <param name="x" type="float"/>
                    <param name="y" type="float"/>
                    <param name="a" type="Shape"/>
                    <param name="biasReturn" type="Position.Bias[]"/>
                </params>
                <comment line="800">
                    return position                    
                </comment>
                <comment line="801">
                    child index to forward to                    
                </comment>
                <comment line="802">
                    child allocation                    
                </comment>
                <comment line="804">
                    locate the child view and it&apos;s allocation so that                    
                </comment>
                <comment line="805">
                    we can forward to it.  Make sure the layout thread                    
                </comment>
                <comment line="806">
                    doesn&apos;t change anything by trying to flush changes                    
                </comment>
                <comment line="807">
                    to the parent while the GUI thread is trying to                    
                </comment>
                <comment line="808">
                    find the child and it&apos;s allocation.                    
                </comment>
                <comment line="814">
                    forward to the child view, and make sure we don&apos;t                    
                </comment>
                <comment line="815">
                    interact with the layout thread by synchronizing                    
                </comment>
                <comment line="816">
                    on the child state.                    
                </comment>
                <declaration name="pos" type="int" line="800"/>
                <declaration name="index" type="int" line="801"/>
                <declaration name="ca" type="Shape" line="802"/>
                <scope line="809"/>
                <declaration name="cs" type="ChildState" line="817"/>
                <scope line="818">
                    <declaration name="v" type="View" line="819"/>
                </scope>
            </method>
            <javadoc line="825">
                Provides a way to determine the next visually represented model
                  location that one might place a caret.  Some views may not be visible,
                  they might not be in the same order found in the model, or they just
                  might not allow access to some of the locations in the model.                
                <param>
                    pos the position to convert >= 0                    
                </param>
                <param>
                    a the allocated region to render into                    
                </param>
                <param>
                    direction the direction from the current position that can
                      be thought of as the arrow keys typically found on a keyboard;
                      this may be one of the following:
                      <ul>
                      <code>SwingConstants.WEST</code>
                      <code>SwingConstants.EAST</code>
                      <code>SwingConstants.NORTH</code>
                      <code>SwingConstants.SOUTH</code>
                      </ul>                    
                </param>
                <param>
                    biasRet an array contain the bias that was checked                    
                </param>
                <return>
                    the location within the model that best represents the next
                      location visual position                    
                </return>
                <exception>
                    BadLocationException                    
                </exception>
                <exception>
                    IllegalArgumentException if <code>direction</code> is invalid                    
                </exception>
            </javadoc>
            <method name="getNextVisualPositionFrom" type="int" line="851">
                <params>
                    <param name="pos" type="int"/>
                    <param name="b" type="Position.Bias"/>
                    <param name="a" type="Shape"/>
                    <param name="direction" type="int"/>
                    <param name="biasRet" type="Position.Bias[]"/>
                </params>
            </method>
            <declaration name="axis" type="int" line="858"/>
            <javadoc line="858">
                The major axis against which the children are
                  tiled.                
            </javadoc>
            <declaration name="stats" type="List&lt;ChildState&gt;" line="864"/>
            <javadoc line="864">
                The children and their layout statistics.                
            </javadoc>
            <declaration name="majorSpan" type="float" line="869"/>
            <javadoc line="869">
                Current span along the major axis.  This
                  is also the value returned by getMinimumSize,
                  getPreferredSize, and getMaximumSize along
                  the major axis.                
            </javadoc>
            <declaration name="estimatedMajorSpan" type="boolean" line="877"/>
            <javadoc line="877">
                Is the span along the major axis estimated?                
            </javadoc>
            <declaration name="minorSpan" type="float" line="882"/>
            <javadoc line="882">
                Current span along the minor axis.  This
                  is what layout was done against (i.e. things
                  are flexible in this direction).                
            </javadoc>
            <declaration name="locator" type="ChildLocator" line="889"/>
            <javadoc line="889">
                Object that manages the offsets of the
                  children.  All locking for management of
                  child locations is on this object.                
            </javadoc>
            <declaration name="topInset" type="float" line="896"/>
            <declaration name="bottomInset" type="float" line="897"/>
            <declaration name="leftInset" type="float" line="898"/>
            <declaration name="rightInset" type="float" line="899"/>
            <declaration name="minRequest" type="ChildState" line="901"/>
            <declaration name="prefRequest" type="ChildState" line="902"/>
            <declaration name="majorChanged" type="boolean" line="903"/>
            <declaration name="minorChanged" type="boolean" line="904"/>
            <declaration name="flushTask" type="Runnable" line="905"/>
            <declaration name="changing" type="ChildState" line="907"/>
            <javadoc line="907">
                Child that is actively changing size.  This often
                  causes a preferenceChanged, so this is a cache to
                  possibly speed up the marking the state.  It also
                  helps flag an opportunity to avoid adding to flush
                  task to the layout queue.                
            </javadoc>
            <class name="ChildLocator" line="916">
                <comment line="1395">
                    minor axis                    
                </comment>
                <comment line="1401">
                    major axis                    
                </comment>
                <javadoc line="916">
                    A class to manage the effective position of the
                      child views in a localized area while changes are
                      being made around the localized area.  The AsyncBoxView
                      may be continuously changing, but the visible area
                      needs to remain fairly stable until the layout thread
                      decides to publish an update to the parent.                    
                    <since>
                        1.3                        
                    </since>
                </javadoc>
                <javadoc line="927">
                    construct a child locator.                    
                </javadoc>
                <method name="ChildLocator" type="constructor" line="930"/>
                <javadoc line="935">
                    Notification that a child changed.  This can effect
                      whether or not new offset calculations are needed.
                      This is called by a ChildState object that has
                      changed it&apos;s major span.  This can therefore be
                      called by multiple threads.                    
                </javadoc>
                <method name="childChanged" type="void" line="942">
                    <params>
                        <param name="cs" type="ChildState"/>
                    </params>
                    <scope line="943"/>
                    <scope line="946"/>
                </method>
                <javadoc line="951">
                    Paint the children that intersect the clip area.                    
                </javadoc>
                <method name="paintChildren" type="void" line="954">
                    <params>
                        <param name="g" type="Graphics"/>
                    </params>
                    <comment line="971">
                        done painting intersection                        
                    </comment>
                    <declaration name="clip" type="Rectangle" line="955"/>
                    <declaration name="targetOffset" type="float" line="956"/>
                    <declaration name="index" type="int" line="958"/>
                    <declaration name="n" type="int" line="959"/>
                    <declaration name="offs" type="float" line="960"/>
                    <scope line="961">
                        <declaration name="cs" type="ChildState" line="962"/>
                        <declaration name="ca" type="Shape" line="964"/>
                        <scope line="965">
                            <scope line="966">
                                <declaration name="v" type="View" line="967"/>
                            </scope>
                        </scope>
                        <scope line="970"/>
                    </scope>
                </method>
                <javadoc line="978">
                    Fetch the allocation to use for a child view.
                      This will update the offsets for all children
                      not yet updated before the given index.                    
                </javadoc>
                <method name="getChildAllocation" type="Shape" line="983">
                    <params>
                        <param name="index" type="int"/>
                        <param name="a" type="Shape"/>
                    </params>
                    <comment line="994">
                        offsets need to be updated                        
                    </comment>
                    <scope line="984"/>
                    <declaration name="cs" type="ChildState" line="988"/>
                    <scope line="989"/>
                    <scope line="993"/>
                    <declaration name="ca" type="Shape" line="997"/>
                </method>
                <javadoc line="1001">
                    Fetches the child view index at the given point.
                      This is called by the various View methods that
                      need to calculate which child to forward a message
                      to.  This should be called by a block synchronized
                      on this object, and would typically be followed
                      with one or more calls to getChildAllocation that
                      should also be in the synchronized block.                    
                    <param>
                        x the X coordinate >= 0                        
                    </param>
                    <param>
                        y the Y coordinate >= 0                        
                    </param>
                    <param>
                        a the allocation to the View                        
                    </param>
                    <return>
                        the nearest child index                        
                    </return>
                </javadoc>
                <method name="getViewIndexAtPoint" type="int" line="1015">
                    <params>
                        <param name="x" type="float"/>
                        <param name="y" type="float"/>
                        <param name="a" type="Shape"/>
                    </params>
                    <declaration name="targetOffset" type="float" line="1017"/>
                    <declaration name="index" type="int" line="1018"/>
                </method>
                <javadoc line="1022">
                    Fetch the allocation to use for a child view.
                      &lt;em&gt;This does not update the offsets in the ChildState
                      records.&lt;/em&gt;                    
                </javadoc>
                <method name="getChildAllocation" type="Shape" line="1027">
                    <params>
                        <param name="index" type="int"/>
                    </params>
                    <declaration name="cs" type="ChildState" line="1028"/>
                    <scope line="1029"/>
                    <scope line="1032"/>
                    <scope line="1037"/>
                </method>
                <javadoc line="1048">
                    Copy the currently allocated shape into the Rectangle
                      used to store the current allocation.  This would be
                      a floating point rectangle in a Java2D-specific implmentation.                    
                </javadoc>
                <method name="setAllocation" type="void" line="1053">
                    <params>
                        <param name="a" type="Shape"/>
                    </params>
                    <scope line="1054"/>
                    <scope line="1056"/>
                </method>
                <javadoc line="1062">
                    Locate the view responsible for an offset into the box
                      along the major axis.  Make sure that offsets are set
                      on the ChildState objects up to the given target span
                      past the desired offset.                    
                    <return>
                        index of the view representing the given visual
                          location (targetOffset), or -1 if no view represents
                          that location                        
                    </return>
                </javadoc>
                <method name="getViewIndexAtVisualOffset" type="int" line="1072">
                    <params>
                        <param name="targetOffset" type="float"/>
                    </params>
                    <comment line="1081">
                        should only get here on the first time display.                        
                    </comment>
                    <comment line="1089">
                        roll offset calculations forward                        
                    </comment>
                    <comment line="1092">
                        no changes prior to the needed offset                        
                    </comment>
                    <comment line="1093">
                        this should be a binary search                        
                    </comment>
                    <declaration name="n" type="int" line="1073"/>
                    <scope line="1074">
                        <declaration name="lastValid" type="boolean" line="1075"/>
                        <scope line="1077"/>
                        <scope line="1080">
                            <scope line="1082"/>
                            <declaration name="pos" type="int" line="1085"/>
                            <declaration name="index" type="int" line="1086"/>
                        </scope>
                        <scope line="1088"/>
                        <scope line="1091">
                            <declaration name="offs" type="float" line="1094"/>
                            <scope line="1095">
                                <declaration name="cs" type="ChildState" line="1096"/>
                                <declaration name="nextOffs" type="float" line="1097"/>
                                <scope line="1098"/>
                            </scope>
                        </scope>
                    </scope>
                </method>
                <javadoc line="1108">
                    Move the location of the last offset calculation forward
                      to the desired offset.                    
                </javadoc>
                <method name="updateChildOffsets" type="int" line="1112">
                    <params>
                        <param name="targetOffset" type="float"/>
                    </params>
                    <declaration name="n" type="int" line="1113"/>
                    <declaration name="targetIndex" type="int" line="1114"/>
                    <declaration name="pos" type="int" line="1115"/>
                    <declaration name="startIndex" type="int" line="1116"/>
                    <declaration name="start" type="float" line="1117"/>
                    <declaration name="lastOffset" type="float" line="1118"/>
                    <scope line="1119">
                        <declaration name="cs" type="ChildState" line="1120"/>
                        <scope line="1123"/>
                    </scope>
                </method>
                <javadoc line="1133">
                    Move the location of the last offset calculation forward
                      to the desired index.                    
                </javadoc>
                <method name="updateChildOffsetsToIndex" type="void" line="1137">
                    <params>
                        <param name="index" type="int"/>
                    </params>
                    <declaration name="pos" type="int" line="1138"/>
                    <declaration name="startIndex" type="int" line="1139"/>
                    <declaration name="lastOffset" type="float" line="1140"/>
                    <scope line="1141">
                        <declaration name="cs" type="ChildState" line="1142"/>
                    </scope>
                </method>
                <method name="intersectsClip" type="boolean" line="1148">
                    <params>
                        <param name="childAlloc" type="Shape"/>
                        <param name="clip" type="Rectangle"/>
                    </params>
                    <comment line="1152">
                        Make sure that lastAlloc also contains childAlloc,                        
                    </comment>
                    <comment line="1153">
                        this will be false if haven&apos;t yet flushed changes.                        
                    </comment>
                    <declaration name="cs" type="Rectangle" line="1149"/>
                    <scope line="1151"/>
                </method>
                <declaration name="lastValidOffset" type="ChildState" line="1159"/>
                <javadoc line="1159">
                    The location of the last offset calculation
                      that is valid.                    
                </javadoc>
                <declaration name="lastAlloc" type="Rectangle" line="1165"/>
                <javadoc line="1165">
                    The last seen allocation (for repainting when changes
                      are flushed upward).                    
                </javadoc>
                <declaration name="childAlloc" type="Rectangle" line="1171"/>
                <javadoc line="1171">
                    A shape to use for the child allocation to avoid
                      creating a lot of garbage.                    
                </javadoc>
            </class>
            <class name="ChildState" line="1178">
                <comment line="1395">
                    minor axis                    
                </comment>
                <comment line="1401">
                    major axis                    
                </comment>
                <implements interface="Runnable"/>
                <javadoc line="1178">
                    A record representing the layout state of a
                      child view.  It is runnable as a task on another
                      thread.  All access to the child view that is
                      based upon a read-lock on the model should synchronize
                      on this object (i.e. The layout thread and the GUI
                      thread can both have a read lock on the model at the
                      same time and are not protected from each other).
                      Access to a child view hierarchy is serialized via
                      synchronization on the ChildState instance.                    
                    <since>
                        1.3                        
                    </since>
                </javadoc>
                <javadoc line="1192">
                    Construct a child status.  This needs to start
                      out as fairly large so we don&apos;t falsely begin with
                      the idea that all of the children are visible.                    
                    <since>
                        1.4                        
                    </since>
                </javadoc>
                <method name="ChildState" type="constructor" line="1198">
                    <params>
                        <param name="v" type="View"/>
                    </params>
                </method>
                <javadoc line="1206">
                    Fetch the child view this record represents                    
                </javadoc>
                <method name="getChildView" type="View" line="1209"/>
                <javadoc line="1213">
                    Update the child state.  This should be
                      called by the thread that desires to spend
                      time updating the child state (intended to
                      be the layout thread).
                      &lt;p&gt;
                      This aquires a read lock on the associated
                      document for the duration of the update to
                      ensure the model is not changed while it is
                      operating.  The first thing to do would be
                      to see if any work actually needs to be done.
                      The following could have conceivably happened
                      while the state was waiting to be updated:
                      &lt;ol&gt;
                      &lt;li&gt;The child may have been removed from the
                      view hierarchy.
                      &lt;li&gt;The child may have been updated by a
                      higher priority operation (i.e. the child
                      may have become visible).
                      &lt;/ol&gt;                    
                </javadoc>
                <method name="run" type="void" line="1234">
                    <comment line="1239">
                        nothing to do                        
                    </comment>
                    <comment line="1243">
                        this may overwrite anothers threads cached                        
                    </comment>
                    <comment line="1244">
                        value for actively changing... but that just                        
                    </comment>
                    <comment line="1245">
                        means it won&apos;t use the cache if there is an                        
                    </comment>
                    <comment line="1246">
                        overwrite.                        
                    </comment>
                    <comment line="1255">
                        setting the child size on the minor axis                        
                    </comment>
                    <comment line="1256">
                        may have caused it to change it&apos;s preference                        
                    </comment>
                    <comment line="1257">
                        along the major axis.                        
                    </comment>
                    <declaration name="doc" type="AbstractDocument" line="1235"/>
                    <scope line="1236">
                        <scope line="1238"/>
                        <scope line="1242">
                            <scope line="1247"/>
                            <scope line="1251"/>
                        </scope>
                    </scope>
                    <scope line="1260"/>
                </method>
                <method name="updateChild" type="void" line="1265">
                    <declaration name="minorUpdated" type="boolean" line="1266"/>
                    <scope line="1267">
                        <scope line="1268">
                            <declaration name="minorAxis" type="int" line="1269"/>
                        </scope>
                    </scope>
                    <scope line="1277"/>
                    <declaration name="majorUpdated" type="boolean" line="1281"/>
                    <declaration name="delta" type="float" line="1282"/>
                    <scope line="1283">
                        <scope line="1284">
                            <declaration name="old" type="float" line="1285"/>
                        </scope>
                    </scope>
                    <scope line="1292"/>
                    <scope line="1297">
                        <scope line="1298">
                            <declaration name="w" type="float" line="1299"/>
                            <declaration name="h" type="float" line="1300"/>
                            <scope line="1301"/>
                            <scope line="1304"/>
                        </scope>
                    </scope>
                </method>
                <javadoc line="1315">
                    What is the span along the minor axis.                    
                </javadoc>
                <method name="getMinorSpan" type="float" line="1318">
                    <comment line="1322">
                        make it the target width, or as small as it can get.                        
                    </comment>
                    <scope line="1319"/>
                </method>
                <javadoc line="1326">
                    What is the offset along the minor axis                    
                </javadoc>
                <method name="getMinorOffset" type="float" line="1329">
                    <comment line="1331">
                        can&apos;t make the child this wide, align it                        
                    </comment>
                    <scope line="1330">
                        <declaration name="align" type="float" line="1332"/>
                    </scope>
                </method>
                <javadoc line="1338">
                    What is the span along the major axis.                    
                </javadoc>
                <method name="getMajorSpan" type="float" line="1341"/>
                <javadoc line="1345">
                    Get the offset along the major axis                    
                </javadoc>
                <method name="getMajorOffset" type="float" line="1348"/>
                <javadoc line="1352">
                    This method should only be called by the ChildLocator,
                      it is simply a convenient place to hold the cached
                      location.                    
                </javadoc>
                <method name="setMajorOffset" type="void" line="1357">
                    <params>
                        <param name="offs" type="float"/>
                    </params>
                </method>
                <javadoc line="1361">
                    Mark preferences changed for this child.                    
                    <param>
                        width true if the width preference has changed                        
                    </param>
                    <param>
                        height true if the height preference has changed                        
                    </param>
                    <see>
                        javax.swing.JComponent#revalidate                        
                    </see>
                </javadoc>
                <method name="preferenceChanged" type="void" line="1368">
                    <params>
                        <param name="width" type="boolean"/>
                        <param name="height" type="boolean"/>
                    </params>
                    <scope line="1369">
                        <scope line="1370"/>
                        <scope line="1373"/>
                    </scope>
                    <scope line="1376">
                        <scope line="1377"/>
                        <scope line="1380"/>
                    </scope>
                </method>
                <javadoc line="1387">
                    Has the child view been laid out.                    
                </javadoc>
                <method name="isLayoutValid" type="boolean" line="1390"/>
                <declaration name="min" type="float" line="1395"/>
                <declaration name="pref" type="float" line="1396"/>
                <declaration name="max" type="float" line="1397"/>
                <declaration name="minorValid" type="boolean" line="1398"/>
                <declaration name="span" type="float" line="1401"/>
                <declaration name="offset" type="float" line="1402"/>
                <declaration name="majorValid" type="boolean" line="1403"/>
                <declaration name="child" type="View" line="1405"/>
                <declaration name="childSizeValid" type="boolean" line="1406"/>
            </class>
            <class name="FlushTask" line="1409">
                <comment line="1395">
                    minor axis                    
                </comment>
                <comment line="1401">
                    major axis                    
                </comment>
                <implements interface="Runnable"/>
                <javadoc line="1409">
                    Task to flush requirement changes upward                    
                </javadoc>
                <method name="run" type="void" line="1414"/>
            </class>
        </class>
    </source>