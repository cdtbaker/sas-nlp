<?xml version="1.0" encoding="UTF-8"?>
    <source package="javax.security.auth">
        <import package="java.security.AccessController"/>
        <import package="java.security.Permission"/>
        <import package="java.security.Permissions"/>
        <import package="java.security.PermissionCollection"/>
        <import package="java.security.Policy"/>
        <import package="java.security.Principal"/>
        <import package="java.security.PrivilegedAction"/>
        <import package="java.security.ProtectionDomain"/>
        <import package="java.security.Security"/>
        <import package="java.util.Set"/>
        <import package="java.util.WeakHashMap"/>
        <import package="java.lang.ref.WeakReference"/>
        <class name="SubjectDomainCombiner" line="14">
            <implements interface="java.security.DomainCombiner"/>
            <javadoc line="14">
                A &lt;code&gt;SubjectDomainCombiner&lt;/code&gt; updates ProtectionDomains
                  with Principals from the &lt;code&gt;Subject&lt;/code&gt; associated with this
                  &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.                
            </javadoc>
            <declaration name="subject" type="Subject" line="20"/>
            <declaration name="cachedPDs" type="WeakKeyValueMap&amp;lt;ProtectionDomain,ProtectionDomain&amp;gt;" line="21"/>
            <declaration name="principalSet" type="Set&amp;lt;Principal&amp;gt;" line="22"/>
            <declaration name="principals" type="Principal[]" line="23"/>
            <declaration name="debug" type="sun.security.util.Debug" line="24"/>
            <declaration name="useJavaxPolicy" type="boolean" line="25"/>
            <declaration name="allowCaching" type="boolean" line="26"/>
            <javadoc line="27">
                Associate the provided &lt;code&gt;Subject&lt;/code&gt; with this
                  &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.
                  &lt;p&gt;                
                <param>
                    subject the &lt;code&gt;Subject&lt;/code&gt; to be associated with
                      with this &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.                    
                </param>
            </javadoc>
            <method name="SubjectDomainCombiner" type="constructor" line="34">
                <params>
                    <param name="subject" type="Subject"/>
                </params>
                <scope line="36"/>
            </method>
            <javadoc line="41">
                Get the &lt;code&gt;Subject&lt;/code&gt; associated with this
                  &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.
                  &lt;p&gt;                
                <return>
                    the &lt;code&gt;Subject&lt;/code&gt; associated with this
                      &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;, or &lt;code&gt;null&lt;/code&gt;
                      if no &lt;code&gt;Subject&lt;/code&gt; is associated with this
                      &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.                    
                </return>
                <exception>
                    SecurityException if the caller does not have permission
                      to get the &lt;code&gt;Subject&lt;/code&gt; associated with this
                      &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.                    
                </exception>
            </javadoc>
            <method name="getSubject" type="Subject" line="53">
                <declaration name="sm" type="java.lang.SecurityManager" line="54"/>
                <scope line="55"/>
            </method>
            <javadoc line="60">
                Update the relevant ProtectionDomains with the Principals
                  from the &lt;code&gt;Subject&lt;/code&gt; associated with this
                  &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.
                  &lt;p&gt; A new &lt;code&gt;ProtectionDomain&lt;/code&gt; instance is created
                  for each &lt;code&gt;ProtectionDomain&lt;/code&gt; in the
                  &lt;i&gt;currentDomains&lt;/i&gt; array.  Each new &lt;code&gt;ProtectionDomain&lt;/code&gt;
                  instance is created using the &lt;code&gt;CodeSource&lt;/code&gt;,
                  &lt;code&gt;Permission&lt;/code&gt;s and &lt;code&gt;ClassLoader&lt;/code&gt;
                  from the corresponding &lt;code&gt;ProtectionDomain&lt;/code&gt; in
                  &lt;i&gt;currentDomains&lt;/i&gt;, as well as with the Principals from
                  the &lt;code&gt;Subject&lt;/code&gt; associated with this
                  &lt;code&gt;SubjectDomainCombiner&lt;/code&gt;.
                  &lt;p&gt; All of the newly instantiated ProtectionDomains are
                  combined into a new array.  The ProtectionDomains from the
                  &lt;i&gt;assignedDomains&lt;/i&gt; array are appended to this new array,
                  and the result is returned.
                  &lt;p&gt; Note that optimizations such as the removal of duplicate
                  ProtectionDomains may have occurred.
                  In addition, caching of ProtectionDomains may be permitted.
                  &lt;p&gt;                
                <param>
                    currentDomains the ProtectionDomains associated with the
                      current execution Thread, up to the most recent
                      privileged &lt;code&gt;ProtectionDomain&lt;/code&gt;.
                      The ProtectionDomains are are listed in order of execution,
                      with the most recently executing &lt;code&gt;ProtectionDomain&lt;/code&gt;
                      residing at the beginning of the array. This parameter may
                      be &lt;code&gt;null&lt;/code&gt; if the current execution Thread
                      has no associated ProtectionDomains.&lt;p&gt;                    
                </param>
                <param>
                    assignedDomains the ProtectionDomains inherited from the
                      parent Thread, or the ProtectionDomains from the
                      privileged &lt;i&gt;context&lt;/i&gt;, if a call to
                      AccessController.doPrivileged(..., &lt;i&gt;context&lt;/i&gt;)
                      had occurred  This parameter may be &lt;code&gt;null&lt;/code&gt;
                      if there were no ProtectionDomains inherited from the
                      parent Thread, or from the privileged &lt;i&gt;context&lt;/i&gt;.                    
                </param>
                <return>
                    a new array consisting of the updated ProtectionDomains,
                      or &lt;code&gt;null&lt;/code&gt;.                    
                </return>
            </javadoc>
            <method name="combine" type="ProtectionDomain[]" line="99">
                <params>
                    <param name="currentDomains" type="ProtectionDomain[]"/>
                    <param name="assignedDomains" type="ProtectionDomain[]"/>
                </params>
                <scope line="100">
                    <scope line="101"/>
                    <scope line="104">
                        <declaration name="s" type="Subject" line="105"/>
                        <anonymous_class line="106">
                            <method name="run" type="Void" line="107"/>
                        </anonymous_class>
                    </scope>
                </scope>
                <scope line="116"/>
                <scope line="120"/>
                <scope line="124"/>
                <scope line="127"/>
                <declaration name="cLen" type="int" line="130"/>
                <declaration name="aLen" type="int" line="131"/>
                <declaration name="newDomains" type="ProtectionDomain[]" line="132"/>
                <declaration name="allNew" type="boolean" line="133"/>
                <scope line="134">
                    <scope line="135">
                        <declaration name="newSet" type="Set&amp;lt;Principal&amp;gt;" line="136"/>
                        <scope line="137"/>
                        <scope line="142"/>
                    </scope>
                    <declaration name="subjectPd" type="ProtectionDomain" line="146"/>
                    <scope line="147">
                        <declaration name="pd" type="ProtectionDomain" line="148"/>
                        <scope line="150"/>
                        <scope line="154"/>
                    </scope>
                </scope>
                <scope line="160">
                    <scope line="162"/>
                </scope>
                <scope line="166">
                    <scope line="168"/>
                </scope>
                <scope line="172">
                    <scope line="173"/>
                    <scope line="176">
                        <scope line="178"/>
                    </scope>
                </scope>
                <scope line="183"/>
                <scope line="186"/>
            </method>
            <javadoc line="190">
                Use the javax.security.auth.Policy implementation                
            </javadoc>
            <method name="combineJavaxPolicy" type="ProtectionDomain[]" line="193">
                <params>
                    <param name="currentDomains" type="ProtectionDomain[]"/>
                    <param name="assignedDomains" type="ProtectionDomain[]"/>
                </params>
                <scope line="194">
                    <anonymous_class line="195">
                        <method name="run" type="Void" line="196"/>
                    </anonymous_class>
                </scope>
                <declaration name="cLen" type="int" line="203"/>
                <declaration name="aLen" type="int" line="204"/>
                <declaration name="newDomains" type="ProtectionDomain[]" line="205"/>
                <scope line="206">
                    <scope line="207">
                        <declaration name="newSet" type="Set&amp;lt;Principal&amp;gt;" line="208"/>
                        <scope line="209"/>
                        <scope line="214"/>
                    </scope>
                    <scope line="218">
                        <declaration name="pd" type="ProtectionDomain" line="219"/>
                        <declaration name="subjectPd" type="ProtectionDomain" line="220"/>
                        <scope line="221">
                            <declaration name="perms" type="Permissions" line="222"/>
                            <declaration name="coll" type="PermissionCollection" line="223"/>
                            <declaration name="e" type="java.util.Enumeration" line="224"/>
                            <scope line="225">
                                <scope line="226">
                                    <scope line="228">
                                        <declaration name="newPerm" type="Permission" line="229"/>
                                    </scope>
                                </scope>
                            </scope>
                            <declaration name="finalCs" type="java.security.CodeSource" line="234"/>
                            <declaration name="finalS" type="Subject" line="235"/>
                            <anonymous_class line="236">
                                <method name="run" type="PermissionCollection" line="237"/>
                            </anonymous_class>
                            <declaration name="newPerms" type="PermissionCollection" line="236"/>
                            <scope line="242">
                                <scope line="244">
                                    <declaration name="newPerm" type="Permission" line="245"/>
                                    <scope line="246"/>
                                </scope>
                            </scope>
                        </scope>
                    </scope>
                </scope>
                <scope line="258">
                    <scope line="260"/>
                </scope>
                <scope line="264"/>
                <scope line="267">
                    <scope line="268"/>
                    <scope line="271">
                        <scope line="273"/>
                    </scope>
                </scope>
                <scope line="278"/>
                <scope line="281"/>
            </method>
            <method name="optimize" type="ProtectionDomain[]" line="285">
                <params>
                    <param name="domains" type="ProtectionDomain[]"/>
                </params>
                <declaration name="optimized" type="ProtectionDomain[]" line="287"/>
                <declaration name="pd" type="ProtectionDomain" line="288"/>
                <declaration name="num" type="int" line="289"/>
                <scope line="290">
                    <scope line="291">
                        <declaration name="found" type="boolean" line="292"/>
                        <scope line="293"/>
                        <scope line="296"/>
                    </scope>
                </scope>
                <scope line="301">
                    <declaration name="downSize" type="ProtectionDomain[]" line="302"/>
                </scope>
            </method>
            <method name="cachePolicy" type="boolean" line="308">
                <anonymous_class line="309">
                    <method name="run" type="String" line="310"/>
                </anonymous_class>
                <declaration name="s" type="String" line="309"/>
                <scope line="315"/>
            </method>
            <method name="printInputDomains" type="void" line="320">
                <params>
                    <param name="currentDomains" type="ProtectionDomain[]"/>
                    <param name="assignedDomains" type="ProtectionDomain[]"/>
                </params>
                <scope line="321"/>
                <scope line="324">
                    <scope line="325">
                        <scope line="326"/>
                        <scope line="329"/>
                    </scope>
                </scope>
                <scope line="334"/>
                <scope line="337">
                    <scope line="339">
                        <scope line="340"/>
                        <scope line="343"/>
                    </scope>
                </scope>
            </method>
            <method name="printDomain" type="String" line="349">
                <params>
                    <param name="pd" type="ProtectionDomain"/>
                </params>
                <scope line="350"/>
                <anonymous_class line="353">
                    <method name="run" type="String" line="354"/>
                </anonymous_class>
            </method>
            <class name="WeakKeyValueMap" line="360">
                <type_params>
                    <type_param name="K"/>
                    <type_param name="V"/>
                </type_params>
                <extends class="WeakHashMap">
                    <type_params>
                        <type_param name="K"/>
                        <type_param name="WeakReference&lt;V&gt;"/>
                    </type_params>
                </extends>
                <javadoc line="360">
                    A HashMap that has weak keys and values.
                      Key objects in this map are the &quot;current&quot; ProtectionDomain instances
                      received via the combine method.  Each &quot;current&quot; PD is mapped to a
                      new PD instance that holds both the contents of the &quot;current&quot; PD,
                      as well as the principals from the Subject associated with this combiner.
                      The newly created &quot;principal-based&quot; PD values must be stored as
                      WeakReferences since they contain strong references to the
                      corresponding key object (the &quot;current&quot; non-principal-based PD),
                      which will prevent the key from being GC&apos;d.  Specifically,
                      a &quot;principal-based&quot; PD contains strong references to the CodeSource,
                      signer certs, PermissionCollection and ClassLoader objects
                      in the &quot;current PD&quot;.                    
                </javadoc>
                <method name="getValue" type="V" line="375">
                    <params>
                        <param name="key" type="K"/>
                    </params>
                    <declaration name="wr" type="WeakReference&amp;lt;V&amp;gt;" line="376"/>
                    <scope line="377"/>
                </method>
                <method name="putValue" type="V" line="382">
                    <params>
                        <param name="key" type="K"/>
                        <param name="value" type="V"/>
                    </params>
                    <declaration name="wr" type="WeakReference&amp;lt;V&amp;gt;" line="383"/>
                    <scope line="384"/>
                </method>
            </class>
        </class>
    </source>