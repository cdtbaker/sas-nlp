<?xml version="1.0" encoding="UTF-8"?>
    <source package="java.lang">
        <import package="java.io.UnsupportedEncodingException"/>
        <import package="java.lang.ref.SoftReference"/>
        <import package="java.nio.ByteBuffer"/>
        <import package="java.nio.CharBuffer"/>
        <import package="java.nio.charset.Charset"/>
        <import package="java.nio.charset.CharsetDecoder"/>
        <import package="java.nio.charset.CharsetEncoder"/>
        <import package="java.nio.charset.CharacterCodingException"/>
        <import package="java.nio.charset.CoderResult"/>
        <import package="java.nio.charset.CodingErrorAction"/>
        <import package="java.nio.charset.IllegalCharsetNameException"/>
        <import package="java.nio.charset.UnsupportedCharsetException"/>
        <import package="java.util.Arrays"/>
        <import package="sun.misc.MessageUtils"/>
        <import package="sun.nio.cs.HistoricallyNamedCharset"/>
        <import package="sun.nio.cs.ArrayDecoder"/>
        <import package="sun.nio.cs.ArrayEncoder"/>
        <class name="StringCoding" line="46">
            <comment line="74">
                Trim the given byte array to the given length                
            </comment>
            <comment line="75">
                                
            </comment>
            <comment line="83">
                Trim the given char array to the given length                
            </comment>
            <comment line="84">
                                
            </comment>
            <comment line="122">
                -- Decoding --                
            </comment>
            <comment line="272">
                -- Encoding --                
            </comment>
            <javadoc line="46">
                Utility class for string encoding and decoding.                
            </javadoc>
            <method name="StringCoding" type="constructor" line="52"/>
            <declaration name="decoder" type="ThreadLocal&lt;SoftReference&lt;StringDecoder&gt;&gt;" line="54"/>
            <javadoc line="54">
                The cached coders for each thread                
            </javadoc>
            <declaration name="encoder" type="ThreadLocal&lt;SoftReference&lt;StringEncoder&gt;&gt;" line="57"/>
            <declaration name="warnUnsupportedCharset" type="boolean" line="60"/>
            <method name="deref" type="T" line="62">
                <params>
                    <param name="tl" type="ThreadLocal<SoftReference<T>>"/>
                </params>
                <declaration name="sr" type="SoftReference&lt;T&gt;" line="63"/>
            </method>
            <method name="set" type="void" line="69">
                <params>
                    <param name="tl" type="ThreadLocal<SoftReference<T>>"/>
                    <param name="ob" type="T"/>
                </params>
            </method>
            <method name="safeTrim" type="byte[]" line="75">
                <params>
                    <param name="ba" type="byte[]"/>
                    <param name="len" type="int"/>
                    <param name="cs" type="Charset"/>
                    <param name="isTrusted" type="boolean"/>
                </params>
            </method>
            <method name="safeTrim" type="char[]" line="85">
                <params>
                    <param name="ca" type="char[]"/>
                    <param name="len" type="int"/>
                    <param name="cs" type="Charset"/>
                    <param name="isTrusted" type="boolean"/>
                </params>
            </method>
            <method name="scale" type="int" line="92">
                <params>
                    <param name="len" type="int"/>
                    <param name="expansionFactor" type="float"/>
                </params>
                <comment line="93">
                    We need to perform double, not float, arithmetic; otherwise                    
                </comment>
                <comment line="94">
                    we lose low order bits when len is larger than 2**24.                    
                </comment>
            </method>
            <method name="lookupCharset" type="Charset" line="98">
                <params>
                    <param name="csn" type="String"/>
                </params>
                <scope line="99">
                    <scope line="100"/>
                    <scope line="102"/>
                </scope>
            </method>
            <method name="warnUnsupportedCharset" type="void" line="109">
                <params>
                    <param name="csn" type="String"/>
                </params>
                <comment line="111">
                    Use sun.misc.MessageUtils rather than the Logging API or                    
                </comment>
                <comment line="112">
                    System.err since this method may be called during VM                    
                </comment>
                <comment line="113">
                    initialization before either is available.                    
                </comment>
                <scope line="110"/>
            </method>
            <class name="StringDecoder" line="122">
                <declaration name="requestedCharsetName" type="String" line="123"/>
                <declaration name="cs" type="Charset" line="124"/>
                <declaration name="cd" type="CharsetDecoder" line="125"/>
                <declaration name="isTrusted" type="boolean" line="126"/>
                <method name="StringDecoder" type="constructor" line="128">
                    <params>
                        <param name="cs" type="Charset"/>
                        <param name="rcn" type="String"/>
                    </params>
                </method>
                <method name="charsetName" type="String" line="137"/>
                <method name="requestedCharsetName" type="String" line="143"/>
                <method name="decode" type="char[]" line="147">
                    <params>
                        <param name="ba" type="byte[]"/>
                        <param name="off" type="int"/>
                        <param name="len" type="int"/>
                    </params>
                    <comment line="167">
                        Substitution is always enabled,                        
                    </comment>
                    <comment line="168">
                        so this shouldn&apos;t happen                        
                    </comment>
                    <declaration name="en" type="int" line="148"/>
                    <declaration name="ca" type="char[]" line="149"/>
                    <scope line="152">
                        <declaration name="clen" type="int" line="153"/>
                    </scope>
                    <scope line="155">
                        <declaration name="bb" type="ByteBuffer" line="157"/>
                        <declaration name="cb" type="CharBuffer" line="158"/>
                        <scope line="159">
                            <declaration name="cr" type="CoderResult" line="160"/>
                        </scope>
                        <scope line="166"/>
                    </scope>
                </method>
            </class>
            <method name="decode" type="char[]" line="178">
                <params>
                    <param name="charsetName" type="String"/>
                    <param name="ba" type="byte[]"/>
                    <param name="off" type="int"/>
                    <param name="len" type="int"/>
                </params>
                <declaration name="sd" type="StringDecoder" line="179"/>
                <declaration name="csn" type="String" line="180"/>
                <scope line="182">
                    <scope line="184">
                        <declaration name="cs" type="Charset" line="185"/>
                    </scope>
                    <scope line="188"/>
                </scope>
            </method>
            <method name="decode" type="char[]" line="196">
                <params>
                    <param name="cs" type="Charset"/>
                    <param name="ba" type="byte[]"/>
                    <param name="off" type="int"/>
                    <param name="len" type="int"/>
                </params>
                <comment line="197">
                    (1)We never cache the &quot;external&quot; cs, the only benefit of creating                    
                </comment>
                <comment line="198">
                    an additional StringDe/Encoder object to wrap it is to share the                    
                </comment>
                <comment line="199">
                    de/encode() method. These SD/E objects are short-lifed, the young-gen                    
                </comment>
                <comment line="200">
                    gc should be able to take care of them well. But the best approash                    
                </comment>
                <comment line="201">
                    is still not to generate them if not really necessary.                    
                </comment>
                <comment line="202">
                    (2)The defensive copy of the input byte/char[] has a big performance                    
                </comment>
                <comment line="203">
                    impact, as well as the outgoing result byte/char[]. Need to do the                    
                </comment>
                <comment line="204">
                    optimization check of (sm==null &amp;&amp; classLoader0==null) for both.                    
                </comment>
                <comment line="205">
                    (3)getClass().getClassLoader0() is expensive                    
                </comment>
                <comment line="206">
                    (4)There might be a timing gap in isTrusted setting. getClassLoader0()                    
                </comment>
                <comment line="207">
                    is only chcked (and then isTrusted gets set) when (SM==null). It is                    
                </comment>
                <comment line="208">
                    possible that the SM==null for now but then SM is NOT null later                    
                </comment>
                <comment line="209">
                    when safeTrim() is invoked...the &quot;safe&quot; way to do is to redundant                    
                </comment>
                <comment line="210">
                    check (... &amp;&amp; (isTrusted || SM == null || getClassLoader0())) in trim                    
                </comment>
                <comment line="211">
                    but it then can be argued that the SM is null when the opertaion                    
                </comment>
                <comment line="212">
                    is started...                    
                </comment>
                <comment line="242">
                    Substitution is always enabled,                    
                </comment>
                <comment line="243">
                    so this shouldn&apos;t happen                    
                </comment>
                <declaration name="cd" type="CharsetDecoder" line="213"/>
                <declaration name="en" type="int" line="214"/>
                <declaration name="ca" type="char[]" line="215"/>
                <declaration name="isTrusted" type="boolean" line="218"/>
                <scope line="219">
                    <scope line="220"/>
                </scope>
                <scope line="228">
                    <declaration name="clen" type="int" line="229"/>
                </scope>
                <scope line="231">
                    <declaration name="bb" type="ByteBuffer" line="232"/>
                    <declaration name="cb" type="CharBuffer" line="233"/>
                    <scope line="234">
                        <declaration name="cr" type="CoderResult" line="235"/>
                    </scope>
                    <scope line="241"/>
                </scope>
            </method>
            <method name="decode" type="char[]" line="250">
                <params>
                    <param name="ba" type="byte[]"/>
                    <param name="off" type="int"/>
                    <param name="len" type="int"/>
                </params>
                <comment line="260">
                    If this code is hit during VM initialization, MessageUtils is                    
                </comment>
                <comment line="261">
                    the only way we will be able to get any kind of error message.                    
                </comment>
                <comment line="264">
                    If we can not find ISO-8859-1 (a required encoding) then things                    
                </comment>
                <comment line="265">
                    are seriously wrong with the installation.                    
                </comment>
                <declaration name="csn" type="String" line="251"/>
                <scope line="252"/>
                <scope line="254"/>
                <scope line="257"/>
                <scope line="259"/>
            </method>
            <class name="StringEncoder" line="272">
                <declaration name="cs" type="Charset" line="273"/>
                <declaration name="ce" type="CharsetEncoder" line="274"/>
                <declaration name="requestedCharsetName" type="String" line="275"/>
                <declaration name="isTrusted" type="boolean" line="276"/>
                <method name="StringEncoder" type="constructor" line="278">
                    <params>
                        <param name="cs" type="Charset"/>
                        <param name="rcn" type="String"/>
                    </params>
                </method>
                <method name="charsetName" type="String" line="287"/>
                <method name="requestedCharsetName" type="String" line="293"/>
                <method name="encode" type="byte[]" line="297">
                    <params>
                        <param name="ca" type="char[]"/>
                        <param name="off" type="int"/>
                        <param name="len" type="int"/>
                    </params>
                    <comment line="317">
                        Substitution is always enabled,                        
                    </comment>
                    <comment line="318">
                        so this shouldn&apos;t happen                        
                    </comment>
                    <declaration name="en" type="int" line="298"/>
                    <declaration name="ba" type="byte[]" line="299"/>
                    <scope line="302">
                        <declaration name="blen" type="int" line="303"/>
                    </scope>
                    <scope line="305">
                        <declaration name="bb" type="ByteBuffer" line="307"/>
                        <declaration name="cb" type="CharBuffer" line="308"/>
                        <scope line="309">
                            <declaration name="cr" type="CoderResult" line="310"/>
                        </scope>
                        <scope line="316"/>
                    </scope>
                </method>
            </class>
            <method name="encode" type="byte[]" line="328">
                <params>
                    <param name="charsetName" type="String"/>
                    <param name="ca" type="char[]"/>
                    <param name="off" type="int"/>
                    <param name="len" type="int"/>
                </params>
                <declaration name="se" type="StringEncoder" line="329"/>
                <declaration name="csn" type="String" line="330"/>
                <scope line="332">
                    <scope line="334">
                        <declaration name="cs" type="Charset" line="335"/>
                    </scope>
                    <scope line="338"/>
                </scope>
            </method>
            <method name="encode" type="byte[]" line="346">
                <params>
                    <param name="cs" type="Charset"/>
                    <param name="ca" type="char[]"/>
                    <param name="off" type="int"/>
                    <param name="len" type="int"/>
                </params>
                <declaration name="ce" type="CharsetEncoder" line="347"/>
                <declaration name="en" type="int" line="348"/>
                <declaration name="ba" type="byte[]" line="349"/>
                <declaration name="isTrusted" type="boolean" line="352"/>
                <scope line="353">
                    <scope line="354"/>
                </scope>
                <scope line="362">
                    <declaration name="blen" type="int" line="363"/>
                </scope>
                <scope line="365">
                    <declaration name="bb" type="ByteBuffer" line="366"/>
                    <declaration name="cb" type="CharBuffer" line="367"/>
                    <scope line="368">
                        <declaration name="cr" type="CoderResult" line="369"/>
                    </scope>
                    <scope line="375"/>
                </scope>
            </method>
            <method name="encode" type="byte[]" line="382">
                <params>
                    <param name="ca" type="char[]"/>
                    <param name="off" type="int"/>
                    <param name="len" type="int"/>
                </params>
                <comment line="392">
                    If this code is hit during VM initialization, MessageUtils is                    
                </comment>
                <comment line="393">
                    the only way we will be able to get any kind of error message.                    
                </comment>
                <comment line="396">
                    If we can not find ISO-8859-1 (a required encoding) then things                    
                </comment>
                <comment line="397">
                    are seriously wrong with the installation.                    
                </comment>
                <declaration name="csn" type="String" line="383"/>
                <scope line="384"/>
                <scope line="386"/>
                <scope line="389"/>
                <scope line="391"/>
            </method>
        </class>
    </source>