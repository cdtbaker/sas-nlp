<?xml version="1.0" encoding="UTF-8"?>
    <source package="java.security">
        <import package="java.util.ArrayList"/>
        <import package="java.util.List"/>
        <import package="sun.security.util.Debug"/>
        <import package="sun.security.util.SecurityConstants"/>
        <import package="sun.misc.JavaSecurityAccess"/>
        <import package="sun.misc.SharedSecrets"/>
        <class name="AccessControlContext" line="36">
            <comment line="85">
                Note: This field is directly used by the virtual machine
                 native codes. Don&apos;t touch it.                
            </comment>
            <javadoc line="36">
                An AccessControlContext is used to make system resource access decisions
                  based on the context it encapsulates.
                  &lt;p&gt;More specifically, it encapsulates a context and
                  has a single method, &lt;code&gt;checkPermission&lt;/code&gt;,
                  that is equivalent to the &lt;code&gt;checkPermission&lt;/code&gt; method
                  in the AccessController class, with one difference: The AccessControlContext
                  &lt;code&gt;checkPermission&lt;/code&gt; method makes access decisions based on the
                  context it encapsulates,
                  rather than that of the current execution thread.
                  &lt;p&gt;Thus, the purpose of AccessControlContext is for those situations where
                  a security check that should be made within a given context
                  actually needs to be done from within a
                  &lt;i&gt;different&lt;/i&gt; context (for example, from within a worker thread).
                  &lt;p&gt; An AccessControlContext is created by calling the
                  &lt;code&gt;AccessController.getContext&lt;/code&gt; method.
                  The &lt;code&gt;getContext&lt;/code&gt; method takes a &quot;snapshot&quot;
                  of the current calling context, and places
                  it in an AccessControlContext object, which it returns. A sample call is
                  the following:
                  &lt;pre&gt;
                  AccessControlContext acc = AccessController.getContext()
                  &lt;/pre&gt;
                  &lt;p&gt;
                  Code within a different context can subsequently call the
                  &lt;code&gt;checkPermission&lt;/code&gt; method on the
                  previously-saved AccessControlContext object. A sample call is the
                  following:
                  &lt;pre&gt;
                  acc.checkPermission(permission)
                  &lt;/pre&gt;                
                <see>
                    AccessController                    
                </see>
                <author>
                    Roland Schemers                    
                </author>
            </javadoc>
            <declaration name="context" type="ProtectionDomain" line="81"/>
            <declaration name="isPrivileged" type="boolean" line="82"/>
            <declaration name="privilegedContext" type="AccessControlContext" line="86"/>
            <declaration name="combiner" type="DomainCombiner" line="88"/>
            <declaration name="debugInit" type="boolean" line="90"/>
            <declaration name="debug" type="Debug" line="91"/>
            <method name="getDebug" type="Debug" line="94">
                <scope line="97">
                    <scope line="98"/>
                </scope>
            </method>
            <javadoc line="106">
                Create an AccessControlContext with the given array of ProtectionDomains.
                  Context must not be null. Duplicate domains will be removed from the
                  context.                
                <param>
                    context the ProtectionDomains associated with this context.
                      The non-duplicate domains are copied from the array. Subsequent
                      changes to the array will not affect this AccessControlContext.                    
                </param>
                <throws>
                    NullPointerException if <code>context</code> is <code>null</code>                    
                </throws>
            </javadoc>
            <method name="AccessControlContext" type="constructor" line="117">
                <params>
                    <param name="context" type="ProtectionDomain"/>
                </params>
                <scope line="118"/>
                <scope line="120">
                    <scope line="121"/>
                    <scope line="123"/>
                </scope>
                <scope line="126">
                    <declaration name="v" type="List&lt;ProtectionDomain&gt;" line="127"/>
                    <scope line="128"/>
                    <scope line="132"/>
                </scope>
            </method>
            <javadoc line="139">
                Create a new &lt;code&gt;AccessControlContext&lt;/code&gt; with the given
                  &lt;code&gt;AccessControlContext&lt;/code&gt; and &lt;code&gt;DomainCombiner&lt;/code&gt;.
                  This constructor associates the provided
                  &lt;code&gt;DomainCombiner&lt;/code&gt; with the provided
                  &lt;code&gt;AccessControlContext&lt;/code&gt;.
                  &lt;p&gt;                
                <param>
                    acc the <code>AccessControlContext</code> associated
                      with the provided <code>DomainCombiner</code>.                    
                </param>
                <param>
                    combiner the <code>DomainCombiner</code> to be associated
                      with the provided <code>AccessControlContext</code>.                    
                </param>
                <exception>
                    NullPointerException if the provided
                      <code>context</code> is <code>null</code>.                    
                </exception>
                <exception>
                    SecurityException if a security manager is installed and the
                      caller does not have the "createAccessControlContext"{@link SecurityPermission}                    
                </exception>
                <since>
                    1.3                    
                </since>
            </javadoc>
            <method name="AccessControlContext" type="constructor" line="163">
                <params>
                    <param name="acc" type="AccessControlContext"/>
                    <param name="combiner" type="DomainCombiner"/>
                </params>
                <comment line="173">
                    we do not need to run the combine method on the
                     provided ACC.  it was already &quot;combined&quot; when the
                     context was originally retrieved.
                    
                     at this point in time, we simply throw away the old
                     combiner and use the newly provided one.                    
                </comment>
                <declaration name="sm" type="SecurityManager" line="165"/>
                <scope line="166"/>
            </method>
            <javadoc line="181">
                package private for AccessController                
            </javadoc>
            <method name="AccessControlContext" type="constructor" line="184">
                <params>
                    <param name="context" type="ProtectionDomain"/>
                    <param name="combiner" type="DomainCombiner"/>
                </params>
                <scope line="185"/>
            </method>
            <javadoc line="191">
                package private constructor for AccessController.getContext()                
            </javadoc>
            <method name="AccessControlContext" type="constructor" line="197">
                <params>
                    <param name="context" type="ProtectionDomain"/>
                    <param name="isPrivileged" type="boolean"/>
                </params>
            </method>
            <javadoc line="202">
                Constructor for JavaSecurityAccess.doIntersectionPrivilege()                
            </javadoc>
            <method name="AccessControlContext" type="constructor" line="207">
                <params>
                    <param name="context" type="ProtectionDomain[]"/>
                    <param name="privilegedContext" type="AccessControlContext"/>
                </params>
            </method>
            <javadoc line="213">
                Returns this context&apos;s context.                
            </javadoc>
            <method name="getContext" type="ProtectionDomain[]" line="216"/>
            <javadoc line="220">
                Returns true if this context is privileged.                
            </javadoc>
            <method name="isPrivileged" type="boolean" line="224"/>
            <javadoc line="228">
                get the assigned combiner from the privileged or inherited context                
            </javadoc>
            <method name="getAssignedCombiner" type="DomainCombiner" line="231">
                <declaration name="acc" type="AccessControlContext" line="232"/>
                <scope line="233"/>
                <scope line="235"/>
                <scope line="238"/>
            </method>
            <javadoc line="244">
                Get the &lt;code&gt;DomainCombiner&lt;/code&gt; associated with this
                  &lt;code&gt;AccessControlContext&lt;/code&gt;.
                  &lt;p&gt;                
                <return>
                    the <code>DomainCombiner</code> associated with this
                      <code>AccessControlContext</code>, or <code>null</code>
                      if there is none.                    
                </return>
                <exception>
                    SecurityException if a security manager is installed and
                      the caller does not have the "getDomainCombiner"{@link SecurityPermission}                    
                </exception>
                <since>
                    1.3                    
                </since>
            </javadoc>
            <method name="getDomainCombiner" type="DomainCombiner" line="259">
                <declaration name="sm" type="SecurityManager" line="261"/>
                <scope line="262"/>
            </method>
            <javadoc line="268">
                Determines whether the access request indicated by the
                  specified permission should be allowed or denied, based on
                  the security policy currently in effect, and the context in
                  this object. The request is allowed only if every ProtectionDomain
                  in the context implies the permission. Otherwise the request is
                  denied.
                  &lt;p&gt;
                  This method quietly returns if the access request
                  is permitted, or throws a suitable AccessControlException otherwise.                
                <param>
                    perm the requested permission.                    
                </param>
                <exception>
                    AccessControlException if the specified permission
                      is not permitted, based on the current security policy and the
                      context encapsulated by this object.                    
                </exception>
                <exception>
                    NullPointerException if the permission to check for is null.                    
                </exception>
            </javadoc>
            <method name="checkPermission" type="void" line="289">
                <params>
                    <param name="perm" type="Permission"/>
                </params>
                <comment line="297">
                    If &quot;codebase&quot; is not specified, we dump the info by default.                    
                </comment>
                <comment line="300">
                    If &quot;codebase&quot; is specified, only dump if the specified code
                     value is in the stack.                    
                </comment>
                <comment line="330">
                    iterate through the ProtectionDomains in the context.
                     Stop at the first one that doesn&apos;t allow the
                     requested permission (throwing an exception).                    
                </comment>
                <comment line="337">
                    if ctxt is null, all we had on the stack were system domains,
                    or the first domain was a Privileged system domain. This                    
                </comment>
                <comment line="351">
                    Want to make sure this is always displayed for failure,
                     but do not want to display again if already displayed
                     above.                    
                </comment>
                <comment line="371">
                    allow if all of them allowed access                    
                </comment>
                <declaration name="dumpDebug" type="boolean" line="290"/>
                <scope line="292"/>
                <scope line="295">
                    <scope line="298">
                        <scope line="301">
                            <scope line="304"/>
                        </scope>
                    </scope>
                    <scope line="314"/>
                    <scope line="318">
                        <scope line="319"/>
                        <scope line="321">
                            <scope line="322"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="343">
                    <scope line="344">
                        <scope line="345"/>
                        <scope line="349">
                            <scope line="353"/>
                            <declaration name="pd" type="ProtectionDomain" line="357"/>
                            <declaration name="db" type="Debug" line="358"/>
                            <anonymous_class line="359">
                                <method name="run" type="Void" line="360"/>
                            </anonymous_class>
                        </scope>
                    </scope>
                </scope>
                <scope line="371"/>
            </method>
            <javadoc line="378">
                Take the stack-based context (this) and combine it with the
                  privileged or inherited context, if need be.                
            </javadoc>
            <method name="optimize" type="AccessControlContext" line="382">
                <comment line="384">
                    the assigned (privileged or inherited) context                    
                </comment>
                <comment line="392">
                    this.context could be null if only system code is on the stack;
                     in that case, ignore the stack context                    
                </comment>
                <comment line="396">
                    acc.context could be null if only system code was involved;
                     in that case, ignore the assigned context                    
                </comment>
                <comment line="401">
                    let the assigned acc&apos;s combiner do its thing                    
                </comment>
                <comment line="405">
                    optimization: if neither have contexts; return acc if possible
                     rather than this, because acc might have a combiner                    
                </comment>
                <comment line="411">
                    optimization: if there is no stack context; there is no reason
                     to compress the assigned context, it already is compressed                    
                </comment>
                <comment line="419">
                    optimization: if there is no assigned context and the stack length
                     is less then or equal to two; there is no reason to compress the
                     stack context, it already is                    
                </comment>
                <comment line="426">
                    optimization: if there is a single stack domain and that domain
                     is already in the assigned context; no need to combine                    
                </comment>
                <comment line="434">
                    now we combine both of them, and create a new context                    
                </comment>
                <comment line="437">
                    first copy in the assigned context domains, no need to compress                    
                </comment>
                <comment line="442">
                    now add the stack context domains, discarding nulls and duplicates                    
                </comment>
                <comment line="456">
                    if length isn&apos;t equal, we need to shorten the array                    
                </comment>
                <comment line="458">
                    optimization: if we didn&apos;t really combine anything                    
                </comment>
                <comment line="469">
                    return new AccessControlContext(pd, false);                    
                </comment>
                <comment line="471">
                    Reuse existing ACC                    
                </comment>
                <declaration name="acc" type="AccessControlContext" line="384"/>
                <scope line="385"/>
                <scope line="387"/>
                <declaration name="skipStack" type="boolean" line="393"/>
                <declaration name="skipAssigned" type="boolean" line="397"/>
                <scope line="399"/>
                <scope line="406"/>
                <scope line="412"/>
                <declaration name="slen" type="int" line="416"/>
                <scope line="421"/>
                <scope line="427"/>
                <declaration name="n" type="int" line="431"/>
                <declaration name="pd" type="ProtectionDomain" line="434"/>
                <scope line="437"/>
                <scope line="443">
                    <declaration name="sd" type="ProtectionDomain" line="444"/>
                    <scope line="445">
                        <scope line="446">
                            <scope line="447"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="456">
                    <scope line="458"/>
                    <scope line="460"/>
                    <declaration name="tmp" type="ProtectionDomain" line="463"/>
                </scope>
            </method>
            <method name="goCombiner" type="AccessControlContext" line="480">
                <params>
                    <param name="current" type="ProtectionDomain[]"/>
                    <param name="assigned" type="AccessControlContext"/>
                </params>
                <comment line="483">
                    the assigned ACC&apos;s combiner is not null --
                     let the combiner do its thing                    
                </comment>
                <comment line="486">
                    XXX we could add optimizations to &apos;current&apos; here ...                    
                </comment>
                <comment line="492">
                    No need to clone current and assigned.context
                     combine() will not update them                    
                </comment>
                <comment line="497">
                    return new AccessControlContext(combinedPds, assigned.combiner);                    
                </comment>
                <comment line="499">
                    Reuse existing ACC                    
                </comment>
                <scope line="487"/>
                <declaration name="combinedPds" type="ProtectionDomain[]" line="493"/>
            </method>
            <javadoc line="506">
                Checks two AccessControlContext objects for equality.
                  Checks that &lt;i&gt;obj&lt;/i&gt; is
                  an AccessControlContext and has the same set of ProtectionDomains
                  as this context.
                  &lt;P&gt;                
                <param>
                    obj the object we are testing for equality with this object.                    
                </param>
                <return>
                    true if <i>obj</i> is an AccessControlContext, and has the
                      same set of ProtectionDomains as this context, false otherwise.                    
                </return>
            </javadoc>
            <method name="equals" type="boolean" line="516">
                <params>
                    <param name="obj" type="Object"/>
                </params>
                <declaration name="that" type="AccessControlContext" line="523"/>
                <scope line="526"/>
            </method>
            <method name="containsAllPDs" type="boolean" line="548">
                <params>
                    <param name="that" type="AccessControlContext"/>
                </params>
                <comment line="551">
                    ProtectionDomains within an ACC currently cannot be null
                     and this is enforced by the constructor and the various
                     optimize methods. However, historically this logic made attempts
                     to support the notion of a null PD and therefore this logic continues
                     to support that notion.                    
                </comment>
                <comment line="570">
                    Class check required to avoid PD exposure (4285406)                    
                </comment>
                <declaration name="match" type="boolean" line="549"/>
                <declaration name="thisPd" type="ProtectionDomain" line="556"/>
                <scope line="557">
                    <scope line="559">
                        <scope line="560"/>
                    </scope>
                    <scope line="563">
                        <declaration name="thisPdClass" type="Class" line="564"/>
                        <declaration name="thatPd" type="ProtectionDomain" line="565"/>
                        <scope line="566"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="578">
                Returns the hash code value for this context. The hash code
                  is computed by exclusive or-ing the hash code of all the protection
                  domains in the context together.                
                <return>
                    a hash code value for this context.                    
                </return>
            </javadoc>
            <method name="hashCode" type="int" line="586">
                <declaration name="hashCode" type="int" line="587"/>
                <scope line="592"/>
            </method>
        </class>
    </source>