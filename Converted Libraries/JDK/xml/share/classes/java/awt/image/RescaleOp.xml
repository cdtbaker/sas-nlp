<?xml version="1.0" encoding="UTF-8"?>
    <source package="java.awt.image">
        <import package="java.awt.color.ColorSpace"/>
        <import package="java.awt.geom.Rectangle2D"/>
        <import package="java.awt.Rectangle"/>
        <import package="java.awt.geom.Point2D"/>
        <import package="java.awt.RenderingHints"/>
        <import package="sun.awt.image.ImagingLib"/>
        <class name="RescaleOp" line="35">
            <implements interface="BufferedImageOp"/>
            <implements interface="RasterOp"/>
            <javadoc line="35">
                This class performs a pixel-by-pixel rescaling of the data in the
                  source image by multiplying the sample values for each pixel by a scale
                  factor and then adding an offset. The scaled sample values are clipped
                  to the minimum/maximum representable in the destination image.
                  &lt;p&gt;
                  The pseudo code for the rescaling operation is as follows:
                  &lt;pre&gt;
                  for each pixel from Source object {
                  for each band/component of the pixel {
                  dstElement = (srcElementscaleFactor) + offset
                  }
                  }
                  &lt;/pre&gt;
                  &lt;p&gt;
                  For Rasters, rescaling operates on bands.  The number of
                  sets of scaling constants may be one, in which case the same constants
                  are applied to all bands, or it must equal the number of Source
                  Raster bands.
                  &lt;p&gt;
                  For BufferedImages, rescaling operates on color and alpha components.
                  The number of sets of scaling constants may be one, in which case the
                  same constants are applied to all color (but not alpha) components.
                  Otherwise, the  number of sets of scaling constants may
                  equal the number of Source color components, in which case no
                  rescaling of the alpha component (if present) is performed.
                  If neither of these cases apply, the number of sets of scaling constants
                  must equal the number of Source color components plus alpha components,
                  in which case all color and alpha components are rescaled.
                  &lt;p&gt;
                  BufferedImage sources with premultiplied alpha data are treated in the same
                  manner as non-premultiplied images for purposes of rescaling.  That is,
                  the rescaling is done per band on the raw data of the BufferedImage source
                  without regard to whether the data is premultiplied.  If a color conversion
                  is required to the destination ColorModel, the premultiplied state of
                  both source and destination will be taken into account for this step.
                  &lt;p&gt;
                  Images with an IndexColorModel cannot be rescaled.
                  &lt;p&gt;
                  If a RenderingHints object is specified in the constructor, the
                  color rendering hint and the dithering hint may be used when color
                  conversion is required.
                  &lt;p&gt;
                  Note that in-place operation is allowed (i.e. the source and destination can
                  be the same object).                
                <see>
                    java.awt.RenderingHints#KEY_COLOR_RENDERING                    
                </see>
                <see>
                    java.awt.RenderingHints#KEY_DITHERING                    
                </see>
            </javadoc>
            <declaration name="scaleFactors" type="float[]" line="84"/>
            <declaration name="offsets" type="float[]" line="85"/>
            <declaration name="length" type="int" line="86"/>
            <declaration name="hints" type="RenderingHints" line="87"/>
            <declaration name="srcNbits" type="int" line="89"/>
            <declaration name="dstNbits" type="int" line="90"/>
            <javadoc line="93">
                Constructs a new RescaleOp with the desired scale factors
                  and offsets.  The length of the scaleFactor and offset arrays
                  must meet the restrictions stated in the class comments above.
                  The RenderingHints argument may be null.                
                <param>
                    scaleFactors the specified scale factors                    
                </param>
                <param>
                    offsets the specified offsets                    
                </param>
                <param>
                    hints the specified &lt;code&gt;RenderingHints&lt;/code&gt;, or
                      &lt;code&gt;null&lt;/code&gt;                    
                </param>
            </javadoc>
            <method name="RescaleOp" type="constructor" line="104">
                <params>
                    <param name="scaleFactors" type="float[]"/>
                    <param name="offsets" type="float[]"/>
                    <param name="hints" type="RenderingHints"/>
                </params>
                <scope line="110"/>
            </method>
            <javadoc line="117">
                Constructs a new RescaleOp with the desired scale factor
                  and offset.  The scaleFactor and offset will be applied to
                  all bands in a source Raster and to all color (but not alpha)
                  components in a BufferedImage.
                  The RenderingHints argument may be null.                
                <param>
                    scaleFactor the specified scale factor                    
                </param>
                <param>
                    offset the specified offset                    
                </param>
                <param>
                    hints the specified &lt;code&gt;RenderingHints&lt;/code&gt;, or
                      &lt;code&gt;null&lt;/code&gt;                    
                </param>
            </javadoc>
            <method name="RescaleOp" type="constructor" line="128">
                <params>
                    <param name="scaleFactor" type="float"/>
                    <param name="offset" type="float"/>
                    <param name="hints" type="RenderingHints"/>
                </params>
            </method>
            <javadoc line="137">
                Returns the scale factors in the given array. The array is also
                  returned for convenience.  If scaleFactors is null, a new array
                  will be allocated.                
                <param>
                    scaleFactors the array to contain the scale factors of
                      this &lt;code&gt;RescaleOp&lt;/code&gt;                    
                </param>
                <return>
                    the scale factors of this &lt;code&gt;RescaleOp&lt;/code&gt;.                    
                </return>
            </javadoc>
            <method name="getScaleFactors" type="float[]" line="145">
                <params>
                    <param name="scaleFactors" type="float"/>
                </params>
                <scope line="146"/>
            </method>
            <javadoc line="155">
                Returns the offsets in the given array. The array is also returned
                  for convenience.  If offsets is null, a new array
                  will be allocated.                
                <param>
                    offsets the array to contain the offsets of
                      this &lt;code&gt;RescaleOp&lt;/code&gt;                    
                </param>
                <return>
                    the offsets of this &lt;code&gt;RescaleOp&lt;/code&gt;.                    
                </return>
            </javadoc>
            <method name="getOffsets" type="float[]" line="163">
                <params>
                    <param name="offsets" type="float"/>
                </params>
                <scope line="164"/>
            </method>
            <javadoc line="173">
                Returns the number of scaling factors and offsets used in this
                  RescaleOp.                
                <return>
                    the number of scaling factors and offsets of this
                      &lt;code&gt;RescaleOp&lt;/code&gt;.                    
                </return>
            </javadoc>
            <method name="getNumFactors" type="int" line="179"/>
            <javadoc line="184">
                Creates a ByteLookupTable to implement the rescale.
                  The table may have either a SHORT or BYTE input.                
                <param>
                    nElems    Number of elements the table is to have.
                      This will generally be 256 for byte and
                      65536 for short.                    
                </param>
            </javadoc>
            <method name="createByteLut" type="ByteLookupTable" line="194">
                <params>
                    <param name="scale" type="float"/>
                    <param name="off" type="float"/>
                    <param name="nBands" type="int"/>
                    <param name="nElems" type="int"/>
                </params>
                <declaration name="lutData" type="byte[][]" line="196"/>
                <scope line="198">
                    <declaration name="bandScale" type="float" line="199"/>
                    <declaration name="bandOff" type="float" line="200"/>
                    <declaration name="bandLutData" type="byte[]" line="201"/>
                    <scope line="202">
                        <declaration name="val" type="int" line="203"/>
                        <scope line="204">
                            <scope line="205"/>
                            <scope line="207"/>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="219">
                Creates a ShortLookupTable to implement the rescale.
                  The table may have either a SHORT or BYTE input.                
                <param>
                    nElems    Number of elements the table is to have.
                      This will generally be 256 for byte and
                      65536 for short.                    
                </param>
            </javadoc>
            <method name="createShortLut" type="ShortLookupTable" line="229">
                <params>
                    <param name="scale" type="float"/>
                    <param name="off" type="float"/>
                    <param name="nBands" type="int"/>
                    <param name="nElems" type="int"/>
                </params>
                <declaration name="lutData" type="short[][]" line="231"/>
                <scope line="233">
                    <declaration name="bandScale" type="float" line="234"/>
                    <declaration name="bandOff" type="float" line="235"/>
                    <declaration name="bandLutData" type="short[]" line="236"/>
                    <scope line="237">
                        <declaration name="val" type="int" line="238"/>
                        <scope line="239">
                            <scope line="240"/>
                            <scope line="242"/>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="254">
                Determines if the rescale can be performed as a lookup.
                  The dst must be a byte or short type.
                  The src must be less than 16 bits.
                  All source band sizes must be the same and all dst band sizes
                  must be the same.                
            </javadoc>
            <method name="canUseLookup" type="boolean" line="261">
                <params>
                    <param name="src" type="Raster"/>
                    <param name="dst" type="Raster"/>
                </params>
                <comment line="264">
                    Check that the src datatype is either a BYTE or SHORT                    
                </comment>
                <comment line="273">
                    Check dst sample sizes. All must be 8 or 16 bits.                    
                </comment>
                <comment line="289">
                    Check src sample sizes. All must be the same size                    
                </comment>
                <declaration name="datatype" type="int" line="266"/>
                <scope line="268"/>
                <declaration name="dstSM" type="SampleModel" line="275"/>
                <scope line="278"/>
                <scope line="281">
                    <declaration name="bandSize" type="int" line="282"/>
                    <scope line="283"/>
                </scope>
                <declaration name="srcSM" type="SampleModel" line="291"/>
                <scope line="293"/>
                <scope line="296">
                    <declaration name="bandSize" type="int" line="297"/>
                    <scope line="298"/>
                </scope>
            </method>
            <javadoc line="306">
                Rescales the source BufferedImage.
                  If the color model in the source image is not the same as that
                  in the destination image, the pixels will be converted
                  in the destination.  If the destination image is null,
                  a BufferedImage will be created with the source ColorModel.
                  An IllegalArgumentException may be thrown if the number of
                  scaling factors/offsets in this object does not meet the
                  restrictions stated in the class comments above, or if the
                  source image has an IndexColorModel.                
                <param>
                    src the &lt;code&gt;BufferedImage&lt;/code&gt; to be filtered                    
                </param>
                <param>
                    dst the destination for the filtering operation
                      or &lt;code&gt;null&lt;/code&gt;                    
                </param>
                <return>
                    the filtered &lt;code&gt;BufferedImage&lt;/code&gt;.                    
                </return>
                <throws>
                    IllegalArgumentException if the &lt;code&gt;ColorModel&lt;/code&gt;
                      of &lt;code&gt;src&lt;/code&gt; is an &lt;code&gt;IndexColorModel&lt;/code&gt;,
                      or if the number of scaling factors and offsets in this
                      &lt;code&gt;RescaleOp&lt;/code&gt; do not meet the requirements
                      stated in the class comments.                    
                </throws>
            </javadoc>
            <method name="filter" type="BufferedImage" line="326">
                <params>
                    <param name="src" type="BufferedImage"/>
                    <param name="dst" type="BufferedImage"/>
                </params>
                <comment line="349">
                    Include alpha                    
                </comment>
                <comment line="386">
                    Try to use a native BI rescale operation first                    
                </comment>
                <comment line="390">
                    Native BI rescale failed - convert to rasters                    
                </comment>
                <comment line="430">
                    Call the raster filter method                    
                </comment>
                <comment line="438">
                    ColorModels are not the same                    
                </comment>
                <declaration name="srcCM" type="ColorModel" line="327"/>
                <declaration name="dstCM" type="ColorModel" line="328"/>
                <declaration name="numBands" type="int" line="329"/>
                <scope line="332"/>
                <scope line="339"/>
                <declaration name="needToConvert" type="boolean" line="346"/>
                <scope line="349"/>
                <declaration name="width" type="int" line="353"/>
                <declaration name="height" type="int" line="354"/>
                <scope line="356"/>
                <scope line="360">
                    <scope line="361"/>
                    <scope line="367"/>
                    <scope line="376"/>
                </scope>
                <declaration name="origDst" type="BufferedImage" line="383"/>
                <scope line="388">
                    <declaration name="srcRaster" type="WritableRaster" line="392"/>
                    <declaration name="dstRaster" type="WritableRaster" line="393"/>
                    <scope line="395">
                        <scope line="396">
                            <declaration name="minx" type="int" line="397"/>
                            <declaration name="miny" type="int" line="398"/>
                            <declaration name="bands" type="int[]" line="399"/>
                            <scope line="400"/>
                        </scope>
                    </scope>
                    <scope line="411">
                        <declaration name="dstNumBands" type="int" line="412"/>
                        <scope line="413">
                            <declaration name="minx" type="int" line="414"/>
                            <declaration name="miny" type="int" line="415"/>
                            <declaration name="bands" type="int[]" line="416"/>
                            <scope line="417"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="436">
                    <declaration name="ccop" type="ColorConvertOp" line="438"/>
                </scope>
            </method>
            <javadoc line="445">
                Rescales the pixel data in the source Raster.
                  If the destination Raster is null, a new Raster will be created.
                  The source and destination must have the same number of bands.
                  Otherwise, an IllegalArgumentException is thrown.
                  Note that the number of scaling factors/offsets in this object must
                  meet the restrictions stated in the class comments above.
                  Otherwise, an IllegalArgumentException is thrown.                
                <param>
                    src the &lt;code&gt;Raster&lt;/code&gt; to be filtered                    
                </param>
                <param>
                    dst the destination for the filtering operation
                      or &lt;code&gt;null&lt;/code&gt;                    
                </param>
                <return>
                    the filtered &lt;code&gt;WritableRaster&lt;/code&gt;.                    
                </return>
                <throws>
                    IllegalArgumentException if &lt;code&gt;src&lt;/code&gt; and
                      &lt;code&gt;dst&lt;/code&gt; do not have the same number of bands,
                      or if the number of scaling factors and offsets in this
                      &lt;code&gt;RescaleOp&lt;/code&gt; do not meet the requirements
                      stated in the class comments.                    
                </throws>
            </javadoc>
            <method name="filter" type="WritableRaster" line="463">
                <params>
                    <param name="src" type="Raster"/>
                    <param name="dst" type="WritableRaster"/>
                </params>
                <comment line="472">
                    Create a new destination Raster, if needed                    
                </comment>
                <comment line="482">
                    Make sure that the number of bands are equal                    
                </comment>
                <comment line="488">
                    Make sure that the arrays match
                     Make sure that the low/high/constant arrays match                    
                </comment>
                <comment line="497">
                    Try for a native raster rescale first                    
                </comment>
                <comment line="504">
                    Native raster rescale failed.
                     Try to see if a lookup operation can be used                    
                </comment>
                <comment line="524">
                    Fall back to the slow code                    
                </comment>
                <comment line="538">
                    Determine bits per band to determine maxval for clamps.
                      The min is assumed to be zero.
                      REMIND: This must change if we ever support signed data types.                    
                </comment>
                <comment line="558">
                    Get data for all bands at this x,y position                    
                </comment>
                <comment line="564">
                    Clamp                    
                </comment>
                <comment line="576">
                    Put it back for all bands                    
                </comment>
                <declaration name="numBands" type="int" line="464"/>
                <declaration name="width" type="int" line="465"/>
                <declaration name="height" type="int" line="466"/>
                <declaration name="srcPix" type="int[]" line="467"/>
                <declaration name="step" type="int" line="468"/>
                <declaration name="tidx" type="int" line="469"/>
                <scope line="472"/>
                <scope line="475"/>
                <scope line="480"/>
                <scope line="489"/>
                <scope line="499"/>
                <scope line="507">
                    <declaration name="srcNgray" type="int" line="508"/>
                    <declaration name="dstNgray" type="int" line="509"/>
                    <scope line="511">
                        <declaration name="lut" type="ByteLookupTable" line="512"/>
                        <declaration name="op" type="LookupOp" line="514"/>
                    </scope>
                    <scope line="516">
                        <declaration name="lut" type="ShortLookupTable" line="517"/>
                        <declaration name="op" type="LookupOp" line="519"/>
                    </scope>
                </scope>
                <scope line="522">
                    <scope line="526"/>
                    <declaration name="sminX" type="int" line="530"/>
                    <declaration name="sY" type="int" line="531"/>
                    <declaration name="dminX" type="int" line="532"/>
                    <declaration name="dY" type="int" line="533"/>
                    <declaration name="sX" type="int" line="534"/>
                    <declaration name="dX" type="int" line="535"/>
                    <declaration name="nbits" type="int" line="542"/>
                    <declaration name="dstMax" type="int" line="543"/>
                    <declaration name="dstMask" type="int" line="544"/>
                    <declaration name="dstSM" type="SampleModel" line="545"/>
                    <scope line="546"/>
                    <declaration name="val" type="int" line="552"/>
                    <scope line="553">
                        <scope line="556">
                            <scope line="560">
                                <scope line="564">
                                    <scope line="565"/>
                                    <scope line="567"/>
                                </scope>
                            </scope>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="583">
                Returns the bounding box of the rescaled destination image.  Since
                  this is not a geometric operation, the bounding box does not
                  change.                
            </javadoc>
            <method name="getBounds2D" type="Rectangle2D" line="588">
                <params>
                    <param name="src" type="BufferedImage"/>
                </params>
            </method>
            <javadoc line="592">
                Returns the bounding box of the rescaled destination Raster.  Since
                  this is not a geometric operation, the bounding box does not
                  change.                
                <param>
                    src the rescaled destination &lt;code&gt;Raster&lt;/code&gt;                    
                </param>
                <return>
                    the bounds of the specified &lt;code&gt;Raster&lt;/code&gt;.                    
                </return>
            </javadoc>
            <method name="getBounds2D" type="Rectangle2D" line="599">
                <params>
                    <param name="src" type="Raster"/>
                </params>
            </method>
            <javadoc line="603">
                Creates a zeroed destination image with the correct size and number of
                  bands.                
                <param>
                    src       Source image for the filter operation.                    
                </param>
                <param>
                    destCM    ColorModel of the destination.  If null, the
                      ColorModel of the source will be used.                    
                </param>
                <return>
                    the zeroed-destination image.                    
                </return>
            </javadoc>
            <method name="createCompatibleDestImage" type="BufferedImage" line="612">
                <params>
                    <param name="src" type="BufferedImage"/>
                    <param name="destCM" type="ColorModel"/>
                </params>
                <declaration name="image" type="BufferedImage" line="613"/>
                <scope line="614">
                    <declaration name="cm" type="ColorModel" line="615"/>
                </scope>
                <scope line="621">
                    <declaration name="w" type="int" line="622"/>
                    <declaration name="h" type="int" line="623"/>
                </scope>
            </method>
            <javadoc line="632">
                Creates a zeroed-destination &lt;code&gt;Raster&lt;/code&gt; with the correct
                  size and number of bands, given this source.                
                <param>
                    src       the source &lt;code&gt;Raster&lt;/code&gt;                    
                </param>
                <return>
                    the zeroed-destination &lt;code&gt;Raster&lt;/code&gt;.                    
                </return>
            </javadoc>
            <method name="createCompatibleDestRaster" type="WritableRaster" line="638">
                <params>
                    <param name="src" type="Raster"/>
                </params>
            </method>
            <javadoc line="642">
                Returns the location of the destination point given a
                  point in the source.  If dstPt is non-null, it will
                  be used to hold the return value.  Since this is not a geometric
                  operation, the srcPt will equal the dstPt.                
                <param>
                    srcPt a point in the source image                    
                </param>
                <param>
                    dstPt the destination point or &lt;code&gt;null&lt;/code&gt;                    
                </param>
                <return>
                    the location of the destination point.                    
                </return>
            </javadoc>
            <method name="getPoint2D" type="Point2D" line="651">
                <params>
                    <param name="srcPt" type="Point2D"/>
                    <param name="dstPt" type="Point2D"/>
                </params>
                <scope line="652"/>
            </method>
            <javadoc line="659">
                Returns the rendering hints for this op.                
                <return>
                    the rendering hints of this &lt;code&gt;RescaleOp&lt;/code&gt;.                    
                </return>
            </javadoc>
            <method name="getRenderingHints" type="RenderingHints" line="663"/>
        </class>
    </source>