<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.rmi.transport.tcp">
        <import package="java.io"/>
        <import package="java.util"/>
        <import package="java.rmi.server.LogStream"/>
        <import package="sun.rmi.runtime.Log"/>
        <class name="ConnectionMultiplexer" line="33">
            <comment line="57">
                                
            </comment>
            <javadoc line="33">
                ConnectionMultiplexer manages the transparent multiplexing of
                  multiple virtual connections from one endpoint to another through
                  one given real connection to that endpoint.  The input and output
                  streams for the the underlying real connection must be supplied.
                  A callback object is also supplied to be informed of new virtual
                  connections opened by the remote endpoint.  After creation, the
                  run() method must be called in a thread created for demultiplexing
                  the connections.  The openConnection() method is called to
                  initiate a virtual connection from this endpoint.                
                <author>
                    Peter Jones                    
                </author>
            </javadoc>
            <declaration name="logLevel" type="int" line="48"/>
            <javadoc line="48">
                &quot;multiplex&quot; log level                
            </javadoc>
            <method name="getLogLevel" type="String" line="51"/>
            <declaration name="multiplexLog" type="Log" line="57"/>
            <declaration name="OPEN" type="int" line="61"/>
            <javadoc line="61">
                multiplexing protocol operation codes                
            </javadoc>
            <declaration name="CLOSE" type="int" line="63"/>
            <declaration name="CLOSEACK" type="int" line="64"/>
            <declaration name="REQUEST" type="int" line="65"/>
            <declaration name="TRANSMIT" type="int" line="66"/>
            <declaration name="channel" type="TCPChannel" line="68"/>
            <javadoc line="68">
                object to notify for new connections from remote endpoint                
            </javadoc>
            <declaration name="in" type="InputStream" line="71"/>
            <javadoc line="71">
                input stream for underlying single connection                
            </javadoc>
            <declaration name="out" type="OutputStream" line="74"/>
            <javadoc line="74">
                output stream for underlying single connection                
            </javadoc>
            <declaration name="orig" type="boolean" line="77"/>
            <javadoc line="77">
                true if underlying connection originated from this endpoint
                  (used for generating unique connection IDs)                
            </javadoc>
            <declaration name="dataIn" type="DataInputStream" line="81"/>
            <javadoc line="81">
                layered stream for reading formatted data from underlying connection                
            </javadoc>
            <declaration name="dataOut" type="DataOutputStream" line="84"/>
            <javadoc line="84">
                layered stream for writing formatted data to underlying connection                
            </javadoc>
            <declaration name="connectionTable" type="Hashtable" line="87"/>
            <javadoc line="87">
                table holding currently open connection IDs and related info                
            </javadoc>
            <declaration name="numConnections" type="int" line="90"/>
            <javadoc line="90">
                number of currently open connections                
            </javadoc>
            <declaration name="maxConnections" type="int" line="93"/>
            <javadoc line="93">
                maximum allowed open connections                
            </javadoc>
            <declaration name="lastID" type="int" line="96"/>
            <javadoc line="96">
                ID of last connection opened                
            </javadoc>
            <declaration name="alive" type="boolean" line="99"/>
            <javadoc line="99">
                true if this mechanism is still alive                
            </javadoc>
            <javadoc line="102">
                Create a new ConnectionMultiplexer using the given underlying
                  input/output stream pair.  The run method must be called
                  (possibly on a new thread) to handle the demultiplexing.                
                <param>
                    channel object to notify when new connection is received                    
                </param>
                <param>
                    in input stream of underlying connection                    
                </param>
                <param>
                    out output stream of underlying connection                    
                </param>
                <param>
                    orig true if this endpoint intiated the underlying
                      connection (needs to be set differently at both ends)                    
                </param>
            </javadoc>
            <method name="ConnectionMultiplexer" type="constructor" line="117">
                <params>
                    <param name="channel" type="TCPChannel"/>
                    <param name="in" type="InputStream"/>
                    <param name="out" type="OutputStream"/>
                    <param name="orig" type="boolean"/>
                </params>
            </method>
            <javadoc line="127">
                Process multiplexing protocol received from underlying connection.                
            </javadoc>
            <method name="run" type="void" line="131">
                <comment line="139">
                    read next op code from remote endpoint                    
                </comment>
                <comment line="143">
                    remote endpoint initiating new connection                    
                </comment>
                <comment line="169">
                    remote endpoint closing connection                    
                </comment>
                <comment line="193">
                    remote endpoint acknowledging close of connection                    
                </comment>
                <comment line="219">
                    remote endpoint declaring additional bytes receivable                    
                </comment>
                <comment line="238">
                    remote endpoint transmitting data packet                    
                </comment>
                <scope line="132">
                    <declaration name="op" type="int" line="133"/>
                    <declaration name="idObj" type="Integer" line="134"/>
                    <declaration name="info" type="MultiplexConnectionInfo" line="135"/>
                    <scope line="137">
                        <scope line="147"/>
                        <scope line="160"/>
                        <declaration name="conn" type="sun.rmi.transport.Connection" line="164"/>
                        <scope line="173"/>
                        <scope line="187"/>
                        <scope line="197"/>
                        <scope line="213"/>
                        <scope line="230"/>
                        <scope line="248"/>
                    </scope>
                </scope>
                <scope line="261"/>
            </method>
            <javadoc line="266">
                Initiate a new multiplexed connection through the underlying
                  connection.                
            </javadoc>
            <method name="openConnection" type="TCPConnection" line="271">
                <comment line="272">
                    generate ID that should not be already used                    
                </comment>
                <comment line="273">
                    If all possible 32768 IDs are used,                    
                </comment>
                <comment line="274">
                    this method will block searching for a new ID forever.                    
                </comment>
                <comment line="281">
                    The orig flag (copied to the high bit of the ID) is used                    
                </comment>
                <comment line="282">
                    to have two distinct ranges to choose IDs from for the                    
                </comment>
                <comment line="283">
                    two endpoints.                    
                </comment>
                <comment line="289">
                    create multiplexing streams and bookkeeping information                    
                </comment>
                <comment line="294">
                    add to connection table if multiplexer has not died                    
                </comment>
                <comment line="305">
                    inform remote endpoint of new connection                    
                </comment>
                <declaration name="id" type="int" line="275"/>
                <declaration name="idObj" type="Integer" line="276"/>
                <scope line="277"/>
                <declaration name="info" type="MultiplexConnectionInfo" line="290"/>
                <scope line="295"/>
                <scope line="306">
                    <scope line="307"/>
                    <scope line="311"/>
                </scope>
            </method>
            <javadoc line="322">
                Shut down all connections and clean up.                
            </javadoc>
            <method name="shutDown" type="void" line="326">
                <comment line="327">
                    inform all associated streams                    
                </comment>
                <comment line="329">
                    return if multiplexer already officially dead                    
                </comment>
                <comment line="345">
                    close underlying connection, if possible (and not already done)                    
                </comment>
                <scope line="328">
                    <declaration name="enum_" type="Enumeration" line="334"/>
                    <scope line="335">
                        <declaration name="info" type="MultiplexConnectionInfo" line="336"/>
                    </scope>
                </scope>
                <scope line="346"/>
                <scope line="348"/>
                <scope line="350"/>
                <scope line="352"/>
            </method>
            <javadoc line="356">
                Send request for more data on connection to remote endpoint.                
                <param>
                    info connection information structure                    
                </param>
                <param>
                    len number of more bytes that can be received                    
                </param>
            </javadoc>
            <method name="sendRequest" type="void" line="362">
                <params>
                    <param name="info" type="MultiplexConnectionInfo"/>
                    <param name="len" type="int"/>
                </params>
                <scope line="363">
                    <scope line="365"/>
                    <scope line="370"/>
                </scope>
            </method>
            <javadoc line="379">
                Send packet of requested data on connection to remote endpoint.                
                <param>
                    info connection information structure                    
                </param>
                <param>
                    buf array containg bytes to send                    
                </param>
                <param>
                    off offset of first array index of packet                    
                </param>
                <param>
                    len number of bytes in packet to send                    
                </param>
            </javadoc>
            <method name="sendTransmit" type="void" line="388">
                <params>
                    <param name="info" type="MultiplexConnectionInfo"/>
                    <param name="buf" type="byte"/>
                    <param name="off" type="int"/>
                    <param name="len" type="int"/>
                </params>
                <scope line="389">
                    <scope line="391"/>
                    <scope line="397"/>
                </scope>
            </method>
            <javadoc line="406">
                Inform remote endpoint that connection has been closed.                
                <param>
                    info connection information structure                    
                </param>
            </javadoc>
            <method name="sendClose" type="void" line="411">
                <params>
                    <param name="info" type="MultiplexConnectionInfo"/>
                </params>
                <scope line="413">
                    <scope line="415"/>
                    <scope line="420"/>
                </scope>
            </method>
            <javadoc line="429">
                Acknowledge remote endpoint&apos;s closing of connection.                
                <param>
                    info connection information structure                    
                </param>
            </javadoc>
            <method name="sendCloseAck" type="void" line="434">
                <params>
                    <param name="info" type="MultiplexConnectionInfo"/>
                </params>
                <scope line="435">
                    <scope line="437"/>
                    <scope line="442"/>
                </scope>
            </method>
            <javadoc line="451">
                Shut down connection upon finalization.                
            </javadoc>
            <method name="finalize" type="void" line="455"/>
        </class>
    </source>