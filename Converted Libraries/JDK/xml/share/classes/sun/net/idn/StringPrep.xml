<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.net.idn">
        <import package="java.io.BufferedInputStream"/>
        <import package="java.io.ByteArrayInputStream"/>
        <import package="java.io.IOException"/>
        <import package="java.io.InputStream"/>
        <import package="java.text.ParseException"/>
        <import package="sun.text.Normalizer"/>
        <import package="sun.text.normalizer.CharTrie"/>
        <import package="sun.text.normalizer.Trie"/>
        <import package="sun.text.normalizer.NormalizerImpl"/>
        <import package="sun.text.normalizer.VersionInfo"/>
        <import package="sun.text.normalizer.UCharacter"/>
        <import package="sun.text.normalizer.UCharacterIterator"/>
        <import package="sun.text.normalizer.UTF16"/>
        <import package="sun.net.idn.UCharacterDirection"/>
        <import package="sun.net.idn.StringPrepDataReader"/>
        <class name="StringPrep" line="61">
            <comment line="122">
                                
            </comment>
            <comment line="125">
                                
            </comment>
            <comment line="126">
                                
            </comment>
            <comment line="127">
                                
            </comment>
            <comment line="128">
                                
            </comment>
            <comment line="129">
                                
            </comment>
            <comment line="130">
                                
            </comment>
            <comment line="133">
                                
            </comment>
            <comment line="134">
                                
            </comment>
            <comment line="142">
                                
            </comment>
            <comment line="157">
                CharTrie implmentation for reading the trie data                
            </comment>
            <comment line="159">
                Indexes read from the data file                
            </comment>
            <comment line="161">
                mapping data read from the data file                
            </comment>
            <comment line="163">
                format version of the data file                
            </comment>
            <comment line="165">
                the version of Unicode supported by the data file                
            </comment>
            <comment line="167">
                the Unicode version of last entry in the
                 NormalizationCorrections.txt file if normalization
                 is turned on                
            </comment>
            <comment line="171">
                Option to turn on Normalization                
            </comment>
            <comment line="173">
                Option to turn on checking for BiDi rules                
            </comment>
            <comment line="360">
                boolean isLabelSeparator(int ch){
                int result = getCodePointValue(ch);
                if( (result &amp; 0x07)  == LABEL_SEPARATOR){
                return true;
                }
                return false;
                }                
            </comment>
            <comment line="369">
                1) Map -- For each character in the input, check if it has a mapping
                and, if so, replace it with its mapping.
                
                2) Normalize -- Possibly normalize the result of step 1 using Unicode
                normalization.
                
                3) Prohibit -- Check for any characters that are not allowed in the
                output.  If any are found, return an error.
                
                4) Check bidi -- Possibly check for right-to-left characters, and if
                any are found, make sure that the whole string satisfies the
                requirements for bidirectional strings.  If the string does not
                satisfy the requirements for bidirectional strings, return an
                error.
                [Unicode3.2] defines several bidirectional categories; each character
                has one bidirectional category assigned to it.  For the purposes of
                the requirements below, an &quot;RandALCat character&quot; is a character that
                has Unicode bidirectional categories &quot;R&quot; or &quot;AL&quot;; an &quot;LCat character&quot;
                is a character that has Unicode bidirectional category &quot;L&quot;.  Note
                
                
                that there are many characters which fall in neither of the above
                definitions; Latin digits (&lt;U+0030&gt; through &lt;U+0039&gt;) are examples of
                this because they have bidirectional category &quot;EN&quot;.
                
                In any profile that specifies bidirectional character handling, all
                three of the following requirements MUST be met:
                
                1) The characters in section 5.8 MUST be prohibited.
                
                2) If a string contains any RandALCat character, the string MUST NOT
                contain any LCat character.
                
                3) If a string contains any RandALCat character, a RandALCat
                character MUST be the first character of the string, and a
                RandALCat character MUST be the last character of the string.                
            </comment>
            <javadoc line="61">
                StringPrep API implements the StingPrep framework as described by
                  &lt;a href=&quot;http://www.ietf.org/rfc/rfc3454.txt&quot;&gt;RFC 3454&lt;/a&gt;.
                  StringPrep prepares Unicode strings for use in network protocols.
                  Profiles of StingPrep are set of rules and data according to which the
                  Unicode Strings are prepared. Each profiles contains tables which describe
                  how a code point should be treated. The tables are broadly classied into
                  &lt;ul&gt;
                  &lt;li&gt; Unassigned Table: Contains code points that are unassigned
                  in the Unicode Version supported by StringPrep. Currently
                  RFC 3454 supports Unicode 3.2. &lt;/li&gt;
                  &lt;li&gt; Prohibited Table: Contains code points that are prohibted from
                  the output of the StringPrep processing function. &lt;/li&gt;
                  &lt;li&gt; Mapping Table: Contains code ponts that are deleted from the output or case mapped. &lt;/li&gt;
                  &lt;/ul&gt;
                  The procedure for preparing Unicode strings:
                  &lt;ol&gt;
                  &lt;li&gt; Map: For each character in the input, check if it has a mapping
                  and, if so, replace it with its mapping. &lt;/li&gt;
                  &lt;li&gt; Normalize: Possibly normalize the result of step 1 using Unicode
                  normalization. &lt;/li&gt;
                  &lt;li&gt; Prohibit: Check for any characters that are not allowed in the
                  output.  If any are found, return an error.&lt;/li&gt;
                  &lt;li&gt; Check bidi: Possibly check for right-to-left characters, and if
                  any are found, make sure that the whole string satisfies the
                  requirements for bidirectional strings.  If the string does not
                  satisfy the requirements for bidirectional strings, return an
                  error.  &lt;/li&gt;
                  &lt;/ol&gt;                
                <author>
                    Ram Viswanadha                    
                </author>
                <draft>
                    ICU 2.8                    
                </draft>
            </javadoc>
            <declaration name="DEFAULT" type="int" line="95"/>
            <javadoc line="95">
                Option to prohibit processing of unassigned code points in the input                
                <see>
                    #prepare                    
                </see>
                <draft>
                    ICU 2.8                    
                </draft>
            </javadoc>
            <declaration name="ALLOW_UNASSIGNED" type="int" line="103"/>
            <javadoc line="103">
                Option to allow processing of unassigned code points in the input                
                <see>
                    #prepare                    
                </see>
                <draft>
                    ICU 2.8                    
                </draft>
            </javadoc>
            <declaration name="UNASSIGNED" type="int" line="111"/>
            <declaration name="MAP" type="int" line="112"/>
            <declaration name="PROHIBITED" type="int" line="113"/>
            <declaration name="DELETE" type="int" line="114"/>
            <declaration name="TYPE_LIMIT" type="int" line="115"/>
            <declaration name="NORMALIZATION_ON" type="int" line="117"/>
            <declaration name="CHECK_BIDI_ON" type="int" line="118"/>
            <declaration name="TYPE_THRESHOLD" type="int" line="120"/>
            <declaration name="MAX_INDEX_VALUE" type="int" line="121"/>
            <declaration name="MAX_INDEX_TOP_LENGTH" type="int" line="122"/>
            <declaration name="INDEX_TRIE_SIZE" type="int" line="125"/>
            <declaration name="INDEX_MAPPING_DATA_SIZE" type="int" line="126"/>
            <declaration name="NORM_CORRECTNS_LAST_UNI_VERSION" type="int" line="127"/>
            <declaration name="ONE_UCHAR_MAPPING_INDEX_START" type="int" line="128"/>
            <declaration name="TWO_UCHARS_MAPPING_INDEX_START" type="int" line="129"/>
            <declaration name="THREE_UCHARS_MAPPING_INDEX_START" type="int" line="130"/>
            <declaration name="FOUR_UCHARS_MAPPING_INDEX_START" type="int" line="131"/>
            <declaration name="OPTIONS" type="int" line="132"/>
            <declaration name="INDEX_TOP" type="int" line="133"/>
            <declaration name="DATA_BUFFER_SIZE" type="int" line="136"/>
            <javadoc line="136">
                Default buffer size of datafile                
            </javadoc>
            <class name="StringPrepTrieImpl" line="142">
                <implements interface="Trie.DataManipulate"/>
                <declaration name="sprepTrie" type="CharTrie" line="143"/>
                <javadoc line="144">
                    Called by com.ibm.icu.util.Trie to extract from a lead surrogate&apos;s
                      data the index array offset of the indexes for that lead surrogate.                    
                    <param>
                        property data value for a surrogate from the trie, including
                          the folding offset                        
                    </param>
                    <return>
                        data offset or 0 if there is no data for the lead surrogate                        
                    </return>
                </javadoc>
                <method name="getFoldingOffset" type="int" line="151">
                    <params>
                        <param name="value" type="int"/>
                    </params>
                </method>
            </class>
            <declaration name="sprepTrieImpl" type="StringPrepTrieImpl" line="157"/>
            <declaration name="indexes" type="int[]" line="159"/>
            <declaration name="mappingData" type="char[]" line="161"/>
            <declaration name="formatVersion" type="byte[]" line="163"/>
            <declaration name="sprepUniVer" type="VersionInfo" line="165"/>
            <declaration name="normCorrVer" type="VersionInfo" line="169"/>
            <declaration name="doNFKC" type="boolean" line="171"/>
            <declaration name="checkBiDi" type="boolean" line="173"/>
            <method name="getCodePointValue" type="char" line="176">
                <params>
                    <param name="ch" type="int"/>
                </params>
            </method>
            <method name="getVersionInfo" type="VersionInfo" line="180">
                <params>
                    <param name="comp" type="int"/>
                </params>
                <declaration name="micro" type="int" line="181"/>
                <declaration name="milli" type="int" line="182"/>
                <declaration name="minor" type="int" line="183"/>
                <declaration name="major" type="int" line="184"/>
            </method>
            <method name="getVersionInfo" type="VersionInfo" line="187">
                <params>
                    <param name="version" type="byte[]"/>
                </params>
                <scope line="188"/>
            </method>
            <javadoc line="193">
                Creates an StringPrep object after reading the input stream.
                  The object does not hold a reference to the input steam, so the stream can be
                  closed after the method returns.                
                <param>
                    inputStream The stream for reading the StringPrep profile binarySun                    
                </param>
                <throws>
                    IOException                    
                </throws>
                <draft>
                    ICU 2.8                    
                </draft>
            </javadoc>
            <method name="StringPrep" type="constructor" line="202">
                <params>
                    <param name="inputStream" type="InputStream"/>
                </params>
                <comment line="209">
                    read the indexes                    
                </comment>
                <comment line="215">
                    indexes[INDEX_MAPPING_DATA_SIZE] store the size of mappingData in bytes                    
                </comment>
                <comment line="217">
                    load the rest of the data data and initialize the data members                    
                </comment>
                <comment line="223">
                    get the data format version                    
                </comment>
                <comment line="226">
                    get the options                    
                </comment>
                <comment line="232">
                                        
                </comment>
                <comment line="233">
                                        
                </comment>
                <comment line="234">
                                        
                </comment>
                <declaration name="b" type="BufferedInputStream" line="204"/>
                <declaration name="reader" type="StringPrepDataReader" line="206"/>
                <declaration name="sprepBytes" type="byte[]" line="211"/>
                <declaration name="normUniVer" type="VersionInfo" line="230"/>
                <scope line="234"/>
            </method>
            <class name="Values" line="240">
                <declaration name="isIndex" type="boolean" line="241"/>
                <declaration name="value" type="int" line="242"/>
                <declaration name="type" type="int" line="243"/>
                <method name="reset" type="void" line="244"/>
            </class>
            <method name="getValues" type="void" line="251">
                <params>
                    <param name="trieWord" type="char"/>
                    <param name="values" type="Values"/>
                </params>
                <comment line="255">
                    Initial value stored in the mapping table
                     just return TYPE_LIMIT .. so that
                     the source codepoint is copied to the destination                    
                </comment>
                <comment line="264">
                                        
                </comment>
                <comment line="266">
                                        
                </comment>
                <comment line="269">
                    mask off the lower 2 bits and shift                    
                </comment>
                <scope line="253"/>
                <scope line="260"/>
                <scope line="262">
                    <scope line="266"/>
                    <scope line="270"/>
                    <scope line="277"/>
                </scope>
            </method>
            <method name="map" type="StringBuffer" line="288">
                <params>
                    <param name="iter" type="UCharacterIterator"/>
                    <param name="options" type="int"/>
                </params>
                <comment line="302">
                    check if the source codepoint is unassigned                    
                </comment>
                <comment line="323">
                                        
                </comment>
                <comment line="331">
                    just consume the codepoint and contine                    
                </comment>
                <comment line="334">
                    copy the source into destination                    
                </comment>
                <declaration name="val" type="Values" line="290"/>
                <declaration name="result" type="char" line="291"/>
                <declaration name="ch" type="int" line="292"/>
                <declaration name="dest" type="StringBuffer" line="293"/>
                <declaration name="allowUnassigned" type="boolean" line="294"/>
                <scope line="296">
                    <scope line="302"/>
                    <scope line="305">
                        <declaration name="index" type="int" line="306"/>
                        <scope line="308">
                            <scope line="311"/>
                            <scope line="314"/>
                            <scope line="317"/>
                            <scope line="319"/>
                        </scope>
                        <scope line="326"/>
                    </scope>
                    <scope line="329"/>
                </scope>
            </method>
            <method name="normalize" type="StringBuffer" line="341">
                <params>
                    <param name="src" type="StringBuffer"/>
                </params>
                <comment line="343">
                    Option UNORM_BEFORE_PRI_29:
                    
                     IDNA as interpreted by IETF members (see unicode mailing list 2004H1)
                     requires strict adherence to Unicode 3.2 normalization,
                     including buggy composition from before fixing Public Review Issue #29.
                     Note that this results in some valid but nonsensical text to be
                     either corrupted or rejected, depending on the text.
                     See http:www.unicode.orgreviewresolved-pri.html#pri29
                     See unorm.cpp and cnormtst.c                    
                </comment>
            </method>
            <javadoc line="406">
                Prepare the input buffer for use in applications with the given profile. This operation maps, normalizes(NFKC),
                  checks for prohited and BiDi characters in the order defined by RFC 3454
                  depending on the options specified in the profile.                
                <param>
                    src           A UCharacterIterator object containing the source string                    
                </param>
                <param>
                    options       A bit set of options:
                      - StringPrep.NONE               Prohibit processing of unassigned code points in the input
                      - StringPrep.ALLOW_UNASSIGNED   Treat the unassigned code points are in the input
                      as normal Unicode code points.                    
                </param>
                <return>
                    StringBuffer A StringBuffer containing the output                    
                </return>
                <throws>
                    ParseException                    
                </throws>
                <draft>
                    ICU 2.8                    
                </draft>
            </javadoc>
            <method name="prepare" type="StringBuffer" line="424">
                <params>
                    <param name="src" type="UCharacterIterator"/>
                    <param name="options" type="int"/>
                </params>
                <comment line="427">
                    map                    
                </comment>
                <comment line="429">
                    initialize                    
                </comment>
                <comment line="432">
                    normalize                    
                </comment>
                <comment line="468">
                    satisfy 2                    
                </comment>
                <comment line="475">
                    satisfy 3                    
                </comment>
                <declaration name="mapOut" type="StringBuffer" line="427"/>
                <declaration name="normOut" type="StringBuffer" line="428"/>
                <scope line="430"/>
                <declaration name="ch" type="int" line="435"/>
                <declaration name="result" type="char" line="436"/>
                <declaration name="iter" type="UCharacterIterator" line="437"/>
                <declaration name="val" type="Values" line="438"/>
                <declaration name="direction" type="int" line="439"/>
                <declaration name="rtlPos" type="int" line="441"/>
                <declaration name="rightToLeft" type="boolean" line="442"/>
                <scope line="444">
                    <scope line="448"/>
                    <scope line="454"/>
                    <scope line="457"/>
                    <scope line="461"/>
                </scope>
                <scope line="466">
                    <scope line="468"/>
                    <scope line="478"/>
                </scope>
            </method>
        </class>
    </source>