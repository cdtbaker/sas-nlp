<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.swing.text">
        <import package="java.awt.ComponentOrientation"/>
        <import package="java.awt.Dimension"/>
        <import package="java.awt.Font"/>
        <import package="java.awt.FontMetrics"/>
        <import package="java.awt.Graphics"/>
        <import package="java.awt.Graphics2D"/>
        <import package="java.awt.Insets"/>
        <import package="java.awt.Rectangle"/>
        <import package="java.awt.Component"/>
        <import package="java.awt.Container"/>
        <import package="java.awt.font.FontRenderContext"/>
        <import package="java.awt.print.PageFormat"/>
        <import package="java.awt.print.Printable"/>
        <import package="java.awt.print.PrinterException"/>
        <import package="java.text.MessageFormat"/>
        <import package="java.util.ArrayList"/>
        <import package="java.util.Collections"/>
        <import package="java.util.List"/>
        <import package="java.util.concurrent.Callable"/>
        <import package="java.util.concurrent.ExecutionException"/>
        <import package="java.util.concurrent.FutureTask"/>
        <import package="java.util.concurrent.atomic.AtomicReference"/>
        <import package="javax.swing.BorderFactory"/>
        <import package="javax.swing.CellRendererPane"/>
        <import package="javax.swing.JTextField"/>
        <import package="javax.swing.JTextArea"/>
        <import package="javax.swing.JEditorPane"/>
        <import package="javax.swing.JViewport"/>
        <import package="javax.swing.JScrollPane"/>
        <import package="javax.swing.JTextPane"/>
        <import package="javax.swing.SwingUtilities"/>
        <import package="javax.swing.border.Border"/>
        <import package="javax.swing.border.TitledBorder"/>
        <import package="javax.swing.text.BadLocationException"/>
        <import package="javax.swing.text.JTextComponent"/>
        <import package="javax.swing.text.Document"/>
        <import package="javax.swing.text.EditorKit"/>
        <import package="javax.swing.text.AbstractDocument"/>
        <import package="javax.swing.text.html.HTMLDocument"/>
        <import package="javax.swing.text.html.HTML"/>
        <import package="sun.font.FontDesignMetrics"/>
        <import package="sun.swing.text.html.FrameEditorPaneTag"/>
        <class name="TextComponentPrintable" line="73">
            <comment line="106">
                The text component to print.                
            </comment>
            <comment line="111">
                The FontRenderContext to layout and print with                
            </comment>
            <implements interface="CountingPrintable"/>
            <javadoc line="73">
                An implementation of {@code Printable} to print {@code JTextComponent} with
                  the header and footer.
                  &lt;h1&gt;
                  WARNING: this class is to be used in
                  javax.swing.text.JTextComponent only.
                  &lt;/h1&gt;
                  &lt;p&gt;
                  The implementation creates a new {@code JTextComponent} ({@code printShell})
                  to print the content using the {@code Document}, {@code EditorKit} and
                  rendering-affecting properties from the original {@code JTextComponent}.
                  &lt;p&gt;{@code printShell} is laid out on the first {@code print} invocation.
                  &lt;p&gt;
                  This class can be used on any thread. Part of the implementation is executed
                  on the EDT though.                
                <author>
                    Igor Kushnirskiy                    
                </author>
                <since>
                    1.6                    
                </since>
            </javadoc>
            <declaration name="LIST_SIZE" type="int" line="101"/>
            <declaration name="isLayouted" type="boolean" line="103"/>
            <declaration name="textComponentToPrint" type="JTextComponent" line="108"/>
            <declaration name="frc" type="AtomicReference&lt;FontRenderContext&gt;" line="113"/>
            <declaration name="printShell" type="JTextComponent" line="116"/>
            <javadoc line="116">
                Special text component used to print to the printer.                
            </javadoc>
            <declaration name="headerFormat" type="MessageFormat" line="121"/>
            <declaration name="footerFormat" type="MessageFormat" line="122"/>
            <declaration name="HEADER_FONT_SIZE" type="float" line="124"/>
            <declaration name="FOOTER_FONT_SIZE" type="float" line="125"/>
            <declaration name="headerFont" type="Font" line="127"/>
            <declaration name="footerFont" type="Font" line="128"/>
            <declaration name="rowsMetrics" type="List&lt;IntegerSegment&gt;" line="130"/>
            <javadoc line="130">
                stores metrics for the unhandled rows. The only metrics we need are
                  yStart and yEnd when row is handled by updatePagesMetrics it is removed
                  from the list. Thus the head of the list is the fist row to handle.
                  sorted                
            </javadoc>
            <declaration name="pagesMetrics" type="List&lt;IntegerSegment&gt;" line="139"/>
            <javadoc line="139">
                thread-safe list for storing pages metrics. The only metrics we need are
                  yStart and yEnd.
                  It has to be thread-safe since metrics are calculated on
                  the printing thread and accessed on the EDT thread.
                  sorted                
            </javadoc>
            <javadoc line="149">
                Returns {@code TextComponentPrintable} to print {@code textComponent}.                
                <param>
                    textComponent {@code JTextComponent} to print                    
                </param>
                <param>
                    headerFormat the page header, or {@code null} for none                    
                </param>
                <param>
                    footerFormat the page footer, or {@code null} for none                    
                </param>
                <return>
                    {@code TextComponentPrintable} to print {@code textComponent}                    
                </return>
            </javadoc>
            <method name="getPrintable" type="Printable" line="159">
                <params>
                    <param name="textComponent" type="JTextComponent"/>
                    <param name="headerFormat" type="MessageFormat"/>
                    <param name="footerFormat" type="MessageFormat"/>
                </params>
                <comment line="164">
                    for document with frames we create one printable per
                    frame and merge them with the CompoundPrintable.                    
                </comment>
                <scope line="162">
                    <declaration name="frames" type="List&lt;JEditorPane&gt;" line="165"/>
                    <declaration name="printables" type="List&lt;CountingPrintable&gt;" line="166"/>
                    <scope line="168"/>
                </scope>
                <scope line="173"/>
            </method>
            <javadoc line="179">
                Checks whether the document has frames. Only HTMLDocument might
                  have frames.                
                <param>
                    document the {@code Document} to check                    
                </param>
                <return>
                    {@code true} if the {@code document} has frames                    
                </return>
            </javadoc>
            <method name="isFrameSetDocument" type="boolean" line="186">
                <params>
                    <param name="document" type="Document"/>
                </params>
                <declaration name="ret" type="boolean" line="187"/>
                <scope line="188">
                    <declaration name="htmlDocument" type="HTMLDocument" line="189"/>
                    <scope line="190"/>
                </scope>
            </method>
            <javadoc line="198">
                Returns frames under the {@code editor}.
                  The frames are created if necessary.                
                <param>
                    editor the {@JEditorPane} to find the frames for                    
                </param>
                <return>
                    list of all frames                    
                </return>
            </javadoc>
            <method name="getFrames" type="List<JEditorPane>" line="205">
                <params>
                    <param name="editor" type="JEditorPane"/>
                </params>
                <comment line="210">
                    the frames have not been created yet.
                    let&apos;s trigger the frames creation.                    
                </comment>
                <declaration name="list" type="List&lt;JEditorPane&gt;" line="206"/>
                <scope line="208"/>
            </method>
            <javadoc line="217">
                Adds all {@code JEditorPanes} under {@code container} tagged by {@codeFrameEditorPaneTag} to the {@code list}. It adds only top
                  level {@code JEditorPanes}.  For instance if there is a frame
                  inside the frame it will return the top frame only.                
                <param>
                    c the container to find all frames under                    
                </param>
                <param>
                    list {@code List} to append the results too                    
                </param>
            </javadoc>
            <method name="getFrames" type="void" line="226">
                <params>
                    <param name="container" type="Container"/>
                    <param name="list" type="List<JEditorPane>"/>
                </params>
                <comment line="230">
                    it should be always JEditorPane                    
                </comment>
                <scope line="227">
                    <scope line="229"/>
                    <scope line="231">
                        <scope line="232"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="239">
                Triggers the frames creation for {@code JEditorPane}                
                <param>
                    editor the {@code JEditorPane} to create frames for                    
                </param>
            </javadoc>
            <method name="createFrames" type="void" line="244">
                <params>
                    <param name="editor" type="JEditorPane"/>
                </params>
                <comment line="253">
                    the values do not matter
                    we only need to get frames created                    
                </comment>
                <anonymous_class line="246">
                    <method name="run" type="void" line="247">
                        <comment line="253">
                            the values do not matter
                            we only need to get frames created                            
                        </comment>
                        <declaration name="WIDTH" type="int" line="248"/>
                        <declaration name="HEIGHT" type="int" line="249"/>
                        <declaration name="rendererPane" type="CellRendererPane" line="250"/>
                    </method>
                </anonymous_class>
                <declaration name="doCreateFrames" type="Runnable" line="245"/>
                <scope line="257"/>
                <scope line="259">
                    <scope line="260"/>
                    <scope line="262">
                        <scope line="263"/>
                        <scope line="265"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="272">
                Constructs  {@code TextComponentPrintable} to print {@code JTextComponent}{@code textComponent} with {@code headerFormat} and {@code footerFormat}.                
                <param>
                    textComponent {@code JTextComponent} to print                    
                </param>
                <param>
                    headerFormat the page header or {@code null} for none                    
                </param>
                <param>
                    footerFormat the page footer or {@code null} for none                    
                </param>
            </javadoc>
            <method name="TextComponentPrintable" type="constructor" line="282">
                <params>
                    <param name="textComponent" type="JTextComponent"/>
                    <param name="headerFormat" type="MessageFormat"/>
                    <param name="footerFormat" type="MessageFormat"/>
                </params>
            </method>
            <javadoc line="297">
                creates a printShell.
                  It creates closest text component to {@code textComponent}which uses {@code frc} from the {@code TextComponentPrintable}for the {@code getFontMetrics} method.                
                <param>
                    textComponent {@code JTextComponent} to create a
                      printShell for                    
                </param>
                <return>
                    the print shell                    
                </return>
            </javadoc>
            <method name="createPrintShell" type="JTextComponent" line="307">
                <params>
                    <param name="textComponent" type="JTextComponent"/>
                </params>
                <scope line="308"/>
                <scope line="310">
                    <anonymous_class line="313">
                        <method name="call" type="JTextComponent" line="314"/>
                    </anonymous_class>
                    <declaration name="futureCreateShell" type="FutureTask&lt;JTextComponent&gt;" line="311"/>
                    <scope line="319"/>
                    <scope line="321"/>
                    <scope line="323">
                        <declaration name="cause" type="Throwable" line="324"/>
                        <scope line="325"/>
                        <scope line="328"/>
                    </scope>
                </scope>
            </method>
            <method name="createPrintShellOnEDT" type="JTextComponent" line="335">
                <params>
                    <param name="textComponent" type="JTextComponent"/>
                </params>
                <comment line="407">
                    want to occupy the whole width and height by text                    
                </comment>
                <comment line="410">
                    set properties from the component to print                    
                </comment>
                <declaration name="ret" type="JTextComponent" line="338"/>
                <scope line="339">
                    <anonymous_class line="341">
                        <scope line="342"/>
                        <method name="getFontMetrics" type="FontMetrics" line="347">
                            <params>
                                <param name="font" type="Font"/>
                            </params>
                        </method>
                    </anonymous_class>
                </scope>
                <scope line="353">
                    <anonymous_class line="355">
                        <scope line="356">
                            <declaration name="textArea" type="JTextArea" line="357"/>
                        </scope>
                        <method name="getFontMetrics" type="FontMetrics" line="363">
                            <params>
                                <param name="font" type="Font"/>
                            </params>
                        </method>
                    </anonymous_class>
                </scope>
                <scope line="369">
                    <anonymous_class line="371">
                        <method name="getFontMetrics" type="FontMetrics" line="373">
                            <params>
                                <param name="font" type="Font"/>
                            </params>
                        </method>
                        <method name="getEditorKit" type="EditorKit" line="379">
                            <scope line="380"/>
                            <scope line="382"/>
                        </method>
                    </anonymous_class>
                </scope>
                <scope line="387">
                    <anonymous_class line="389">
                        <method name="getFontMetrics" type="FontMetrics" line="391">
                            <params>
                                <param name="font" type="Font"/>
                            </params>
                        </method>
                        <method name="getEditorKit" type="EditorKit" line="397">
                            <scope line="398"/>
                            <scope line="400"/>
                        </method>
                    </anonymous_class>
                </scope>
                <scope line="419"/>
            </method>
            <javadoc line="435">
                Returns the number of pages in this printable.
                  &lt;p&gt;
                  This number is defined only after {@code print} returns NO_SUCH_PAGE.                
                <return>
                    the number of pages.                    
                </return>
            </javadoc>
            <method name="getNumberOfPages" type="int" line="442"/>
            <javadoc line="446">
                See Printable.print for the API description.
                  There are two parts in the implementation.
                  First part (print) is to be called on the printing thread.
                  Second part (printOnEDT) is to be called on the EDT only.
                  print triggers printOnEDT                
            </javadoc>
            <method name="print" type="int" line="457">
                <params>
                    <param name="graphics" type="Graphics"/>
                    <param name="pf" type="PageFormat"/>
                    <param name="pageIndex" type="int"/>
                </params>
                <scope line="458">
                    <scope line="459"/>
                </scope>
                <declaration name="ret" type="int" line="465"/>
                <scope line="466">
                    <anonymous_class line="467">
                        <method name="call" type="Integer" line="468"/>
                    </anonymous_class>
                    <declaration name="doPrintOnEDT" type="Callable&lt;Integer&gt;" line="467"/>
                    <declaration name="futurePrintOnEDT" type="FutureTask&lt;Integer&gt;" line="472"/>
                    <scope line="475"/>
                    <scope line="477"/>
                    <scope line="479">
                        <declaration name="cause" type="Throwable" line="480"/>
                        <scope line="481"/>
                        <scope line="483"/>
                        <scope line="485"/>
                        <scope line="487"/>
                    </scope>
                </scope>
                <scope line="491"/>
            </method>
            <javadoc line="498">
                The EDT part of the print method.
                  This method is to be called on the EDT only. Layout should be done before
                  calling this method.                
            </javadoc>
            <method name="printOnEDT" type="int" line="506">
                <params>
                    <param name="graphics" type="Graphics"/>
                    <param name="pf" type="PageFormat"/>
                    <param name="pageIndex" type="int"/>
                </params>
                <comment line="510">
                    handle header and footer                    
                </comment>
                <comment line="512">
                    Printable page enumeration is 0 base. We need 1 based.                    
                </comment>
                <comment line="544">
                    want to clip only vertically                    
                </comment>
                <declaration name="border" type="Border" line="508"/>
                <scope line="510">
                    <declaration name="formatArg" type="Object[]" line="512"/>
                    <scope line="513"/>
                    <scope line="519"/>
                </scope>
                <declaration name="borderInsets" type="Insets" line="526"/>
                <scope line="531"/>
                <declaration name="g2d" type="Graphics2D" line="535"/>
                <declaration name="clip" type="Rectangle" line="544"/>
                <declaration name="xStart" type="int" line="550"/>
                <scope line="552"/>
            </method>
            <declaration name="needReadLock" type="boolean" line="564"/>
            <javadoc line="566">
                Tries to release document&apos;s readlock
                  Note: Not to be called on the EDT.                
            </javadoc>
            <method name="releaseReadLock" type="void" line="571">
                <comment line="580">
                    readUnlock() might throw StateInvariantError                    
                </comment>
                <declaration name="document" type="Document" line="573"/>
                <scope line="574">
                    <scope line="575"/>
                    <scope line="578"/>
                </scope>
            </method>
            <javadoc line="585">
                Tries to acquire document&apos;s readLock if it was released
                  in releaseReadLock() method.
                  Note: Not to be called on the EDT.                
            </javadoc>
            <method name="acquireReadLock" type="void" line="591">
                <comment line="596">
                    wait until all the EDT events are processed
                     some of the document changes are asynchronous
                     we need to make sure we get the lock after those changes                    
                </comment>
                <scope line="593">
                    <scope line="594">
                        <anonymous_class line="601">
                            <method name="run" type="void" line="602"/>
                        </anonymous_class>
                    </scope>
                    <scope line="605"/>
                    <scope line="606"/>
                    <declaration name="document" type="Document" line="608"/>
                </scope>
            </method>
            <javadoc line="614">
                Prepares {@code printShell} for printing.
                  Sets properties from the component to print.
                  Sets width and FontRenderContext.
                  Triggers Views creation for the printShell.
                  There are two parts in the implementation.
                  First part (layout) is to be called on the printing thread.
                  Second part (layoutOnEDT) is to be called on the EDT only.{@code layout} triggers {@code layoutOnEDT}.                
                <param>
                    width width to layout the text for                    
                </param>
            </javadoc>
            <method name="layout" type="void" line="630">
                <params>
                    <param name="width" type="int"/>
                </params>
                <comment line="642">
                    We need to release document&apos;s readlock while printShell is
                     initializing                    
                </comment>
                <scope line="631">
                    <anonymous_class line="632">
                        <method name="call" type="Object" line="633"/>
                    </anonymous_class>
                    <declaration name="doLayoutOnEDT" type="Callable&lt;Object&gt;" line="632"/>
                    <declaration name="futureLayoutOnEDT" type="FutureTask&lt;Object&gt;" line="638"/>
                    <scope line="647"/>
                    <scope line="649"/>
                    <scope line="651">
                        <declaration name="cause" type="Throwable" line="652"/>
                        <scope line="653"/>
                        <scope line="655"/>
                        <scope line="657"/>
                    </scope>
                    <scope line="660"/>
                </scope>
                <scope line="663"/>
            </method>
            <javadoc line="670">
                The EDT part of layout method.
                  This method is to be called on the EDT only.                
            </javadoc>
            <method name="layoutOnEDT" type="void" line="675">
                <params>
                    <param name="width" type="int"/>
                </params>
                <comment line="678">
                    need to have big value but smaller than MAX_VALUE otherwise
                    printing goes south due to overflow somewhere                    
                </comment>
                <comment line="684">
                    need to use JViewport since text is layouted to the viewPort width
                    otherwise it will be layouted to the maximum text width                    
                </comment>
                <comment line="690">
                    JTextField is a special case
                    it layouts text in the middle by Y                    
                </comment>
                <declaration name="HUGE_INTEGER" type="int" line="679"/>
                <declaration name="rendererPane" type="CellRendererPane" line="681"/>
                <declaration name="viewport" type="JViewport" line="685"/>
                <declaration name="size" type="Dimension" line="687"/>
                <scope line="691"/>
            </method>
            <javadoc line="702">
                Calculates pageMetrics for the pages up to the {@code pageIndex} using{@code rowsMetrics}.
                  Metrics are stored in the {@code pagesMetrics}.                
                <param>
                    pageIndex the page to update the metrics for                    
                </param>
                <param>
                    pageHeight the page height                    
                </param>
            </javadoc>
            <method name="updatePagesMetrics" type="void" line="710">
                <params>
                    <param name="pageIndex" type="int"/>
                    <param name="pageHeight" type="int"/>
                </params>
                <comment line="713">
                    add one page to the pageMetrics                    
                </comment>
                <comment line="726">
                    can not fit a single row
                     need to split                    
                </comment>
                <scope line="711">
                    <declaration name="lastPage" type="int" line="713"/>
                    <declaration name="pageStart" type="int" line="714"/>
                    <declaration name="rowIndex" type="int" line="717"/>
                    <scope line="722"/>
                    <scope line="724"/>
                    <scope line="729">
                        <scope line="733"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="740">
                Calculates rowsMetrics for the document. The result is stored
                  in the {@code rowsMetrics}.
                  Two steps process.
                  First step is to find yStart and yEnd for the every document position.
                  Second step is to merge all intersected segments ( [yStart, yEnd] ).                
            </javadoc>
            <method name="calculateRowsMetrics" type="void" line="748">
                <comment line="762">
                    we do not store the same value as previous. in our
                     documents it is often for consequent positons to have
                     the same modelToView y and height.                    
                </comment>
                <comment line="776">
                    Merge all intersected segments.                    
                </comment>
                <declaration name="documentLength" type="int" line="749"/>
                <declaration name="documentMetrics" type="List&lt;IntegerSegment&gt;" line="750"/>
                <declaration name="rect" type="Rectangle" line="751"/>
                <scope line="753">
                    <scope line="754">
                        <scope line="756">
                            <declaration name="y" type="int" line="757"/>
                            <declaration name="height" type="int" line="758"/>
                            <scope line="760"/>
                        </scope>
                    </scope>
                    <scope line="771"/>
                </scope>
                <declaration name="yStart" type="int" line="779"/>
                <declaration name="yEnd" type="int" line="780"/>
                <scope line="781">
                    <scope line="782">
                        <scope line="783"/>
                    </scope>
                    <scope line="788"/>
                </scope>
                <scope line="792"/>
            </method>
            <class name="IntegerSegment" line="797">
                <implements interface="Comparable">
                    <type_params>
                        <type_param name="IntegerSegment"/>
                    </type_params>
                </implements>
                <javadoc line="797">
                    Class to represent segment of integers.
                      we do not call it Segment to avoid confusion with
                      javax.swing.text.Segment                    
                </javadoc>
                <declaration name="start" type="int" line="803"/>
                <declaration name="end" type="int" line="804"/>
                <method name="IntegerSegment" type="constructor" line="806">
                    <params>
                        <param name="start" type="int"/>
                        <param name="end" type="int"/>
                    </params>
                </method>
                <method name="compareTo" type="int" line="811">
                    <params>
                        <param name="object" type="IntegerSegment"/>
                    </params>
                    <declaration name="startsDelta" type="int" line="812"/>
                </method>
                <method name="equals" type="boolean" line="817">
                    <params>
                        <param name="obj" type="Object"/>
                    </params>
                    <scope line="818"/>
                    <scope line="820"/>
                </method>
                <method name="hashCode" type="int" line="826">
                    <comment line="828">
                        from the &quot;Effective Java: Programming Language Guide&quot;                        
                    </comment>
                    <declaration name="result" type="int" line="828"/>
                </method>
                <method name="toString" type="String" line="835"/>
            </class>
        </class>
    </source>