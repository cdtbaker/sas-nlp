<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.security.pkcs11">
        <import package="java.util"/>
        <import package="java.security.ProviderException"/>
        <import package="sun.security.util.Debug"/>
        <import package="sun.security.pkcs11.wrapper"/>
        <import package="sun.security.pkcs11.wrapper.PKCS11Constants"/>
        <class name="SessionManager" line="37">
            <comment line="74">
                token instance                
            </comment>
            <comment line="77">
                maximum number of sessions to open with this token                
            </comment>
            <comment line="80">
                total number of active sessions                
            </comment>
            <comment line="83">
                pool of available object sessions                
            </comment>
            <comment line="86">
                pool of available operation sessions                
            </comment>
            <comment line="89">
                maximum number of active sessions during this invocation, for debugging                
            </comment>
            <comment line="92">
                flags to use in the C_OpenSession() call                
            </comment>
            <comment line="116">
                returns whether only a fairly low number of sessions are
                 supported by this token.                
            </comment>
            <javadoc line="37">
                Session manager. There is one session manager object per PKCS#11
                  provider. It allows code to checkout a session, release it
                  back to the pool, or force it to be closed.
                  The session manager pools sessions to minimize the number of
                  C_OpenSession() and C_CloseSession() that have to be made. It
                  maintains two pools: one for &quot;object&quot; sessions and one for
                  &quot;operation&quot; sessions.
                  The reason for this separation is how PKCS#11 deals with session objects.
                  It defines that when a session is closed, all objects created within
                  that session are destroyed. In other words, we may never close a session
                  while a Key created it in is still in use. We would like to keep the
                  number of such sessions low. Note that we occasionally want to explicitly
                  close a session, see P11Signature.
                  NOTE that sessions obtained from this class SHOULD be returned using
                  either releaseSession() or closeSession() using a finally block when
                  not needed anymore. Otherwise, they will be left for cleanup via the
                  PhantomReference mechanism when GC kicks in, but it&apos;s best not to rely
                  on that since GC may not run timely enough since the native PKCS11 library
                  is also consuming memory.
                  Note that sessions are automatically closed when they are not used for a
                  period of time, see Session.                
                <author>
                    Andreas Sterbenz                    
                </author>
                <since>
                    1.5                    
                </since>
            </javadoc>
            <declaration name="DEFAULT_MAX_SESSIONS" type="int" line="69"/>
            <declaration name="debug" type="Debug" line="71"/>
            <declaration name="token" type="Token" line="74"/>
            <declaration name="maxSessions" type="int" line="77"/>
            <declaration name="activeSessions" type="int" line="80"/>
            <declaration name="objSessions" type="Pool" line="83"/>
            <declaration name="opSessions" type="Pool" line="86"/>
            <declaration name="maxActiveSessions" type="int" line="89"/>
            <declaration name="openSessionFlags" type="long" line="92"/>
            <method name="SessionManager" type="constructor" line="94">
                <params>
                    <param name="token" type="Token"/>
                </params>
                <comment line="107">
                    choose an arbitrary concrete value                    
                </comment>
                <declaration name="n" type="long" line="95"/>
                <scope line="96"/>
                <scope line="99"/>
                <scope line="103"/>
                <scope line="105"/>
            </method>
            <method name="lowMaxSessions" type="boolean" line="117"/>
            <method name="getObjSession" type="Session" line="121">
                <declaration name="session" type="Session" line="122"/>
                <scope line="123"/>
                <scope line="127"/>
            </method>
            <method name="getOpSession" type="Session" line="134">
                <comment line="140">
                    create a new session rather than re-using an obj session
                     that avoids potential expensive cancels() for Signatures &amp; RSACipher                    
                </comment>
                <declaration name="session" type="Session" line="135"/>
                <scope line="136"/>
                <scope line="142"/>
                <scope line="147"/>
            </method>
            <method name="ensureValid" type="Session" line="153">
                <params>
                    <param name="session" type="Session"/>
                </params>
            </method>
            <method name="killSession" type="Session" line="158">
                <params>
                    <param name="session" type="Session"/>
                </params>
                <scope line="159"/>
                <scope line="162">
                    <declaration name="location" type="String" line="163"/>
                </scope>
            </method>
            <method name="releaseSession" type="Session" line="171">
                <params>
                    <param name="session" type="Session"/>
                </params>
                <scope line="172"/>
                <scope line="176"/>
                <scope line="178"/>
            </method>
            <method name="demoteObjSession" type="void" line="184">
                <params>
                    <param name="session" type="Session"/>
                </params>
                <comment line="195">
                    session is currently in use
                     will be added to correct pool on release, nothing to do now                    
                </comment>
                <scope line="185"/>
                <scope line="188"/>
                <declaration name="present" type="boolean" line="192"/>
                <scope line="193"/>
            </method>
            <method name="openSession" type="Session" line="201">
                <scope line="203"/>
                <declaration name="id" type="long" line="206"/>
                <declaration name="session" type="Session" line="208"/>
                <scope line="210">
                    <scope line="211">
                        <scope line="213"/>
                    </scope>
                </scope>
            </method>
            <method name="closeSession" type="void" line="221">
                <params>
                    <param name="session" type="Session"/>
                </params>
            </method>
            <class name="Pool" line="226">
                <declaration name="mgr" type="SessionManager" line="228"/>
                <declaration name="pool" type="List&lt;Session&gt;" line="230"/>
                <method name="Pool" type="constructor" line="232">
                    <params>
                        <param name="mgr" type="SessionManager"/>
                    </params>
                </method>
                <method name="remove" type="boolean" line="237">
                    <params>
                        <param name="session" type="Session"/>
                    </params>
                </method>
                <method name="poll" type="Session" line="241">
                    <declaration name="n" type="int" line="242"/>
                    <scope line="243"/>
                    <declaration name="session" type="Session" line="246"/>
                </method>
                <method name="release" type="void" line="250">
                    <params>
                        <param name="session" type="Session"/>
                    </params>
                    <comment line="253">
                        if there are idle sessions, close them                        
                    </comment>
                    <comment line="268">
                        always keep at least 1 session open                        
                    </comment>
                    <scope line="253"/>
                    <declaration name="n" type="int" line="256"/>
                    <scope line="257"/>
                    <declaration name="oldestSession" type="Session" line="260"/>
                    <declaration name="time" type="long" line="261"/>
                    <scope line="262"/>
                    <declaration name="i" type="int" line="266"/>
                    <scope line="267">
                        <scope line="269"/>
                    </scope>
                    <scope line="275"/>
                    <declaration name="subList" type="List&lt;Session&gt;" line="279"/>
                </method>
            </class>
        </class>
    </source>