<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.security.provider.certpath">
        <import package="java.util"/>
        <import package="java.security.InvalidAlgorithmParameterException"/>
        <import package="java.security.cert"/>
        <import package="javax.security.auth.x500.X500Principal"/>
        <class name="IndexedCollectionCertStore" line="35">
            <extends class="CertStoreSpi"/>
            <javadoc line="35">
                A &lt;code&gt;CertStore&lt;/code&gt; that retrieves &lt;code&gt;Certificates&lt;/code&gt; and
                  &lt;code&gt;CRL&lt;/code&gt;s from a &lt;code&gt;Collection&lt;/code&gt;.
                  &lt;p&gt;
                  This implementation is functionally equivalent to CollectionCertStore
                  with two differences:
                  &lt;ol&gt;
                  &lt;li&gt;Upon construction, the elements in the specified Collection are
                  partially indexed. X509Certificates are indexed by subject, X509CRLs
                  by issuer, non-X509 Certificates and CRLs are copied without indexing,
                  other objects are ignored. This increases CertStore construction time
                  but allows significant speedups for searches which specify the indexed
                  attributes, in particular for large Collections (reduction from linear
                  time to effectively constant time). Searches for non-indexed queries
                  are as fast (or marginally faster) than for the standard
                  CollectionCertStore. Certificate subjects and CRL issuers
                  were found to be specified in most searches used internally by the
                  CertPath provider. Additional attributes could indexed if there are
                  queries that justify the effort.
                  &lt;li&gt;Changes to the specified Collection after construction time are
                  not detected and ignored. This is because there is no way to efficiently
                  detect if a Collection has been modified, a full traversal would be
                  required. That would degrade lookup performance to linear time and
                  eliminated the benefit of indexing. We may fix this via the introduction
                  of new public APIs in the future.
                  &lt;/ol&gt;
                  &lt;p&gt;
                  Before calling the {@link #engineGetCertificates engineGetCertificates} or{@link #engineGetCRLs engineGetCRLs} methods, the{@link #CollectionCertStore(CertStoreParameters)CollectionCertStore(CertStoreParameters)} constructor is called to
                  create the &lt;code&gt;CertStore&lt;/code&gt; and establish the
                  &lt;code&gt;Collection&lt;/code&gt; from which &lt;code&gt;Certificate&lt;/code&gt;s and
                  &lt;code&gt;CRL&lt;/code&gt;s will be retrieved. If the specified
                  &lt;code&gt;Collection&lt;/code&gt; contains an object that is not a
                  &lt;code&gt;Certificate&lt;/code&gt; or &lt;code&gt;CRL&lt;/code&gt;, that object will be
                  ignored.
                  &lt;p&gt;
                  &lt;b&gt;Concurrent Access&lt;/b&gt;
                  &lt;p&gt;
                  As described in the javadoc for &lt;code&gt;CertStoreSpi&lt;/code&gt;, the
                  &lt;code&gt;engineGetCertificates&lt;/code&gt; and &lt;code&gt;engineGetCRLs&lt;/code&gt; methods
                  must be thread-safe. That is, multiple threads may concurrently
                  invoke these methods on a single &lt;code&gt;CollectionCertStore&lt;/code&gt;
                  object (or more than one) with no ill effects.
                  &lt;p&gt;
                  This is achieved by requiring that the &lt;code&gt;Collection&lt;/code&gt; passed to
                  the {@link #CollectionCertStore(CertStoreParameters)CollectionCertStore(CertStoreParameters)} constructor (via the
                  &lt;code&gt;CollectionCertStoreParameters&lt;/code&gt; object) must have fail-fast
                  iterators. Simultaneous modifications to the &lt;code&gt;Collection&lt;/code&gt; can thus be
                  detected and certificate or CRL retrieval can be retried. The fact that
                  &lt;code&gt;Certificate&lt;/code&gt;s and &lt;code&gt;CRL&lt;/code&gt;s must be thread-safe is also
                  essential.                
                <see>
                    java.security.cert.CertStore                    
                </see>
                <see>
                    CollectionCertStore                    
                </see>
                <author>
                    Andreas Sterbenz                    
                </author>
            </javadoc>
            <declaration name="certSubjects" type="Map&lt;X500Principal,Object&gt;" line="98"/>
            <javadoc line="98">
                Map X500Principal(subject) -&gt; X509Certificate | List of X509Certificate                
            </javadoc>
            <declaration name="crlIssuers" type="Map&lt;X500Principal,Object&gt;" line="102"/>
            <javadoc line="102">
                Map X500Principal(issuer) -&gt; X509CRL | List of X509CRL                
            </javadoc>
            <declaration name="otherCertificates" type="Set&lt;Certificate&gt;" line="106"/>
            <javadoc line="106">
                Sets of non-X509 certificates and CRLs                
            </javadoc>
            <declaration name="otherCRLs" type="Set&lt;CRL&gt;" line="110"/>
            <javadoc line="112">
                Creates a &lt;code&gt;CertStore&lt;/code&gt; with the specified parameters.
                  For this class, the parameters object must be an instance of
                  &lt;code&gt;CollectionCertStoreParameters&lt;/code&gt;.                
                <param>
                    params the algorithm parameters                    
                </param>
                <exception>
                    InvalidAlgorithmParameterException if params is not an
                      instance of &lt;code&gt;CollectionCertStoreParameters&lt;/code&gt;                    
                </exception>
            </javadoc>
            <method name="IndexedCollectionCertStore" type="constructor" line="122">
                <params>
                    <param name="params" type="CertStoreParameters"/>
                </params>
                <scope line="124"/>
                <declaration name="coll" type="Collection&lt;?&gt;" line="128"/>
                <scope line="129"/>
            </method>
            <javadoc line="136">
                Index the specified Collection copying all references to Certificates
                  and CRLs.                
            </javadoc>
            <method name="buildIndex" type="void" line="140">
                <params>
                    <param name="coll" type="Collection<?>"/>
                </params>
                <comment line="162">
                    ignore                    
                </comment>
                <scope line="145">
                    <scope line="146"/>
                    <scope line="148"/>
                    <scope line="150">
                        <scope line="151"/>
                    </scope>
                    <scope line="155">
                        <scope line="156"/>
                    </scope>
                    <scope line="160"/>
                </scope>
                <scope line="164"/>
                <scope line="167"/>
            </method>
            <javadoc line="172">
                Add an X509Certificate to the index.                
            </javadoc>
            <method name="indexCertificate" type="void" line="175">
                <params>
                    <param name="cert" type="X509Certificate"/>
                </params>
                <comment line="179">
                    assume this is unlikely                    
                </comment>
                <declaration name="subject" type="X500Principal" line="176"/>
                <declaration name="oldEntry" type="Object" line="177"/>
                <scope line="178">
                    <scope line="179">
                        <scope line="180"/>
                        <declaration name="list" type="List&lt;X509Certificate&gt;" line="183"/>
                    </scope>
                    <scope line="187">
                        <declaration name="list" type="List&lt;X509Certificate&gt;" line="188"/>
                        <scope line="189"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="197">
                Add an X509CRL to the index.                
            </javadoc>
            <method name="indexCRL" type="void" line="200">
                <params>
                    <param name="crl" type="X509CRL"/>
                </params>
                <comment line="204">
                    assume this is unlikely                    
                </comment>
                <declaration name="issuer" type="X500Principal" line="201"/>
                <declaration name="oldEntry" type="Object" line="202"/>
                <scope line="203">
                    <scope line="204">
                        <scope line="205"/>
                        <declaration name="list" type="List&lt;X509CRL&gt;" line="208"/>
                    </scope>
                    <scope line="212">
                        <declaration name="list" type="List&lt;X509CRL&gt;" line="213"/>
                        <scope line="214"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="222">
                Returns a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;Certificate&lt;/code&gt;s that
                  match the specified selector. If no &lt;code&gt;Certificate&lt;/code&gt;s
                  match the selector, an empty &lt;code&gt;Collection&lt;/code&gt; will be returned.                
                <param>
                    selector a &lt;code&gt;CertSelector&lt;/code&gt; used to select which
                      &lt;code&gt;Certificate&lt;/code&gt;s should be returned. Specify &lt;code&gt;null&lt;/code&gt;
                      to return all &lt;code&gt;Certificate&lt;/code&gt;s.                    
                </param>
                <return>
                    a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;Certificate&lt;/code&gt;s that
                      match the specified selector                    
                </return>
                <throws>
                    CertStoreException if an exception occurs                    
                </throws>
            </javadoc>
            <method name="engineGetCertificates" type="Collection<? extends Certificate>" line="235">
                <params>
                    <param name="selector" type="CertSelector"/>
                </params>
                <comment line="238">
                    no selector means match all                    
                </comment>
                <comment line="261">
                    see if the subject is specified                    
                </comment>
                <comment line="270">
                    yes, narrow down candidates to indexed possibilities                    
                </comment>
                <comment line="293">
                    cannot use index, iterate all                    
                </comment>
                <scope line="238">
                    <declaration name="matches" type="Set&lt;Certificate&gt;" line="239"/>
                </scope>
                <scope line="245">
                    <declaration name="matches" type="Set&lt;Certificate&gt;" line="246"/>
                    <scope line="248">
                        <scope line="249"/>
                    </scope>
                </scope>
                <scope line="256"/>
                <declaration name="x509Selector" type="X509CertSelector" line="259"/>
                <declaration name="subject" type="X500Principal" line="261"/>
                <declaration name="matchCert" type="X509Certificate" line="262"/>
                <scope line="263"/>
                <scope line="265"/>
                <scope line="268">
                    <declaration name="entry" type="Object" line="270"/>
                    <scope line="271"/>
                    <scope line="274">
                        <declaration name="x509Entry" type="X509Certificate" line="275"/>
                        <scope line="276"/>
                        <scope line="278"/>
                    </scope>
                    <scope line="281">
                        <declaration name="list" type="List&lt;X509Certificate&gt;" line="282"/>
                        <declaration name="matches" type="Set&lt;X509Certificate&gt;" line="283"/>
                        <scope line="284">
                            <scope line="285"/>
                        </scope>
                    </scope>
                </scope>
                <declaration name="matches" type="Set&lt;Certificate&gt;" line="293"/>
            </method>
            <javadoc line="298">
                Iterate through all the X509Certificates and add matches to the
                  collection.                
            </javadoc>
            <method name="matchX509Certs" type="void" line="303">
                <params>
                    <param name="selector" type="CertSelector"/>
                    <param name="matches" type="Collection<Certificate>"/>
                </params>
                <scope line="305">
                    <scope line="306">
                        <declaration name="cert" type="X509Certificate" line="307"/>
                        <scope line="308"/>
                    </scope>
                    <scope line="311">
                        <declaration name="list" type="List&lt;X509Certificate&gt;" line="312"/>
                        <scope line="313">
                            <scope line="314"/>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="322">
                Returns a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;CRL&lt;/code&gt;s that
                  match the specified selector. If no &lt;code&gt;CRL&lt;/code&gt;s
                  match the selector, an empty &lt;code&gt;Collection&lt;/code&gt; will be returned.                
                <param>
                    selector a &lt;code&gt;CRLSelector&lt;/code&gt; used to select which
                      &lt;code&gt;CRL&lt;/code&gt;s should be returned. Specify &lt;code&gt;null&lt;/code&gt;
                      to return all &lt;code&gt;CRL&lt;/code&gt;s.                    
                </param>
                <return>
                    a &lt;code&gt;Collection&lt;/code&gt; of &lt;code&gt;CRL&lt;/code&gt;s that
                      match the specified selector                    
                </return>
                <throws>
                    CertStoreException if an exception occurs                    
                </throws>
            </javadoc>
            <method name="engineGetCRLs" type="Collection<CRL>" line="335">
                <params>
                    <param name="selector" type="CRLSelector"/>
                </params>
                <comment line="360">
                    see if the issuer is specified                    
                </comment>
                <comment line="367">
                    empty                    
                </comment>
                <comment line="373">
                    List                    
                </comment>
                <comment line="384">
                    cannot use index, iterate all                    
                </comment>
                <scope line="337">
                    <declaration name="matches" type="Set&lt;CRL&gt;" line="338"/>
                </scope>
                <scope line="344">
                    <declaration name="matches" type="Set&lt;CRL&gt;" line="345"/>
                    <scope line="347">
                        <scope line="348"/>
                    </scope>
                </scope>
                <scope line="355"/>
                <declaration name="x509Selector" type="X509CRLSelector" line="358"/>
                <declaration name="issuers" type="Collection&lt;X500Principal&gt;" line="360"/>
                <scope line="361">
                    <declaration name="matches" type="HashSet&lt;CRL&gt;" line="362"/>
                    <scope line="363">
                        <declaration name="entry" type="Object" line="364"/>
                        <scope line="365"/>
                        <scope line="367">
                            <declaration name="crl" type="X509CRL" line="368"/>
                            <scope line="369"/>
                        </scope>
                        <scope line="372">
                            <declaration name="list" type="List&lt;X509CRL&gt;" line="373"/>
                            <scope line="374">
                                <scope line="375"/>
                            </scope>
                        </scope>
                    </scope>
                </scope>
                <declaration name="matches" type="Set&lt;CRL&gt;" line="384"/>
            </method>
            <javadoc line="389">
                Iterate through all the X509CRLs and add matches to the
                  collection.                
            </javadoc>
            <method name="matchX509CRLs" type="void" line="393">
                <params>
                    <param name="selector" type="CRLSelector"/>
                    <param name="matches" type="Collection<CRL>"/>
                </params>
                <scope line="394">
                    <scope line="395">
                        <declaration name="crl" type="X509CRL" line="396"/>
                        <scope line="397"/>
                    </scope>
                    <scope line="400">
                        <declaration name="list" type="List&lt;X509CRL&gt;" line="401"/>
                        <scope line="402">
                            <scope line="403"/>
                        </scope>
                    </scope>
                </scope>
            </method>
        </class>
    </source>