<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.print">
        <import package="java.io.BufferedReader"/>
        <import package="java.io.FileInputStream"/>
        <import package="java.io.InputStream"/>
        <import package="java.io.InputStreamReader"/>
        <import package="java.io.IOException"/>
        <import package="java.util.ArrayList"/>
        <import package="java.util.Vector"/>
        <import package="java.security.AccessController"/>
        <import package="java.security.PrivilegedActionException"/>
        <import package="java.security.PrivilegedExceptionAction"/>
        <import package="javax.print.DocFlavor"/>
        <import package="javax.print.MultiDocPrintService"/>
        <import package="javax.print.PrintService"/>
        <import package="javax.print.PrintServiceLookup"/>
        <import package="javax.print.attribute.Attribute"/>
        <import package="javax.print.attribute.AttributeSet"/>
        <import package="javax.print.attribute.HashPrintRequestAttributeSet"/>
        <import package="javax.print.attribute.HashPrintServiceAttributeSet"/>
        <import package="javax.print.attribute.PrintRequestAttribute"/>
        <import package="javax.print.attribute.PrintRequestAttributeSet"/>
        <import package="javax.print.attribute.PrintServiceAttribute"/>
        <import package="javax.print.attribute.PrintServiceAttributeSet"/>
        <import package="javax.print.attribute.standard.PrinterName"/>
        <import package="java.io.File"/>
        <import package="java.io.FileReader"/>
        <import package="java.net.URL"/>
        <class name="UnixPrintServiceLookup" line="59">
            <extends class="PrintServiceLookup"/>
            <comment line="63">
                Remind: the current implementation is static, as its assumed
                 its preferable to minimise creation of PrintService instances.
                 Later we should add logic to addremove services on the fly which
                 will take a hit of needing to regather the list of services.                
            </comment>
            <comment line="70">
                                
            </comment>
            <comment line="74">
                2 minutes                
            </comment>
            <comment line="176">
                Want the PrintService which is default print service to have
                 equality of reference with the equivalent in list of print services
                 This isn&apos;t required by the API and there&apos;s a risk doing this will
                 lead people to assume its guaranteed.                
            </comment>
            <comment line="198">
                refreshes &quot;printServices&quot;                
            </comment>
            <comment line="336">
                This checks for validity of the printer name before passing as
                 parameter to a shell command.                
            </comment>
            <comment line="354">
                On a network with many (hundreds) of network printers, it
                 can save several seconds if you know all you want is a particular
                 printer, to ask for that printer rather than retrieving all printers.                
            </comment>
            <comment line="435">
                If service attributes are specified then there must be additional
                 filtering.                
            </comment>
            <comment line="498">
                return empty array as don&apos;t support multi docs                
            </comment>
            <comment line="580">
                This method isn&apos;t used in most cases because we rely on code in
                 javax.print.PrintServiceLookup. This is needed just for the cases
                 where those interfaces are by-passed.                
            </comment>
            <implements interface="BackgroundServiceLookup"/>
            <implements interface="Runnable"/>
            <declaration name="defaultPrinter" type="String" line="67"/>
            <declaration name="defaultPrintService" type="PrintService" line="68"/>
            <declaration name="printServices" type="PrintService[]" line="69"/>
            <declaration name="lookupListeners" type="Vector" line="70"/>
            <declaration name="debugPrefix" type="String" line="71"/>
            <declaration name="pollServices" type="boolean" line="72"/>
            <declaration name="DEFAULT_MINREFRESH" type="int" line="73"/>
            <declaration name="minRefreshTime" type="int" line="74"/>
            <declaration name="osname" type="String" line="77"/>
            <scope line="79">
                <declaration name="pollStr" type="String" line="84"/>
                <scope line="87">
                    <scope line="88"/>
                    <scope line="90"/>
                </scope>
                <declaration name="refreshTimeStr" type="String" line="99"/>
                <scope line="103">
                    <scope line="104"/>
                    <scope line="106"/>
                    <scope line="108"/>
                </scope>
            </scope>
            <method name="isSysV" type="boolean" line="117"/>
            <method name="isBSD" type="boolean" line="121"/>
            <declaration name="UNINITIALIZED" type="int" line="125"/>
            <declaration name="BSD_LPD" type="int" line="126"/>
            <declaration name="BSD_LPD_NG" type="int" line="127"/>
            <declaration name="cmdIndex" type="int" line="129"/>
            <declaration name="lpcFirstCom" type="String[]" line="131"/>
            <declaration name="lpcAllCom" type="String[]" line="136"/>
            <declaration name="lpcNameCom" type="String[]" line="141"/>
            <method name="getBSDCommandIndex" type="int" line="147">
                <declaration name="command" type="String" line="148"/>
                <declaration name="names" type="String[]" line="149"/>
                <scope line="151"/>
                <scope line="155">
                    <scope line="156"/>
                </scope>
            </method>
            <method name="UnixPrintServiceLookup" type="constructor" line="165">
                <comment line="167">
                    start the printer listener thread                    
                </comment>
                <scope line="167">
                    <declaration name="thr" type="PrinterChangeListener" line="168"/>
                </scope>
            </method>
            <method name="getPrintServices" type="PrintService[]" line="180">
                <declaration name="security" type="SecurityManager" line="181"/>
                <scope line="182"/>
                <scope line="186"/>
                <scope line="189"/>
                <scope line="191"/>
            </method>
            <method name="refreshServices" type="void" line="198">
                <comment line="200">
                                        
                </comment>
                <comment line="201">
                    array of printer names                    
                </comment>
                <comment line="202">
                    array of printer URIs                    
                </comment>
                <comment line="217">
                    BSD                    
                </comment>
                <comment line="272">
                    not found?                    
                </comment>
                <comment line="293">
                    Look for deleted services and invalidate these                    
                </comment>
                <comment line="303">
                    if defaultService is not found in printerList                    
                </comment>
                <comment line="305">
                    add default to the list                    
                </comment>
                <comment line="313">
                    swap default with the first in the list                    
                </comment>
                <declaration name="printers" type="String[]" line="200"/>
                <declaration name="printerURIs" type="String[]" line="201"/>
                <scope line="204">
                    <scope line="206">
                        <scope line="208">
                            <declaration name="lastIndex" type="int" line="209"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="213">
                    <scope line="214"/>
                    <scope line="216"/>
                </scope>
                <scope line="221">
                    <scope line="222"/>
                    <scope line="225"/>
                </scope>
                <declaration name="printerList" type="ArrayList" line="231"/>
                <declaration name="defaultIndex" type="int" line="232"/>
                <scope line="233">
                    <scope line="234"/>
                    <scope line="238"/>
                    <scope line="241">
                        <scope line="242">
                            <scope line="246">
                                <scope line="247"/>
                                <scope line="251"/>
                            </scope>
                            <scope line="257"/>
                        </scope>
                        <scope line="260">
                            <declaration name="j" type="int" line="261"/>
                            <scope line="262">
                                <scope line="264"/>
                            </scope>
                            <scope line="271">
                                <scope line="272">
                                    <scope line="273"/>
                                    <scope line="278"/>
                                </scope>
                                <scope line="284"/>
                            </scope>
                        </scope>
                    </scope>
                </scope>
                <scope line="293">
                    <scope line="294">
                        <scope line="296"/>
                    </scope>
                </scope>
                <scope line="303"/>
                <scope line="313">
                    <declaration name="saveService" type="PrintService" line="314"/>
                </scope>
            </method>
            <method name="matchesAttributes" type="boolean" line="321">
                <params>
                    <param name="service" type="PrintService"/>
                    <param name="attributes" type="PrintServiceAttributeSet"/>
                </params>
                <declaration name="attrs" type="Attribute[]" line="323"/>
                <declaration name="serviceAttr" type="Attribute" line="324"/>
                <scope line="325">
                    <scope line="328"/>
                </scope>
            </method>
            <method name="checkPrinterName" type="boolean" line="338">
                <params>
                    <param name="s" type="String"/>
                </params>
                <declaration name="c" type="char" line="339"/>
                <scope line="341">
                    <scope line="344"/>
                    <scope line="346"/>
                </scope>
            </method>
            <method name="getServiceByName" type="PrintService" line="357">
                <params>
                    <param name="nameAttr" type="PrinterName"/>
                </params>
                <declaration name="name" type="String" line="358"/>
                <declaration name="printer" type="PrintService" line="359"/>
                <scope line="360"/>
                <scope line="363"/>
                <scope line="365"/>
            </method>
            <method name="getPrintServices" type="PrintService[]" line="372">
                <params>
                    <param name="serviceSet" type="PrintServiceAttributeSet"/>
                </params>
                <comment line="379">
                    Typically expect that if a service attribute is specified that
                     its a printer name and there ought to be only one match.
                     Directly retrieve that service and confirm
                     that it meets the other requirements.
                     If printer name isn&apos;t mentioned then go a slow path checking
                     all printers if they meet the reqiremements.                    
                </comment>
                <comment line="390">
                    To avoid execing a unix command  see if the client is asking
                     for the default printer by name, since we already have that
                     initialised.                    
                </comment>
                <comment line="407">
                                        
                </comment>
                <comment line="419">
                                        
                </comment>
                <scope line="374"/>
                <declaration name="services" type="PrintService[]" line="385"/>
                <declaration name="name" type="PrinterName" line="386"/>
                <declaration name="defService" type="PrintService" line="387"/>
                <scope line="388">
                    <declaration name="defName" type="PrinterName" line="394"/>
                    <scope line="397">
                        <scope line="398"/>
                        <scope line="402"/>
                    </scope>
                    <scope line="405">
                        <declaration name="service" type="PrintService" line="407"/>
                        <scope line="409"/>
                        <scope line="413"/>
                    </scope>
                </scope>
                <scope line="417">
                    <declaration name="matchedServices" type="Vector" line="419"/>
                    <scope line="421">
                        <scope line="422"/>
                    </scope>
                    <scope line="427"/>
                </scope>
            </method>
            <method name="getPrintServices" type="PrintService[]" line="439">
                <params>
                    <param name="flavor" type="DocFlavor"/>
                    <param name="attributes" type="AttributeSet"/>
                </params>
                <comment line="483">
                    We only need to compare 1 PrintService because all
                     UnixPrintServices are the same anyway.  We will not use
                     default PrintService because it might be null.                    
                </comment>
                <declaration name="security" type="SecurityManager" line="440"/>
                <scope line="441"/>
                <declaration name="requestSet" type="PrintRequestAttributeSet" line="444"/>
                <declaration name="serviceSet" type="PrintServiceAttributeSet" line="445"/>
                <scope line="447">
                    <declaration name="attrs" type="Attribute[]" line="452"/>
                    <scope line="453">
                        <scope line="454"/>
                        <scope line="456"/>
                    </scope>
                </scope>
                <declaration name="services" type="PrintService[]" line="462"/>
                <scope line="463"/>
                <scope line="467">
                    <declaration name="matchingServices" type="ArrayList" line="468"/>
                    <scope line="469">
                        <scope line="470">
                            <scope line="472"/>
                        </scope>
                        <scope line="475"/>
                    </scope>
                </scope>
                <scope line="481">
                    <declaration name="service" type="PrintService" line="485"/>
                    <scope line="489"/>
                    <scope line="491"/>
                </scope>
            </method>
            <method name="getMultiDocPrintServices" type="MultiDocPrintService[]" line="502">
                <params>
                    <param name="flavors" type="DocFlavor[]"/>
                    <param name="attributes" type="AttributeSet"/>
                </params>
                <declaration name="security" type="SecurityManager" line="503"/>
                <scope line="504"/>
            </method>
            <method name="getDefaultPrintService" type="PrintService" line="511">
                <comment line="518">
                    clear defaultPrintService                    
                </comment>
                <declaration name="security" type="SecurityManager" line="512"/>
                <scope line="513"/>
                <scope line="522"/>
                <scope line="524">
                    <scope line="525"/>
                    <scope line="527"/>
                </scope>
                <scope line="531"/>
                <scope line="535">
                    <scope line="536">
                        <scope line="537"/>
                    </scope>
                </scope>
                <scope line="543">
                    <scope line="544">
                        <scope line="545">
                            <declaration name="defaultPS" type="PrintService" line="546"/>
                        </scope>
                        <scope line="553"/>
                    </scope>
                    <scope line="555"/>
                </scope>
            </method>
            <method name="getServicesInbackground" type="void" line="564">
                <params>
                    <param name="listener" type="BackgroundLookupListener"/>
                </params>
                <scope line="565"/>
                <scope line="567">
                    <scope line="568">
                        <declaration name="lookupThread" type="Thread" line="571"/>
                    </scope>
                    <scope line="573"/>
                </scope>
            </method>
            <method name="copyOf" type="PrintService[]" line="583">
                <params>
                    <param name="inArr" type="PrintService[]"/>
                </params>
                <scope line="584"/>
                <scope line="586">
                    <declaration name="outArr" type="PrintService[]" line="587"/>
                </scope>
            </method>
            <method name="run" type="void" line="593">
                <declaration name="services" type="PrintService[]" line="594"/>
                <scope line="595">
                    <declaration name="listener" type="BackgroundLookupListener" line="596"/>
                    <scope line="597"/>
                </scope>
            </method>
            <method name="getDefaultPrinterNameBSD" type="String" line="606">
                <scope line="607"/>
                <declaration name="names" type="String[]" line="610"/>
                <scope line="611"/>
                <scope line="616"/>
            </method>
            <method name="getNamedPrinterNameBSD" type="PrintService" line="622">
                <params>
                    <param name="name" type="String"/>
                </params>
                <scope line="623"/>
                <declaration name="command" type="String" line="626"/>
                <declaration name="result" type="String[]" line="627"/>
                <scope line="629"/>
            </method>
            <method name="getAllPrinterNamesBSD" type="String[]" line="635">
                <scope line="636"/>
                <declaration name="names" type="String[]" line="639"/>
                <scope line="640"/>
            </method>
            <method name="getDefaultPrinterNameSysV" type="String" line="646">
                <declaration name="defaultPrinter" type="String" line="647"/>
                <declaration name="command" type="String" line="648"/>
                <declaration name="names" type="String[]" line="650"/>
                <scope line="651"/>
                <scope line="653">
                    <declaration name="index" type="int" line="654"/>
                    <scope line="655"/>
                    <scope line="657">
                        <declaration name="name" type="String" line="658"/>
                        <scope line="659"/>
                        <scope line="661"/>
                    </scope>
                </scope>
            </method>
            <method name="getNamedPrinterNameSysV" type="PrintService" line="668">
                <params>
                    <param name="name" type="String"/>
                </params>
                <declaration name="command" type="String" line="670"/>
                <declaration name="result" type="String[]" line="671"/>
                <scope line="673"/>
                <scope line="675"/>
            </method>
            <method name="getAllPrinterNamesSysV" type="String[]" line="680">
                <declaration name="defaultPrinter" type="String" line="681"/>
                <declaration name="command" type="String" line="682"/>
                <declaration name="names" type="String[]" line="684"/>
                <declaration name="printerNames" type="ArrayList" line="685"/>
                <scope line="686">
                    <scope line="689"/>
                </scope>
            </method>
            <method name="execCmd" type="String[]" line="696">
                <params>
                    <param name="command" type="String"/>
                </params>
                <comment line="722">
                    in case of interrupt.                    
                </comment>
                <comment line="744">
                    promptly close all streams.                    
                </comment>
                <declaration name="results" type="ArrayList" line="697"/>
                <scope line="698">
                    <declaration name="cmd" type="String[]" line="699"/>
                    <scope line="700"/>
                    <scope line="704"/>
                    <anonymous_class line="711">
                        <method name="run" type="Object" line="712">
                            <comment line="722">
                                in case of interrupt.                                
                            </comment>
                            <comment line="744">
                                promptly close all streams.                                
                            </comment>
                            <declaration name="proc" type="Process" line="714"/>
                            <declaration name="bufferedReader" type="BufferedReader" line="715"/>
                            <declaration name="f" type="File" line="716"/>
                            <scope line="720">
                                <declaration name="done" type="boolean" line="721"/>
                                <scope line="722">
                                    <scope line="723"/>
                                    <scope line="726"/>
                                </scope>
                                <scope line="730">
                                    <declaration name="reader" type="FileReader" line="731"/>
                                    <declaration name="line" type="String" line="733"/>
                                    <declaration name="results" type="ArrayList" line="734"/>
                                    <scope line="736"/>
                                </scope>
                            </scope>
                            <scope line="741">
                                <scope line="744"/>
                            </scope>
                        </method>
                    </anonymous_class>
                </scope>
                <scope line="754"/>
                <scope line="756"/>
                <scope line="758"/>
            </method>
            <class name="PrinterChangeListener" line="763">
                <extends class="Thread"/>
                <method name="run" type="void" line="765">
                    <comment line="778">
                        compute new refresh time 1 printer = 1 sec                        
                    </comment>
                    <declaration name="refreshSecs" type="int" line="766"/>
                    <scope line="767">
                        <scope line="768"/>
                        <scope line="770"/>
                        <scope line="776"/>
                        <scope line="779"/>
                        <scope line="782"/>
                        <scope line="784"/>
                    </scope>
                </method>
            </class>
        </class>
    </source>