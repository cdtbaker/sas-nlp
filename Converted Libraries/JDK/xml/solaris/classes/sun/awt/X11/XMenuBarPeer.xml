<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.awt.X11">
        <import package="java.awt"/>
        <import package="java.awt.peer"/>
        <import package="java.awt.event"/>
        <import package="java.lang.reflect.Field"/>
        <import package="java.util.Vector"/>
        <import package="sun.util.logging.PlatformLogger"/>
        <import package="sun.awt.SunToolkit"/>
        <class name="XMenuBarPeer" line="36">
            <extends class="XBaseMenuWindow"/>
            <comment line="47">
                Primary members                
            </comment>
            <comment line="53">
                Index of help menu                
            </comment>
            <comment line="58">
                dimension constants                
            </comment>
            <comment line="71">
                fields                
            </comment>
            <comment line="80">
                Mapping data                
            </comment>
            <comment line="135">
                From MenuBarPeer                
            </comment>
            <comment line="139">
                Functions addMenu, delMenu, addHelpMenu
                 need to have somewhat strange behaivour
                 deduced from java.awt.MenuBar.
                 We can not get index of particular item in
                 MenuBar.menus array, because MenuBar firstly
                 performs array operations and then calls peer.
                 So we need to synchronize indicies in &apos;items&apos;
                 array with MenuBar.menus. We have to follow
                 these rules:
                 1. Menus are always added to the end of array,
                 even when helpMenu is present
                 2. Removal of any menu item acts as casual
                 remove from array
                 3. MenuBar.setHelpMenu _firstly_ removes
                 previous helpMenu by calling delMenu() if
                 necessary, then it performs addMenu(),
                 and then - addHelpMenu().
                
                 Note that these functions don&apos;t perform
                 type checks and checks for nulls or duplicates                
            </comment>
            <comment line="185">
                Initialization                
            </comment>
            <comment line="225">
                Implementation of abstract methods                
            </comment>
            <comment line="347">
                Utility functions                
            </comment>
            <comment line="373">
                Overriden XBaseMenuWindow functions                
            </comment>
            <comment line="387">
                Overriden XWindow general-purpose functions                
            </comment>
            <comment line="530">
                In previous version keys were handled in handleKeyPress.
                 Now we override this function do disable F10 explicit
                 processing. All processing is done using KeyEvent.                
            </comment>
            <implements interface="MenuBarPeer"/>
            <declaration name="log" type="PlatformLogger" line="38"/>
            <javadoc line="38">
                Data members                
            </javadoc>
            <declaration name="framePeer" type="XFramePeer" line="49"/>
            <declaration name="menuBarTarget" type="MenuBar" line="50"/>
            <declaration name="helpMenu" type="XMenuPeer" line="55"/>
            <declaration name="BAR_SPACING_TOP" type="int" line="60"/>
            <declaration name="BAR_SPACING_BOTTOM" type="int" line="61"/>
            <declaration name="BAR_SPACING_LEFT" type="int" line="62"/>
            <declaration name="BAR_SPACING_RIGHT" type="int" line="63"/>
            <declaration name="BAR_ITEM_SPACING" type="int" line="64"/>
            <declaration name="BAR_ITEM_MARGIN_LEFT" type="int" line="65"/>
            <declaration name="BAR_ITEM_MARGIN_RIGHT" type="int" line="66"/>
            <declaration name="BAR_ITEM_MARGIN_TOP" type="int" line="67"/>
            <declaration name="BAR_ITEM_MARGIN_BOTTOM" type="int" line="68"/>
            <declaration name="f_helpMenu" type="Field" line="71"/>
            <declaration name="f_menus" type="Field" line="72"/>
            <scope line="74"/>
            <class name="MappingData" line="85">
                <extends class="XBaseMenuWindow.MappingData"/>
                <comment line="126">
                    From MenuComponentPeer                    
                </comment>
                <comment line="515">
                    This function is called from XWindow
                     @see XWindow.handleF10onEDT()                    
                </comment>
                <javadoc line="85">
                    XBaseMenuWindow&apos;s mappingData is extended with
                      desired height of menu bar                    
                </javadoc>
                <declaration name="desiredHeight" type="int" line="90"/>
                <method name="MappingData" type="constructor" line="92">
                    <params>
                        <param name="items" type="XMenuItemPeer[]"/>
                        <param name="desiredHeight" type="int"/>
                    </params>
                </method>
                <javadoc line="97">
                    Constructs MappingData without items
                      This constructor should be used in case of errors                    
                </javadoc>
                <method name="MappingData" type="constructor" line="101"/>
                <method name="getDesiredHeight" type="int" line="105"/>
            </class>
            <javadoc line="110">
                Construction                
            </javadoc>
            <method name="XMenuBarPeer" type="constructor" line="115">
                <params>
                    <param name="menuBarTarget" type="MenuBar"/>
                </params>
            </method>
            <javadoc line="119">
                Implementaion of interface methods                
            </javadoc>
            <method name="setFont" type="void" line="128">
                <params>
                    <param name="f" type="Font"/>
                </params>
                <comment line="125">
                    From MenuComponentPeer                    
                </comment>
            </method>
            <method name="addMenu" type="void" line="160">
                <params>
                    <param name="m" type="Menu"/>
                </params>
            </method>
            <method name="delMenu" type="void" line="165">
                <params>
                    <param name="index" type="int"/>
                </params>
                <scope line="166">
                    <declaration name="item" type="XMenuItemPeer" line="167"/>
                    <scope line="168"/>
                </scope>
            </method>
            <method name="addHelpMenu" type="void" line="176">
                <params>
                    <param name="m" type="Menu"/>
                </params>
                <declaration name="mp" type="XMenuPeer" line="177"/>
                <scope line="178"/>
            </method>
            <javadoc line="189">
                called from XFramePeer.setMenuBar                
            </javadoc>
            <method name="init" type="void" line="192">
                <params>
                    <param name="frame" type="Frame"/>
                </params>
                <declaration name="params" type="XCreateWindowParams" line="195"/>
            </method>
            <javadoc line="202">
                Overriden initialization                
            </javadoc>
            <method name="postInit" type="void" line="205">
                <params>
                    <param name="params" type="XCreateWindowParams"/>
                </params>
                <comment line="210">
                    Get menus from the target.                    
                </comment>
                <declaration name="targetMenuVector" type="Vector" line="207"/>
                <declaration name="targetHelpMenu" type="Menu" line="208"/>
                <scope line="209"/>
                <scope line="214"/>
                <scope line="217"/>
            </method>
            <javadoc line="230">
                Menu bar is always root window in menu window&apos;s
                  hierarchy                
            </javadoc>
            <method name="getParentMenuWindow" type="XBaseMenuWindow" line="234"/>
            <javadoc line="238">
                @see XBaseMenuWindow.map                
            </javadoc>
            <method name="map" type="MappingData" line="241">
                <comment line="246">
                    find helpMenu and move it to the end of array                    
                </comment>
                <comment line="248">
                    Fixed 6270847: PIT: HELP menu is not shown at the right place when normal menus added to MB are removed, XToolkit                    
                </comment>
                <comment line="260">
                    We need maximum height before calculating item&apos;s bounds                    
                </comment>
                <comment line="270">
                    Calculate bounds                    
                </comment>
                <comment line="280">
                    Fix for 6270757: PIT: Menus and Sub-menus are shown outside the frame, XToolkit                    
                </comment>
                <comment line="281">
                    Cut-off items that don&apos;t fit in window                    
                </comment>
                <comment line="282">
                    At least one item must remain in menu                    
                </comment>
                <comment line="287">
                    If this item is help menu, move it to the right edge                    
                </comment>
                <comment line="292">
                    text should be centered vertically in menu item&apos;s bounds                    
                </comment>
                <declaration name="itemVector" type="XMenuItemPeer[]" line="242"/>
                <declaration name="itemCnt" type="int" line="243"/>
                <declaration name="helpMenu" type="XMenuItemPeer" line="244"/>
                <declaration name="helpMenuPos" type="int" line="245"/>
                <scope line="247">
                    <scope line="249">
                        <scope line="250"/>
                    </scope>
                    <scope line="255"/>
                </scope>
                <declaration name="maxHeight" type="int" line="261"/>
                <declaration name="itemMetrics" type="XMenuItemPeer.TextMetrics[]" line="262"/>
                <scope line="263">
                    <declaration name="dim" type="Dimension" line="265"/>
                    <scope line="266"/>
                </scope>
                <declaration name="nextOffset" type="int" line="271"/>
                <declaration name="itemHeight" type="int" line="272"/>
                <declaration name="mappedCnt" type="int" line="273"/>
                <scope line="274">
                    <declaration name="item" type="XMenuItemPeer" line="275"/>
                    <declaration name="metrics" type="XMenuItemPeer.TextMetrics" line="276"/>
                    <declaration name="dim" type="Dimension" line="277"/>
                    <scope line="278">
                        <declaration name="itemWidth" type="int" line="279"/>
                        <scope line="283"/>
                        <scope line="288"/>
                        <declaration name="bounds" type="Rectangle" line="291"/>
                        <declaration name="y" type="int" line="293"/>
                        <declaration name="textOrigin" type="Point" line="294"/>
                    </scope>
                    <scope line="297">
                        <declaration name="bounds" type="Rectangle" line="298"/>
                        <declaration name="textOrigin" type="Point" line="299"/>
                    </scope>
                </scope>
                <declaration name="mappedVector" type="XMenuItemPeer" line="302"/>
                <declaration name="mappingData" type="MappingData" line="304"/>
            </method>
            <javadoc line="308">
                @see XBaseMenuWindow.getSubmenuBounds                
            </javadoc>
            <method name="getSubmenuBounds" type="Rectangle" line="311">
                <params>
                    <param name="itemBounds" type="Rectangle"/>
                    <param name="windowSize" type="Dimension"/>
                </params>
                <declaration name="globalBounds" type="Rectangle" line="312"/>
                <declaration name="screenSize" type="Dimension" line="313"/>
                <declaration name="res" type="Rectangle" line="314"/>
                <scope line="316"/>
                <scope line="320"/>
                <scope line="324"/>
                <scope line="328"/>
            </method>
            <javadoc line="334">
                This function is called when it&apos;s likely that
                  size of items has changed.
                  Invokes framePeer&apos;s updateChildrenSizes()                
            </javadoc>
            <method name="updateSize" type="void" line="339">
                <scope line="341"/>
            </method>
            <javadoc line="352">
                Returns desired height of menu bar                
            </javadoc>
            <method name="getDesiredHeight" type="int" line="355">
                <declaration name="mappingData" type="MappingData" line="356"/>
            </method>
            <javadoc line="360">
                Returns true if framePeer is not null and is enabled
                  Used to fix 6185057: Disabling a frame does not disable
                  the menus on the frame, on solaris/linux                
            </javadoc>
            <method name="isFramePeerEnabled" type="boolean" line="365">
                <scope line="366"/>
            </method>
            <javadoc line="378">
                @see XBaseMenuWindow.doDispose()                
            </javadoc>
            <method name="doDispose" type="void" line="381"/>
            <javadoc line="392">
                For menu bars this function is called from framePeer&apos;s
                  reshape(...) and updateChildrenSizes()                
            </javadoc>
            <method name="reshape" type="void" line="396">
                <params>
                    <param name="x" type="int"/>
                    <param name="y" type="int"/>
                    <param name="width" type="int"/>
                    <param name="height" type="int"/>
                </params>
                <scope line="397"/>
            </method>
            <javadoc line="403">
                Performs ungrabbing of input                
                <see>
                    XBaseWindow.ungrabInputImpl()                    
                </see>
            </javadoc>
            <method name="ungrabInputImpl" type="void" line="407"/>
            <javadoc line="413">
                Overriden XWindow painting &amp; printing                
            </javadoc>
            <method name="paint" type="void" line="418">
                <params>
                    <param name="g" type="Graphics"/>
                </params>
                <comment line="420">
                                        
                </comment>
                <comment line="425">
                    Fill background of rectangle                    
                </comment>
                <comment line="431">
                    Paint menus                    
                </comment>
                <comment line="437">
                    paint item                    
                </comment>
                <declaration name="width" type="int" line="421"/>
                <declaration name="height" type="int" line="422"/>
                <declaration name="mappingData" type="MappingData" line="432"/>
                <declaration name="itemVector" type="XMenuItemPeer[]" line="433"/>
                <declaration name="selectedItem" type="XMenuItemPeer" line="434"/>
                <scope line="435">
                    <declaration name="item" type="XMenuItemPeer" line="436"/>
                    <declaration name="bounds" type="Rectangle" line="439"/>
                    <declaration name="textOrigin" type="Point" line="440"/>
                    <scope line="441"/>
                    <scope line="446"/>
                    <scope line="448"/>
                </scope>
            </method>
            <declaration name="W_DIFF" type="int" line="456"/>
            <declaration name="H_DIFF" type="int" line="457"/>
            <method name="print" type="void" line="459">
                <params>
                    <param name="g" type="Graphics"/>
                </params>
                <comment line="460">
                    TODO:Implement                    
                </comment>
            </method>
            <javadoc line="463">
                Overriden XBaseMenuWindow event handling                
            </javadoc>
            <method name="handleEvent" type="void" line="468">
                <params>
                    <param name="event" type="AWTEvent"/>
                </params>
                <comment line="469">
                    explicitly block all events except PaintEvent.PAINT for menus,                    
                </comment>
                <comment line="470">
                    that are in the modal blocked window                    
                </comment>
                <comment line="486">
                    Fix for 6185057: Disabling a frame does not disable                    
                </comment>
                <comment line="487">
                    the menus on the frame, on solaris/linux                    
                </comment>
                <comment line="494">
                    Fix for 6185057: Disabling a frame does not disable                    
                </comment>
                <comment line="495">
                    the menus on the frame, on solaris/linux                    
                </comment>
                <scope line="473">
                    <scope line="474"/>
                </scope>
                <scope line="488"/>
                <scope line="496"/>
            </method>
            <javadoc line="508">
                Overriden XWindow keyboard processing                
            </javadoc>
            <method name="handleF10KeyPress" type="void" line="518">
                <params>
                    <param name="event" type="KeyEvent"/>
                </params>
                <comment line="514">
                    This function is called from XWindow
                     @see XWindow.handleF10onEDT()                    
                </comment>
                <declaration name="keyState" type="int" line="519"/>
                <scope line="522"/>
            </method>
            <method name="handleKeyPress" type="void" line="534">
                <params>
                    <param name="xev" type="XEvent"/>
                </params>
                <comment line="541">
                    This is the only difference from XWindow.handleKeyPress                    
                </comment>
                <comment line="542">
                    Ancestor&apos;s function can invoke handleF10KeyPress here                    
                </comment>
                <declaration name="xkey" type="XKeyEvent" line="535"/>
                <scope line="537"/>
                <declaration name="currentSource" type="Component" line="540"/>
            </method>
        </class>
    </source>