<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.awt.X11">
        <import package="java.awt.datatransfer.Transferable"/>
        <import package="java.io.ByteArrayOutputStream"/>
        <import package="java.io.IOException"/>
        <import package="java.util.Hashtable"/>
        <import package="java.util.Map"/>
        <import package="sun.awt.AppContext"/>
        <import package="sun.awt.SunToolkit"/>
        <import package="sun.awt.UNIXToolkit"/>
        <import package="sun.awt.datatransfer.DataTransferer"/>
        <class name="XSelection" line="42">
            <comment line="48">
                                
            </comment>
            <comment line="50">
                                
            </comment>
            <comment line="52">
                                
            </comment>
            <comment line="54">
                                
            </comment>
            <comment line="56">
                The maximum data size for ChangeProperty request.
                 100 is for the structure prepended to the request.                
            </comment>
            <comment line="71">
                                
            </comment>
            <comment line="74">
                                
            </comment>
            <comment line="77">
                The orders of the lock acquisition:                
            </comment>
            <comment line="78">
                XClipboard -&gt; XSelection -&gt; awtLock.                
            </comment>
            <comment line="79">
                lock -&gt; awtLock.                
            </comment>
            <comment line="81">
                                
            </comment>
            <comment line="84">
                Owner-related variables - protected with synchronized (this).                
            </comment>
            <comment line="88">
                                
            </comment>
            <comment line="90">
                                
            </comment>
            <comment line="92">
                                
            </comment>
            <comment line="94">
                                
            </comment>
            <comment line="96">
                The X server time of the last XConvertSelection() call;                
            </comment>
            <comment line="97">
                protected with &apos;lock&apos; and awtLock.                
            </comment>
            <comment line="99">
                                
            </comment>
            <comment line="101">
                True if we are the owner of this selection.                
            </comment>
            <comment line="111">
                Returns the XSelection object for the specified selection atom or
                 &lt;code&gt;null&lt;code&gt; if none exists.                
            </comment>
            <comment line="188">
                Returns the list of atoms that represent the targets for which an attempt
                 to convert the current selection will succeed.                
            </comment>
            <comment line="262">
                Requests the selection data in the specified format and returns
                 the data provided by the owner.                
            </comment>
            <comment line="454">
                To be MT-safe this method should be called under awtLock.                
            </comment>
            <comment line="459">
                To be MT-safe this method should be called under awtLock.                
            </comment>
            <comment line="477">
                Converts the data to the &apos;format&apos; and if the conversion succeeded stores                
            </comment>
            <comment line="478">
                the data in the &apos;property&apos; on the &apos;requestor&apos; window.                
            </comment>
            <comment line="479">
                Returns true if the conversion succeeded.                
            </comment>
            <javadoc line="42">
                A class which interfaces with the X11 selection service.                
            </javadoc>
            <declaration name="table" type="Hashtable&lt;XAtom,XSelection&gt;" line="48"/>
            <declaration name="lock" type="Object" line="50"/>
            <declaration name="selectionPropertyAtom" type="XAtom" line="52"/>
            <declaration name="MAX_LENGTH" type="long" line="54"/>
            <declaration name="MAX_PROPERTY_SIZE" type="int" line="59"/>
            <scope line="60">
                <scope line="62"/>
                <scope line="65"/>
            </scope>
            <declaration name="incrementalTransferHandler" type="XEventDispatcher" line="71"/>
            <declaration name="propertyGetter" type="WindowPropertyGetter" line="74"/>
            <declaration name="selectionAtom" type="XAtom" line="81"/>
            <declaration name="contents" type="Transferable" line="88"/>
            <declaration name="formatMap" type="Map" line="90"/>
            <declaration name="formats" type="long[]" line="92"/>
            <declaration name="appContext" type="AppContext" line="94"/>
            <declaration name="lastRequestServerTime" type="long" line="97"/>
            <declaration name="ownershipTime" type="long" line="99"/>
            <declaration name="isOwner" type="boolean" line="101"/>
            <declaration name="ownershipListener" type="OwnershipListener" line="102"/>
            <declaration name="stateLock" type="Object" line="103"/>
            <scope line="105"/>
            <method name="getSelection" type="XSelection" line="114">
                <params>
                    <param name="atom" type="XAtom"/>
                </params>
            </method>
            <javadoc line="118">
                Creates a selection object.                
                <param>
                    atom   the selection atom.                    
                </param>
                <param>
                    clpbrd the corresponding clipoboard                    
                </param>
                <exception>
                    NullPointerException if atom is <code>null</code>.                    
                </exception>
            </javadoc>
            <method name="XSelection" type="constructor" line="125">
                <params>
                    <param name="atom" type="XAtom"/>
                </params>
                <scope line="126"/>
            </method>
            <method name="getSelectionAtom" type="XAtom" line="133"/>
            <method name="setOwner" type="boolean" line="139">
                <params>
                    <param name="contents" type="Transferable"/>
                    <param name="formatMap" type="Map"/>
                    <param name="formats" type="long[]"/>
                    <param name="time" type="long"/>
                </params>
                <comment line="143">
                    ICCCM prescribes that CurrentTime should not be used for SetSelectionOwner.                    
                </comment>
                <declaration name="owner" type="long" line="140"/>
                <declaration name="selection" type="long" line="141"/>
                <scope line="144"/>
                <scope line="155">
                    <scope line="160"/>
                </scope>
                <scope line="166"/>
            </method>
            <javadoc line="171">
                Blocks the current thread till SelectionNotify or PropertyNotify (in case of INCR transfer) arrives.                
            </javadoc>
            <method name="waitForSelectionNotify" type="void" line="174">
                <params>
                    <param name="dataGetter" type="WindowPropertyGetter"/>
                </params>
                <declaration name="startTime" type="long" line="175"/>
                <scope line="177">
                    <scope line="178"/>
                </scope>
                <scope line="182"/>
            </method>
            <method name="getTargets" type="long[]" line="191">
                <params>
                    <param name="time" type="long"/>
                </params>
                <comment line="217">
                    If the owner doesn&apos;t respond within the                    
                </comment>
                <comment line="218">
                    SELECTION_TIMEOUT, we report conversion failure.                    
                </comment>
                <scope line="192"/>
                <declaration name="targets" type="long[]" line="196"/>
                <scope line="198">
                    <declaration name="targetsGetter" type="WindowPropertyGetter" line="199"/>
                    <scope line="204">
                        <scope line="206">
                            <scope line="219"/>
                            <scope line="221"/>
                            <scope line="223"/>
                        </scope>
                        <scope line="226"/>
                    </scope>
                    <scope line="230"/>
                </scope>
            </method>
            <method name="getFormats" type="long[]" line="237">
                <params>
                    <param name="targetsGetter" type="WindowPropertyGetter"/>
                </params>
                <comment line="245">
                    we accept property with TARGETS type to be compatible with old jdks                    
                </comment>
                <comment line="246">
                    see 6607163                    
                </comment>
                <declaration name="formats" type="long[]" line="238"/>
                <scope line="244">
                    <declaration name="count" type="int" line="247"/>
                    <scope line="248">
                        <declaration name="atoms" type="long" line="249"/>
                        <scope line="251"/>
                    </scope>
                </scope>
            </method>
            <method name="getData" type="byte[]" line="265">
                <params>
                    <param name="format" type="long"/>
                    <param name="time" type="long"/>
                </params>
                <comment line="276">
                    don&apos;t delete to handle INCR properly.                    
                </comment>
                <comment line="292">
                    If the owner doesn&apos;t respond within the                    
                </comment>
                <comment line="293">
                    SELECTION_TIMEOUT, we report conversion failure.                    
                </comment>
                <comment line="307">
                    Handle incremental transfer.                    
                </comment>
                <comment line="327">
                    Following Xt sources use the last element.                    
                </comment>
                <comment line="365">
                    If the owner doesn&apos;t respond within the                    
                </comment>
                <comment line="366">
                    SELECTION_TIMEOUT, we terminate incremental                    
                </comment>
                <comment line="367">
                    transfer.                    
                </comment>
                <scope line="266"/>
                <declaration name="data" type="byte[]" line="270"/>
                <scope line="272">
                    <declaration name="dataGetter" type="WindowPropertyGetter" line="273"/>
                    <scope line="279">
                        <scope line="281">
                            <scope line="294"/>
                            <scope line="296"/>
                            <scope line="298"/>
                        </scope>
                        <scope line="301"/>
                        <scope line="309">
                            <scope line="311"/>
                            <declaration name="count" type="int" line="316"/>
                            <scope line="318"/>
                            <declaration name="ptr" type="long" line="322"/>
                            <declaration name="len" type="int" line="324"/>
                            <scope line="326">
                                <declaration name="longLength" type="long" line="328"/>
                                <scope line="330"/>
                                <scope line="334"/>
                            </scope>
                            <declaration name="dataStream" type="ByteArrayOutputStream" line="344"/>
                            <scope line="346">
                                <declaration name="incrDataGetter" type="WindowPropertyGetter" line="347"/>
                                <scope line="353">
                                    <scope line="360"/>
                                    <scope line="369"/>
                                    <scope line="371"/>
                                    <scope line="380"/>
                                    <scope line="387"/>
                                    <scope line="391">
                                        <scope line="393"/>
                                    </scope>
                                </scope>
                                <scope line="400"/>
                            </scope>
                        </scope>
                        <scope line="404">
                            <scope line="406"/>
                            <scope line="410"/>
                            <scope line="414"/>
                            <declaration name="count" type="int" line="419"/>
                            <scope line="420">
                                <declaration name="ptr" type="long" line="422"/>
                                <scope line="423"/>
                            </scope>
                        </scope>
                    </scope>
                    <scope line="428"/>
                </scope>
            </method>
            <method name="validateDataGetter" type="void" line="438">
                <params>
                    <param name="propertyGetter" type="WindowPropertyGetter"/>
                </params>
                <comment line="439">
                    The order of checks is important because a property getter                    
                </comment>
                <comment line="440">
                    has not been executed in case of timeout as well as in case of                    
                </comment>
                <comment line="441">
                    changed selection owner.                    
                </comment>
                <comment line="447">
                    The owner didn&apos;t respond - terminate the transfer.                    
                </comment>
                <scope line="443"/>
                <scope line="448"/>
            </method>
            <method name="isOwner" type="boolean" line="454"/>
            <method name="setOwnerProp" type="void" line="459">
                <params>
                    <param name="f" type="boolean"/>
                </params>
            </method>
            <method name="lostOwnership" type="void" line="464"/>
            <method name="reset" type="void" line="468"/>
            <method name="convertAndStore" type="boolean" line="479">
                <params>
                    <param name="requestor" type="long"/>
                    <param name="format" type="long"/>
                    <param name="property" type="long"/>
                </params>
                <comment line="480">
                                        
                </comment>
                <comment line="508">
                    Initiate incremental data transfer.                    
                </comment>
                <declaration name="dataFormat" type="int" line="480"/>
                <declaration name="byteData" type="byte[]" line="481"/>
                <declaration name="nativeDataPtr" type="long" line="482"/>
                <declaration name="count" type="int" line="483"/>
                <scope line="485"/>
                <scope line="493"/>
                <scope line="497"/>
                <scope line="503">
                    <scope line="504">
                        <scope line="505"/>
                        <scope line="507"/>
                    </scope>
                    <scope line="525"/>
                    <scope line="530"/>
                </scope>
                <scope line="533">
                    <scope line="534"/>
                </scope>
            </method>
            <method name="handleSelectionRequest" type="void" line="543">
                <params>
                    <param name="xsre" type="XSelectionRequestEvent"/>
                </params>
                <comment line="553">
                    Handle MULTIPLE requests as per ICCCM.                    
                </comment>
                <comment line="557">
                    Support for obsolete clients as per ICCCM.                    
                </comment>
                <comment line="571">
                    None property indicates conversion failure.                    
                </comment>
                <declaration name="property" type="long" line="544"/>
                <declaration name="requestor" type="long" line="545"/>
                <declaration name="requestTime" type="long" line="546"/>
                <declaration name="format" type="long" line="547"/>
                <declaration name="conversionSucceeded" type="boolean" line="548"/>
                <scope line="552">
                    <scope line="554"/>
                    <scope line="556">
                        <scope line="558"/>
                        <scope line="562"/>
                        <scope line="564"/>
                    </scope>
                </scope>
                <scope line="570"/>
                <declaration name="xse" type="XSelectionEvent" line="575"/>
                <scope line="576">
                    <scope line="586"/>
                    <scope line="589"/>
                </scope>
                <scope line="592"/>
            </method>
            <method name="handleMultipleRequest" type="boolean" line="597">
                <params>
                    <param name="requestor" type="long"/>
                    <param name="property" type="long"/>
                </params>
                <comment line="599">
                    The property cannot be None for a MULTIPLE request.                    
                </comment>
                <comment line="605">
                    First retrieve the list of requested targets.                    
                </comment>
                <comment line="623">
                    To report failure, we should replace the                    
                </comment>
                <comment line="624">
                    target atom with 0 in the MULTIPLE property.                    
                </comment>
                <scope line="598"/>
                <declaration name="conversionSucceeded" type="boolean" line="603"/>
                <declaration name="wpg" type="WindowPropertyGetter" line="606"/>
                <scope line="610">
                    <scope line="613">
                        <declaration name="count" type="long" line="614"/>
                        <declaration name="pairsPtr" type="long" line="615"/>
                        <declaration name="writeBack" type="boolean" line="616"/>
                        <scope line="618">
                            <declaration name="target" type="long" line="619"/>
                            <declaration name="prop" type="long" line="620"/>
                            <scope line="622"/>
                        </scope>
                        <scope line="629">
                            <scope line="631"/>
                            <scope line="640"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="646"/>
            </method>
            <method name="handleTargetsRequest" type="boolean" line="655">
                <params>
                    <param name="property" type="long"/>
                    <param name="requestor" type="long"/>
                </params>
                <comment line="657">
                    Use a local copy to avoid synchronization.                    
                </comment>
                <declaration name="conversionSucceeded" type="boolean" line="656"/>
                <declaration name="formatsLocal" type="long[]" line="658"/>
                <scope line="660"/>
                <declaration name="nativeDataPtr" type="long" line="664"/>
                <scope line="666">
                    <declaration name="count" type="int" line="667"/>
                    <declaration name="dataFormat" type="int" line="668"/>
                    <scope line="670"/>
                    <scope line="678"/>
                    <scope line="683"/>
                </scope>
                <scope line="686">
                    <scope line="687"/>
                </scope>
            </method>
            <method name="fireOwnershipChanges" type="void" line="695">
                <params>
                    <param name="isOwner" type="boolean"/>
                </params>
                <declaration name="l" type="OwnershipListener" line="696"/>
                <scope line="697"/>
                <scope line="700"/>
            </method>
            <method name="registerOwershipListener" type="void" line="705">
                <params>
                    <param name="l" type="OwnershipListener"/>
                </params>
                <scope line="706"/>
            </method>
            <method name="unregisterOwnershipListener" type="void" line="711">
                <scope line="712"/>
            </method>
            <class name="SelectionEventHandler" line="717">
                <comment line="781">
                    NOTE: formats other than 8 are not supported.                    
                </comment>
                <implements interface="XEventDispatcher"/>
                <method name="dispatchEvent" type="void" line="718">
                    <params>
                        <param name="ev" type="XEvent"/>
                    </params>
                    <comment line="724">
                        Ignore the SelectionNotify event if it is not the response to our last request.                        
                    </comment>
                    <comment line="726">
                        The property will be None in case of convertion failure.                        
                    </comment>
                    <scope line="720">
                        <scope line="722">
                            <declaration name="xse" type="XSelectionEvent" line="723"/>
                            <scope line="725">
                                <scope line="727"/>
                                <scope line="730"/>
                            </scope>
                        </scope>
                        <scope line="736"/>
                    </scope>
                    <scope line="741">
                        <declaration name="xsre" type="XSelectionRequestEvent" line="742"/>
                        <declaration name="atom" type="long" line="743"/>
                        <declaration name="selection" type="XSelection" line="744"/>
                        <scope line="746"/>
                    </scope>
                    <scope line="751">
                        <declaration name="xsce" type="XSelectionClearEvent" line="752"/>
                        <declaration name="atom" type="long" line="753"/>
                        <declaration name="selection" type="XSelection" line="754"/>
                        <scope line="756"/>
                        <scope line="761"/>
                        <scope line="763"/>
                    </scope>
                </method>
            </class>
            <class name="IncrementalDataProvider" line="772">
                <comment line="781">
                    NOTE: formats other than 8 are not supported.                    
                </comment>
                <implements interface="XEventDispatcher"/>
                <declaration name="requestor" type="long" line="773"/>
                <declaration name="property" type="long" line="774"/>
                <declaration name="target" type="long" line="775"/>
                <declaration name="format" type="int" line="776"/>
                <declaration name="data" type="byte[]" line="777"/>
                <declaration name="offset" type="int" line="778"/>
                <method name="IncrementalDataProvider" type="constructor" line="782">
                    <params>
                        <param name="requestor" type="long"/>
                        <param name="property" type="long"/>
                        <param name="target" type="long"/>
                        <param name="format" type="int"/>
                        <param name="data" type="byte[]"/>
                    </params>
                    <scope line="783"/>
                    <declaration name="wattr" type="XWindowAttributes" line="793"/>
                    <scope line="794">
                        <scope line="796"/>
                        <scope line="802"/>
                    </scope>
                    <scope line="805"/>
                </method>
                <method name="dispatchEvent" type="void" line="811">
                    <params>
                        <param name="ev" type="XEvent"/>
                    </params>
                    <comment line="832">
                        All data has been transferred.                        
                    </comment>
                    <comment line="833">
                        This zero-length data indicates end of transfer.                        
                    </comment>
                    <declaration name="xpe" type="XPropertyEvent" line="814"/>
                    <scope line="817">
                        <declaration name="count" type="int" line="819"/>
                        <declaration name="nativeDataPtr" type="long" line="820"/>
                        <scope line="821"/>
                        <scope line="825">
                            <scope line="827"/>
                        </scope>
                        <scope line="830"/>
                        <scope line="838"/>
                        <scope line="844"/>
                        <scope line="847"/>
                    </scope>
                </method>
            </class>
            <class name="IncrementalTransferHandler" line="858">
                <comment line="781">
                    NOTE: formats other than 8 are not supported.                    
                </comment>
                <implements interface="XEventDispatcher"/>
                <method name="dispatchEvent" type="void" line="859">
                    <params>
                        <param name="ev" type="XEvent"/>
                    </params>
                    <declaration name="xpe" type="XPropertyEvent" line="862"/>
                    <scope line="864">
                        <scope line="866">
                            <scope line="867"/>
                        </scope>
                        <scope line="872"/>
                    </scope>
                </method>
            </class>
        </class>
    </source>