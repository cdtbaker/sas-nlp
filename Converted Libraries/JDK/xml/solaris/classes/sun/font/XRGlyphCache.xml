<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.font">
        <import package="java.io"/>
        <import package="java.util"/>
        <import package="sun.awt"/>
        <import package="sun.java2d.xr"/>
        <class name="XRGlyphCache" line="34">
            <comment line="58">
                Boolean.parseBoolean(System.getProperty(&quot;sun.java2d.xrender.batchGlyphUpload&quot;));                
            </comment>
            <implements interface="GlyphDisposedListener"/>
            <javadoc line="34">
                Glyph cache used by the XRender pipeline.                
                <author>
                    Clemens Eisserer                    
                </author>
            </javadoc>
            <declaration name="con" type="XRBackend" line="41"/>
            <declaration name="maskBuffer" type="XRCompositeManager" line="42"/>
            <declaration name="cacheMap" type="HashMap&amp;lt;MutableInteger,XRGlyphCacheEntry&amp;gt;" line="43"/>
            <declaration name="nextID" type="int" line="45"/>
            <declaration name="tmp" type="MutableInteger" line="46"/>
            <declaration name="grayGlyphSet" type="int" line="48"/>
            <declaration name="lcdGlyphSet" type="int" line="49"/>
            <declaration name="time" type="int" line="51"/>
            <declaration name="cachedPixels" type="int" line="52"/>
            <declaration name="MAX_CACHED_PIXELS" type="int" line="53"/>
            <declaration name="freeGlyphIDs" type="ArrayList&amp;lt;Integer&amp;gt;" line="55"/>
            <declaration name="batchGlyphUpload" type="boolean" line="57"/>
            <method name="XRGlyphCache" type="constructor" line="59">
                <params>
                    <param name="maskBuf" type="XRCompositeManager"/>
                </params>
            </method>
            <method name="glyphDisposed" type="void" line="69">
                <params>
                    <param name="glyphPtrList" type="ArrayList&lt;Long&gt;"/>
                </params>
                <comment line="78">
                    Check if glyph hasn&apos;t been freed already                    
                </comment>
                <scope line="70">
                    <declaration name="glyphIDList" type="GrowableIntArray" line="73"/>
                    <scope line="74">
                        <declaration name="glyphID" type="int" line="75"/>
                        <scope line="78"/>
                    </scope>
                </scope>
                <scope line="83"/>
            </method>
            <method name="getFreeGlyphID" type="int" line="88">
                <scope line="89">
                    <declaration name="newID" type="int" line="90"/>
                </scope>
            </method>
            <method name="getEntryForPointer" type="XRGlyphCacheEntry" line="96">
                <params>
                    <param name="imgPtr" type="long"/>
                </params>
                <declaration name="id" type="int" line="97"/>
                <scope line="99"/>
            </method>
            <method name="cacheGlyphs" type="XRGlyphCacheEntry[]" line="107">
                <params>
                    <param name="glyphList" type="GlyphList"/>
                </params>
                <comment line="118">
                    Find uncached glyphs and queue them for upload                    
                </comment>
                <comment line="133">
                    Add glyphs to cache                    
                </comment>
                <declaration name="entries" type="XRGlyphCacheEntry[]" line="110"/>
                <declaration name="imgPtrs" type="long[]" line="111"/>
                <declaration name="uncachedGlyphs" type="ArrayList&amp;lt;XRGlyphCacheEntry&amp;gt;" line="112"/>
                <scope line="114">
                    <declaration name="glyph" type="XRGlyphCacheEntry" line="115"/>
                    <scope line="118">
                        <scope line="123"/>
                    </scope>
                </scope>
                <scope line="133"/>
            </method>
            <method name="uploadGlyphs" type="void" line="140">
                <params>
                    <param name="glyphs" type="XRGlyphCacheEntry[]"/>
                    <param name="uncachedGlyphs" type="ArrayList&lt;XRGlyphCacheEntry&gt;"/>
                    <param name="gl" type="GlyphList"/>
                    <param name="glIndices" type="int[]"/>
                </params>
                <comment line="155">
                    Some XServers crash when uploading multiple glyphs at once. TODO:
                     Implement build-switch in local case for distributors who know their
                     XServer is fixed                    
                </comment>
                <scope line="141"/>
                <scope line="145"/>
                <declaration name="containsLCDGlyphs" type="boolean" line="149"/>
                <declaration name="seperatedGlyphList" type="List&amp;lt;XRGlyphCacheEntry&amp;gt;[]" line="150"/>
                <declaration name="grayGlyphList" type="List&amp;lt;XRGlyphCacheEntry&amp;gt;" line="151"/>
                <declaration name="lcdGlyphList" type="List&amp;lt;XRGlyphCacheEntry&amp;gt;" line="152"/>
                <scope line="159">
                    <scope line="160"/>
                    <scope line="163"/>
                </scope>
                <scope line="166">
                    <declaration name="tmpList" type="ArrayList&amp;lt;XRGlyphCacheEntry&amp;gt;" line="167"/>
                    <scope line="170">
                        <scope line="173"/>
                        <scope line="175"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="182">
                Seperates lcd and grayscale glyphs queued for upload, and sets the
                  appropriate glyphset for the cache entries.                
            </javadoc>
            <method name="seperateGlyphTypes" type="List&lt;XRGlyphCacheEntry&gt;[]" line="186">
                <params>
                    <param name="glyphList" type="List&lt;XRGlyphCacheEntry&gt;"/>
                    <param name="containsLCDGlyphs" type="boolean"/>
                </params>
                <declaration name="lcdGlyphs" type="ArrayList&amp;lt;XRGlyphCacheEntry&amp;gt;" line="187"/>
                <declaration name="grayGlyphs" type="ArrayList&amp;lt;XRGlyphCacheEntry&amp;gt;" line="188"/>
                <scope line="190">
                    <scope line="191">
                        <scope line="192"/>
                    </scope>
                    <scope line="197">
                        <scope line="198"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="209">
                Copies the glyph-images into a continous buffer, required for uploading.                
            </javadoc>
            <method name="generateGlyphImageStream" type="byte[]" line="212">
                <params>
                    <param name="glyphList" type="List&lt;XRGlyphCacheEntry&gt;"/>
                </params>
                <declaration name="isLCDGlyph" type="boolean" line="213"/>
                <declaration name="stream" type="ByteArrayOutputStream" line="215"/>
                <scope line="216"/>
            </method>
            <method name="containsLCDGlyphs" type="boolean" line="223">
                <params>
                    <param name="entries" type="List&lt;XRGlyphCacheEntry&gt;"/>
                </params>
                <declaration name="containsLCDGlyphs" type="boolean" line="224"/>
                <scope line="226">
                    <scope line="229"/>
                </scope>
            </method>
            <method name="clearCache" type="void" line="236">
                <params>
                    <param name="glyps" type="XRGlyphCacheEntry[]"/>
                </params>
                <comment line="238">
                    Glyph uploading is so slow anyway, we can afford some inefficiency
                     here, as the cache should usually be quite small. TODO: Implement
                     something not that stupid ;)                    
                </comment>
                <declaration name="cacheList" type="ArrayList&amp;lt;XRGlyphCacheEntry&amp;gt;" line="242"/>
                <anonymous_class line="243">
                    <method name="compare" type="int" line="244">
                        <params>
                            <param name="e1" type="XRGlyphCacheEntry"/>
                            <param name="e2" type="XRGlyphCacheEntry"/>
                        </params>
                    </method>
                </anonymous_class>
                <scope line="249"/>
                <declaration name="deleteGlyphList" type="GrowableIntArray" line="253"/>
                <declaration name="pixelsToRelease" type="int" line="254"/>
                <scope line="256">
                    <declaration name="entry" type="XRGlyphCacheEntry" line="257"/>
                    <scope line="259"/>
                </scope>
                <scope line="265"/>
            </method>
            <method name="freeGlyphs" type="void" line="272">
                <params>
                    <param name="glyphIdList" type="GrowableIntArray"/>
                </params>
                <declaration name="removedLCDGlyphs" type="GrowableIntArray" line="273"/>
                <declaration name="removedGrayscaleGlyphs" type="GrowableIntArray" line="274"/>
                <scope line="276">
                    <declaration name="glyphId" type="int" line="277"/>
                    <declaration name="entry" type="XRGlyphCacheEntry" line="281"/>
                    <scope line="285"/>
                    <scope line="287"/>
                </scope>
                <scope line="294"/>
                <scope line="298"/>
            </method>
        </class>
    </source>