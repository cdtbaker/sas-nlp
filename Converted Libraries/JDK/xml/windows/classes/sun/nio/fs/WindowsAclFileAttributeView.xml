<?xml version="1.0" encoding="UTF-8"?>
    <source package="sun.nio.fs">
        <import package="java.nio.file.ProviderMismatchException"/>
        <import package="java.nio.file.attribute"/>
        <import package="java.util"/>
        <import package="java.io.IOException"/>
        <import package="sun.nio.fs.WindowsNativeDispatcher"/>
        <import package="sun.nio.fs.WindowsConstants"/>
        <class name="WindowsAclFileAttributeView" line="36">
            <extends class="AbstractAclFileAttributeView"/>
            <comment line="65">
                permision check                
            </comment>
            <comment line="80">
                invokes GetFileSecurity to get requested security information                
            </comment>
            <javadoc line="36">
                Windows implementation of AclFileAttributeView.                
            </javadoc>
            <declaration name="SIZEOF_SECURITY_DESCRIPTOR" type="short" line="43"/>
            <javadoc line="43">
                typedef struct _SECURITY_DESCRIPTOR {
                  BYTE  Revision;
                  BYTE  Sbz1;
                  SECURITY_DESCRIPTOR_CONTROL Control;
                  PSID Owner;
                  PSID Group;
                  PACL Sacl;
                  PACL Dacl;
                  } SECURITY_DESCRIPTOR;                
            </javadoc>
            <declaration name="file" type="WindowsPath" line="56"/>
            <declaration name="followLinks" type="boolean" line="57"/>
            <method name="WindowsAclFileAttributeView" type="constructor" line="59">
                <params>
                    <param name="file" type="WindowsPath"/>
                    <param name="followLinks" type="boolean"/>
                </params>
            </method>
            <method name="checkAccess" type="void" line="68">
                <params>
                    <param name="file" type="WindowsPath"/>
                    <param name="checkRead" type="boolean"/>
                    <param name="checkWrite" type="boolean"/>
                </params>
                <declaration name="sm" type="SecurityManager" line="69"/>
                <scope line="70"/>
            </method>
            <method name="getFileSecurity" type="NativeBuffer" line="82">
                <params>
                    <param name="path" type="String"/>
                    <param name="request" type="int"/>
                </params>
                <comment line="83">
                    invoke get to buffer size                    
                </comment>
                <comment line="92">
                    allocate buffer and re-invoke to get security information                    
                </comment>
                <comment line="100">
                    buffer was insufficient                    
                </comment>
                <declaration name="size" type="int" line="84"/>
                <scope line="85"/>
                <scope line="87"/>
                <declaration name="buffer" type="NativeBuffer" line="93"/>
                <scope line="94">
                    <scope line="95">
                        <declaration name="newSize" type="int" line="96"/>
                    </scope>
                </scope>
                <scope line="105"/>
            </method>
            <method name="getOwner" type="UserPrincipal" line="115">
                <comment line="118">
                    GetFileSecurity does not follow links so when following links we                    
                </comment>
                <comment line="119">
                    need the final target                    
                </comment>
                <comment line="123">
                    get the address of the SID                    
                </comment>
                <declaration name="path" type="String" line="120"/>
                <declaration name="buffer" type="NativeBuffer" line="121"/>
                <scope line="122">
                    <declaration name="sidAddress" type="long" line="124"/>
                </scope>
                <scope line="128"/>
                <scope line="131"/>
            </method>
            <method name="getAcl" type="List<AclEntry>" line="139">
                <comment line="142">
                    GetFileSecurity does not follow links so when following links we                    
                </comment>
                <comment line="143">
                    need the final target                    
                </comment>
                <comment line="146">
                    ALLOW and DENY entries in DACL;                    
                </comment>
                <comment line="147">
                    AUDIT entries in SACL (ignore for now as it requires privileges)                    
                </comment>
                <declaration name="path" type="String" line="144"/>
                <declaration name="buffer" type="NativeBuffer" line="148"/>
                <scope line="149"/>
                <scope line="151"/>
            </method>
            <method name="setOwner" type="void" line="159">
                <params>
                    <param name="obj" type="UserPrincipal"/>
                </params>
                <comment line="166">
                    permission check                    
                </comment>
                <comment line="169">
                    SetFileSecurity does not follow links so when following links we                    
                </comment>
                <comment line="170">
                    need the final target                    
                </comment>
                <comment line="173">
                    ConvertStringSidToSid allocates memory for SID so must invoke                    
                </comment>
                <comment line="174">
                    LocalFree to free it when we are done                    
                </comment>
                <comment line="183">
                    Allocate buffer for security descriptor, initialize it, set                    
                </comment>
                <comment line="184">
                    owner information and update the file.                    
                </comment>
                <comment line="190">
                    may need SeRestorePrivilege to set the owner                    
                </comment>
                <declaration name="owner" type="WindowsUserPrincipals.User" line="164"/>
                <declaration name="path" type="String" line="171"/>
                <declaration name="pOwner" type="long" line="175"/>
                <scope line="176"/>
                <scope line="178"/>
                <scope line="185">
                    <declaration name="buffer" type="NativeBuffer" line="186"/>
                    <scope line="187">
                        <declaration name="priv" type="WindowsSecurity.Privilege" line="191"/>
                        <scope line="193"/>
                        <scope line="197"/>
                    </scope>
                    <scope line="200"/>
                    <scope line="202"/>
                </scope>
                <scope line="205"/>
            </method>
            <method name="setAcl" type="void" line="211">
                <params>
                    <param name="acl" type="List<AclEntry>"/>
                </params>
                <comment line="214">
                    SetFileSecurity does not follow links so when following links we                    
                </comment>
                <comment line="215">
                    need the final target                    
                </comment>
                <declaration name="path" type="String" line="216"/>
                <declaration name="sd" type="WindowsSecurityDescriptor" line="217"/>
                <scope line="218"/>
                <scope line="220"/>
                <scope line="222"/>
            </method>
        </class>
    </source>