<?xml version="1.0" encoding="UTF-8"?>
    <source package="org.apache.commons.math3.ode.nonstiff">
        <import package="java.io.IOException"/>
        <import package="java.io.ObjectInput"/>
        <import package="java.io.ObjectOutput"/>
        <import package="org.apache.commons.math3.ode.EquationsMapper"/>
        <import package="org.apache.commons.math3.ode.sampling.AbstractStepInterpolator"/>
        <import package="org.apache.commons.math3.ode.sampling.StepInterpolator"/>
        <import package="org.apache.commons.math3.util.FastMath"/>
        <class name="GraggBulirschStoerStepInterpolator" line="29">
            <extends class="AbstractStepInterpolator"/>
            <javadoc line="29">
                This class implements an interpolator for the Gragg-Bulirsch-Stoer
                  integrator.
                  &lt;p&gt;This interpolator compute dense output inside the last step
                  produced by a Gragg-Bulirsch-Stoer integrator.&lt;/p&gt;
                  &lt;p&gt;
                  This implementation is basically a reimplementation in Java of the
                  &lt;a
                  href=&quot;http://www.unige.ch/math/folks/hairer/prog/nonstiff/odex.f&quot;&gt;odex&lt;/a&gt;
                  fortran code by E. Hairer and G. Wanner. The redistribution policy
                  for this code is available &lt;a
                  href=&quot;http://www.unige.ch/~hairer/prog/licence.txt&quot;&gt;here&lt;/a&gt;, for
                  convenience, it is reproduced below.&lt;/p&gt;
                  &lt;/p&gt;
                  &lt;table border=&quot;0&quot; width=&quot;80%&quot; cellpadding=&quot;10&quot; align=&quot;center&quot; bgcolor=&quot;#E0E0E0&quot;&gt;
                  &lt;tr&gt;&lt;td&gt;Copyright (c) 2004, Ernst Hairer&lt;/td&gt;&lt;/tr&gt;
                  &lt;tr&gt;&lt;td&gt;Redistribution and use in source and binary forms, with or
                  without modification, are permitted provided that the following
                  conditions are met:
                  &lt;ul&gt;
                  &lt;li&gt;Redistributions of source code must retain the above copyright
                  notice, this list of conditions and the following disclaimer.&lt;/li&gt;
                  &lt;li&gt;Redistributions in binary form must reproduce the above copyright
                  notice, this list of conditions and the following disclaimer in the
                  documentation and/or other materials provided with the distribution.&lt;/li&gt;
                  &lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;
                  &lt;tr&gt;&lt;td&gt;&lt;strong&gt;THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
                  CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
                  BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
                  FOR A  PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR
                  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
                  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
                  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
                  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
                  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
                  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
                  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;
                  &lt;/table&gt;                
                <see>
                    GraggBulirschStoerIntegrator                    
                </see>
                <version>
                    $Id: GraggBulirschStoerStepInterpolator.java 1416643 2012-12-03 19:37:14Z tn $                    
                </version>
                <since>
                    1.2                    
                </since>
            </javadoc>
            <declaration name="serialVersionUID" type="long" line="81"/>
            <javadoc line="81">
                Serializable version identifier.                
            </javadoc>
            <declaration name="y0Dot" type="double[]" line="84"/>
            <javadoc line="84">
                Slope at the beginning of the step.                
            </javadoc>
            <declaration name="y1" type="double[]" line="87"/>
            <javadoc line="87">
                State at the end of the step.                
            </javadoc>
            <declaration name="y1Dot" type="double[]" line="90"/>
            <javadoc line="90">
                Slope at the end of the step.                
            </javadoc>
            <declaration name="yMidDots" type="double[][]" line="93"/>
            <javadoc line="93">
                Derivatives at the middle of the step.
                  element 0 is state at midpoint, element 1 is first derivative ...                
            </javadoc>
            <declaration name="polynomials" type="double[][]" line="98"/>
            <javadoc line="98">
                Interpolation polynomials.                
            </javadoc>
            <declaration name="errfac" type="double[]" line="101"/>
            <javadoc line="101">
                Error coefficients for the interpolation.                
            </javadoc>
            <declaration name="currentDegree" type="int" line="104"/>
            <javadoc line="104">
                Degree of the interpolation polynomials.                
            </javadoc>
            <javadoc line="107">
                Simple constructor.
                  This constructor should not be used directly, it is only intended
                  for the serialization process.                
            </javadoc>
            <method name="GraggBulirschStoerStepInterpolator" type="constructor" line="111"/>
            <javadoc line="119">
                Simple constructor.                
                <param>
                    y reference to the integrator array holding the current state                    
                </param>
                <param>
                    y0Dot reference to the integrator array holding the slope
                      at the beginning of the step                    
                </param>
                <param>
                    y1 reference to the integrator array holding the state at
                      the end of the step                    
                </param>
                <param>
                    y1Dot reference to the integrator array holding the slope
                      at the end of the step                    
                </param>
                <param>
                    yMidDots reference to the integrator array holding the
                      derivatives at the middle point of the step                    
                </param>
                <param>
                    forward integration direction indicator                    
                </param>
                <param>
                    primaryMapper equations mapper for the primary equations set                    
                </param>
                <param>
                    secondaryMappers equations mappers for the secondary equations sets                    
                </param>
            </javadoc>
            <method name="GraggBulirschStoerStepInterpolator" type="constructor" line="138">
                <params>
                    <param name="y" type="double[]"/>
                    <param name="y0Dot" type="double[]"/>
                    <param name="y1" type="double[]"/>
                    <param name="y1Dot" type="double[]"/>
                    <param name="yMidDots" type="double[][]"/>
                    <param name="forward" type="boolean"/>
                    <param name="primaryMapper" type="EquationsMapper"/>
                    <param name="secondaryMappers" type="EquationsMapper[]"/>
                </params>
            </method>
            <javadoc line="150">
                Copy constructor.                
                <param>
                    interpolator interpolator to copy from. The copy is a deep
                      copy: its arrays are separated from the original arrays of the
                      instance                    
                </param>
            </javadoc>
            <method name="GraggBulirschStoerStepInterpolator" type="constructor" line="156">
                <params>
                    <param name="interpolator" type="GraggBulirschStoerStepInterpolator"/>
                </params>
                <comment line="162">
                    the interpolator has been finalized,                    
                </comment>
                <comment line="163">
                    the following arrays are not needed anymore                    
                </comment>
                <comment line="169">
                    copy the interpolation polynomials (up to the current degree only)                    
                </comment>
                <declaration name="dimension" type="int" line="160"/>
                <scope line="170"/>
                <scope line="173">
                    <scope line="175"/>
                </scope>
            </method>
            <javadoc line="185">
                Reallocate the internal tables.
                  Reallocate the internal tables in order to be able to handle
                  interpolation polynomials up to the given degree                
                <param>
                    maxDegree maximal degree to handle                    
                </param>
            </javadoc>
            <method name="resetTables" type="void" line="190">
                <params>
                    <param name="maxDegree" type="int"/>
                </params>
                <comment line="211">
                    initialize the error factors array for interpolation                    
                </comment>
                <scope line="192"/>
                <scope line="196">
                    <declaration name="newPols" type="double[][]" line="198"/>
                    <scope line="199">
                        <scope line="201"/>
                    </scope>
                    <scope line="204">
                        <scope line="205"/>
                    </scope>
                    <scope line="212"/>
                    <scope line="214">
                        <scope line="216">
                            <declaration name="ip5" type="int" line="217"/>
                            <declaration name="e" type="double" line="219"/>
                            <scope line="220"/>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="232">
                {@inheritDoc}                
            </javadoc>
            <method name="doCopy" type="StepInterpolator" line="234"/>
            <javadoc line="239">
                Compute the interpolation coefficients for dense output.                
                <param>
                    mu degree of the interpolation polynomial                    
                </param>
                <param>
                    h current step                    
                </param>
            </javadoc>
            <method name="computeCoefficients" type="void" line="243">
                <params>
                    <param name="mu" type="int"/>
                    <param name="h" type="double"/>
                </params>
                <comment line="268">
                    compute the remaining coefficients                    
                </comment>
                <scope line="245"/>
                <scope line="251">
                    <declaration name="yp0" type="double" line="253"/>
                    <declaration name="yp1" type="double" line="254"/>
                    <declaration name="ydiff" type="double" line="255"/>
                    <declaration name="aspl" type="double" line="256"/>
                    <declaration name="bspl" type="double" line="257"/>
                    <scope line="264"/>
                    <declaration name="ph0" type="double" line="269"/>
                    <scope line="272">
                        <declaration name="ph1" type="double" line="273"/>
                        <scope line="276">
                            <declaration name="ph2" type="double" line="277"/>
                            <scope line="280">
                                <declaration name="ph3" type="double" line="281"/>
                                <scope line="284">
                                    <declaration name="fac1" type="double" line="285"/>
                                    <declaration name="fac2" type="double" line="286"/>
                                </scope>
                            </scope>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="298">
                Estimate interpolation error.                
                <param>
                    scale scaling array                    
                </param>
                <return>
                    estimate of the interpolation error                    
                </return>
            </javadoc>
            <method name="estimateError" type="double" line="302">
                <params>
                    <param name="scale" type="double[]"/>
                </params>
                <declaration name="error" type="double" line="303"/>
                <scope line="304">
                    <scope line="305">
                        <declaration name="e" type="double" line="306"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="314">
                {@inheritDoc}                
            </javadoc>
            <method name="computeInterpolatedStateAndDerivatives" type="void" line="317">
                <params>
                    <param name="theta" type="double"/>
                    <param name="oneMinusThetaH" type="double"/>
                </params>
                <comment line="354">
                    in this degenerated case, the previous computation leads to NaN for derivatives                    
                </comment>
                <comment line="355">
                    we fix this by using the derivatives at midpoint                    
                </comment>
                <declaration name="dimension" type="int" line="319"/>
                <declaration name="oneMinusTheta" type="double" line="321"/>
                <declaration name="theta05" type="double" line="322"/>
                <declaration name="tOmT" type="double" line="323"/>
                <declaration name="t4" type="double" line="324"/>
                <declaration name="t4Dot" type="double" line="325"/>
                <declaration name="dot1" type="double" line="326"/>
                <declaration name="dot2" type="double" line="327"/>
                <declaration name="dot3" type="double" line="328"/>
                <scope line="330">
                    <declaration name="p0" type="double" line="332"/>
                    <declaration name="p1" type="double" line="333"/>
                    <declaration name="p2" type="double" line="334"/>
                    <declaration name="p3" type="double" line="335"/>
                    <scope line="339">
                        <declaration name="cDot" type="double" line="340"/>
                        <declaration name="c" type="double" line="341"/>
                        <scope line="342">
                            <declaration name="d" type="double" line="343"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="353"/>
            </method>
            <javadoc line="361">
                {@inheritDoc}                
            </javadoc>
            <method name="writeExternal" type="void" line="364">
                <params>
                    <param name="out" type="ObjectOutput"/>
                </params>
                <comment line="368">
                    save the state of the base class                    
                </comment>
                <comment line="371">
                    save the local attributes (but not the temporary vectors)                    
                </comment>
                <declaration name="dimension" type="int" line="366"/>
                <scope line="373">
                    <scope line="374"/>
                </scope>
            </method>
            <javadoc line="381">
                {@inheritDoc}                
            </javadoc>
            <method name="readExternal" type="void" line="384">
                <params>
                    <param name="in" type="ObjectInput"/>
                </params>
                <comment line="386">
                    read the base class                    
                </comment>
                <comment line="390">
                    read the local attributes                    
                </comment>
                <comment line="401">
                    we can now set the interpolated time and state                    
                </comment>
                <declaration name="t" type="double" line="387"/>
                <declaration name="dimension" type="int" line="388"/>
                <declaration name="degree" type="int" line="391"/>
                <scope line="395">
                    <scope line="396"/>
                </scope>
            </method>
        </class>
    </source>