<?xml version="1.0" encoding="UTF-8"?>
    <source package="org.apache.commons.math3.optim.nonlinear.scalar.noderiv">
        <import package="org.apache.commons.math3.exception.MathIllegalStateException"/>
        <import package="org.apache.commons.math3.exception.NumberIsTooSmallException"/>
        <import package="org.apache.commons.math3.exception.OutOfRangeException"/>
        <import package="org.apache.commons.math3.exception.util.LocalizedFormats"/>
        <import package="org.apache.commons.math3.linear.Array2DRowRealMatrix"/>
        <import package="org.apache.commons.math3.linear.ArrayRealVector"/>
        <import package="org.apache.commons.math3.linear.RealVector"/>
        <import package="org.apache.commons.math3.optim.nonlinear.scalar.GoalType"/>
        <import package="org.apache.commons.math3.optim.PointValuePair"/>
        <import package="org.apache.commons.math3.optim.nonlinear.scalar.MultivariateOptimizer"/>
        <class name="BOBYQAOptimizer" line="31">
            <extends class="MultivariateOptimizer"/>
            <comment line="331">
                bobyqa                
            </comment>
            <comment line="333">
                ----------------------------------------------------------------------------------------                
            </comment>
            <comment line="1217">
                bobyqb                
            </comment>
            <comment line="1219">
                ----------------------------------------------------------------------------------------                
            </comment>
            <comment line="1554">
                altmov                
            </comment>
            <comment line="1556">
                ----------------------------------------------------------------------------------------                
            </comment>
            <comment line="1749">
                prelim                
            </comment>
            <comment line="1752">
                ----------------------------------------------------------------------------------------                
            </comment>
            <comment line="2271">
                trsbox                
            </comment>
            <comment line="2273">
                ----------------------------------------------------------------------------------------                
            </comment>
            <comment line="2367">
                update                
            </comment>
            <comment line="2430">
                XXX utility for figuring out call sequence.                
            </comment>
            <comment line="2437">
                XXX utility for figuring out call sequence.                
            </comment>
            <comment line="2441">
                XXX utility for figuring out call sequence.                
            </comment>
            <javadoc line="31">
                Powell&apos;s BOBYQA algorithm. This implementation is translated and
                  adapted from the Fortran version available
                  &lt;a href=&quot;http://plato.asu.edu/ftp/other_software/bobyqa.zip&quot;&gt;here&lt;/a&gt;.
                  See &lt;a href=&quot;http://www.optimization-online.org/DB_HTML/2010/05/2616.html&quot;&gt;
                  this paper&lt;/a&gt; for an introduction.
                  &lt;br/&gt;
                  BOBYQA is particularly well suited for high dimensional problems
                  where derivatives are not available. In most cases it outperforms the{@link PowellOptimizer} significantly. Stochastic algorithms like{@link CMAESOptimizer} succeed more often than BOBYQA, but are more
                  expensive. BOBYQA could also be considered as a replacement of any
                  derivative-based optimizer when the derivatives are approximated by
                  finite differences.                
                <version>
                    $Id: BOBYQAOptimizer.java 1462507 2013-03-29 15:50:22Z luc $                    
                </version>
                <since>
                    3.0                    
                </since>
            </javadoc>
            <declaration name="MINIMUM_PROBLEM_DIMENSION" type="int" line="51"/>
            <javadoc line="51">
                Minimum dimension of the problem: {@value}                
            </javadoc>
            <declaration name="DEFAULT_INITIAL_RADIUS" type="double" line="53"/>
            <javadoc line="53">
                Default value for {@link #initialTrustRegionRadius}: {@value} .                
            </javadoc>
            <declaration name="DEFAULT_STOPPING_RADIUS" type="double" line="55"/>
            <javadoc line="55">
                Default value for {@link #stoppingTrustRegionRadius}: {@value} .                
            </javadoc>
            <declaration name="ZERO" type="double" line="58"/>
            <declaration name="ONE" type="double" line="59"/>
            <declaration name="TWO" type="double" line="60"/>
            <declaration name="TEN" type="double" line="61"/>
            <declaration name="SIXTEEN" type="double" line="62"/>
            <declaration name="TWO_HUNDRED_FIFTY" type="double" line="63"/>
            <declaration name="MINUS_ONE" type="double" line="64"/>
            <declaration name="HALF" type="double" line="65"/>
            <declaration name="ONE_OVER_FOUR" type="double" line="66"/>
            <declaration name="ONE_OVER_EIGHT" type="double" line="67"/>
            <declaration name="ONE_OVER_TEN" type="double" line="68"/>
            <declaration name="ONE_OVER_A_THOUSAND" type="double" line="69"/>
            <declaration name="numberOfInterpolationPoints" type="int" line="71"/>
            <javadoc line="71">
                numberOfInterpolationPoints XXX                
            </javadoc>
            <declaration name="initialTrustRegionRadius" type="double" line="75"/>
            <javadoc line="75">
                initialTrustRegionRadius XXX                
            </javadoc>
            <declaration name="stoppingTrustRegionRadius" type="double" line="79"/>
            <javadoc line="79">
                stoppingTrustRegionRadius XXX                
            </javadoc>
            <declaration name="isMinimize" type="boolean" line="83"/>
            <javadoc line="83">
                Goal type (minimize or maximize).                
            </javadoc>
            <declaration name="currentBest" type="ArrayRealVector" line="85"/>
            <javadoc line="85">
                Current best values for the variables to be optimized.
                  The vector will be changed in-place to contain the values of the least
                  calculated objective function values.                
            </javadoc>
            <declaration name="boundDifference" type="double[]" line="91"/>
            <javadoc line="91">
                Differences between the upper and lower bounds.                
            </javadoc>
            <declaration name="trustRegionCenterInterpolationPointIndex" type="int" line="93"/>
            <javadoc line="93">
                Index of the interpolation point at the trust region center.                
            </javadoc>
            <declaration name="bMatrix" type="Array2DRowRealMatrix" line="97"/>
            <javadoc line="97">
                Last &lt;em&gt;n&lt;/em&gt; columns of matrix H (where &lt;em&gt;n&lt;/em&gt; is the dimension
                  of the problem).
                  XXX &quot;bmat&quot; in the original code.                
            </javadoc>
            <declaration name="zMatrix" type="Array2DRowRealMatrix" line="103"/>
            <javadoc line="103">
                Factorization of the leading &lt;em&gt;npt&lt;/em&gt; square submatrix of H, this
                  factorization being Z Z&lt;sup&gt;T&lt;/sup&gt;, which provides both the correct
                  rank and positive semi-definiteness.
                  XXX &quot;zmat&quot; in the original code.                
            </javadoc>
            <declaration name="interpolationPoints" type="Array2DRowRealMatrix" line="110"/>
            <javadoc line="110">
                Coordinates of the interpolation points relative to {@link #originShift}.
                  XXX &quot;xpt&quot; in the original code.                
            </javadoc>
            <declaration name="originShift" type="ArrayRealVector" line="115"/>
            <javadoc line="115">
                Shift of origin that should reduce the contributions from rounding
                  errors to values of the model and Lagrange functions.
                  XXX &quot;xbase&quot; in the original code.                
            </javadoc>
            <declaration name="fAtInterpolationPoints" type="ArrayRealVector" line="121"/>
            <javadoc line="121">
                Values of the objective function at the interpolation points.
                  XXX &quot;fval&quot; in the original code.                
            </javadoc>
            <declaration name="trustRegionCenterOffset" type="ArrayRealVector" line="126"/>
            <javadoc line="126">
                Displacement from {@link #originShift} of the trust region center.
                  XXX &quot;xopt&quot; in the original code.                
            </javadoc>
            <declaration name="gradientAtTrustRegionCenter" type="ArrayRealVector" line="131"/>
            <javadoc line="131">
                Gradient of the quadratic model at {@link #originShift} +{@link #trustRegionCenterOffset}.
                  XXX &quot;gopt&quot; in the original code.                
            </javadoc>
            <declaration name="lowerDifference" type="ArrayRealVector" line="137"/>
            <javadoc line="137">
                Differences {@link #getLowerBound()} - {@link #originShift}.
                  All the components of every {@link #trustRegionCenterOffset} are going
                  to satisfy the bounds&lt;br/&gt;{@link #getLowerBound() lowerBound}&lt;sub&gt;i&lt;/sub&gt; &amp;le;{@link #trustRegionCenterOffset}&lt;sub&gt;i&lt;/sub&gt;,&lt;br/&gt;
                  with appropriate equalities when {@link #trustRegionCenterOffset} is
                  on a constraint boundary.
                  XXX &quot;sl&quot; in the original code.                
            </javadoc>
            <declaration name="upperDifference" type="ArrayRealVector" line="148"/>
            <javadoc line="148">
                Differences {@link #getUpperBound()} - {@link #originShift}All the components of every {@link #trustRegionCenterOffset} are going
                  to satisfy the bounds&lt;br/&gt;{@link #trustRegionCenterOffset}&lt;sub&gt;i&lt;/sub&gt; &amp;le;{@link #getUpperBound() upperBound}&lt;sub&gt;i&lt;/sub&gt;,&lt;br/&gt;
                  with appropriate equalities when {@link #trustRegionCenterOffset} is
                  on a constraint boundary.
                  XXX &quot;su&quot; in the original code.                
            </javadoc>
            <declaration name="modelSecondDerivativesParameters" type="ArrayRealVector" line="159"/>
            <javadoc line="159">
                Parameters of the implicit second derivatives of the quadratic model.
                  XXX &quot;pq&quot; in the original code.                
            </javadoc>
            <declaration name="newPoint" type="ArrayRealVector" line="164"/>
            <javadoc line="164">
                Point chosen by function {@link #trsbox(double,ArrayRealVector,ArrayRealVector,ArrayRealVector,ArrayRealVector,ArrayRealVector) trsbox}or {@link #altmov(int,double) altmov}.
                  Usually {@link #originShift} + {@link #newPoint} is the vector of
                  variables for the next evaluation of the objective function.
                  It also satisfies the constraints indicated in {@link #lowerDifference}and {@link #upperDifference}.
                  XXX &quot;xnew&quot; in the original code.                
            </javadoc>
            <declaration name="alternativeNewPoint" type="ArrayRealVector" line="175"/>
            <javadoc line="175">
                Alternative to {@link #newPoint}, chosen by{@link #altmov(int,double) altmov}.
                  It may replace {@link #newPoint} in order to increase the denominator
                  in the {@link #update(double,double,int) updating procedure}.
                  XXX &quot;xalt&quot; in the original code.                
            </javadoc>
            <declaration name="trialStepPoint" type="ArrayRealVector" line="183"/>
            <javadoc line="183">
                Trial step from {@link #trustRegionCenterOffset} which is usually{@link #newPoint} - {@link #trustRegionCenterOffset}.
                  XXX &quot;d__&quot; in the original code.                
            </javadoc>
            <declaration name="lagrangeValuesAtNewPoint" type="ArrayRealVector" line="189"/>
            <javadoc line="189">
                Values of the Lagrange functions at a new point.
                  XXX &quot;vlag&quot; in the original code.                
            </javadoc>
            <declaration name="modelSecondDerivativesValues" type="ArrayRealVector" line="194"/>
            <javadoc line="194">
                Explicit second derivatives of the quadratic model.
                  XXX &quot;hq&quot; in the original code.                
            </javadoc>
            <javadoc line="200">
                @param numberOfInterpolationPoints Number of interpolation conditions.
                  For a problem of dimension {@code n}, its value must be in the interval{@code [n+2, (n+1)(n+2)/2]}.
                  Choices that exceed {@code 2n+1} are not recommended.                
            </javadoc>
            <method name="BOBYQAOptimizer" type="constructor" line="206">
                <params>
                    <param name="numberOfInterpolationPoints" type="int"/>
                </params>
            </method>
            <javadoc line="212">
                @param numberOfInterpolationPoints Number of interpolation conditions.
                  For a problem of dimension {@code n}, its value must be in the interval{@code [n+2, (n+1)(n+2)/2]}.
                  Choices that exceed {@code 2n+1} are not recommended.                
                <param>
                    initialTrustRegionRadius Initial trust region radius.                    
                </param>
                <param>
                    stoppingTrustRegionRadius Stopping trust region radius.                    
                </param>
            </javadoc>
            <method name="BOBYQAOptimizer" type="constructor" line="222">
                <params>
                    <param name="numberOfInterpolationPoints" type="int"/>
                    <param name="initialTrustRegionRadius" type="double"/>
                    <param name="stoppingTrustRegionRadius" type="double"/>
                </params>
                <comment line="223">
                    No custom convergence criterion.                    
                </comment>
            </method>
            <javadoc line="229">
                {@inheritDoc}                
            </javadoc>
            <method name="doOptimize" type="PointValuePair" line="231">
                <comment line="235">
                    Validity checks.                    
                </comment>
                <declaration name="lowerBound" type="double[]" line="232"/>
                <declaration name="upperBound" type="double[]" line="233"/>
                <declaration name="value" type="double" line="241"/>
            </method>
            <javadoc line="247">
                This subroutine seeks the least value of a function of many variables,
                  by applying a trust region method that forms quadratic models by
                  interpolation. There is usually some freedom in the interpolation
                  conditions, which is taken up by minimizing the Frobenius norm of
                  the change to the second derivative of the model, beginning with the
                  zero matrix. The values of the variables are constrained by upper and
                  lower bounds. The arguments of the subroutine are as follows.
                  N must be set to the number of variables and must be at least two.
                  NPT is the number of interpolation conditions. Its value must be in
                  the interval [N+2,(N+1)(N+2)/2]. Choices that exceed 2N+1 are not
                  recommended.
                  Initial values of the variables must be set in X(1),X(2),...,X(N). They
                  will be changed to the values that give the least calculated F.
                  For I=1,2,...,N, XL(I) and XU(I) must provide the lower and upper
                  bounds, respectively, on X(I). The construction of quadratic models
                  requires XL(I) to be strictly less than XU(I) for each I. Further,
                  the contribution to a model from changes to the I-th variable is
                  damaged severely by rounding errors if XU(I)-XL(I) is too small.
                  RHOBEG and RHOEND must be set to the initial and final values of a trust
                  region radius, so both must be positive with RHOEND no greater than
                  RHOBEG. Typically, RHOBEG should be about one tenth of the greatest
                  expected change to a variable, while RHOEND should indicate the
                  accuracy that is required in the final values of the variables. An
                  error return occurs if any of the differences XU(I)-XL(I), I=1,...,N,
                  is less than 2RHOBEG.
                  MAXFUN must be set to an upper bound on the number of calls of CALFUN.
                  The array W will be used for working space. Its length must be at least
                  (NPT+5)(NPT+N)+3N(N+5)/2.                
                <param>
                    lowerBound Lower bounds.                    
                </param>
                <param>
                    upperBound Upper bounds.                    
                </param>
                <return>
                    the value of the objective at the optimum.                    
                </return>
            </javadoc>
            <method name="bobyqa" type="double" line="283">
                <params>
                    <param name="lowerBound" type="double[]"/>
                    <param name="upperBound" type="double[]"/>
                </params>
                <comment line="284">
                    XXX                    
                </comment>
                <comment line="288">
                    Return if there is insufficient space between the bounds. Modify the                    
                </comment>
                <comment line="289">
                    initial X if necessary in order to avoid conflicts between the bounds                    
                </comment>
                <comment line="290">
                    and the construction of the first quadratic model. The lower and upper                    
                </comment>
                <comment line="291">
                    bounds on moves from the updated X are set now, in the ISL and ISU                    
                </comment>
                <comment line="292">
                    partitions of W, in order to provide useful and exact information about                    
                </comment>
                <comment line="293">
                    components of X that become within distance RHOBEG from their bounds.                    
                </comment>
                <comment line="307">
                    Computing MAX                    
                </comment>
                <comment line="318">
                    Computing MIN                    
                </comment>
                <comment line="327">
                    Make the call of BOBYQB.                    
                </comment>
                <declaration name="n" type="int" line="286"/>
                <scope line="295">
                    <declaration name="boundDiff" type="double" line="296"/>
                    <scope line="299">
                        <scope line="300"/>
                        <scope line="304">
                            <declaration name="deltaOne" type="double" line="308"/>
                        </scope>
                    </scope>
                    <scope line="311">
                        <scope line="312"/>
                        <scope line="316">
                            <declaration name="deltaOne" type="double" line="319"/>
                            <declaration name="deltaTwo" type="double" line="320"/>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="334">
                The arguments N, NPT, X, XL, XU, RHOBEG, RHOEND, IPRINT and MAXFUN
                  are identical to the corresponding arguments in SUBROUTINE BOBYQA.
                  XBASE holds a shift of origin that should reduce the contributions
                  from rounding errors to values of the model and Lagrange functions.
                  XPT is a two-dimensional array that holds the coordinates of the
                  interpolation points relative to XBASE.
                  FVAL holds the values of F at the interpolation points.
                  XOPT is set to the displacement from XBASE of the trust region centre.
                  GOPT holds the gradient of the quadratic model at XBASE+XOPT.
                  HQ holds the explicit second derivatives of the quadratic model.
                  PQ contains the parameters of the implicit second derivatives of the
                  quadratic model.
                  BMAT holds the last N columns of H.
                  ZMAT holds the factorization of the leading NPT by NPT submatrix of H,
                  this factorization being ZMAT times ZMAT^T, which provides both the
                  correct rank and positive semi-definiteness.
                  NDIM is the first dimension of BMAT and has the value NPT+N.
                  SL and SU hold the differences XL-XBASE and XU-XBASE, respectively.
                  All the components of every XOPT are going to satisfy the bounds
                  SL(I) .LEQ. XOPT(I) .LEQ. SU(I), with appropriate equalities when
                  XOPT is on a constraint boundary.
                  XNEW is chosen by SUBROUTINE TRSBOX or ALTMOV. Usually XBASE+XNEW is the
                  vector of variables for the next call of CALFUN. XNEW also satisfies
                  the SL and SU constraints in the way that has just been mentioned.
                  XALT is an alternative to XNEW, chosen by ALTMOV, that may replace XNEW
                  in order to increase the denominator in the updating of UPDATE.
                  D is reserved for a trial step from XOPT, which is usually XNEW-XOPT.
                  VLAG contains the values of the Lagrange functions at a new point X.
                  They are part of a product that requires VLAG to be of length NDIM.
                  W is a one-dimensional array that is used for working space. Its length
                  must be at least 3NDIM = 3(NPT+N).                
                <param>
                    lowerBound Lower bounds.                    
                </param>
                <param>
                    upperBound Upper bounds.                    
                </param>
                <return>
                    the value of the objective at the optimum.                    
                </return>
            </javadoc>
            <method name="bobyqb" type="double" line="372">
                <params>
                    <param name="lowerBound" type="double[]"/>
                    <param name="upperBound" type="double[]"/>
                </params>
                <comment line="373">
                    XXX                    
                </comment>
                <comment line="390">
                    Set some constants.                    
                </comment>
                <comment line="391">
                    Parameter adjustments                    
                </comment>
                <comment line="393">
                    Function Body                    
                </comment>
                <comment line="395">
                    The call of PRELIM sets the elements of XBASE, XPT, FVAL, GOPT, HQ, PQ,                    
                </comment>
                <comment line="396">
                    BMAT and ZMAT for the first iteration, with the corresponding values of                    
                </comment>
                <comment line="397">
                    of NF and KOPT, which are the number of calls of CALFUN so far and the                    
                </comment>
                <comment line="398">
                    index of the interpolation point at the trust region centre. Then the                    
                </comment>
                <comment line="399">
                    initial XOPT is set too. The branch to label 720 occurs if MAXFUN is                    
                </comment>
                <comment line="400">
                    less than NPT. GOPT will be updated if KOPT is different from KBASE.                    
                </comment>
                <comment line="408">
                    Computing 2nd power                    
                </comment>
                <comment line="415">
                    Complete the settings that are required for the iterative procedure.                    
                </comment>
                <comment line="436">
                    Update GOPT if necessary before the first iteration and after each                    
                </comment>
                <comment line="437">
                    call of RESCUE that makes a call of CALFUN.                    
                </comment>
                <comment line="442">
                    XXX                    
                </comment>
                <comment line="465">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <comment line="469">
                    Generate the next point in the trust region that provides a small value                    
                </comment>
                <comment line="470">
                    of the quadratic model subject to the constraints on the variables.                    
                </comment>
                <comment line="471">
                    The int NTRITS is set to the number &quot;trust region&quot; iterations that                    
                </comment>
                <comment line="472">
                    have occurred since the last &quot;alternative&quot; iteration. If the length                    
                </comment>
                <comment line="473">
                    of XNEW-XOPT is less than HALF*RHO, however, then there is a branch to                    
                </comment>
                <comment line="474">
                    label 650 or 680 with NTRITS=-1, instead of calculating F at XNEW.                    
                </comment>
                <comment line="478">
                    XXX                    
                </comment>
                <comment line="490">
                    Computing MIN                    
                </comment>
                <comment line="496">
                    Computing 2nd power                    
                </comment>
                <comment line="503">
                    The following choice between labels 650 and 680 depends on whether or                    
                </comment>
                <comment line="504">
                    not our work with the current RHO seems to be complete. Either RHO is                    
                </comment>
                <comment line="505">
                    decreased or termination occurs if the errors in the quadratic model at                    
                </comment>
                <comment line="506">
                    the last three interpolation points compare favourably with predictions                    
                </comment>
                <comment line="507">
                    of likely improvements to the model within distance HALF*RHO of XOPT.                    
                </comment>
                <comment line="509">
                    Computing MAX                    
                </comment>
                <comment line="529">
                    Computing 2nd power                    
                </comment>
                <comment line="537">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <comment line="544">
                    Severe cancellation is likely to occur if XOPT is too far from XBASE.                    
                </comment>
                <comment line="545">
                    If the following test holds, then XBASE is shifted so that XOPT becomes                    
                </comment>
                <comment line="546">
                    zero. The appropriate changes are made to BMAT and to the second                    
                </comment>
                <comment line="547">
                    derivatives of the current model, beginning with the changes to BMAT                    
                </comment>
                <comment line="548">
                    that do not depend on ZMAT. VLAG is used temporarily for working space.                    
                </comment>
                <comment line="552">
                    XXX                    
                </comment>
                <comment line="556">
                    final RealVector sumVector                    
                </comment>
                <comment line="557">
                    = new ArrayRealVector(npt, -HALF * xoptsq).add(interpolationPoints.operate(trustRegionCenter));                    
                </comment>
                <comment line="564">
                    sum = sumVector.getEntry(k); // XXX &quot;testAckley&quot; and &quot;testDiffPow&quot; fail.                    
                </comment>
                <comment line="580">
                    Then the revisions of BMAT that depend on ZMAT are calculated.                    
                </comment>
                <comment line="613">
                    The following instructions complete the shift, including the changes                    
                </comment>
                <comment line="614">
                    to the second derivative parameters of the quadratic model.                    
                </comment>
                <comment line="646">
                    XBASE is also moved to XOPT by a call of RESCUE. This calculation is                    
                </comment>
                <comment line="647">
                    more expensive than the previous shift, because new matrices BMAT and                    
                </comment>
                <comment line="648">
                    ZMAT are generated from scratch, which may include the replacement of                    
                </comment>
                <comment line="649">
                    interpolation points whose positions seem to be causing near linear                    
                </comment>
                <comment line="650">
                    dependence in the interpolation conditions. Therefore RESCUE is called                    
                </comment>
                <comment line="651">
                    only if rounding errors have reduced by at least a factor of two the                    
                </comment>
                <comment line="652">
                    denominator of the formula for updating the H matrix. It provides a                    
                </comment>
                <comment line="653">
                    useful safeguard, but is not invoked in most applications of BOBYQA.                    
                </comment>
                <comment line="657">
                    XXX                    
                </comment>
                <comment line="658">
                    Pick two alternative vectors of variables, relative to XBASE, that                    
                </comment>
                <comment line="659">
                    are suitable as new positions of the KNEW-th interpolation point.                    
                </comment>
                <comment line="660">
                    Firstly, XNEW is set to the point on a line through XOPT and another                    
                </comment>
                <comment line="661">
                    interpolation point that minimizes the predicted value of the next                    
                </comment>
                <comment line="662">
                    denominator, subject to ||XNEW - XOPT|| .LEQ. ADELT and to the SL                    
                </comment>
                <comment line="663">
                    and SU bounds. Secondly, XALT is set to the best feasible point on                    
                </comment>
                <comment line="664">
                    a constrained version of the Cauchy step of the KNEW-th Lagrange                    
                </comment>
                <comment line="665">
                    function, the corresponding value of the square of this function                    
                </comment>
                <comment line="666">
                    being returned in CAUCHY. The choice between these alternatives is                    
                </comment>
                <comment line="667">
                    going to be made when the denominator is calculated.                    
                </comment>
                <comment line="677">
                    Calculate VLAG and BETA for the current choice of D. The scalar                    
                </comment>
                <comment line="678">
                    product of D with XPT(K,.) is going to be held in W(NPT+K) for                    
                </comment>
                <comment line="679">
                    use when VQUAD is calculated.                    
                </comment>
                <comment line="683">
                    XXX                    
                </comment>
                <comment line="712">
                    Computing 2nd power                    
                </comment>
                <comment line="729">
                    Original                    
                </comment>
                <comment line="730">
                    beta += dx * dx + dsq * (xoptsq + dx + dx + HALF * dsq) - bsum; // XXX &quot;testAckley&quot; and &quot;testDiffPow&quot; fail.                    
                </comment>
                <comment line="731">
                    beta = dx * dx + dsq * (xoptsq + 2 * dx + HALF * dsq) + beta - bsum; // XXX &quot;testDiffPow&quot; fails.                    
                </comment>
                <comment line="736">
                    If NTRITS is zero, the denominator may be increased by replacing                    
                </comment>
                <comment line="737">
                    the step D of ALTMOV by a Cauchy step. Then RESCUE may be called if                    
                </comment>
                <comment line="738">
                    rounding errors have damaged the chosen denominator.                    
                </comment>
                <comment line="741">
                    Computing 2nd power                    
                </comment>
                <comment line="749">
                    XXX Useful statement?                    
                </comment>
                <comment line="752">
                    Alternatively, if NTRITS is positive, then set KNEW to the index of                    
                </comment>
                <comment line="753">
                    the next interpolation point to be deleted to make room for a trust                    
                </comment>
                <comment line="754">
                    region step. Again RESCUE may be called if rounding errors have damaged_                    
                </comment>
                <comment line="755">
                    the chosen denominator, which is the reason for attempting to select                    
                </comment>
                <comment line="756">
                    KNEW before calculating the next value of the objective function.                    
                </comment>
                <comment line="769">
                    Computing 2nd power                    
                </comment>
                <comment line="773">
                    Computing 2nd power                    
                </comment>
                <comment line="778">
                    Computing 2nd power                    
                </comment>
                <comment line="782">
                    Computing MAX                    
                </comment>
                <comment line="783">
                    Computing 2nd power                    
                </comment>
                <comment line="791">
                    Computing MAX                    
                </comment>
                <comment line="792">
                    Computing 2nd power                    
                </comment>
                <comment line="798">
                    Put the variables for the next calculation of the objective function                    
                </comment>
                <comment line="799">
                    in XNEW, with any adjustments for the bounds.                    
                </comment>
                <comment line="801">
                    Calculate the value of the objective function at XBASE+XNEW, unless                    
                </comment>
                <comment line="802">
                    the limit on the number of calculations of F has been reached.                    
                </comment>
                <comment line="806">
                    XXX                    
                </comment>
                <comment line="808">
                    Computing MIN                    
                </comment>
                <comment line="809">
                    Computing MAX                    
                </comment>
                <comment line="832">
                    Use the quadratic model to predict the change in F due to the step D,                    
                </comment>
                <comment line="833">
                    and set DIFF to the error of this prediction.                    
                </comment>
                <comment line="850">
                    Computing 2nd power                    
                </comment>
                <comment line="852">
                    &quot;d1&quot; must be squared first to prevent test failures.                    
                </comment>
                <comment line="863">
                    Pick the next value of DELTA after a trust region step.                    
                </comment>
                <comment line="872">
                    Computing MIN                    
                </comment>
                <comment line="875">
                    Computing MAX                    
                </comment>
                <comment line="878">
                    Computing MAX                    
                </comment>
                <comment line="885">
                    Recalculate KNEW and DENOM if the new F is less than FOPT.                    
                </comment>
                <comment line="897">
                    Computing 2nd power                    
                </comment>
                <comment line="901">
                    Computing 2nd power                    
                </comment>
                <comment line="906">
                    Computing 2nd power                    
                </comment>
                <comment line="910">
                    Computing MAX                    
                </comment>
                <comment line="911">
                    Computing 2nd power                    
                </comment>
                <comment line="919">
                    Computing MAX                    
                </comment>
                <comment line="920">
                    Computing 2nd power                    
                </comment>
                <comment line="932">
                    Update BMAT and ZMAT, so that the KNEW-th interpolation point can be                    
                </comment>
                <comment line="933">
                    moved. Also update the second derivative terms of the model.                    
                </comment>
                <comment line="954">
                    Include the new interpolation point, and make the changes to GOPT at                    
                </comment>
                <comment line="955">
                    the old XOPT that are caused by the updating of the quadratic model.                    
                </comment>
                <comment line="980">
                    Update XOPT, GOPT and KOPT if the new calculated F is less than FOPT.                    
                </comment>
                <comment line="988">
                    Computing 2nd power                    
                </comment>
                <comment line="1011">
                    Calculate the parameters of the least Frobenius norm interpolant to                    
                </comment>
                <comment line="1012">
                    the current data, the gradient of this interpolant at XOPT being put                    
                </comment>
                <comment line="1013">
                    into VLAG(NPT+I), I=1,2,...,N.                    
                </comment>
                <comment line="1046">
                    Computing MIN                    
                </comment>
                <comment line="1047">
                    Computing 2nd power                    
                </comment>
                <comment line="1050">
                    Computing 2nd power                    
                </comment>
                <comment line="1054">
                    Computing MAX                    
                </comment>
                <comment line="1055">
                    Computing 2nd power                    
                </comment>
                <comment line="1058">
                    Computing 2nd power                    
                </comment>
                <comment line="1062">
                    Computing 2nd power                    
                </comment>
                <comment line="1070">
                    Test whether to replace the new quadratic model by the least Frobenius                    
                </comment>
                <comment line="1071">
                    norm interpolant, making the replacement if the test is satisfied.                    
                </comment>
                <comment line="1093">
                    If a trust region step has provided a sufficient decrease in F, then                    
                </comment>
                <comment line="1094">
                    branch for another trust region calculation. The case NTRITS=0 occurs                    
                </comment>
                <comment line="1095">
                    when the new interpolation point was reached by an alternative step.                    
                </comment>
                <comment line="1104">
                    Alternatively, find out if the interpolation points are close enough                    
                </comment>
                <comment line="1105">
                    to the best point so far.                    
                </comment>
                <comment line="1107">
                    Computing MAX                    
                </comment>
                <comment line="1108">
                    Computing 2nd power                    
                </comment>
                <comment line="1110">
                    Computing 2nd power                    
                </comment>
                <comment line="1115">
                    XXX                    
                </comment>
                <comment line="1120">
                    Computing 2nd power                    
                </comment>
                <comment line="1130">
                    If KNEW is positive, then ALTMOV finds alternative new positions for                    
                </comment>
                <comment line="1131">
                    the KNEW-th interpolation point within distance ADELT of XOPT. It is                    
                </comment>
                <comment line="1132">
                    reached via label 90. Otherwise, there is a branch to label 60 for                    
                </comment>
                <comment line="1133">
                    another trust region iteration, unless the calculations with the                    
                </comment>
                <comment line="1134">
                    current RHO are complete.                    
                </comment>
                <comment line="1139">
                    Computing MIN                    
                </comment>
                <comment line="1146">
                    Computing MAX                    
                </comment>
                <comment line="1147">
                    Computing MIN                    
                </comment>
                <comment line="1163">
                    The calculations with the current value of RHO are complete. Pick the                    
                </comment>
                <comment line="1164">
                    next values of RHO and DELTA.                    
                </comment>
                <comment line="1167">
                    XXX                    
                </comment>
                <comment line="1184">
                    Return from the calculation, after another Newton-Raphson step, if                    
                </comment>
                <comment line="1185">
                    it is too short to have been tried before.                    
                </comment>
                <comment line="1192">
                    XXX                    
                </comment>
                <comment line="1195">
                    Computing MIN                    
                </comment>
                <comment line="1196">
                    Computing MAX                    
                </comment>
                <declaration name="n" type="int" line="375"/>
                <declaration name="npt" type="int" line="376"/>
                <declaration name="np" type="int" line="377"/>
                <declaration name="nptm" type="int" line="378"/>
                <declaration name="nh" type="int" line="379"/>
                <declaration name="work1" type="ArrayRealVector" line="381"/>
                <declaration name="work2" type="ArrayRealVector" line="382"/>
                <declaration name="work3" type="ArrayRealVector" line="383"/>
                <declaration name="cauchy" type="double" line="385"/>
                <declaration name="alpha" type="double" line="386"/>
                <declaration name="dsq" type="double" line="387"/>
                <declaration name="crvmin" type="double" line="388"/>
                <declaration name="xoptsq" type="double" line="405"/>
                <scope line="406">
                    <declaration name="deltaOne" type="double" line="409"/>
                </scope>
                <declaration name="fsave" type="double" line="412"/>
                <declaration name="kbase" type="int" line="413"/>
                <declaration name="ntrits" type="int" line="417"/>
                <declaration name="itest" type="int" line="418"/>
                <declaration name="knew" type="int" line="419"/>
                <declaration name="nfsav" type="int" line="420"/>
                <declaration name="rho" type="double" line="421"/>
                <declaration name="delta" type="double" line="422"/>
                <declaration name="diffa" type="double" line="423"/>
                <declaration name="diffb" type="double" line="424"/>
                <declaration name="diffc" type="double" line="425"/>
                <declaration name="f" type="double" line="426"/>
                <declaration name="beta" type="double" line="427"/>
                <declaration name="adelt" type="double" line="428"/>
                <declaration name="denom" type="double" line="429"/>
                <declaration name="ratio" type="double" line="430"/>
                <declaration name="dnorm" type="double" line="431"/>
                <declaration name="scaden" type="double" line="432"/>
                <declaration name="biglsq" type="double" line="433"/>
                <declaration name="distsq" type="double" line="434"/>
                <declaration name="state" type="int" line="439"/>
                <scope line="441">
                    <scope line="443">
                        <declaration name="ih" type="int" line="444"/>
                        <scope line="445">
                            <scope line="446">
                                <scope line="447"/>
                            </scope>
                        </scope>
                        <scope line="454">
                            <scope line="455">
                                <declaration name="temp" type="double" line="456"/>
                                <scope line="457"/>
                                <scope line="461"/>
                            </scope>
                        </scope>
                    </scope>
                </scope>
                <scope line="477">
                    <declaration name="gnew" type="ArrayRealVector" line="479"/>
                    <declaration name="xbdi" type="ArrayRealVector" line="480"/>
                    <declaration name="s" type="ArrayRealVector" line="481"/>
                    <declaration name="hs" type="ArrayRealVector" line="482"/>
                    <declaration name="hred" type="ArrayRealVector" line="483"/>
                    <declaration name="dsqCrvmin" type="double[]" line="485"/>
                    <declaration name="deltaOne" type="double" line="491"/>
                    <declaration name="deltaTwo" type="double" line="492"/>
                    <scope line="494">
                        <scope line="499"/>
                        <declaration name="errbig" type="double" line="511"/>
                        <declaration name="frhosq" type="double" line="512"/>
                        <scope line="514"/>
                        <declaration name="bdtol" type="double" line="517"/>
                        <scope line="518">
                            <declaration name="bdtest" type="double" line="519"/>
                            <scope line="520"/>
                            <scope line="523"/>
                            <scope line="526">
                                <declaration name="curv" type="double" line="527"/>
                                <scope line="528">
                                    <declaration name="d1" type="double" line="530"/>
                                </scope>
                                <scope line="534"/>
                            </scope>
                        </scope>
                    </scope>
                </scope>
                <scope line="551">
                    <scope line="553">
                        <declaration name="fracsq" type="double" line="554"/>
                        <declaration name="sumpq" type="double" line="555"/>
                        <scope line="558">
                            <declaration name="sum" type="double" line="560"/>
                            <scope line="561"/>
                            <declaration name="temp" type="double" line="566"/>
                            <scope line="567">
                                <declaration name="ip" type="int" line="570"/>
                                <scope line="571"/>
                            </scope>
                        </scope>
                        <scope line="582">
                            <declaration name="sumz" type="double" line="583"/>
                            <declaration name="sumw" type="double" line="584"/>
                            <scope line="585"/>
                            <scope line="590">
                                <declaration name="sum" type="double" line="591"/>
                                <scope line="592"/>
                                <scope line="596"/>
                            </scope>
                            <scope line="602">
                                <declaration name="ip" type="int" line="603"/>
                                <declaration name="temp" type="double" line="604"/>
                                <scope line="605"/>
                            </scope>
                        </scope>
                        <declaration name="ih" type="int" line="616"/>
                        <scope line="617">
                            <scope line="619"/>
                            <scope line="623"/>
                        </scope>
                        <scope line="632"/>
                    </scope>
                    <scope line="641"/>
                </scope>
                <scope line="656">
                    <declaration name="alphaCauchy" type="double[]" line="669"/>
                    <scope line="673"/>
                </scope>
                <scope line="682">
                    <scope line="684">
                        <declaration name="suma" type="double" line="685"/>
                        <declaration name="sumb" type="double" line="686"/>
                        <declaration name="sum" type="double" line="687"/>
                        <scope line="688"/>
                    </scope>
                    <scope line="698">
                        <declaration name="sum" type="double" line="699"/>
                        <scope line="700"/>
                        <scope line="704"/>
                    </scope>
                    <declaration name="bsum" type="double" line="709"/>
                    <declaration name="dx" type="double" line="710"/>
                    <scope line="711">
                        <declaration name="d1" type="double" line="713"/>
                        <declaration name="sum" type="double" line="715"/>
                        <scope line="716"/>
                        <declaration name="jp" type="int" line="720"/>
                        <scope line="721"/>
                    </scope>
                    <scope line="740">
                        <declaration name="d1" type="double" line="742"/>
                        <scope line="744">
                            <scope line="745"/>
                        </scope>
                    </scope>
                    <scope line="758">
                        <declaration name="delsq" type="double" line="759"/>
                        <scope line="763">
                            <scope line="764"/>
                            <declaration name="hdiag" type="double" line="767"/>
                            <scope line="768">
                                <declaration name="d1" type="double" line="770"/>
                            </scope>
                            <declaration name="d2" type="double" line="774"/>
                            <declaration name="den" type="double" line="775"/>
                            <scope line="777">
                                <declaration name="d3" type="double" line="779"/>
                            </scope>
                            <declaration name="d4" type="double" line="784"/>
                            <declaration name="temp" type="double" line="785"/>
                            <scope line="786"/>
                            <declaration name="d5" type="double" line="793"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="805">
                    <scope line="807">
                        <declaration name="d3" type="double" line="810"/>
                        <declaration name="d4" type="double" line="811"/>
                        <declaration name="d1" type="double" line="812"/>
                        <declaration name="d2" type="double" line="813"/>
                        <scope line="815"/>
                        <scope line="818"/>
                    </scope>
                    <scope line="827"/>
                    <declaration name="fopt" type="double" line="835"/>
                    <declaration name="vquad" type="double" line="836"/>
                    <declaration name="ih" type="int" line="837"/>
                    <scope line="838">
                        <scope line="840">
                            <declaration name="temp" type="double" line="841"/>
                            <scope line="842"/>
                        </scope>
                    </scope>
                    <scope line="849">
                        <declaration name="d1" type="double" line="851"/>
                        <declaration name="d2" type="double" line="852"/>
                    </scope>
                    <declaration name="diff" type="double" line="855"/>
                    <scope line="859"/>
                    <scope line="865">
                        <scope line="866"/>
                        <declaration name="hDelta" type="double" line="870"/>
                        <scope line="871"/>
                        <scope line="874"/>
                        <scope line="877"/>
                        <scope line="881"/>
                        <scope line="887">
                            <declaration name="ksav" type="int" line="888"/>
                            <declaration name="densav" type="double" line="889"/>
                            <declaration name="delsq" type="double" line="890"/>
                            <scope line="894">
                                <declaration name="hdiag" type="double" line="895"/>
                                <scope line="896">
                                    <declaration name="d1" type="double" line="898"/>
                                </scope>
                                <declaration name="d1" type="double" line="902"/>
                                <declaration name="den" type="double" line="903"/>
                                <scope line="905">
                                    <declaration name="d2" type="double" line="907"/>
                                </scope>
                                <declaration name="d3" type="double" line="912"/>
                                <declaration name="temp" type="double" line="913"/>
                                <scope line="914"/>
                                <declaration name="d4" type="double" line="921"/>
                                <declaration name="d5" type="double" line="922"/>
                            </scope>
                            <scope line="925"/>
                        </scope>
                    </scope>
                    <declaration name="pqold" type="double" line="938"/>
                    <scope line="940">
                        <declaration name="temp" type="double" line="941"/>
                        <scope line="942"/>
                    </scope>
                    <scope line="947">
                        <declaration name="temp" type="double" line="948"/>
                        <scope line="949"/>
                    </scope>
                    <scope line="958"/>
                    <scope line="962">
                        <declaration name="suma" type="double" line="963"/>
                        <scope line="964"/>
                        <declaration name="sumb" type="double" line="967"/>
                        <scope line="968"/>
                        <declaration name="temp" type="double" line="971"/>
                        <scope line="972"/>
                    </scope>
                    <scope line="976"/>
                    <scope line="982">
                        <scope line="986">
                            <declaration name="d1" type="double" line="989"/>
                            <scope line="991">
                                <scope line="992"/>
                            </scope>
                        </scope>
                        <scope line="999">
                            <declaration name="temp" type="double" line="1000"/>
                            <scope line="1001"/>
                            <scope line="1005"/>
                        </scope>
                    </scope>
                    <scope line="1015">
                        <scope line="1016"/>
                        <scope line="1020">
                            <declaration name="sum" type="double" line="1021"/>
                            <scope line="1022"/>
                            <scope line="1025"/>
                        </scope>
                        <scope line="1029">
                            <declaration name="sum" type="double" line="1030"/>
                            <scope line="1031"/>
                        </scope>
                        <declaration name="gqsq" type="double" line="1037"/>
                        <declaration name="gisq" type="double" line="1038"/>
                        <scope line="1039">
                            <declaration name="sum" type="double" line="1040"/>
                            <scope line="1041"/>
                            <scope line="1045">
                                <declaration name="d1" type="double" line="1048"/>
                                <declaration name="d2" type="double" line="1051"/>
                            </scope>
                            <scope line="1053">
                                <declaration name="d1" type="double" line="1056"/>
                                <declaration name="d2" type="double" line="1059"/>
                            </scope>
                            <scope line="1061">
                                <declaration name="d1" type="double" line="1063"/>
                            </scope>
                        </scope>
                        <scope line="1074"/>
                        <scope line="1077">
                            <scope line="1078">
                                <scope line="1079"/>
                                <scope line="1082"/>
                                <scope line="1085"/>
                            </scope>
                        </scope>
                    </scope>
                    <scope line="1097"/>
                    <scope line="1100"/>
                    <declaration name="d1" type="double" line="1109"/>
                    <declaration name="d2" type="double" line="1111"/>
                </scope>
                <scope line="1114">
                    <scope line="1117">
                        <declaration name="sum" type="double" line="1118"/>
                        <scope line="1119">
                            <declaration name="d1" type="double" line="1121"/>
                        </scope>
                        <scope line="1124"/>
                    </scope>
                    <scope line="1136">
                        <declaration name="dist" type="double" line="1137"/>
                        <scope line="1138">
                            <scope line="1141"/>
                        </scope>
                        <declaration name="d1" type="double" line="1148"/>
                    </scope>
                    <scope line="1153"/>
                    <scope line="1156"/>
                    <scope line="1159"/>
                </scope>
                <scope line="1166">
                    <scope line="1168">
                        <scope line="1171"/>
                        <scope line="1173"/>
                        <scope line="1175"/>
                    </scope>
                    <scope line="1187"/>
                </scope>
                <scope line="1191">
                    <scope line="1193">
                        <scope line="1194">
                            <declaration name="d3" type="double" line="1197"/>
                            <declaration name="d4" type="double" line="1198"/>
                            <declaration name="d1" type="double" line="1199"/>
                            <declaration name="d2" type="double" line="1200"/>
                            <scope line="1202"/>
                            <scope line="1205"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="1213"/>
            </method>
            <javadoc line="1220">
                The arguments N, NPT, XPT, XOPT, BMAT, ZMAT, NDIM, SL and SU all have
                  the same meanings as the corresponding arguments of BOBYQB.
                  KOPT is the index of the optimal interpolation point.
                  KNEW is the index of the interpolation point that is going to be moved.
                  ADELT is the current trust region bound.
                  XNEW will be set to a suitable new position for the interpolation point
                  XPT(KNEW,.). Specifically, it satisfies the SL, SU and trust region
                  bounds and it should provide a large denominator in the next call of
                  UPDATE. The step XNEW-XOPT from XOPT is restricted to moves along the
                  straight lines through XOPT and another interpolation point.
                  XALT also provides a large value of the modulus of the KNEW-th Lagrange
                  function subject to the constraints that have been mentioned, its main
                  difference from XNEW being that XALT-XOPT is a constrained version of
                  the Cauchy step within the trust region. An exception is that XALT is
                  not calculated if all components of GLAG (see below) are zero.
                  ALPHA will be set to the KNEW-th diagonal element of the H matrix.
                  CAUCHY will be set to the square of the KNEW-th Lagrange function at
                  the step XALT-XOPT from XOPT for the vector XALT that is returned,
                  except that CAUCHY is set to zero if XALT is not calculated.
                  GLAG is a working space vector of length N for the gradient of the
                  KNEW-th Lagrange function at XOPT.
                  HCOL is a working space vector of length NPT for the second derivative
                  coefficients of the KNEW-th Lagrange function.
                  W is a working space vector of length 2N that is going to hold the
                  constrained Cauchy step from XOPT of the Lagrange function, followed
                  by the downhill version of XALT when the uphill step is calculated.
                  Set the first NPT components of W to the leading elements of the
                  KNEW-th column of the H matrix.                
                <param>
                    knew                    
                </param>
                <param>
                    adelt                    
                </param>
            </javadoc>
            <method name="altmov" type="double[]" line="1256">
                <params>
                    <param name="knew" type="int"/>
                    <param name="adelt" type="double"/>
                </params>
                <comment line="1257">
                    XXX                    
                </comment>
                <comment line="1280">
                    Calculate the gradient of the KNEW-th Lagrange function at XOPT.                    
                </comment>
                <comment line="1296">
                    Search for a large denominator along the straight lines through XOPT                    
                </comment>
                <comment line="1297">
                    and another interpolation point. SLBD and SUBD will be lower and upper                    
                </comment>
                <comment line="1298">
                    bounds on the step along each of these lines in turn. PREDSQ will be                    
                </comment>
                <comment line="1299">
                    set to the square of the predicted denominator for each line. PRESAV                    
                </comment>
                <comment line="1300">
                    will be set to the largest admissible value of PREDSQ that occurs.                    
                </comment>
                <comment line="1324">
                    Revise SLBD and SUBD if necessary because of the bounds in SL and SU.                    
                </comment>
                <comment line="1334">
                    Computing MAX                    
                </comment>
                <comment line="1345">
                    Computing MAX                    
                </comment>
                <comment line="1353">
                    Seek a large modulus of the KNEW-th Lagrange function when the index                    
                </comment>
                <comment line="1354">
                    of the other interpolation point on the line through XOPT is KNEW.                    
                </comment>
                <comment line="1380">
                    Search along each of the other lines through XOPT and another point.                    
                </comment>
                <comment line="1398">
                    Calculate PREDSQ for the current line search and maintain PRESAV.                    
                </comment>
                <comment line="1410">
                    Construct XNEW in a way that satisfies the bound constraints exactly.                    
                </comment>
                <comment line="1424">
                    Prepare for the iterative method that assembles the constrained Cauchy                    
                </comment>
                <comment line="1425">
                    step in W. The sum of squares of the fixed components of W is formed in                    
                </comment>
                <comment line="1426">
                    WFIXSQ, and the free components of W are set to BIGSTP.                    
                </comment>
                <comment line="1441">
                    Computing 2nd power                    
                </comment>
                <comment line="1449">
                    Investigate whether more components of W can be fixed.                    
                </comment>
                <comment line="1459">
                    Computing 2nd power                    
                </comment>
                <comment line="1464">
                    Computing 2nd power                    
                </comment>
                <comment line="1468">
                    Computing 2nd power                    
                </comment>
                <comment line="1476">
                    Set the remaining free components of W and all components of XALT,                    
                </comment>
                <comment line="1477">
                    except that W may be scaled later.                    
                </comment>
                <comment line="1497">
                    Set CURV to the curvature of the KNEW-th Lagrange function along W.                    
                </comment>
                <comment line="1498">
                    Scale W by a factor less than one if that can reduce the modulus of                    
                </comment>
                <comment line="1499">
                    the Lagrange function at XOPT+W. Set CAUCHY to the final value of                    
                </comment>
                <comment line="1500">
                    the square of this function.                    
                </comment>
                <comment line="1521">
                    Computing 2nd power                    
                </comment>
                <comment line="1525">
                    Computing 2nd power                    
                </comment>
                <comment line="1530">
                    If IFLAG is zero, then XALT is calculated as before after reversing                    
                </comment>
                <comment line="1531">
                    the sign of GLAG. Thus two XALT vectors become available. The one that                    
                </comment>
                <comment line="1532">
                    is chosen is the one that gives the larger value of CAUCHY.                    
                </comment>
                <declaration name="n" type="int" line="1259"/>
                <declaration name="npt" type="int" line="1260"/>
                <declaration name="glag" type="ArrayRealVector" line="1262"/>
                <declaration name="hcol" type="ArrayRealVector" line="1263"/>
                <declaration name="work1" type="ArrayRealVector" line="1265"/>
                <declaration name="work2" type="ArrayRealVector" line="1266"/>
                <scope line="1268"/>
                <scope line="1271">
                    <declaration name="tmp" type="double" line="1272"/>
                    <scope line="1273"/>
                </scope>
                <declaration name="alpha" type="double" line="1277"/>
                <declaration name="ha" type="double" line="1278"/>
                <scope line="1282"/>
                <scope line="1285">
                    <declaration name="tmp" type="double" line="1286"/>
                    <scope line="1287"/>
                    <scope line="1291"/>
                </scope>
                <declaration name="presav" type="double" line="1302"/>
                <declaration name="step" type="double" line="1303"/>
                <declaration name="ksav" type="int" line="1304"/>
                <declaration name="ibdsav" type="int" line="1305"/>
                <declaration name="stpsav" type="double" line="1306"/>
                <scope line="1307">
                    <scope line="1308"/>
                    <declaration name="dderiv" type="double" line="1311"/>
                    <declaration name="distsq" type="double" line="1312"/>
                    <scope line="1313">
                        <declaration name="tmp" type="double" line="1314"/>
                    </scope>
                    <declaration name="subd" type="double" line="1318"/>
                    <declaration name="slbd" type="double" line="1319"/>
                    <declaration name="ilbd" type="int" line="1320"/>
                    <declaration name="iubd" type="int" line="1321"/>
                    <declaration name="sumin" type="double" line="1322"/>
                    <scope line="1326">
                        <declaration name="tmp" type="double" line="1327"/>
                        <scope line="1328">
                            <scope line="1329"/>
                            <scope line="1333"/>
                        </scope>
                        <scope line="1339">
                            <scope line="1340"/>
                            <scope line="1344"/>
                        </scope>
                    </scope>
                    <declaration name="isbd" type="int" line="1357"/>
                    <declaration name="vlag" type="double" line="1358"/>
                    <scope line="1359">
                        <declaration name="diff" type="double" line="1360"/>
                        <declaration name="d1" type="double" line="1362"/>
                        <scope line="1363"/>
                        <declaration name="d2" type="double" line="1368"/>
                        <declaration name="d3" type="double" line="1369"/>
                        <declaration name="d4" type="double" line="1370"/>
                        <scope line="1371">
                            <declaration name="d5" type="double" line="1372"/>
                            <scope line="1373"/>
                        </scope>
                    </scope>
                    <scope line="1382">
                        <declaration name="tmp" type="double" line="1384"/>
                        <scope line="1385"/>
                        <scope line="1390"/>
                    </scope>
                    <declaration name="tmp" type="double" line="1400"/>
                    <declaration name="predsq" type="double" line="1401"/>
                    <scope line="1402"/>
                </scope>
                <scope line="1412">
                    <declaration name="tmp" type="double" line="1413"/>
                </scope>
                <scope line="1417"/>
                <scope line="1420"/>
                <declaration name="bigstp" type="double" line="1428"/>
                <declaration name="iflag" type="int" line="1429"/>
                <declaration name="cauchy" type="double" line="1430"/>
                <declaration name="csave" type="double" line="1431"/>
                <scope line="1432">
                    <declaration name="wfixsq" type="double" line="1433"/>
                    <declaration name="ggfree" type="double" line="1434"/>
                    <scope line="1435">
                        <declaration name="glagValue" type="double" line="1436"/>
                        <scope line="1439"/>
                    </scope>
                    <scope line="1445"/>
                    <declaration name="tmp1" type="double" line="1450"/>
                    <scope line="1451">
                        <scope line="1454">
                            <scope line="1455">
                                <declaration name="tmp2" type="double" line="1456"/>
                                <scope line="1457">
                                    <declaration name="d1" type="double" line="1460"/>
                                </scope>
                                <scope line="1462">
                                    <declaration name="d1" type="double" line="1465"/>
                                </scope>
                                <scope line="1467">
                                    <declaration name="d1" type="double" line="1469"/>
                                </scope>
                            </scope>
                        </scope>
                    </scope>
                    <declaration name="gw" type="double" line="1479"/>
                    <scope line="1480">
                        <declaration name="glagValue" type="double" line="1481"/>
                        <scope line="1482">
                            <declaration name="min" type="double" line="1484"/>
                        </scope>
                        <scope line="1487"/>
                        <scope line="1489"/>
                        <scope line="1491"/>
                    </scope>
                    <declaration name="curv" type="double" line="1502"/>
                    <scope line="1503">
                        <declaration name="tmp" type="double" line="1504"/>
                        <scope line="1505"/>
                    </scope>
                    <scope line="1510"/>
                    <scope line="1514">
                        <declaration name="scale" type="double" line="1515"/>
                        <scope line="1516">
                            <declaration name="tmp" type="double" line="1517"/>
                        </scope>
                        <declaration name="d1" type="double" line="1522"/>
                    </scope>
                    <scope line="1524">
                        <declaration name="d1" type="double" line="1526"/>
                    </scope>
                    <scope line="1534">
                        <scope line="1535"/>
                    </scope>
                    <scope line="1541"/>
                </scope>
                <scope line="1545">
                    <scope line="1546"/>
                </scope>
            </method>
            <javadoc line="1557">
                SUBROUTINE PRELIM sets the elements of XBASE, XPT, FVAL, GOPT, HQ, PQ,
                  BMAT and ZMAT for the first iteration, and it maintains the values of
                  NF and KOPT. The vector X is also changed by PRELIM.
                  The arguments N, NPT, X, XL, XU, RHOBEG, IPRINT and MAXFUN are the
                  same as the corresponding arguments in SUBROUTINE BOBYQA.
                  The arguments XBASE, XPT, FVAL, HQ, PQ, BMAT, ZMAT, NDIM, SL and SU
                  are the same as the corresponding arguments in BOBYQB, the elements
                  of SL and SU being set in BOBYQA.
                  GOPT is usually the gradient of the quadratic model at XOPT+XBASE, but
                  it is set by PRELIM to the gradient of the quadratic model at XBASE.
                  If XOPT is nonzero, BOBYQB will change it to its usual value later.
                  NF is maintaned as the number of calls of CALFUN so far.
                  KOPT will be such that the least calculated value of F so far is at
                  the point XPT(KOPT,.)+XBASE in the space of the variables.                
                <param>
                    lowerBound Lower bounds.                    
                </param>
                <param>
                    upperBound Upper bounds.                    
                </param>
            </javadoc>
            <method name="prelim" type="void" line="1578">
                <params>
                    <param name="lowerBound" type="double[]"/>
                    <param name="upperBound" type="double[]"/>
                </params>
                <comment line="1579">
                    XXX                    
                </comment>
                <comment line="1589">
                    Set XBASE to the initial vector of variables, and set the initial                    
                </comment>
                <comment line="1590">
                    elements of XPT, BMAT, HQ, PQ and ZMAT to zero.                    
                </comment>
                <comment line="1611">
                    Begin the initialization procedure. NF becomes one more than the number                    
                </comment>
                <comment line="1612">
                    of function values so far. The coordinates of the displacement of the                    
                </comment>
                <comment line="1613">
                    next initial interpolation point from XBASE are set in XPT(NF+1,.).                    
                </comment>
                <comment line="1631">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <comment line="1639">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <comment line="1643">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <comment line="1655">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <comment line="1663">
                    Calculate the next value of F. The least function value so far and                    
                </comment>
                <comment line="1664">
                    its index are required.                    
                </comment>
                <comment line="1680">
                    nfm + 1                    
                </comment>
                <comment line="1690">
                    Set the nonzero initial elements of BMAT and the quadratic model in the                    
                </comment>
                <comment line="1691">
                    cases when NF is at most 2*N+1. If NF exceeds N+1, then the positions                    
                </comment>
                <comment line="1692">
                    of the NF-th and (NF-N)-th interpolation points may be switched, in                    
                </comment>
                <comment line="1693">
                    order that the function value at the first of them contributes to the                    
                </comment>
                <comment line="1694">
                    off-diagonal second derivative terms of the initial quadratic model.                    
                </comment>
                <comment line="1705">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <comment line="1728">
                    zMatrix.setEntry(nfm, nfxm, Math.sqrt(HALF) * recip); // XXX &quot;testAckley&quot; and &quot;testDiffPow&quot; fail.                    
                </comment>
                <comment line="1733">
                    Set the off-diagonal second derivatives of the Lagrange functions and                    
                </comment>
                <comment line="1734">
                    the initial quadratic model.                    
                </comment>
                <comment line="1745">
                    throw new PathIsExploredException(); // XXX                    
                </comment>
                <declaration name="n" type="int" line="1581"/>
                <declaration name="npt" type="int" line="1582"/>
                <declaration name="ndim" type="int" line="1583"/>
                <declaration name="rhosq" type="double" line="1585"/>
                <declaration name="recip" type="double" line="1586"/>
                <declaration name="np" type="int" line="1587"/>
                <scope line="1592">
                    <scope line="1594"/>
                    <scope line="1597"/>
                </scope>
                <scope line="1601"/>
                <scope line="1604">
                    <scope line="1606"/>
                </scope>
                <declaration name="ipt" type="int" line="1615"/>
                <declaration name="jpt" type="int" line="1616"/>
                <declaration name="fbeg" type="double" line="1617"/>
                <scope line="1618">
                    <declaration name="nfm" type="int" line="1619"/>
                    <declaration name="nfx" type="int" line="1620"/>
                    <declaration name="nfmm" type="int" line="1621"/>
                    <declaration name="nfxm" type="int" line="1622"/>
                    <declaration name="stepa" type="double" line="1623"/>
                    <declaration name="stepb" type="double" line="1624"/>
                    <scope line="1625">
                        <scope line="1627">
                            <scope line="1629"/>
                        </scope>
                        <scope line="1634">
                            <scope line="1637"/>
                            <scope line="1641"/>
                        </scope>
                    </scope>
                    <scope line="1647">
                        <declaration name="tmp1" type="int" line="1648"/>
                        <scope line="1651">
                            <declaration name="tmp2" type="int" line="1652"/>
                        </scope>
                        <declaration name="iptMinus1" type="int" line="1657"/>
                        <declaration name="jptMinus1" type="int" line="1658"/>
                    </scope>
                    <scope line="1666">
                        <scope line="1670"/>
                        <scope line="1673"/>
                    </scope>
                    <declaration name="objectiveValue" type="double" line="1678"/>
                    <declaration name="f" type="double" line="1679"/>
                    <declaration name="numEval" type="int" line="1680"/>
                    <scope line="1683"/>
                    <scope line="1686"/>
                    <scope line="1696">
                        <scope line="1698">
                            <scope line="1700">
                                <declaration name="oneOverStepA" type="double" line="1701"/>
                            </scope>
                        </scope>
                        <scope line="1707">
                            <declaration name="ih" type="int" line="1708"/>
                            <declaration name="tmp" type="double" line="1709"/>
                            <declaration name="diff" type="double" line="1710"/>
                            <scope line="1713">
                                <scope line="1716"/>
                            </scope>
                        </scope>
                    </scope>
                    <scope line="1736">
                        <declaration name="ih" type="int" line="1742"/>
                        <declaration name="tmp" type="double" line="1743"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="1753">
                A version of the truncated conjugate gradient is applied. If a line
                  search is restricted by a constraint, then the procedure is restarted,
                  the values of the variables that are at their bounds being fixed. If
                  the trust region boundary is reached, then further changes may be made
                  to D, each one being in the two dimensional space that is spanned
                  by the current D and the gradient of Q at XOPT+D, staying on the trust
                  region boundary. Termination occurs when the reduction in Q seems to
                  be close to the greatest reduction that can be achieved.
                  The arguments N, NPT, XPT, XOPT, GOPT, HQ, PQ, SL and SU have the same
                  meanings as the corresponding arguments of BOBYQB.
                  DELTA is the trust region radius for the present calculation, which
                  seeks a small value of the quadratic model within distance DELTA of
                  XOPT subject to the bounds on the variables.
                  XNEW will be set to a new vector of variables that is approximately
                  the one that minimizes the quadratic model within the trust region
                  subject to the SL and SU constraints on the variables. It satisfies
                  as equations the bounds that become active during the calculation.
                  D is the calculated trial step from XOPT, generated iteratively from an
                  initial value of zero. Thus XNEW is XOPT+D after the final iteration.
                  GNEW holds the gradient of the quadratic model at XOPT+D. It is updated
                  when D is updated.
                  xbdi.get( is a working space vector. For I=1,2,...,N, the element xbdi.get((I) is
                  set to -1.0, 0.0, or 1.0, the value being nonzero if and only if the
                  I-th variable has become fixed at a bound, the bound being SL(I) or
                  SU(I) in the case xbdi.get((I)=-1.0 or xbdi.get((I)=1.0, respectively. This
                  information is accumulated during the construction of XNEW.
                  The arrays S, HS and HRED are also used for working space. They hold the
                  current search direction, and the changes in the gradient of Q along S
                  and the reduced D, respectively, where the reduced D is the same as D,
                  except that the components of the fixed variables are zero.
                  DSQ will be set to the square of the length of XNEW-XOPT.
                  CRVMIN is set to zero if D reaches the trust region boundary. Otherwise
                  it is set to the least curvature of H that occurs in the conjugate
                  gradient searches that are not restricted by any constraints. The
                  value CRVMIN=-1.0D0 is set, however, if all of these searches are
                  constrained.                
                <param>
                    delta                    
                </param>
                <param>
                    gnew                    
                </param>
                <param>
                    xbdi                    
                </param>
                <param>
                    s                    
                </param>
                <param>
                    hs                    
                </param>
                <param>
                    hred                    
                </param>
            </javadoc>
            <method name="trsbox" type="double[]" line="1804">
                <params>
                    <param name="delta" type="double"/>
                    <param name="gnew" type="ArrayRealVector"/>
                    <param name="xbdi" type="ArrayRealVector"/>
                    <param name="s" type="ArrayRealVector"/>
                    <param name="hs" type="ArrayRealVector"/>
                    <param name="hred" type="ArrayRealVector"/>
                </params>
                <comment line="1805">
                    XXX                    
                </comment>
                <comment line="1813">
                    Local variables                    
                </comment>
                <comment line="1829">
                    Set some constants.                    
                </comment>
                <comment line="1831">
                    Function Body                    
                </comment>
                <comment line="1833">
                    The sign of GOPT(I) gives the sign of the change to the I-th variable                    
                </comment>
                <comment line="1834">
                    that will reduce Q from its value at XOPT. Thus xbdi.get((I) shows whether                    
                </comment>
                <comment line="1835">
                    or not to fix the I-th variable at one of its bounds initially, with                    
                </comment>
                <comment line="1836">
                    NACT being set to the number of fixed variables. D and GNEW are also                    
                </comment>
                <comment line="1837">
                    set for the first iteration. DELSQ is the upper bound on the sum of                    
                </comment>
                <comment line="1838">
                    squares of the free variables. QRED is the reduction in Q so far.                    
                </comment>
                <comment line="1862">
                    Set the next search direction of the conjugate gradient method. It is                    
                </comment>
                <comment line="1863">
                    the steepest descent direction initially and when the iterations are                    
                </comment>
                <comment line="1864">
                    restarted because a variable has just been fixed by a bound, and of                    
                </comment>
                <comment line="1865">
                    course the components of the fixed variables are zero. ITERMAX is an                    
                </comment>
                <comment line="1866">
                    upper bound on the indices of the conjugate gradient iterations.                    
                </comment>
                <comment line="1872">
                    XXX                    
                </comment>
                <comment line="1876">
                    XXX                    
                </comment>
                <comment line="1886">
                    Computing 2nd power                    
                </comment>
                <comment line="1901">
                    Multiply the search direction by the second derivative matrix of Q and                    
                </comment>
                <comment line="1902">
                    calculate some scalars for the choice of steplength. Then set BLEN to                    
                </comment>
                <comment line="1903">
                    the length of the the step to the trust region boundary and STPLEN to                    
                </comment>
                <comment line="1904">
                    the steplength, ignoring the simple bounds.                    
                </comment>
                <comment line="1909">
                    XXX                    
                </comment>
                <comment line="1915">
                    Computing 2nd power                    
                </comment>
                <comment line="1933">
                    Computing MIN                    
                </comment>
                <comment line="1937">
                    Reduce STPLEN if necessary in order to preserve the simple bounds,                    
                </comment>
                <comment line="1938">
                    letting IACT be the index of the new constrained variable.                    
                </comment>
                <comment line="1956">
                    Update CRVMIN, GNEW and D. Set SDEC to the decrease that occurs in Q.                    
                </comment>
                <comment line="1973">
                    Computing 2nd power                    
                </comment>
                <comment line="1979">
                    Computing MAX                    
                </comment>
                <comment line="1985">
                    Restart the conjugate gradient method if it has hit a new bound.                    
                </comment>
                <comment line="1993">
                    Computing 2nd power                    
                </comment>
                <comment line="2002">
                    If STPLEN is less than BLEN, then either apply another conjugate                    
                </comment>
                <comment line="2003">
                    gradient iteration or RETURN.                    
                </comment>
                <comment line="2017">
                    XXX                    
                </comment>
                <comment line="2020">
                    Prepare for the alternative iteration by calculating some scalars                    
                </comment>
                <comment line="2021">
                    and by multiplying the reduced D by the second derivative matrix of                    
                </comment>
                <comment line="2022">
                    Q, where S holds the reduced D in the call of GGMULT.                    
                </comment>
                <comment line="2026">
                    XXX                    
                </comment>
                <comment line="2035">
                    Computing 2nd power                    
                </comment>
                <comment line="2039">
                    Computing 2nd power                    
                </comment>
                <comment line="2049">
                    Let the search direction S be a linear combination of the reduced D                    
                </comment>
                <comment line="2050">
                    and the reduced G that is orthogonal to the reduced D.                    
                </comment>
                <comment line="2053">
                    XXX                    
                </comment>
                <comment line="2069">
                    By considering the simple bounds on the variables, calculate an upper                    
                </comment>
                <comment line="2070">
                    bound on the tangent of half the angle of the alternative iteration,                    
                </comment>
                <comment line="2071">
                    namely ANGBD, except that, if already a free variable has reached a                    
                </comment>
                <comment line="2072">
                    bound, there is a branch back to label 100 after fixing that variable.                    
                </comment>
                <comment line="2089">
                    Computing 2nd power                    
                </comment>
                <comment line="2091">
                    Computing 2nd power                    
                </comment>
                <comment line="2094">
                    Computing 2nd power                    
                </comment>
                <comment line="2105">
                    Computing 2nd power                    
                </comment>
                <comment line="2119">
                    Calculate HHD and some curvatures for the alternative iteration.                    
                </comment>
                <comment line="2124">
                    XXX                    
                </comment>
                <comment line="2136">
                    Seek the greatest reduction in Q for a range of equally spaced values                    
                </comment>
                <comment line="2137">
                    of ANGT in [0,ANGBD], where ANGT is the tangent of half the angle of                    
                </comment>
                <comment line="2138">
                    the alternative iteration.                    
                </comment>
                <comment line="2159">
                    Return if the reduction is zero. Otherwise, set the sine and cosine                    
                </comment>
                <comment line="2160">
                    of the angle of the alternative iteration, and calculate SDEC.                    
                </comment>
                <comment line="2177">
                    Update GNEW, D and HRED. If the angle of the alternative iteration                    
                </comment>
                <comment line="2178">
                    is restricted by a bound on a free variable, that variable is fixed                    
                </comment>
                <comment line="2179">
                    at the bound.                    
                </comment>
                <comment line="2188">
                    Computing 2nd power                    
                </comment>
                <comment line="2201">
                    If SDEC is sufficiently small, then RETURN after setting XNEW to                    
                </comment>
                <comment line="2202">
                    XOPT+D, giving careful attention to the bounds.                    
                </comment>
                <comment line="2209">
                    XXX                    
                </comment>
                <comment line="2212">
                    Computing MAX                    
                </comment>
                <comment line="2213">
                    Computing MIN                    
                </comment>
                <comment line="2224">
                    Computing 2nd power                    
                </comment>
                <comment line="2229">
                    The following instructions multiply the current S-vector by the second                    
                </comment>
                <comment line="2230">
                    derivative matrix of the quadratic model, putting the product in HS.                    
                </comment>
                <comment line="2231">
                    They are reached from three different parts of the software above and                    
                </comment>
                <comment line="2232">
                    they can be regarded as an external subroutine.                    
                </comment>
                <comment line="2235">
                    XXX                    
                </comment>
                <declaration name="n" type="int" line="1807"/>
                <declaration name="npt" type="int" line="1808"/>
                <declaration name="dsq" type="double" line="1810"/>
                <declaration name="crvmin" type="double" line="1811"/>
                <declaration name="ds" type="double" line="1814"/>
                <declaration name="iu" type="int" line="1815"/>
                <declaration name="dhd" type="double" line="1816"/>
                <declaration name="iact" type="int" line="1817"/>
                <declaration name="nact" type="int" line="1818"/>
                <declaration name="angt" type="double" line="1819"/>
                <declaration name="isav" type="int" line="1820"/>
                <declaration name="temp" type="double" line="1821"/>
                <declaration name="iterc" type="int" line="1822"/>
                <declaration name="resid" type="double" line="1823"/>
                <declaration name="itcsav" type="int" line="1825"/>
                <declaration name="rdprev" type="double" line="1826"/>
                <declaration name="itermax" type="int" line="1827"/>
                <scope line="1842">
                    <scope line="1844">
                        <scope line="1845"/>
                    </scope>
                    <scope line="1849"/>
                    <scope line="1852"/>
                </scope>
                <declaration name="state" type="int" line="1868"/>
                <scope line="1869">
                    <scope line="1871"/>
                    <scope line="1875">
                        <scope line="1878">
                            <scope line="1879"/>
                            <scope line="1881"/>
                            <scope line="1883"/>
                            <declaration name="d1" type="double" line="1887"/>
                        </scope>
                        <scope line="1890"/>
                        <scope line="1893"/>
                        <scope line="1897"/>
                    </scope>
                    <scope line="1908">
                        <scope line="1913">
                            <scope line="1914">
                                <declaration name="d1" type="double" line="1916"/>
                            </scope>
                        </scope>
                        <scope line="1922"/>
                        <scope line="1926"/>
                        <scope line="1928"/>
                        <scope line="1932"/>
                        <scope line="1941">
                            <scope line="1942">
                                <scope line="1944"/>
                                <scope line="1946"/>
                                <scope line="1949"/>
                            </scope>
                        </scope>
                        <scope line="1959">
                            <scope line="1962">
                                <scope line="1964"/>
                            </scope>
                            <scope line="1970">
                                <scope line="1972">
                                    <declaration name="d1" type="double" line="1974"/>
                                </scope>
                            </scope>
                            <declaration name="d1" type="double" line="1980"/>
                        </scope>
                        <scope line="1987">
                            <scope line="1990"/>
                            <declaration name="d1" type="double" line="1994"/>
                            <scope line="1996"/>
                        </scope>
                        <scope line="2005">
                            <scope line="2006"/>
                            <scope line="2009"/>
                        </scope>
                    </scope>
                    <scope line="2016"/>
                    <scope line="2025">
                        <scope line="2027"/>
                        <scope line="2033">
                            <scope line="2034">
                                <declaration name="d1" type="double" line="2036"/>
                            </scope>
                            <scope line="2043"/>
                        </scope>
                    </scope>
                    <scope line="2052">
                        <scope line="2056"/>
                        <scope line="2060">
                            <scope line="2061"/>
                            <scope line="2063"/>
                        </scope>
                        <scope line="2076">
                            <scope line="2077">
                                <scope line="2080"/>
                                <scope line="2084"/>
                                <declaration name="d1" type="double" line="2090"/>
                                <declaration name="d2" type="double" line="2092"/>
                                <scope line="2097">
                                    <scope line="2099"/>
                                </scope>
                                <scope line="2108">
                                    <scope line="2110"/>
                                </scope>
                            </scope>
                        </scope>
                    </scope>
                    <scope line="2123">
                        <scope line="2128">
                            <scope line="2129"/>
                        </scope>
                        <scope line="2144">
                            <scope line="2149"/>
                            <scope line="2153"/>
                        </scope>
                        <scope line="2162"/>
                        <scope line="2165"/>
                        <scope line="2173"/>
                        <scope line="2183">
                            <scope line="2185">
                                <declaration name="d1" type="double" line="2189"/>
                            </scope>
                        </scope>
                        <scope line="2195"/>
                        <scope line="2204"/>
                    </scope>
                    <scope line="2208">
                        <scope line="2211">
                            <declaration name="min" type="double" line="2214"/>
                            <scope line="2217"/>
                            <scope line="2220"/>
                            <declaration name="d1" type="double" line="2225"/>
                        </scope>
                    </scope>
                    <scope line="2234">
                        <declaration name="ih" type="int" line="2236"/>
                        <scope line="2237">
                            <scope line="2239">
                                <scope line="2240"/>
                            </scope>
                        </scope>
                        <declaration name="tmp" type="RealVector" line="2247"/>
                        <scope line="2248">
                            <scope line="2249">
                                <scope line="2250"/>
                            </scope>
                        </scope>
                        <scope line="2255"/>
                        <scope line="2258"/>
                        <scope line="2261"/>
                    </scope>
                    <scope line="2266"/>
                </scope>
            </method>
            <javadoc line="2274">
                The arrays BMAT and ZMAT are updated, as required by the new position
                  of the interpolation point that has the index KNEW. The vector VLAG has
                  N+NPT components, set on entry to the first NPT and last N components
                  of the product Hw in equation (4.11) of the Powell (2006) paper on
                  NEWUOA. Further, BETA is set on entry to the value of the parameter
                  with that name, and DENOM is set to the denominator of the updating
                  formula. Elements of ZMAT may be treated as zero if their moduli are
                  at most ZTEST. The first NDIM elements of W are used for working space.                
                <param>
                    beta                    
                </param>
                <param>
                    denom                    
                </param>
                <param>
                    knew                    
                </param>
            </javadoc>
            <method name="update" type="void" line="2291">
                <params>
                    <param name="beta" type="double"/>
                    <param name="denom" type="double"/>
                    <param name="knew" type="int"/>
                </params>
                <comment line="2292">
                    XXX                    
                </comment>
                <comment line="2298">
                    XXX Should probably be split into two arrays.                    
                </comment>
                <comment line="2304">
                    Computing MAX                    
                </comment>
                <comment line="2310">
                    Apply the rotations that put zeros in the KNEW-th row of ZMAT.                    
                </comment>
                <comment line="2315">
                    Computing 2nd power                    
                </comment>
                <comment line="2317">
                    Computing 2nd power                    
                </comment>
                <comment line="2331">
                    Put the first NPT components of the KNEW-th column of HLAG into W,                    
                </comment>
                <comment line="2332">
                    and calculate the parameters of the updating formula.                    
                </comment>
                <comment line="2341">
                    Complete the updating of ZMAT.                    
                </comment>
                <comment line="2351">
                    Finally, update the matrix BMAT.                    
                </comment>
                <declaration name="n" type="int" line="2294"/>
                <declaration name="npt" type="int" line="2295"/>
                <declaration name="nptm" type="int" line="2296"/>
                <declaration name="work" type="ArrayRealVector" line="2299"/>
                <declaration name="ztest" type="double" line="2301"/>
                <scope line="2302">
                    <scope line="2303"/>
                </scope>
                <scope line="2312">
                    <declaration name="d1" type="double" line="2313"/>
                    <scope line="2314">
                        <declaration name="d2" type="double" line="2316"/>
                        <declaration name="d3" type="double" line="2318"/>
                        <declaration name="d4" type="double" line="2319"/>
                        <declaration name="d5" type="double" line="2320"/>
                        <declaration name="d6" type="double" line="2321"/>
                        <scope line="2322">
                            <declaration name="d7" type="double" line="2323"/>
                        </scope>
                    </scope>
                </scope>
                <scope line="2334"/>
                <declaration name="alpha" type="double" line="2337"/>
                <declaration name="tau" type="double" line="2338"/>
                <declaration name="sqrtDenom" type="double" line="2343"/>
                <declaration name="d1" type="double" line="2344"/>
                <declaration name="d2" type="double" line="2345"/>
                <scope line="2346"/>
                <scope line="2353">
                    <declaration name="jp" type="int" line="2354"/>
                    <declaration name="d3" type="double" line="2356"/>
                    <declaration name="d4" type="double" line="2357"/>
                    <scope line="2358">
                        <scope line="2361"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="2368">
                Performs validity checks.                
                <param>
                    lowerBound Lower bounds (constraints) of the objective variables.                    
                </param>
                <param>
                    upperBound Upperer bounds (constraints) of the objective variables.                    
                </param>
            </javadoc>
            <method name="setup" type="void" line="2375">
                <params>
                    <param name="lowerBound" type="double[]"/>
                    <param name="upperBound" type="double[]"/>
                </params>
                <comment line="2376">
                    XXX                    
                </comment>
                <comment line="2381">
                    Check problem dimension.                    
                </comment>
                <comment line="2385">
                    Check number of interpolation points.                    
                </comment>
                <comment line="2395">
                    Initialize bound differences.                    
                </comment>
                <comment line="2408">
                    Initialize the data structures used by the &quot;bobyqa&quot; method.                    
                </comment>
                <declaration name="init" type="double[]" line="2378"/>
                <declaration name="dimension" type="int" line="2379"/>
                <scope line="2382"/>
                <declaration name="nPointsInterval" type="int[]" line="2386"/>
                <scope line="2388"/>
                <declaration name="requiredMinDiff" type="double" line="2398"/>
                <declaration name="minDiff" type="double" line="2399"/>
                <scope line="2400"/>
                <scope line="2404"/>
            </method>
            <method name="caller" type="String" line="2430">
                <params>
                    <param name="n" type="int"/>
                </params>
                <declaration name="t" type="Throwable" line="2431"/>
                <declaration name="elements" type="StackTraceElement[]" line="2432"/>
                <declaration name="e" type="StackTraceElement" line="2433"/>
            </method>
            <method name="printState" type="void" line="2437">
                <params>
                    <param name="s" type="int"/>
                </params>
                <comment line="2438">
                    System.out.println(caller(2) + &quot;: state &quot; + s);                    
                </comment>
            </method>
            <method name="printMethod" type="void" line="2441">
                <comment line="2442">
                    System.out.println(caller(2));                    
                </comment>
            </method>
            <class name="PathIsExploredException" line="2445">
                <extends class="RuntimeException"/>
                <javadoc line="2445">
                    Marker for code paths that are not explored with the current unit tests.
                      If the path becomes explored, it should just be removed from the code.                    
                </javadoc>
                <declaration name="serialVersionUID" type="long" line="2450"/>
                <declaration name="PATH_IS_EXPLORED" type="String" line="2452"/>
                <method name="PathIsExploredException" type="constructor" line="2455"/>
            </class>
        </class>
    </source>