<?xml version="1.0" encoding="UTF-8"?>
    <source package="org.apache.commons.math3.fitting.leastsquares">
        <import package="org.apache.commons.math3.linear.ArrayRealVector"/>
        <import package="org.apache.commons.math3.linear.DiagonalMatrix"/>
        <import package="org.apache.commons.math3.linear.RealVector"/>
        <import package="org.apache.commons.math3.stat.descriptive.StatisticalSummary"/>
        <import package="org.apache.commons.math3.stat.descriptive.SummaryStatistics"/>
        <import package="org.apache.commons.math3.util.FastMath"/>
        <import package="org.junit.Assert"/>
        <import package="org.junit.Test"/>
        <import package="java.awt.geom.Point2D"/>
        <import package="java.util.ArrayList"/>
        <import package="java.util.List"/>
        <class name="EvaluationTestValidation" line="29">
            <javadoc line="29">
                This class demonstrates the main functionality of the{@link LeastSquaresProblem.Evaluation}, common to the
                  optimizer implementations in package{@link org.apache.commons.math3.fitting.leastsquares}.
                  &lt;br/&gt;
                  Not enabled by default, as the class name does not end with &quot;Test&quot;.
                  &lt;br/&gt;
                  Invoke by running
                  &lt;pre&gt;&lt;code&gt;
                  mvn test -Dtest=EvaluationTestValidation
                  &lt;/code&gt;&lt;/pre&gt;
                  or by running
                  &lt;pre&gt;&lt;code&gt;
                  mvn test -Dtest=EvaluationTestValidation -DargLine=&quot;-DmcRuns=1234 -server&quot;
                  &lt;/code&gt;&lt;/pre&gt;                
            </javadoc>
            <declaration name="MONTE_CARLO_RUNS" type="int" line="47"/>
            <javadoc line="47">
                Number of runs.                
            </javadoc>
            <javadoc line="51">
                Using a Monte-Carlo procedure, this test checks the error estimations
                  as provided by the square-root of the diagonal elements of the
                  covariance matrix.
                  &lt;br/&gt;
                  The test generates sets of observations, each sampled from
                  a Gaussian distribution.
                  &lt;br/&gt;
                  The optimization problem solved is defined in class{@link StraightLineProblem}.
                  &lt;br/&gt;
                  The output (on stdout) will be a table summarizing the distribution
                  of parameters generated by the Monte-Carlo process and by the direct
                  estimation provided by the diagonal elements of the covariance matrix.                
            </javadoc>
            <method name="testParametersErrorMonteCarloObservations" type="void" line="67">
                <comment line="69">
                    Error on the observations.                    
                </comment>
                <comment line="72">
                    True values of the parameters.                    
                </comment>
                <comment line="76">
                    Samples generator.                    
                </comment>
                <comment line="83">
                    Number of observations.                    
                </comment>
                <comment line="84">
                    XXX Should be a command-line option.                    
                </comment>
                <comment line="85">
                    number of parameters.                    
                </comment>
                <comment line="88">
                    Parameters found for each of Monte-Carlo run.                    
                </comment>
                <comment line="90">
                    Sigma estimations (square-root of the diagonal elements of the
                     covariance matrix), for each Monte-Carlo run.                    
                </comment>
                <comment line="94">
                    Initialize statistics accumulators.                    
                </comment>
                <comment line="102">
                    Monte-Carlo (generates many sets of observations).                    
                </comment>
                <comment line="106">
                    Observations.                    
                </comment>
                <comment line="115">
                    Direct solution (using simple regression).                    
                </comment>
                <comment line="118">
                    Estimation of the standard deviation (diagonal elements of the
                     covariance matrix).                    
                </comment>
                <comment line="124">
                    Accumulate statistics.                    
                </comment>
                <comment line="130">
                    Next Monte-Carlo.                    
                </comment>
                <comment line="134">
                    Print statistics.                    
                </comment>
                <comment line="154">
                    Check the error estimation.                    
                </comment>
                <declaration name="yError" type="double" line="69"/>
                <declaration name="slope" type="double" line="72"/>
                <declaration name="offset" type="double" line="73"/>
                <declaration name="lineGenerator" type="RandomStraightLinePointGenerator" line="76"/>
                <declaration name="numObs" type="int" line="83"/>
                <declaration name="numParams" type="int" line="85"/>
                <declaration name="paramsFoundByDirectSolution" type="SummaryStatistics[]" line="88"/>
                <declaration name="sigmaEstimate" type="SummaryStatistics[]" line="91"/>
                <scope line="94"/>
                <declaration name="init" type="RealVector" line="99"/>
                <declaration name="mcRepeat" type="int" line="102"/>
                <declaration name="mcCount" type="int" line="103"/>
                <scope line="104">
                    <declaration name="obs" type="Point2D.Double[]" line="106"/>
                    <declaration name="problem" type="StraightLineProblem" line="108"/>
                    <scope line="109">
                        <declaration name="p" type="Point2D.Double" line="110"/>
                    </scope>
                    <declaration name="regress" type="double[]" line="115"/>
                    <declaration name="lsp" type="LeastSquaresProblem" line="119"/>
                    <declaration name="sigma" type="RealVector" line="121"/>
                    <scope line="124"/>
                </scope>
                <declaration name="line" type="String" line="134"/>
                <scope line="136">
                    <declaration name="s" type="StatisticalSummary" line="140"/>
                </scope>
                <scope line="154"/>
            </method>
            <javadoc line="161">
                In this test, the set of observations is fixed.
                  Using a Monte-Carlo procedure, it generates sets of parameters,
                  and determine the parameter change that will result in the
                  normalized chi-square becoming larger by one than the value from
                  the best fit solution.
                  &lt;br/&gt;
                  The optimization problem solved is defined in class{@link StraightLineProblem}.
                  &lt;br/&gt;
                  The output (on stdout) will be a list of lines containing:
                  &lt;ul&gt;
                  &lt;li&gt;slope of the straight line,&lt;/li&gt;
                  &lt;li&gt;intercept of the straight line,&lt;/li&gt;
                  &lt;li&gt;chi-square of the solution defined by the above two values.&lt;/li&gt;
                  &lt;/ul&gt;
                  The output is separated into two blocks (with a blank line between
                  them); the first block will contain all parameter sets for which{@code chi2 &lt; chi2_b + 1}and the second block, all sets for which{@code chi2 &gt;= chi2_b + 1}where {@code chi2_b} is the lowest chi-square (corresponding to the
                  best solution).                
            </javadoc>
            <method name="testParametersErrorMonteCarloParameters" type="void" line="186">
                <comment line="188">
                    Error on the observations.                    
                </comment>
                <comment line="191">
                    True values of the parameters.                    
                </comment>
                <comment line="195">
                    Samples generator.                    
                </comment>
                <comment line="202">
                    Number of observations.                    
                </comment>
                <comment line="204">
                    number of parameters.                    
                </comment>
                <comment line="207">
                    Create a single set of observations.                    
                </comment>
                <comment line="216">
                    Direct solution (using simple regression).                    
                </comment>
                <comment line="219">
                    Dummy optimizer (to compute the chi-square).                    
                </comment>
                <comment line="223">
                    Get chi-square of the best parameters set for the given set of
                     observations.                    
                </comment>
                <comment line="228">
                    Monte-Carlo (generates a grid of parameters).                    
                </comment>
                <comment line="232">
                    Parameters found for each of Monte-Carlo run.
                     Index 0 = slope
                     Index 1 = offset
                     Index 2 = normalized chi2                    
                </comment>
                <comment line="255">
                    Output (for use with &quot;gnuplot&quot;).                    
                </comment>
                <comment line="257">
                    Some info.                    
                </comment>
                <comment line="259">
                    For plotting separately sets of parameters that have a large chi2.                    
                </comment>
                <comment line="265">
                    Point with smallest chi-square.                    
                </comment>
                <comment line="267">
                    Empty line.                    
                </comment>
                <comment line="269">
                    Points within the confidence interval.                    
                </comment>
                <comment line="275">
                    Empty line.                    
                </comment>
                <comment line="277">
                    Points outside the confidence interval.                    
                </comment>
                <comment line="284">
                    Empty line.                    
                </comment>
                <declaration name="yError" type="double" line="188"/>
                <declaration name="slope" type="double" line="191"/>
                <declaration name="offset" type="double" line="192"/>
                <declaration name="lineGenerator" type="RandomStraightLinePointGenerator" line="195"/>
                <declaration name="numObs" type="int" line="202"/>
                <declaration name="numParams" type="int" line="204"/>
                <declaration name="obs" type="Point2D.Double[]" line="207"/>
                <declaration name="problem" type="StraightLineProblem" line="209"/>
                <scope line="210">
                    <declaration name="p" type="Point2D.Double" line="211"/>
                </scope>
                <declaration name="regress" type="RealVector" line="216"/>
                <declaration name="lsp" type="LeastSquaresProblem" line="219"/>
                <declaration name="init" type="double[]" line="221"/>
                <declaration name="bestChi2N" type="double" line="224"/>
                <declaration name="sigma" type="RealVector" line="225"/>
                <declaration name="mcRepeat" type="int" line="228"/>
                <declaration name="gridSize" type="int" line="229"/>
                <declaration name="paramsAndChi2" type="List&amp;lt;double[]&amp;gt;" line="235"/>
                <declaration name="slopeRange" type="double" line="237"/>
                <declaration name="offsetRange" type="double" line="238"/>
                <declaration name="minSlope" type="double" line="239"/>
                <declaration name="minOffset" type="double" line="240"/>
                <declaration name="deltaSlope" type="double" line="241"/>
                <declaration name="deltaOffset" type="double" line="242"/>
                <scope line="243">
                    <declaration name="s" type="double" line="244"/>
                    <scope line="245">
                        <declaration name="o" type="double" line="246"/>
                        <declaration name="chi2N" type="double" line="247"/>
                    </scope>
                </scope>
                <declaration name="chi2NPlusOne" type="double" line="259"/>
                <declaration name="numLarger" type="int" line="260"/>
                <declaration name="lineFmt" type="String" line="262"/>
                <scope line="269">
                    <scope line="270"/>
                </scope>
                <scope line="277">
                    <scope line="278"/>
                </scope>
            </method>
            <method name="builder" type="LeastSquaresBuilder" line="289">
                <params>
                    <param name="problem" type="StraightLineProblem"/>
                </params>
                <comment line="295">
                    unused start point to avoid NPE                    
                </comment>
            </method>
            <javadoc line="297">
                @return the normalized chi-square.                
            </javadoc>
            <method name="getChi2N" type="double" line="301">
                <params>
                    <param name="lsp" type="LeastSquaresProblem"/>
                    <param name="params" type="RealVector"/>
                </params>
                <declaration name="cost" type="double" line="302"/>
            </method>
        </class>
    </source>