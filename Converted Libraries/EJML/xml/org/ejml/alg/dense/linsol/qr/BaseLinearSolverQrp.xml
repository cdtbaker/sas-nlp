<?xml version="1.0" encoding="UTF-8"?>
    <source package="org.ejml.alg.dense.linsol.qr">
        <import package="org.ejml.UtilEjml"/>
        <import package="org.ejml.alg.dense.decomposition.TriangularSolver"/>
        <import package="org.ejml.alg.dense.linsol.LinearSolverAbstract"/>
        <import package="org.ejml.alg.dense.linsol.LinearSolverSafe"/>
        <import package="org.ejml.data.DenseMatrix64F"/>
        <import package="org.ejml.factory.LinearSolverFactory"/>
        <import package="org.ejml.interfaces.decomposition.QRPDecomposition"/>
        <import package="org.ejml.interfaces.linsol.LinearSolver"/>
        <import package="org.ejml.ops.CommonOps"/>
        <import package="org.ejml.ops.SpecializedOps"/>
        <class name="BaseLinearSolverQrp" line="32">
            <extends class="LinearSolverAbstract"/>
            <comment line="74">
                if true then only the basic solution will be found                
            </comment>
            <comment line="80">
                stores sub-matrices inside the R matrix                
            </comment>
            <comment line="83">
                store an identity matrix for computing the inverse                
            </comment>
            <comment line="86">
                rank of the system matrix                
            </comment>
            <comment line="91">
                used to compute optimal 2-norm solution                
            </comment>
            <javadoc line="32">
                &lt;p&gt;
                  Base class for QR pivot based pseudo inverse classes.  It will return either the
                  basic of minimal 2-norm solution. See [1] for details.  The minimal 2-norm solution refers to the solution
                  &apos;x&apos; whose 2-norm is the smallest making it unique, not some other error function.
                  &lt;/p&gt;
                  &lt;p&gt;
                  &lt;pre&gt;
                  R = [ R12  R12 ] r      P^Tx = [ y ] r       Q^Tb = [ c ] r
                  [  0    0  ] m-r            [ z ] n -r            [ d ] m-r
                  r   n-r
                  where r is the rank of the matrix and (m,n) is the dimension of the linear system.
                  &lt;/pre&gt;
                  &lt;/p&gt;
                  &lt;p&gt;
                  &lt;pre&gt;
                  The solution &apos;x&apos; is found by solving the system below.  The basic solution is found by setting z=0
                  [ R_11^-1(c - R12z) ]
                  x = [          z          ]
                  &lt;/pre&gt;
                  &lt;/p&gt;
                  &lt;p&gt;
                  NOTE: The matrix rank is determined using the provided QR decomposition. [1] mentions that this will not always
                  work and could cause some problems.
                  &lt;/p&gt;
                  &lt;p&gt;
                  [1] See page 258-259 in Gene H. Golub and Charles F. Van Loan &quot;Matrix Computations&quot; 3rd Ed, 1996
                  &lt;/p&gt;                
                <author>
                    Peter Abeles                    
                </author>
            </javadoc>
            <declaration name="decomposition" type="QRPDecomposition&amp;lt;DenseMatrix64F&amp;gt;" line="71"/>
            <declaration name="norm2Solution" type="boolean" line="74"/>
            <declaration name="Y" type="DenseMatrix64F" line="76"/>
            <declaration name="R" type="DenseMatrix64F" line="77"/>
            <declaration name="R11" type="DenseMatrix64F" line="80"/>
            <declaration name="I" type="DenseMatrix64F" line="83"/>
            <declaration name="rank" type="int" line="86"/>
            <declaration name="internalSolver" type="LinearSolver&amp;lt;DenseMatrix64F&amp;gt;" line="88"/>
            <declaration name="W" type="DenseMatrix64F" line="91"/>
            <javadoc line="93">
                Configures internal parameters.                
                <param>
                    decomposition Used to solve the linear system.                    
                </param>
                <param>
                    norm2Solution If true then the optimal 2-norm solution will be computed for degenerate systems.                    
                </param>
            </javadoc>
            <method name="BaseLinearSolverQrp" type="constructor" line="101">
                <params>
                    <param name="decomposition" type="QRPDecomposition&lt;DenseMatrix64F&gt;"/>
                    <param name="norm2Solution" type="boolean"/>
                </params>
            </method>
            <method name="setA" type="boolean" line="110">
                <params>
                    <param name="A" type="DenseMatrix64F"/>
                </params>
                <comment line="124">
                    extract the r11 triangle sub matrix                    
                </comment>
                <comment line="129">
                    extract the R12 sub-matrix                    
                </comment>
                <comment line="133">
                    W=inv(R11)*R12                    
                </comment>
                <comment line="136">
                    set the identity matrix in the upper portion                    
                </comment>
                <scope line="127">
                    <scope line="138">
                        <scope line="139"/>
                    </scope>
                </scope>
            </method>
            <method name="quality" type="double" line="152"/>
            <javadoc line="156">
                &lt;p&gt;
                  Upgrades the basic solution to the optimal 2-norm solution.
                  &lt;/p&gt;
                  &lt;pre&gt;
                  First solves for &apos;z&apos;
                  || x_b - P[ R_11^-1  R_12 ]  z ||2
                  min z ||         [ - I_{n-r}      ]     ||
                  &lt;/pre&gt;                
                <param>
                    X basic solution, also output solution                    
                </param>
            </javadoc>
            <method name="upgradeSolution" type="void" line="171">
                <params>
                    <param name="X" type="DenseMatrix64F"/>
                </params>
                <comment line="173">
                    recycle Y                    
                </comment>
                <comment line="175">
                    compute the z which will minimize the 2-norm of X
                     because of the identity matrix tacked onto the end &apos;A&apos; should never be singular                    
                </comment>
                <comment line="182">
                    compute X by tweaking the original                    
                </comment>
                <declaration name="z" type="DenseMatrix64F" line="172"/>
            </method>
            <method name="invert" type="void" line="186">
                <params>
                    <param name="A_inv" type="DenseMatrix64F"/>
                </params>
            </method>
        </class>
    </source>