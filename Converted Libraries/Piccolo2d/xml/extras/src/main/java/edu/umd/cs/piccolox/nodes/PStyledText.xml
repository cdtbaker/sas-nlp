<?xml version="1.0" encoding="UTF-8"?>
    <source package="edu.umd.cs.piccolox.nodes">
        <import package="java.awt.Color"/>
        <import package="java.awt.Font"/>
        <import package="java.awt.FontMetrics"/>
        <import package="java.awt.Graphics2D"/>
        <import package="java.awt.Insets"/>
        <import package="java.awt.font.FontRenderContext"/>
        <import package="java.awt.font.LineBreakMeasurer"/>
        <import package="java.awt.font.TextAttribute"/>
        <import package="java.awt.font.TextLayout"/>
        <import package="java.awt.geom.Line2D"/>
        <import package="java.awt.geom.Rectangle2D"/>
        <import package="java.text.AttributedCharacterIterator"/>
        <import package="java.text.AttributedString"/>
        <import package="java.util.ArrayList"/>
        <import package="java.util.Iterator"/>
        <import package="java.util.List"/>
        <import package="java.util.StringTokenizer"/>
        <import package="javax.swing.text.AttributeSet"/>
        <import package="javax.swing.text.BadLocationException"/>
        <import package="javax.swing.text.DefaultStyledDocument"/>
        <import package="javax.swing.text.Document"/>
        <import package="javax.swing.text.Element"/>
        <import package="javax.swing.text.StyleConstants"/>
        <import package="javax.swing.text.StyleContext"/>
        <import package="edu.umd.cs.piccolo.PNode"/>
        <import package="edu.umd.cs.piccolo.util.PPaintContext"/>
        <class name="PStyledText" line="60">
            <extends class="PNode"/>
            <comment line="542">
                Because swing doesn&apos;t use fractional font metrics by default, we use
                 LineBreakMeasurer to find out where Swing is going to break them                
            </comment>
            <javadoc line="60">
                @author Lance Good                
            </javadoc>
            <declaration name="serialVersionUID" type="long" line="65"/>
            <declaration name="SWING_FRC" type="FontRenderContext" line="67"/>
            <javadoc line="67">
                Font rendering context used for all PStyledText instances.                
            </javadoc>
            <declaration name="paintLine" type="Line2D" line="70"/>
            <javadoc line="70">
                Used while painting underlines.                
            </javadoc>
            <declaration name="document" type="Document" line="73"/>
            <javadoc line="73">
                Underlying document used to handle the complexities involved with
                  arbitrary text and formatting.                
            </javadoc>
            <declaration name="stringContents" type="ArrayList" line="79"/>
            <javadoc line="79">
                String contents of the document.                
            </javadoc>
            <declaration name="lines" type="LineInfo[]" line="82"/>
            <javadoc line="82">
                Tracks the information about line metrics within the document.                
            </javadoc>
            <declaration name="editing" type="boolean" line="85"/>
            <javadoc line="85">
                Whether this node is currently being edited.                
            </javadoc>
            <declaration name="insets" type="Insets" line="88"/>
            <javadoc line="88">
                Insets represent how far away from the bounding box text will be drawn.                
            </javadoc>
            <declaration name="constrainHeightToTextHeight" type="boolean" line="91"/>
            <javadoc line="91">
                Whether width will be forced to match containing text&apos;s height.                
            </javadoc>
            <declaration name="constrainWidthToTextWidth" type="boolean" line="94"/>
            <javadoc line="94">
                Whether width will be forced to match containing text&apos;s width.                
            </javadoc>
            <javadoc line="97">
                Constructs an empty PStyledText element.                
            </javadoc>
            <method name="PStyledText" type="constructor" line="100"/>
            <javadoc line="103">
                Controls whether this node changes its width to fit the width of its
                  text. If flag is true it does; if flag is false it doesn&apos;t                
                <param>
                    constrainWidthToTextWidth whether node&apos;s width should be
                      constrained to the width of its text                    
                </param>
            </javadoc>
            <method name="setConstrainWidthToTextWidth" type="void" line="110">
                <params>
                    <param name="constrainWidthToTextWidth" type="boolean"/>
                </params>
            </method>
            <javadoc line="115">
                Controls whether this node changes its height to fit the height of its
                  text. If flag is true it does; if flag is false it doesn&apos;t                
                <param>
                    constrainHeightToTextHeight whether node&apos;s height should be
                      constrained to the height of its text                    
                </param>
            </javadoc>
            <method name="setConstrainHeightToTextHeight" type="void" line="122">
                <params>
                    <param name="constrainHeightToTextHeight" type="boolean"/>
                </params>
            </method>
            <javadoc line="127">
                Controls whether this node changes its width to fit the width of its
                  text. If flag is true it does; if flag is false it doesn&apos;t                
                <return>
                    true if node is constrained to the width of its text                    
                </return>
            </javadoc>
            <method name="getConstrainWidthToTextWidth" type="boolean" line="133"/>
            <javadoc line="137">
                Controls whether this node changes its height to fit the height of its
                  text. If flag is true it does; if flag is false it doesn&apos;t                
                <return>
                    true if node is constrained to the height of its text                    
                </return>
            </javadoc>
            <method name="getConstrainHeightToTextHeight" type="boolean" line="143"/>
            <javadoc line="147">
                Get the document for this PStyledText. Document is used as the node&apos;s
                  model.                
                <return>
                    internal document used as a model of this PStyledText                    
                </return>
            </javadoc>
            <method name="getDocument" type="Document" line="153"/>
            <javadoc line="157">
                Set the document on this PStyledText. Document is used as the node&apos;s
                  model.                
                <param>
                    document to be used as the model for this PStyledText                    
                </param>
            </javadoc>
            <method name="setDocument" type="void" line="163">
                <params>
                    <param name="document" type="Document"/>
                </params>
                <comment line="165">
                    Save the document                    
                </comment>
            </method>
            <javadoc line="170">
                Enforce that the current display matches the styling of the underlying
                  document as closely as possible.                
            </javadoc>
            <method name="syncWithDocument" type="void" line="174">
                <comment line="176">
                    First get the actual text and stick it in an Attributed String                    
                </comment>
                <comment line="184">
                    Since this the location we&apos;re providing comes from directly
                     querying the document, this is impossible in a single threaded
                     model                    
                </comment>
                <comment line="190">
                    The paragraph start and end indices                    
                </comment>
                <comment line="193">
                    The default style context - which will be reused                    
                </comment>
                <comment line="208">
                    The current element will be used as a temp variable while
                     searching for the leaf element at the current position                    
                </comment>
                <comment line="212">
                    Small assumption here that there is one root element - can fix
                     for more general support later                    
                </comment>
                <comment line="216">
                    If the string is length 0 then we just need to add the attributes
                     once                    
                </comment>
                <comment line="221">
                    These are the mandatory attributes                    
                </comment>
                <comment line="237">
                    OK, now we loop until we find all the leaf elements in the
                     range                    
                </comment>
                <comment line="242">
                    These are the mandatory attributes                    
                </comment>
                <comment line="257">
                    And set the position to the end of the given attribute                    
                </comment>
                <declaration name="documentString" type="String" line="178"/>
                <scope line="179"/>
                <scope line="182"/>
                <declaration name="pEnds" type="ArrayList" line="190"/>
                <declaration name="styleContext" type="StyleContext" line="193"/>
                <declaration name="pos" type="int" line="195"/>
                <declaration name="paragraphRange" type="RunInfo" line="196"/>
                <declaration name="attributedString" type="AttributedString" line="198"/>
                <declaration name="contentIterator" type="Iterator" line="200"/>
                <declaration name="paragraphIterator" type="Iterator" line="201"/>
                <scope line="202">
                    <declaration name="curElement" type="Element" line="209"/>
                    <declaration name="rootElement" type="Element" line="213"/>
                    <scope line="217">
                        <declaration name="attributes" type="AttributeSet" line="221"/>
                        <declaration name="foreground" type="Color" line="222"/>
                        <declaration name="font" type="Font" line="229"/>
                    </scope>
                    <scope line="235">
                        <scope line="238">
                            <declaration name="attributes" type="AttributeSet" line="242"/>
                            <declaration name="foreground" type="Color" line="243"/>
                            <declaration name="font" type="Font" line="250"/>
                        </scope>
                    </scope>
                </scope>
            </method>
            <javadoc line="265">
                Returns the first leaf encountered by drilling into the document for the
                  given position.                
                <param>
                    pos position under which we&apos;re trying to find a leaf                    
                </param>
                <param>
                    rootElement top most element in the document tree                    
                </param>
                <return>
                    Leaf element that corresponds to the position provided in the
                      document                    
                </return>
            </javadoc>
            <method name="drillDownFromRoot" type="Element" line="275">
                <params>
                    <param name="pos" type="int"/>
                    <param name="rootElement" type="Element"/>
                </params>
                <comment line="277">
                    Before each pass, start at the root                    
                </comment>
                <comment line="280">
                    Now we descend the hierarchy until we get to a leaf                    
                </comment>
                <declaration name="curElement" type="Element" line="277"/>
                <scope line="280"/>
            </method>
            <method name="applyFontAttribute" type="void" line="288">
                <params>
                    <param name="paragraphRange" type="RunInfo"/>
                    <param name="attributedString" type="AttributedString"/>
                    <param name="curElement" type="Element"/>
                    <param name="font" type="Font"/>
                </params>
                <scope line="289"/>
            </method>
            <method name="applyStrikeThroughAttribute" type="void" line="297">
                <params>
                    <param name="paragraphRange" type="RunInfo"/>
                    <param name="attributedString" type="AttributedString"/>
                    <param name="curElement" type="Element"/>
                    <param name="attributes" type="AttributeSet"/>
                </params>
                <declaration name="strikethrough" type="boolean" line="298"/>
                <scope line="299"/>
            </method>
            <method name="applyUnderlineAttribute" type="void" line="308">
                <params>
                    <param name="paragraphRange" type="RunInfo"/>
                    <param name="attributedString" type="AttributedString"/>
                    <param name="curElement" type="Element"/>
                    <param name="attributes" type="AttributeSet"/>
                </params>
                <declaration name="underline" type="boolean" line="309"/>
                <scope line="310"/>
            </method>
            <method name="applyBackgroundAttribute" type="void" line="319">
                <params>
                    <param name="style" type="StyleContext"/>
                    <param name="paragraphRange" type="RunInfo"/>
                    <param name="attributedString" type="AttributedString"/>
                    <param name="curElement" type="Element"/>
                    <param name="attributes" type="AttributeSet"/>
                </params>
                <scope line="320">
                    <declaration name="background" type="Color" line="321"/>
                </scope>
            </method>
            <method name="extractFont" type="Font" line="329">
                <params>
                    <param name="style" type="StyleContext"/>
                    <param name="pos" type="int"/>
                    <param name="rootElement" type="Element"/>
                    <param name="attributes" type="AttributeSet"/>
                </params>
                <declaration name="font" type="Font" line="330"/>
                <scope line="331"/>
                <scope line="335">
                    <scope line="336"/>
                    <scope line="339"/>
                </scope>
            </method>
            <method name="extractFontFromDefaultStyledDocument" type="Font" line="347">
                <params>
                    <param name="styledDocument" type="DefaultStyledDocument"/>
                    <param name="style" type="StyleContext"/>
                    <param name="pos" type="int"/>
                    <param name="rootElement" type="Element"/>
                </params>
                <declaration name="font" type="Font" line="348"/>
                <scope line="349">
                    <scope line="351"/>
                </scope>
            </method>
            <method name="extractParagraphRanges" type="ArrayList" line="358">
                <params>
                    <param name="documentString" type="String"/>
                </params>
                <comment line="360">
                    The paragraph start and end indices                    
                </comment>
                <comment line="363">
                    The current position in the specified range                    
                </comment>
                <comment line="368">
                    lastNewLine is used to detect the case when two newlines follow
                     in direct succession
                     &amp; lastNewLine should be true to start in case the first character
                     is a newline                    
                </comment>
                <comment line="377">
                    If the token                    
                </comment>
                <comment line="388">
                    If the token is empty - create an attributed string with a
                     single space since LineBreakMeasurers don&apos;t work with an empty
                     string
                     - note that this case should only arise if the document is empty                    
                </comment>
                <comment line="398">
                    This is the normal case - where we have some text                    
                </comment>
                <comment line="403">
                    Increment the position                    
                </comment>
                <comment line="410">
                    Add one more newline if the last character was a newline                    
                </comment>
                <declaration name="paragraphRanges" type="ArrayList" line="360"/>
                <declaration name="pos" type="int" line="363"/>
                <declaration name="tokenizer" type="StringTokenizer" line="365"/>
                <declaration name="lastNewLine" type="boolean" line="371"/>
                <scope line="373">
                    <declaration name="token" type="String" line="374"/>
                    <scope line="377">
                        <scope line="378"/>
                    </scope>
                    <scope line="391"/>
                    <scope line="398"/>
                </scope>
                <scope line="410"/>
            </method>
            <javadoc line="418">
                Compute the bounds of the text wrapped by this node. The text layout is
                  wrapped based on the bounds of this node. If the shrinkBoundsToFit
                  parameter is true then after the text has been laid out the bounds of
                  this node are shrunk to fit around those text bounds.                
            </javadoc>
            <method name="recomputeLayout" type="void" line="424">
                <comment line="449">
                    Need to change the lineinfo data structure to know about multiple
                     text layouts per line                    
                </comment>
                <comment line="466">
                    Now create a new line                    
                </comment>
                <scope line="425"/>
                <declaration name="linesList" type="ArrayList" line="429"/>
                <declaration name="textWidth" type="double" line="431"/>
                <declaration name="textHeight" type="double" line="432"/>
                <declaration name="contentIterator" type="Iterator" line="434"/>
                <scope line="436">
                    <declaration name="ats" type="AttributedString" line="437"/>
                    <declaration name="itr" type="AttributedCharacterIterator" line="438"/>
                    <declaration name="measurer" type="LineBreakMeasurer" line="440"/>
                    <declaration name="breakList" type="ArrayList" line="441"/>
                    <declaration name="lineInfo" type="LineInfo" line="451"/>
                    <declaration name="newLine" type="boolean" line="452"/>
                    <declaration name="lineWidth" type="double" line="453"/>
                    <scope line="454">
                        <declaration name="aTextLayout" type="TextLayout" line="455"/>
                        <scope line="457">
                            <declaration name="lineHeight" type="double" line="460"/>
                        </scope>
                        <declaration name="lineEnd" type="int" line="470"/>
                        <scope line="471"/>
                        <declaration name="sInfo" type="SegmentInfo" line="478"/>
                        <declaration name="metrics" type="FontMetrics" line="485"/>
                    </scope>
                    <declaration name="lineHeight" type="double" line="497"/>
                </scope>
            </method>
            <javadoc line="507">
                @param lineInfo                
                <return>
                                        
                </return>
            </javadoc>
            <method name="calculateLineHeightFromLineInfo" type="double" line="511">
                <params>
                    <param name="lineInfo" type="LineInfo"/>
                </params>
                <declaration name="lineHeight" type="double" line="512"/>
                <scope line="513"/>
                <scope line="516"/>
            </method>
            <method name="constrainDimensionsIfNeeded" type="void" line="522">
                <params>
                    <param name="textWidth" type="double"/>
                    <param name="textHeight" type="double"/>
                </params>
                <scope line="523"/>
                <declaration name="newWidth" type="double" line="527"/>
                <declaration name="newHeight" type="double" line="528"/>
                <scope line="530"/>
                <scope line="534"/>
            </method>
            <method name="extractLineBreaks" type="ArrayList" line="543">
                <params>
                    <param name="itr" type="AttributedCharacterIterator"/>
                    <param name="measurer" type="LineBreakMeasurer"/>
                </params>
                <declaration name="breakList" type="ArrayList" line="544"/>
                <scope line="546">
                    <scope line="547"/>
                    <scope line="550"/>
                </scope>
            </method>
            <javadoc line="559">
                Get the height of the font at the beginning of the document.                
                <return>
                    height of font at the start of the document.                    
                </return>
            </javadoc>
            <method name="getInitialFontHeight" type="double" line="564">
                <comment line="567">
                    Small assumption here that there is one root element - can fix
                     for more general support later                    
                </comment>
                <declaration name="rootElement" type="Element" line="568"/>
                <declaration name="curElement" type="Element" line="569"/>
                <declaration name="context" type="StyleContext" line="570"/>
                <declaration name="font" type="Font" line="571"/>
                <declaration name="curFM" type="FontMetrics" line="573"/>
            </method>
            <javadoc line="578">
                {@inheritDoc}                
            </javadoc>
            <method name="paint" type="void" line="579">
                <params>
                    <param name="paintContext" type="PPaintContext"/>
                </params>
                <comment line="619">
                    Manually set the paint - this is specified in the
                     AttributedString but seems to be
                     ignored by the TextLayout. To handle multiple colors we
                     should be breaking up the lines
                     but that functionality can be added later as needed                    
                </comment>
                <comment line="627">
                    Draw the underline and the strikethrough after the text                    
                </comment>
                <scope line="580"/>
                <declaration name="x" type="float" line="584"/>
                <declaration name="y" type="float" line="585"/>
                <declaration name="bottomY" type="float" line="586"/>
                <declaration name="g2" type="Graphics2D" line="588"/>
                <scope line="590"/>
                <declaration name="curX" type="float" line="595"/>
                <declaration name="lineInfo" type="LineInfo" line="596"/>
                <scope line="597">
                    <scope line="602"/>
                    <scope line="606">
                        <declaration name="sInfo" type="SegmentInfo" line="607"/>
                        <declaration name="width" type="float" line="608"/>
                        <scope line="610"/>
                        <scope line="627"/>
                    </scope>
                </scope>
            </method>
            <javadoc line="639">
                {@inheritDoc}                
            </javadoc>
            <method name="fullPaint" type="void" line="642">
                <params>
                    <param name="paintContext" type="PPaintContext"/>
                </params>
                <scope line="643"/>
            </method>
            <javadoc line="648">
                Set whether this node is current in editing mode.                
                <param>
                    editing value to set editing flag                    
                </param>
            </javadoc>
            <method name="setEditing" type="void" line="653">
                <params>
                    <param name="editing" type="boolean"/>
                </params>
            </method>
            <javadoc line="657">
                Whether node is currently in editing state.                
                <return>
                    true if node is currently editing                    
                </return>
            </javadoc>
            <method name="isEditing" type="boolean" line="662"/>
            <javadoc line="666">
                Set the insets of the text.                
                <param>
                    insets desired insets                    
                </param>
            </javadoc>
            <method name="setInsets" type="void" line="671">
                <params>
                    <param name="insets" type="Insets"/>
                </params>
                <scope line="672"/>
            </method>
            <javadoc line="682">
                Get the insets of the text.                
                <return>
                    current text insets                    
                </return>
            </javadoc>
            <method name="getInsets" type="Insets" line="687"/>
            <javadoc line="691">
                {@inheritDoc}                
            </javadoc>
            <method name="setBounds" type="boolean" line="692">
                <params>
                    <param name="x" type="double"/>
                    <param name="y" type="double"/>
                    <param name="width" type="double"/>
                    <param name="height" type="double"/>
                </params>
                <scope line="693"/>
            </method>
            <class name="RunInfo" line="701">
                <javadoc line="701">
                    Simple class to represent an range within the document.                    
                </javadoc>
                <declaration name="startIndex" type="int" line="705"/>
                <declaration name="endIndex" type="int" line="706"/>
                <javadoc line="708">
                    Constructs a RunInfo representing the range within the document from
                      runStart to runLimit.                    
                    <param>
                        runStart starting index of the range                        
                    </param>
                    <param>
                        runLimit ending index of the range                        
                    </param>
                </javadoc>
                <method name="RunInfo" type="constructor" line="715">
                    <params>
                        <param name="runStart" type="int"/>
                        <param name="runLimit" type="int"/>
                    </params>
                </method>
                <javadoc line="720">
                    Returns whether the run is empty.                    
                    <return>
                        true is run is empty                        
                    </return>
                </javadoc>
                <method name="isEmpty" type="boolean" line="725"/>
                <javadoc line="729">
                    Returns the length of the run.                    
                    <return>
                        length of run                        
                    </return>
                </javadoc>
                <method name="length" type="int" line="734"/>
            </class>
            <class name="LineInfo" line="739">
                <javadoc line="739">
                    The info for rendering and computing the bounds of a line.                    
                </javadoc>
                <declaration name="segments" type="List" line="743"/>
                <javadoc line="743">
                    Segments which make up this line&apos;s formatting segments.                    
                </javadoc>
                <declaration name="maxAscent" type="double" line="746"/>
                <javadoc line="746">
                    Maximum of the line segments&apos; ascents.                    
                </javadoc>
                <declaration name="maxDescent" type="double" line="749"/>
                <javadoc line="749">
                    Maximum of the line segments&apos; descents.                    
                </javadoc>
                <declaration name="leading" type="double" line="752"/>
                <javadoc line="752">
                    Leading space at front of line segment.                    
                </javadoc>
                <javadoc line="755">
                    Creates a LineInfo that contains no segments.                    
                </javadoc>
                <method name="LineInfo" type="constructor" line="758"/>
            </class>
            <class name="SegmentInfo" line="763">
                <javadoc line="763">
                    Encapsulates information about a particular LineSegment.                    
                </javadoc>
                <declaration name="layout" type="TextLayout" line="767"/>
                <javadoc line="767">
                    Text Layout applied to the segment.                    
                </javadoc>
                <declaration name="font" type="Font" line="770"/>
                <javadoc line="770">
                    Font being used to render the segment.                    
                </javadoc>
                <declaration name="foreground" type="Color" line="773"/>
                <javadoc line="773">
                    Foreground (text) color of the segment.                    
                </javadoc>
                <declaration name="background" type="Color" line="776"/>
                <javadoc line="776">
                    Background color of the segment.                    
                </javadoc>
                <declaration name="underline" type="Boolean" line="779"/>
                <javadoc line="779">
                    Whether the segment is underlined.                    
                </javadoc>
                <javadoc line="782">
                    Construct a segment with null properties.                    
                </javadoc>
                <method name="SegmentInfo" type="constructor" line="783"/>
                <javadoc line="786">
                    Applies this particular SegmentInfo&apos;s font to the graphics object
                      passed in.                    
                    <param>
                        g2 will have the font of this segment applied                        
                    </param>
                </javadoc>
                <method name="applyFont" type="void" line="792">
                    <params>
                        <param name="g2" type="Graphics2D"/>
                    </params>
                    <scope line="793"/>
                </method>
            </class>
        </class>
    </source>