<?xml version="1.0" encoding="UTF-8"?>
<source package="edu.umd.cs.piccolo.examples">
  <import name="edu.umd.cs.piccolo.PLayer" />
  <import name="edu.umd.cs.piccolo.PNode" />
  <import name="edu.umd.cs.piccolo.activities.PActivity" />
  <import name="edu.umd.cs.piccolo.nodes.PPath" />
  <import name="edu.umd.cs.piccolox.PFrame" />
  <import name="javax.swing.*" />
  <import name="java.awt.event.ActionEvent" />
  <import name="java.awt.event.ActionListener" />
  <import name="java.lang.ref.WeakReference" />
  <class name="ActivityMemoryLeakBugExample" extends="PFrame" startLine="42">
    <javadoc>
      <text>* Example that demonstrates the memory leak in Issue 185.
 * <p>
 * Memory leak - PActivityScheduler keeps processed activities in reference<br/>
 * <a href="http://code.google.com/p/piccolo2d/issues/detail?id=185">http://code.google.com/p/piccolo2d/issues/detail?id=185</a>
 * </p></text>
    </javadoc>
    <method type="void" name="main" startLine="51" endLine="53" />
    <javadoc>
      <text>* {@inheritDoc}</text>
    </javadoc>
    <method type="void" name="initialize" startLine="56" endLine="80">
      <declaration type="PLayer" name="layer" />
      <declaration type="PNode" name="node" />
      <declaration type="WeakReference" name="ref" />
      <method type="void" name="actionPerformed" startLine="67" endLine="76" />
      <comment>Create the node that we expect to get garbage collected.</comment>
      <comment>Create a WeakReference to the node so we can detect if it is gc'd.</comment>
      <comment>Create and execute an activity.</comment>
      <comment>Create a Timer that will start after the activity and repeat.</comment>
      <comment>Remove our reference to the node.</comment>
      <comment>Force garbage collection.</comment>
      <comment>This should print null if the node was successfully gc'd. (IT never does.)</comment>
      <comment>This prints 0 as expected.</comment>
      <comment>This will cause any previous activity references to clear.</comment>
    </method>
    <method type="void" name="forceCleanupOfPriorActivities" startLine="82" endLine="107">
      <javadoc>
        <text>* {@inheritDoc}</text>
      </javadoc>
      <method type="void" name="run" startLine="85" endLine="105">
        <scope startLine="87" endLine="89" />
        <scope startLine="90" endLine="92">
          <comment>empty</comment>
        </scope>
        <method type="void" name="run" startLine="95" endLine="103">
          <declaration type="PActivity" name="a" />
          <method type="void" name="activityStep" startLine="97" endLine="100" />
        </method>
      </method>
      <comment>Wait 6 seconds before doing the cleanup so the bug can be witnessed.</comment>
    </method>
  </class>
</source>
